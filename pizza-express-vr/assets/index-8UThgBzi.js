import{r as e,a as t,R as n}from"./react-vendor-DENY9G7l.js";import{T as r,a as o,b as s,L as i,c as a,F as l,M as c,V as d,C as p,d as u,S as h,e as f,P as m,D as g,f as x,g as y,I as b,Q as v,h as w,O as S,i as T,j as z,B as R,k as A,l as E,N as k,m as M,n as D,o as C,p as j,R as P,q as I,r as L,s as _,t as N,u as F,v as O,w as B,x as H,y as U,z as G,A as W,E as $,G as V,H as X,J as K,K as q,U as Y,W as J,X as Z,Y as Q,Z as ee,_ as te,$ as ne,a0 as re,a1 as oe,a2 as se,a3 as ie,a4 as ae,a5 as le,a6 as ce,a7 as de,a8 as pe,a9 as ue,aa as he,ab as fe,ac as me,ad as ge,ae as xe,af as ye,ag as be,ah as ve,ai as we,aj as Se,ak as Te,al as ze,am as Re,an as Ae,ao as Ee,ap as ke,aq as Me,ar as De,as as Ce,at as je,au as Pe,av as Ie,aw as Le,ax as _e}from"./three-qqiv_Kag.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Ne={exports:{}},Fe={},Oe=e,Be=Symbol.for("react.element"),He=Symbol.for("react.fragment"),Ue=Object.prototype.hasOwnProperty,Ge=Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,We={key:!0,ref:!0,__self:!0,__source:!0};function $e(e,t,n){var r,o={},s=null,i=null;for(r in void 0!==n&&(s=""+n),void 0!==t.key&&(s=""+t.key),void 0!==t.ref&&(i=t.ref),t)Ue.call(t,r)&&!We.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:Be,type:e,key:s,ref:i,props:o,_owner:Ge.current}}Fe.Fragment=He,Fe.jsx=$e,Fe.jsxs=$e,Ne.exports=Fe;var Ve=Ne.exports,Xe={},Ke=t;Xe.createRoot=Ke.createRoot,Xe.hydrateRoot=Ke.hydrateRoot;const qe=[{x:-15,z:10,label:"A"},{x:15,z:10,label:"B"},{x:-15,z:-12,label:"C"},{x:15,z:-12,label:"D"}],Ye=[{x:-40,z:40,num:1},{x:40,z:40,num:2},{x:-40,z:-40,num:3},{x:40,z:-40,num:4}],Je=0,Ze=4,Qe=[{id:1,title:"Welcome to Pizza Express VR! üçï",message:"You are a drone pilot delivering pizzas across the city! Each customer has a name and is waiting for their delicious pizza!",highlight:null},{id:2,title:"Pick Up Pizza üì¶",message:"Grab a pizza from the shop. Each pizza has a different price - the more expensive, the bigger tips possible!",highlight:"shop"},{id:3,title:"Carry Carefully üéØ",message:"Tilt meter shows pizza condition. Keep it green! Damaged pizzas = angry customers = no tips!",highlight:"tiltMeter"},{id:4,title:"Climb the Ranks! üèÜ",message:"Earn XP with each delivery! Rise from Trainee to PIZZA GOD! Higher ranks = bigger tip bonuses! But beware - dropping pizzas costs more XP than you earn!",highlight:null},{id:5,title:"Earn Badges üéñÔ∏è",message:"Deliver specific pizza types to unlock badges! Each pizza type has special achievements. Collect them all!",highlight:null},{id:6,title:"Store Earnings üí∞",message:"Every pizza you deliver adds to the store's total earnings! Compete to be the top contributor!",highlight:null},{id:7,title:"Fly Controls ‚úàÔ∏è",message:"Use WASD to move, Space/Shift for altitude, V to switch camera. In VR, use your controllers!",highlight:"controls"},{id:8,title:"Deliver & Get Paid! üöÄ",message:"Land in the green zone and release the pizza! Fast + careful = big tips! Now go make some deliveries!",highlight:"deliveryZone"}],et=8900331,tt=4881468,nt=16729156,rt=16776960,ot=3355443,st=2201331,it=65280,at=4473924,lt=2236962,ct=16750848,dt=16739179;function pt(e,t){if(t===r)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===o||t===s){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,s=[];if(t===o)for(let e=1;e<=r;e++)s.push(n.getX(0)),s.push(n.getX(e)),s.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(s.push(n.getX(e)),s.push(n.getX(e+1)),s.push(n.getX(e+2))):(s.push(n.getX(e+2)),s.push(n.getX(e+1)),s.push(n.getX(e)));s.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(s),i.clearGroups(),i}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class ut extends i{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new yt(e)}),this.register(function(e){return new Et(e)}),this.register(function(e){return new kt(e)}),this.register(function(e){return new Mt(e)}),this.register(function(e){return new vt(e)}),this.register(function(e){return new wt(e)}),this.register(function(e){return new St(e)}),this.register(function(e){return new Tt(e)}),this.register(function(e){return new xt(e)}),this.register(function(e){return new zt(e)}),this.register(function(e){return new bt(e)}),this.register(function(e){return new At(e)}),this.register(function(e){return new Rt(e)}),this.register(function(e){return new mt(e)}),this.register(function(e){return new Dt(e)}),this.register(function(e){return new Ct(e)})}load(e,t,n,r){const o=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=a.extractUrlBase(e);s=a.resolveURL(t,this.path)}else s=a.extractUrlBase(e);this.manager.itemStart(e);const i=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},c=new l(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(n){try{o.parse(n,s,function(n){t(n),o.manager.itemEnd(e)},i)}catch(r){i(r)}},n,i)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let o;const s={},i={},a=new TextDecoder;if("string"==typeof e)o=JSON.parse(e);else if(e instanceof ArrayBuffer){if(a.decode(new Uint8Array(e,0,4))===jt){try{s[ft.KHR_BINARY_GLTF]=new Lt(e)}catch(c){return void(r&&r(c))}o=JSON.parse(s[ft.KHR_BINARY_GLTF].content)}else o=JSON.parse(a.decode(e))}else o=e;if(void 0===o.asset||o.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new ln(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const e=this.pluginCallbacks[d](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),i[e.name]=e,s[e.name]=!0}if(o.extensionsUsed)for(let d=0;d<o.extensionsUsed.length;++d){const e=o.extensionsUsed[d],t=o.extensionsRequired||[];switch(e){case ft.KHR_MATERIALS_UNLIT:s[e]=new gt;break;case ft.KHR_DRACO_MESH_COMPRESSION:s[e]=new _t(o,this.dracoLoader);break;case ft.KHR_TEXTURE_TRANSFORM:s[e]=new Nt;break;case ft.KHR_MESH_QUANTIZATION:s[e]=new Ft;break;default:t.indexOf(e)>=0&&void 0===i[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(s),l.setPlugins(i),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,o){n.parse(e,t,r,o)})}}function ht(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const ft={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class mt{constructor(e){this.parser=e,this.name=ft.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const o=t.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let i;const a=new p(16777215);void 0!==s.color&&a.setRGB(s.color[0],s.color[1],s.color[2],u);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":i=new g(a),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new m(a),i.distance=l;break;case"spot":i=new f(a),i.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,i.angle=s.spot.outerConeAngle,i.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return i.position.set(0,0,0),i.decay=2,tn(i,s),void 0!==s.intensity&&(i.intensity=s.intensity),i.name=t.createUniqueName(s.name||"light_"+e),r=Promise.resolve(i),t.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then(function(e){return n._getNodeRef(t.cache,o,e)})}}class gt{constructor(){this.name=ft.KHR_MATERIALS_UNLIT}getMaterialType(){return H}extendParams(e,t,n){const r=[];e.color=new p(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const t=o.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],u),e.opacity=t[3]}void 0!==o.baseColorTexture&&r.push(n.assignTexture(e,"map",o.baseColorTexture,h))}return Promise.all(r)}}class xt{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class yt{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],s=r.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&o.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(o.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new d(e,e)}return Promise.all(o)}}class bt{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],s=r.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&o.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&o.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(o)}}class vt{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new p(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=r.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],u)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&o.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,h)),void 0!==s.sheenRoughnessTexture&&o.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}}class wt{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&o.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(o)}}class St{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],s=r.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&o.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const i=s.attenuationColor||[1,1,1];return t.attenuationColor=(new p).setRGB(i[0],i[1],i[2],u),Promise.all(o)}}class Tt{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class zt{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],s=r.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&o.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const i=s.specularColorFactor||[1,1,1];return t.specularColor=(new p).setRGB(i[0],i[1],i[2],u),void 0!==s.specularColorTexture&&o.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,h)),Promise.all(o)}}class Rt{constructor(e){this.parser=e,this.name=ft.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],s=r.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&o.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(o)}}class At{constructor(e){this.parser=e,this.name=ft.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],s=r.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&o.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(o)}}class Et{constructor(e){this.parser=e,this.name=ft.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,s)}}class kt{constructor(e){this.parser=e,this.name=ft.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;const s=o.extensions[t],i=r.images[s.source];let a=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(a=e)}return this.detectSupport().then(function(o){if(o)return n.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Mt{constructor(e){this.parser=e,this.name=ft.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;const s=o.extensions[t],i=r.images[s.source];let a=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(a=e)}return this.detectSupport().then(function(o){if(o)return n.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Dt{constructor(e){this.name=ft.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(t){const n=e.byteOffset||0,r=e.byteLength||0,s=e.count,i=e.byteStride,a=new Uint8Array(t,n,r);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(s,i,a,e.mode,e.filter).then(function(e){return e.buffer}):o.ready.then(function(){const t=new ArrayBuffer(s*i);return o.decodeGltfBuffer(new Uint8Array(t),s,i,a,e.mode,e.filter),t})})}return null}}class Ct{constructor(e){this.name=ft.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=t.meshes[n.mesh];for(const a of r.primitives)if(a.mode!==Ut.TRIANGLES&&a.mode!==Ut.TRIANGLE_STRIP&&a.mode!==Ut.TRIANGLE_FAN&&void 0!==a.mode)return null;const o=n.extensions[this.name].attributes,s=[],i={};for(const a in o)s.push(this.parser.getDependency("accessor",o[a]).then(e=>(i[a]=e,i[a])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],r=e[0].count,o=[];for(const s of n){const e=new x,t=new y,n=new v,a=new y(1,1,1),l=new b(s.geometry,s.material,r);for(let o=0;o<r;o++)i.TRANSLATION&&t.fromBufferAttribute(i.TRANSLATION,o),i.ROTATION&&n.fromBufferAttribute(i.ROTATION,o),i.SCALE&&a.fromBufferAttribute(i.SCALE,o),l.setMatrixAt(o,e.compose(t,n,a));for(const r in i)if("_COLOR_0"===r){const e=i[r];l.instanceColor=new w(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&s.geometry.setAttribute(r,i[r]);S.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),o.push(l)}return t.isGroup?(t.clear(),t.add(...o),t):o[0]}))}}const jt="glTF",Pt=1313821514,It=5130562;class Lt{constructor(e){this.name=ft.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==jt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,o=new DataView(e,12);let s=0;for(;s<r;){const t=o.getUint32(s,!0);s+=4;const r=o.getUint32(s,!0);if(s+=4,r===Pt){const r=new Uint8Array(e,12+s,t);this.content=n.decode(r)}else if(r===It){const n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class _t{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ft.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,i={},a={},l={};for(const c in s){const e=Xt[c]||c.toLowerCase();i[e]=s[c]}for(const c in e.attributes){const t=Xt[c]||c.toLowerCase();if(void 0!==s[c]){const r=n.accessors[e.attributes[c]],o=Gt[r.componentType];l[t]=o.name,a[t]=!0===r.normalized}}return t.getDependency("bufferView",o).then(function(e){return new Promise(function(t,n){r.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)},i,l,u,n)})})}}class Nt{constructor(){this.name=ft.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Ft{constructor(){this.name=ft.KHR_MESH_QUANTIZATION}}class Ot extends ue{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let s=0;s!==r;s++)t[s]=n[o+s];return t}interpolate_(e,t,n,r){const o=this.resultBuffer,s=this.sampleValues,i=this.valueSize,a=2*i,l=3*i,c=r-t,d=(n-t)/c,p=d*d,u=p*d,h=e*l,f=h-l,m=-2*u+3*p,g=u-p,x=1-m,y=g-p+d;for(let b=0;b!==i;b++){const e=s[f+b+i],t=s[f+b+a]*c,n=s[h+b+i],r=s[h+b]*c;o[b]=x*e+y*t+m*n+g*r}return o}}const Bt=new v;class Ht extends Ot{interpolate_(e,t,n,r){const o=super.interpolate_(e,t,n,r);return Bt.fromArray(o).normalize().toArray(o),o}}const Ut={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Gt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Wt={9728:j,9729:C,9984:D,9985:M,9986:k,9987:E},$t={33071:L,33648:I,10497:P},Vt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Kt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},qt={CUBICSPLINE:void 0,LINEAR:oe,STEP:re},Yt="OPAQUE",Jt="MASK",Zt="BLEND";function Qt(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new O({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:pe})),e.DefaultMaterial}function en(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function tn(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function nn(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function rn(e){let t;const n=e.extensions&&e.extensions[ft.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+on(n.attributes):e.indices+":"+on(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,o=e.targets.length;r<o;r++)t+=":"+on(e.targets[r]);return t}function on(e){let t="";const n=Object.keys(e).sort();for(let r=0,o=n.length;r<o;r++)t+=n[r]+":"+e[n[r]]+";";return t}function sn(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const an=new x;class ln{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ht,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,o=-1;"undefined"!=typeof navigator&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,o=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||r&&o<98?this.textureLoader=new T(this.options.manager):this.textureLoader=new z(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const s={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};return en(o,s,r),tn(s,r),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,o=t.length;r<o;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let r=0,o=e.length;r<o;r++){const t=e[r];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),o=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[r,s]of e.children.entries())o(s,t.children[r])};return o(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const o=e(t[r]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[ft.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(e,o){n.load(a.resolveURL(t.uri,r.path),e,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=Vt[r.type],t=Gt[r.componentType],n=!0===r.normalized,o=new t(r.count*e);return Promise.resolve(new R(o,e,n))}const o=[];return void 0!==r.bufferView?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),void 0!==r.sparse&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(e){const o=e[0],s=Vt[r.type],i=Gt[r.componentType],a=i.BYTES_PER_ELEMENT,l=a*s,c=r.byteOffset||0,d=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;let u,h;if(d&&d!==l){const e=Math.floor(c/d),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let l=t.cache.get(n);l||(u=new i(o,e*d,r.count*d/a),l=new A(u,d/a),t.cache.add(n,l)),h=new se(l,s,c%d/a,p)}else u=null===o?new i(r.count*s):new i(o,c,r.count*s),h=new R(u,s,p);if(void 0!==r.sparse){const t=Vt.SCALAR,n=Gt[r.sparse.indices.componentType],a=r.sparse.indices.byteOffset||0,l=r.sparse.values.byteOffset||0,c=new n(e[1],a,r.sparse.count*t),d=new i(e[2],l,r.sparse.count*s);null!==o&&(h=new R(h.array.slice(),h.itemSize,h.normalized));for(let e=0,r=c.length;e<r;e++){const t=c[e];if(h.setX(t,d[e*s]),s>=2&&h.setY(t,d[e*s+1]),s>=3&&h.setZ(t,d[e*s+2]),s>=4&&h.setW(t,d[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return h})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let s=this.textureLoader;if(o.uri){const e=n.manager.getHandler(o.uri);null!==e&&(s=e)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){const r=this,o=this.json,s=o.textures[e],i=o.images[t],a=(i.uri||i.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=s.name||i.name||"",""===t.name&&"string"==typeof i.uri&&!1===i.uri.startsWith("data:image/")&&(t.name=i.uri);const n=(o.samplers||{})[s.sampler]||{};return t.magFilter=Wt[n.magFilter]||C,t.minFilter=Wt[n.minFilter]||E,t.wrapS=$t[n.wrapS]||P,t.wrapT=$t[n.wrapT]||P,r.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,r=this.json,o=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const s=r.images[e],i=self.URL||self.webkitURL;let l=s.uri||"",c=!1;if(void 0!==s.bufferView)l=n.getDependency("bufferView",s.bufferView).then(function(e){c=!0;const t=new Blob([e],{type:s.mimeType});return l=i.createObjectURL(t),l});else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(l).then(function(e){return new Promise(function(n,r){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new ie(e);t.needsUpdate=!0,n(t)}),t.load(a.resolveURL(e,o.path),s,void 0,r)})}).then(function(e){var t;return!0===c&&i.revokeObjectURL(l),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e});return this.sourceCache[e]=d,d}assignTexture(e,t,n,r){const o=this;return this.getDependency("texture",n.index).then(function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),o.extensions[ft.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[ft.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=o.associations.get(s);s=o.extensions[ft.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),o.associations.set(s,t)}}return void 0!==r&&(s.colorSpace=r),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,o=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new _,N.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new F,N.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(r||o||s){let e="ClonedMaterial:"+n.uuid+":";r&&(e+="derivative-tangents:"),o&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),o&&(t.vertexColors=!0),s&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return O}loadMaterial(e){const t=this,n=this.json,r=this.extensions,o=n.materials[e];let s;const i={},a=[];if((o.extensions||{})[ft.KHR_MATERIALS_UNLIT]){const e=r[ft.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),a.push(e.extendParams(i,o,t))}else{const n=o.pbrMetallicRoughness||{};if(i.color=new p(1,1,1),i.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;i.color.setRGB(e[0],e[1],e[2],u),i.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(i,"map",n.baseColorTexture,h)),i.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,i.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(i,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(i,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),a.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,i)})))}!0===o.doubleSided&&(i.side=B);const l=o.alphaMode||Yt;if(l===Zt?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,l===Jt&&(i.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&s!==H&&(a.push(t.assignTexture(i,"normalMap",o.normalTexture)),i.normalScale=new d(1,1),void 0!==o.normalTexture.scale)){const e=o.normalTexture.scale;i.normalScale.set(e,e)}if(void 0!==o.occlusionTexture&&s!==H&&(a.push(t.assignTexture(i,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(i.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&s!==H){const e=o.emissiveFactor;i.emissive=(new p).setRGB(e[0],e[1],e[2],u)}return void 0!==o.emissiveTexture&&s!==H&&a.push(t.assignTexture(i,"emissiveMap",o.emissiveTexture,h)),Promise.all(a).then(function(){const n=new s(i);return o.name&&(n.name=o.name),tn(n,o),t.associations.set(n,{materials:e}),o.extensions&&en(r,n,o),n})}createUniqueName(e){const t=U.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function o(e){return n[ft.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return cn(n,e,t)})}const s=[];for(let i=0,a=e.length;i<a;i++){const n=e[i],a=rn(n),l=r[a];if(l)s.push(l.promise);else{let e;e=n.extensions&&n.extensions[ft.KHR_DRACO_MESH_COMPRESSION]?o(n):cn(new G,n,t),r[a]={primitive:n,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],a=i.primitives,l=[];for(let o=0,s=a.length;o<s;o++){const e=void 0===a[o].material?Qt(this.cache):this.getDependency("material",a[o].material);l.push(e)}return l.push(t.loadGeometries(a)),Promise.all(l).then(function(n){const l=n.slice(0,n.length-1),c=n[n.length-1],d=[];for(let u=0,h=c.length;u<h;u++){const n=c[u],p=a[u];let h;const f=l[u];if(p.mode===Ut.TRIANGLES||p.mode===Ut.TRIANGLE_STRIP||p.mode===Ut.TRIANGLE_FAN||void 0===p.mode)h=!0===i.isSkinnedMesh?new W(n,f):new $(n,f),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),p.mode===Ut.TRIANGLE_STRIP?h.geometry=pt(h.geometry,s):p.mode===Ut.TRIANGLE_FAN&&(h.geometry=pt(h.geometry,o));else if(p.mode===Ut.LINES)h=new V(n,f);else if(p.mode===Ut.LINE_STRIP)h=new X(n,f);else if(p.mode===Ut.LINE_LOOP)h=new K(n,f);else{if(p.mode!==Ut.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);h=new q(n,f)}Object.keys(h.geometry.morphAttributes).length>0&&nn(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),tn(h,i),p.extensions&&en(r,h,p),t.assignFinalMaterial(h),d.push(h)}for(let r=0,o=d.length;r<o;r++)t.associations.set(d[r],{meshes:e,primitives:r});if(1===d.length)return i.extensions&&en(r,d[0],i),d[0];const p=new Y;i.extensions&&en(r,p,i),t.associations.set(p,{meshes:e});for(let e=0,t=d.length;e<t;e++)p.add(d[e]);return p})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new J(Z.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new Q(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),tn(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,o=t.joints.length;r<o;r++)n.push(this._loadNodeShallow(t.joints[r]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const n=e.pop(),r=e,o=[],s=[];for(let i=0,a=r.length;i<a;i++){const e=r[i];if(e){o.push(e);const t=new x;null!==n&&t.fromArray(n.array,16*i),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[i])}return new ee(o,s)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],o=r.name?r.name:"animation_"+e,s=[],i=[],a=[],l=[],c=[];for(let d=0,p=r.channels.length;d<p;d++){const e=r.channels[d],t=r.samplers[e.sampler],n=e.target,o=n.node,p=void 0!==r.parameters?r.parameters[t.input]:t.input,u=void 0!==r.parameters?r.parameters[t.output]:t.output;void 0!==n.node&&(s.push(this.getDependency("node",o)),i.push(this.getDependency("accessor",p)),a.push(this.getDependency("accessor",u)),l.push(t),c.push(n))}return Promise.all([Promise.all(s),Promise.all(i),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],r=e[1],s=e[2],i=e[3],a=e[4],l=[];for(let o=0,c=t.length;o<c;o++){const e=t[o],c=r[o],d=s[o],p=i[o],u=a[o];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const h=n._createAnimationTracks(e,c,d,p,u);if(h)for(let t=0;t<h.length;t++)l.push(h[t])}return new te(o,void 0,l)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),o=[],s=n.children||[];for(let a=0,l=s.length;a<l;a++)o.push(t.getDependency("node",s[a]));const i=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(o),i]).then(function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(r,an)});for(let o=0,s=n.length;o<s;o++)t.add(n[o]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const o=t.nodes[e],s=o.name?r.createUniqueName(o.name):"",i=[],a=r._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return a&&i.push(a),void 0!==o.camera&&i.push(r.getDependency("camera",o.camera).then(function(e){return r._getNodeRef(r.cameraCache,o.camera,e)})),r._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){i.push(e)}),this.nodeCache[e]=Promise.all(i).then(function(t){let i;if(i=!0===o.isBone?new ne:t.length>1?new Y:1===t.length?t[0]:new S,i!==t[0])for(let e=0,n=t.length;e<n;e++)i.add(t[e]);if(o.name&&(i.userData.name=o.name,i.name=s),tn(i,o),o.extensions&&en(n,i,o),void 0!==o.matrix){const e=new x;e.fromArray(o.matrix),i.applyMatrix4(e)}else void 0!==o.translation&&i.position.fromArray(o.translation),void 0!==o.rotation&&i.quaternion.fromArray(o.rotation),void 0!==o.scale&&i.scale.fromArray(o.scale);return r.associations.has(i)||r.associations.set(i,{}),r.associations.get(i).nodes=e,i}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,o=new Y;n.name&&(o.name=r.createUniqueName(n.name)),tn(o,n),n.extensions&&en(t,o,n);const s=n.nodes||[],i=[];for(let a=0,l=s.length;a<l;a++)i.push(r.getDependency("node",s[a]));return Promise.all(i).then(function(e){for(let t=0,n=e.length;t<n;t++)o.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[n,o]of r.associations)(n instanceof N||n instanceof ie)&&t.set(n,o);return e.traverse(e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)}),t})(o),o})}_createAnimationTracks(e,t,n,r,o){const s=[],i=e.name?e.name:e.uuid,a=[];let l;switch(Kt[o.path]===Kt.weights?e.traverse(function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)}):a.push(i),Kt[o.path]){case Kt.weights:l=le;break;case Kt.rotation:l=ce;break;case Kt.position:case Kt.scale:l=ae;break;default:if(1===n.itemSize)l=le;else l=ae}const c=void 0!==r.interpolation?qt[r.interpolation]:oe,d=this._getArrayFromAccessor(n);for(let p=0,u=a.length;p<u;p++){const e=new l(a[p]+"."+Kt[o.path],t.array,d,c);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(e),s.push(e)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=sn(t.constructor),n=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)n[r]=t[r]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof ce?Ht:Ot)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function cn(e,t,n){const r=t.attributes,o=[];function s(t,r){return n.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(const i in r){const t=Xt[i]||i.toLowerCase();t in e.attributes||o.push(s(r[i],t))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(r)}return de.workingColorSpace!==u&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${de.workingColorSpace}" not supported.`),tn(e,t),function(e,t,n){const r=t.attributes,o=new he;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new y(t[0],t[1],t[2]),new y(s[0],s[1],s[2])),e.normalized){const t=sn(Gt[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new y,t=new y;for(let r=0,o=s.length;r<o;r++){const o=s[r];if(void 0!==o.POSITION){const r=n.json.accessors[o.POSITION],s=r.min,i=r.max;if(void 0!==s&&void 0!==i){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(i[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(i[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(i[2]))),r.normalized){const e=sn(Gt[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;const i=new fe;o.getCenter(i.center),i.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=i}(e,t,n),Promise.all(o).then(function(){return void 0!==t.targets?function(e,t,n){let r=!1,o=!1,s=!1;for(let c=0,d=t.length;c<d;c++){const e=t[c];if(void 0!==e.POSITION&&(r=!0),void 0!==e.NORMAL&&(o=!0),void 0!==e.COLOR_0&&(s=!0),r&&o&&s)break}if(!r&&!o&&!s)return Promise.resolve(e);const i=[],a=[],l=[];for(let c=0,d=t.length;c<d;c++){const d=t[c];if(r){const t=void 0!==d.POSITION?n.getDependency("accessor",d.POSITION):e.attributes.position;i.push(t)}if(o){const t=void 0!==d.NORMAL?n.getDependency("accessor",d.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==d.COLOR_0?n.getDependency("accessor",d.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(l)]).then(function(t){const n=t[0],i=t[1],a=t[2];return r&&(e.morphAttributes.position=n),o&&(e.morphAttributes.normal=i),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}const dn={ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function pn(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function un(e,t,n=null,r=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const o=await async function(e){if(!e)throw new Error("No basePath supplied");return await pn(`${e}/profilesList.json`)}(t);let s;if(e.profiles.some(e=>{const n=o[e];return n&&(s={profileId:e,profilePath:`${t}/${n.path}`,deprecated:!!n.deprecated}),!!s}),!s){if(!n)throw new Error("No matching profile name found");const e=o[n];if(!e)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const i=await pn(s.profilePath);let a;if(r){let t;if(t="any"===e.handedness?i.layouts[Object.keys(i.layouts)[0]]:i.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${s.profileId}`);t.assetPath&&(a=s.profilePath.replace("profile.json",t.assetPath))}return{profile:i,assetPath:a}}const hn={xAxis:0,yAxis:0,button:0,state:dn.ComponentState.DEFAULT};class fn{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===dn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(hn)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:r}){const{normalizedXAxis:o,normalizedYAxis:s}=function(e=0,t=0){let n=e,r=t;if(Math.sqrt(e*e+t*t)>1){const o=Math.atan2(t,e);n=Math.cos(o),r=Math.sin(o)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*r+.5}}(e,t);switch(this.componentProperty){case dn.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?o:.5;break;case dn.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?s:.5;break;case dn.ComponentProperty.BUTTON:this.value=this.states.includes(r)?n:0;break;case dn.ComponentProperty.STATE:this.valueNodeProperty===dn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class mn{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(e=>{const n=new fn(t.visualResponses[e]);this.visualResponses[e]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:dn.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=dn.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=dn.ComponentState.PRESSED:(t.touched||this.values.button>dn.ButtonTouchThreshold)&&(this.values.state=dn.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===dn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>dn.AxisTouchThreshold&&(this.values.state=dn.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===dn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>dn.AxisTouchThreshold&&(this.values.state=dn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}}class gn{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(e=>{const t=this.layoutDescription.components[e];this.components[e]=new mn(e,t)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}class xn extends S{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)})),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(e=>{const{valueNode:t,minNode:n,maxNode:r,value:o,valueNodeProperty:s}=e;t&&(s===dn.VisualResponseProperty.VISIBILITY?t.visible=o:s===dn.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(n.quaternion,r.quaternion,o),t.position.lerpVectors(n.position,r.position,o)))})}))}}function yn(e,t){!function(e,t){Object.values(e.components).forEach(e=>{const{type:n,touchPointNodeName:r,visualResponses:o}=e;if(n===dn.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(r),e.touchPointNode){const t=new me(.001),n=new H({color:255}),r=new $(t,n);e.touchPointNode.add(r)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(o).forEach(e=>{const{valueNodeName:n,minNodeName:r,maxNodeName:o,valueNodeProperty:s}=e;if(s===dn.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(r),e.maxNode=t.getObjectByName(o),!e.minNode)return void console.warn(`Could not find ${r} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${o} in the model`)}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn(`Could not find ${n} in the model`)})})}(e.motionController,t),e.envMap&&t.traverse(t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)}),e.add(t)}class bn{constructor(e=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new ut)}createControllerModel(e){const t=new xn;let n=null;return e.addEventListener("connected",e=>{const r=e.data;"tracked-pointer"===r.targetRayMode&&r.gamepad&&un(r,this.path,"generic-trigger").then(({profile:e,assetPath:o})=>{t.motionController=new gn(r,e,o);const s=this._assetCache[t.motionController.assetUrl];if(s)n=s.scene.clone(),yn(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,e=>{this._assetCache[t.motionController.assetUrl]=e,n=e.scene.clone(),yn(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(e=>{console.warn(e)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}}const vn=new x,wn=new y;class Sn{constructor(e,t,n,r,o){let s;this.controller=t,this.handModel=e,this.envMap=null,o&&o.primitive&&"sphere"!==o.primitive?"box"===o.primitive&&(s=new ge(1,1,1)):s=new me(1,10,10);const i=new O;this.handMesh=new b(s,i,30),this.handMesh.frustumCulled=!1,this.handMesh.instanceMatrix.setUsage(xe),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){const e=this.controller.joints;let t=0;for(let n=0;n<this.joints.length;n++){const r=e[this.joints[n]];r.visible&&(wn.setScalar(r.jointRadius||.008),vn.compose(r.position,r.quaternion,wn),this.handMesh.setMatrixAt(n,vn),t++)}this.handMesh.count=t,this.handMesh.instanceMatrix.needsUpdate=!0}}class Tn{constructor(e,t,n,r,o=null){this.controller=t,this.handModel=e,this.bones=[],null===o&&(o=new ut).setPath(n||"https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/"),o.load(`${r}.glb`,e=>{const t=e.scene.children[0];this.handModel.add(t);const n=t.getObjectByProperty("type","SkinnedMesh");n.frustumCulled=!1,n.castShadow=!0,n.receiveShadow=!0;["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(e=>{const n=t.getObjectByName(e);void 0!==n?n.jointName=e:console.warn(`Couldn't find ${e} in ${r} hand mesh`),this.bones.push(n)})})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const n=this.bones[t];if(n){const t=e[n.jointName];if(t.visible){const e=t.position;n.position.copy(e),n.quaternion.copy(t.quaternion)}}}}}class zn extends S{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}}class Rn{constructor(){this.path=null}setPath(e){return this.path=e,this}createHandModel(e,t){const n=new zn(e);return e.addEventListener("connected",r=>{const o=r.data;o.hand&&!n.motionController&&(n.xrInputSource=o,void 0===t||"spheres"===t?n.motionController=new Sn(n,e,this.path,o.handedness,{primitive:"sphere"}):"boxes"===t?n.motionController=new Sn(n,e,this.path,o.handedness,{primitive:"box"}):"mesh"===t&&(n.motionController=new Tn(n,e,this.path,o.handedness))),e.visible=!0}),e.addEventListener("disconnected",()=>{e.visible=!1}),n}}const An={requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor","hand-tracking","layers","anchors","secondary-views"],preferredFrameRate:90,framebufferScaleFactor:1,foveation:1,enableHands:!0,worldScale:1,snapTurn:!0,snapAngle:Z.degToRad(30),smoothTurnSpeed:Z.degToRad(90),hapticsIntensity:1,allowRecenter:!0},En={left:{pinch:"grab",squeeze:"menu"},right:{pinch:"primary",squeeze:"secondary"}},kn=async()=>{if(!navigator.xr)return{supported:!1,reason:"WebXR not available in this browser"};try{const e=await navigator.xr.isSessionSupported("immersive-vr");return{supported:e,reason:e?"VR supported":"immersive-vr not supported"}}catch(e){return{supported:!1,reason:e.message}}};class Mn{constructor(e,t,n,r=null,o={}){this.renderer=e,this.scene=t,this.camera=n,this.playerRig=r,this.session=null,this.referenceSpace=null,this.controllers=[],this.controllerGrips=[],this.hands=[],this.isInVR=!1,this.options={...An,...o},this.controllerModelFactory=new bn,this.handModelFactory=new Rn,this.handBindings={...En},this.snapTurnAccumulator=0,this.onSnapTurn=null,this.onSmoothTurn=null,this.onRecenter=null,this.baseReferenceSpace=null,this.visibilityState="visible",this.supportsAnchors=!1,this.lastViewerPose=null,this.worldScale=this.options.worldScale,this.pendingFrameRate=null,this.dynamicResolutionEnabled=!1,this.controllerState={left:{connected:!1,squeezing:!1,selecting:!1,thumbstick:{x:0,y:0}},right:{connected:!1,squeezing:!1,selecting:!1,thumbstick:{x:0,y:0}}},this.onSessionStart=null,this.onSessionEnd=null,this.onControllerInput=null,this.handActionCallback=null,this.onVisibilityChange=null}async init(){const e=await kn();return e.supported?(this.renderer.xr.enabled=!0,"function"==typeof this.renderer.xr.setFoveation&&void 0!==this.options.foveation&&this.renderer.xr.setFoveation(this.options.foveation),this.setupControllers(),!0):(console.warn("WebXR not supported:",e.reason),!1)}setupControllers(){const e=this.playerRig||this.scene,t=this.renderer.xr.getController(0);t.userData.handedness="left",this.setupControllerEvents(t,0),e.add(t),this.controllers.push(t);const n=this.renderer.xr.getController(1);n.userData.handedness="right",this.setupControllerEvents(n,1),e.add(n),this.controllers.push(n);const r=this.renderer.xr.getControllerGrip(0);e.add(r),this.controllerGrips.push(r);const o=this.renderer.xr.getControllerGrip(1);e.add(o),this.controllerGrips.push(o);try{const e=this.controllerModelFactory.createControllerModel(r);r.add(e);const t=this.controllerModelFactory.createControllerModel(o);o.add(t)}catch(s){console.warn("Controller model factory unavailable:",s),this.addControllerVisuals()}this.options.enableHands&&this.setupHands(e),this.options.allowRecenter&&this.renderer.xr.addEventListener("sessionstart",()=>{this.snapTurnAccumulator=0})}addControllerVisuals(){const e=new ye(.01,.02,.1,8),t=new O({color:4491519,emissive:2245768,emissiveIntensity:.3});this.controllers.forEach((n,r)=>{const o=new $(e,t);o.rotation.x=-Math.PI/2,n.add(o);const s=(new G).setFromPoints([new y(0,0,0),new y(0,0,-5)]),i=new F({color:4521864,transparent:!0,opacity:.5}),a=new X(s,i);n.add(a)})}setupHands(e){try{const t=this.renderer.xr.getHand(0);t.userData.handedness="left";const n=this.handModelFactory.createHandModel(t,"spheres");t.add(n),e.add(t),this.hands.push(t);const r=this.renderer.xr.getHand(1);r.userData.handedness="right";const o=this.handModelFactory.createHandModel(r,"spheres");r.add(o),e.add(r),this.hands.push(r),this.hands.forEach(e=>{e.addEventListener("pinchstart",()=>{this.dispatchHandAction("pinch",e.userData.handedness,"start")}),e.addEventListener("pinchend",()=>{this.dispatchHandAction("pinch",e.userData.handedness,"end")}),e.addEventListener("squeezestart",()=>{this.dispatchHandAction("squeeze",e.userData.handedness,"start")}),e.addEventListener("squeezeend",()=>{this.dispatchHandAction("squeeze",e.userData.handedness,"end")})})}catch(t){console.warn("Hand tracking not available:",t)}}setupControllerEvents(e,t){const n=0===t?"left":"right";e.addEventListener("connected",t=>{this.controllerState[n].connected=!0,e.userData.inputSource=t.data,t.data.handedness&&(e.userData.handedness=t.data.handedness),console.log(`Controller ${n} connected:`,t.data.handedness)}),e.addEventListener("disconnected",()=>{this.controllerState[n].connected=!1,console.log(`Controller ${n} disconnected`)}),e.addEventListener("selectstart",()=>{this.controllerState[n].selecting=!0,this.onControllerInput&&this.onControllerInput({type:"selectstart",hand:n,controller:e})}),e.addEventListener("selectend",()=>{this.controllerState[n].selecting=!1,this.onControllerInput&&this.onControllerInput({type:"selectend",hand:n,controller:e})}),e.addEventListener("squeezestart",()=>{this.controllerState[n].squeezing=!0,this.onControllerInput&&this.onControllerInput({type:"squeezestart",hand:n,controller:e})}),e.addEventListener("squeezeend",()=>{this.controllerState[n].squeezing=!1,this.onControllerInput&&this.onControllerInput({type:"squeezeend",hand:n,controller:e})})}async startSession(){try{const e={requiredFeatures:this.options.requiredFeatures,optionalFeatures:this.options.optionalFeatures};return this.session=await navigator.xr.requestSession("immersive-vr",e),this.isInVR=!0,this.renderer.xr.setSession(this.session),await this.configureRenderState(),this.baseReferenceSpace=await this.session.requestReferenceSpace("local-floor"),this.referenceSpace=this.baseReferenceSpace,this.supportsAnchors=void 0!==this.session?.requestReferenceSpace&&this.options.optionalFeatures.includes("anchors"),this.session.addEventListener("inputsourceschange",e=>{this.handleInputSourcesChange(e)}),this.session.addEventListener("visibilitychange",()=>{this.visibilityState=this.session.visibilityState,this.onVisibilityChange&&this.onVisibilityChange(this.visibilityState)}),this.session.addEventListener("end",()=>{this.isInVR=!1,this.session=null,this.onSessionEnd&&this.onSessionEnd()}),this.options.preferredFrameRate&&this.setPreferredFrameRate(this.options.preferredFrameRate),this.onSessionStart&&this.onSessionStart(),this.applyWorldScale(this.worldScale),console.log("VR session started"),!0}catch(e){return console.error("Failed to start VR session:",e),!1}}async configureRenderState(){if(!this.session)return;const e=this.renderer.getContext();e&&"function"==typeof e.makeXRCompatible&&await e.makeXRCompatible();const t={};this.options.framebufferScaleFactor&&(t.framebufferScaleFactor=this.options.framebufferScaleFactor);const n="undefined"!=typeof XRWebGLLayer?XRWebGLLayer:null;if(n)try{const r=new n(this.session,e,t);this.session.updateRenderState({baseLayer:r})}catch(r){console.warn("XRWebGLLayer configuration failed, using default:",r)}}async endSession(){this.session&&await this.session.end()}pollControllerInput(){const e=this.session||(this.renderer.xr.isPresenting?this.renderer.xr.getSession():null);if(!e)return;const t=e.inputSources;for(const n of t){if(!n.gamepad)continue;const e=n.handedness||"unknown";if("left"!==e&&"right"!==e)continue;const t=n.gamepad;if(t.axes.length>=2){const n=t.axes.length>=4&&(Math.abs(t.axes[2])>.01||Math.abs(t.axes[3])>.01)?t.axes[2]:t.axes[0],r=t.axes.length>=4&&(Math.abs(t.axes[2])>.01||Math.abs(t.axes[3])>.01)?t.axes[3]:t.axes[1];this.controllerState[e].thumbstick={x:n||0,y:r||0},"left"!==e&&"right"!==e||this.handleTurnInput(e)}t.buttons.length>4&&(this.controllerState[e].primaryButton=t.buttons[4]?.pressed||!1,this.controllerState[e].secondaryButton=t.buttons[5]?.pressed||!1)}return this.controllerState}async triggerHaptic(e,t=.5,n=100){const r=this.session||(this.renderer.xr.isPresenting?this.renderer.xr.getSession():null);if(!r)return;const o=r.inputSources;for(const i of o)if(i.handedness===e&&i.gamepad){const e=i.gamepad;if("function"==typeof e.getHapticActuator)try{const r=e.getHapticActuator(0);if(r)return void(await r.pulse(t*this.options.hapticsIntensity,n))}catch(s){}if(e.vibrationActuator)try{return void(await e.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:n,weakMagnitude:.5*t*this.options.hapticsIntensity,strongMagnitude:t*this.options.hapticsIntensity}))}catch(s){}if(e.hapticActuators&&e.hapticActuators[0])try{await e.hapticActuators[0].pulse(t*this.options.hapticsIntensity,n)}catch(s){}}}getControllerPosition(e){const t="left"===e?0:1,n=this.controllers[t];if(!n)return null;const r=new y;return n.getWorldPosition(r),r}getControllerDirection(e){const t="left"===e?0:1,n=this.controllers[t];if(!n)return null;const r=new y(0,0,-1);return n.getWorldDirection(r),r}handleInputSourcesChange(e){e.added?.forEach(e=>{e.hand&&this.options.enableHands&&this.registerHandSource(e)}),e.removed?.forEach(e=>{e.hand&&this.unregisterHandSource(e)})}registerHandSource(e){const t="left"===e.handedness?this.hands[0]:this.hands[1];t&&(t.userData.inputSource=e)}unregisterHandSource(e){const t=e.handedness;this.hands.forEach(e=>{e.userData.handedness===t&&(e.userData.inputSource=null)})}dispatchHandAction(e,t,n){if(!this.handActionCallback)return;const r=this.handBindings?.[t]?.[e];r&&this.handActionCallback({action:r,hand:t,phase:n})}setHandBindings(e){this.handBindings={left:{...En.left,...e?.left||{}},right:{...En.right,...e?.right||{}}}}onHandAction(e){this.handActionCallback=e}setComfortOptions(e={}){this.options={...this.options,...e}}setPreferredFrameRate(e){this.pendingFrameRate=e,this.session?.updateTargetFrameRate&&this.session.updateTargetFrameRate(e).catch(e=>{console.warn("Preferred frame rate unsupported:",e)})}enableDynamicResolution(e,t=.75,n=1.15){this.dynamicResolutionEnabled=e,this.dynamicResolutionRange={minScale:t,maxScale:n}}applyDynamicResolution(e){if(!this.dynamicResolutionEnabled)return;if(!this.renderer.xr.isPresenting)return;const t=1e3/(this.pendingFrameRate||72),n=.15*t;e>t+n?(this.options.framebufferScaleFactor=Math.max(this.dynamicResolutionRange.minScale,this.options.framebufferScaleFactor-.05),this.configureRenderState()):e<t-n&&(this.options.framebufferScaleFactor=Math.min(this.dynamicResolutionRange.maxScale,this.options.framebufferScaleFactor+.05),this.configureRenderState())}update(e,t){if(!t)return;const n=t.getViewerPose(this.referenceSpace);n&&(this.lastViewerPose=n)}handleTurnInput(e){if(!this.options.snapTurn&&!this.onSmoothTurn)return;const t=this.controllerState[e];if(!t)return;const n=t.thumbstick?.x||0;if(Math.abs(n)<.2)this.snapTurnAccumulator=0;else if(this.options.snapTurn){const t=Math.sign(n);if(this.snapTurnAccumulator+=n,Math.abs(this.snapTurnAccumulator)>=.8){const n=t*this.options.snapAngle;this.onSnapTurn&&this.onSnapTurn(n,e),this.snapTurnAccumulator=0}}else if(this.onSmoothTurn){const t=n*this.options.smoothTurnSpeed;this.onSmoothTurn(t,e)}}setSnapTurnHandler(e){this.onSnapTurn=e}setSmoothTurnHandler(e){this.onSmoothTurn=e}setRecenterHandler(e){this.onRecenter=e}recenter(e=new y,t=new y(0,0,-1)){if(this.baseReferenceSpace)try{const n=new XRRigidTransform({x:-e.x,y:-e.y,z:-e.z},this.vectorToQuaternion(t));this.referenceSpace=this.baseReferenceSpace.getOffsetReferenceSpace(n),this.onRecenter&&this.onRecenter()}catch(n){console.warn("Recentering failed:",n)}}vectorToQuaternion(e){const t=e.clone().normalize(),n=new y(0,1,0),r=(new y).crossVectors(n,t).normalize();n.crossVectors(t,r);const o=(new x).makeBasis(r,n,t),s=(new v).setFromRotationMatrix(o);return{x:s.x,y:s.y,z:s.z,w:s.w}}applyWorldScale(e=1){this.worldScale=e,this.playerRig&&this.playerRig.scale.setScalar(e)}dispose(){this.controllers.forEach(e=>{e.removeFromParent()}),this.controllerGrips.forEach(e=>{e.removeFromParent()}),this.hands.forEach(e=>{e.removeFromParent()}),this.controllers=[],this.controllerGrips=[],this.hands=[]}}const Dn=[{name:"Plain Cheese",price:12.99,emoji:"üßÄ",description:"Lucky you! Just a basic cheese pizza."},{name:"Pepperoni",price:14.99,emoji:"üçï",description:"Classic pepperoni - not too bad."},{name:"Hawaiian",price:15.99,emoji:"üçç",description:"Pineapple lovers hate you now."},{name:"Veggie Supreme",price:16.99,emoji:"ü•¨",description:"All those veggies... wasted!"},{name:"Meat Lovers",price:18.99,emoji:"ü•ì",description:"So much meat... gone forever."},{name:"BBQ Chicken",price:17.99,emoji:"üçó",description:"That BBQ sauce is everywhere now!"},{name:"Supreme Deluxe",price:21.99,emoji:"üëë",description:"The EXPENSIVE one! Boss is MAD!"},{name:"Truffle Special",price:24.99,emoji:"üçÑ",description:"TRUFFLE?! That costs a fortune!"},{name:"Lobster & Gold Leaf",price:49.99,emoji:"ü¶û",description:"OH NO! The $50 LUXURY PIZZA! You're in DEEP trouble!"}],Cn=[{id:"cheese_lover",name:"Cheese Lover",emoji:"üßÄ",description:"Delivered 25 Plain Cheese pizzas",pizzaType:"Plain Cheese",required:25},{id:"cheese_king",name:"Cheese King",emoji:"üßÄüëë",description:"Delivered 100 Plain Cheese pizzas",pizzaType:"Plain Cheese",required:100},{id:"pepperoni_pro",name:"Pepperoni Pro",emoji:"üçï",description:"Delivered 25 Pepperoni pizzas",pizzaType:"Pepperoni",required:25},{id:"pepperoni_legend",name:"Pepperoni Legend",emoji:"üçïüî•",description:"Delivered 100 Pepperoni pizzas",pizzaType:"Pepperoni",required:100},{id:"hawaiian_hero",name:"Hawaiian Hero",emoji:"üçç",description:"Delivered 25 Hawaiian pizzas",pizzaType:"Hawaiian",required:25},{id:"pineapple_defender",name:"Pineapple Defender",emoji:"üççüõ°Ô∏è",description:"Delivered 100 Hawaiian pizzas - You embrace the controversy!",pizzaType:"Hawaiian",required:100},{id:"veggie_friend",name:"Veggie Friend",emoji:"ü•¨",description:"Delivered 25 Veggie Supreme pizzas",pizzaType:"Veggie Supreme",required:25},{id:"green_machine",name:"Green Machine",emoji:"ü•¨üíö",description:"Delivered 100 Veggie Supreme pizzas",pizzaType:"Veggie Supreme",required:100},{id:"carnivore",name:"Carnivore",emoji:"ü•ì",description:"Delivered 25 Meat Lovers pizzas",pizzaType:"Meat Lovers",required:25},{id:"meat_master",name:"Meat Master",emoji:"ü•ìüèÜ",description:"Delivered 100 Meat Lovers pizzas",pizzaType:"Meat Lovers",required:100},{id:"bbq_boss",name:"BBQ Boss",emoji:"üçó",description:"Delivered 25 BBQ Chicken pizzas",pizzaType:"BBQ Chicken",required:25},{id:"grill_master",name:"Grill Master",emoji:"üçóüî•",description:"Delivered 100 BBQ Chicken pizzas",pizzaType:"BBQ Chicken",required:100},{id:"supreme_server",name:"Supreme Server",emoji:"üëë",description:"Delivered 25 Supreme Deluxe pizzas",pizzaType:"Supreme Deluxe",required:25},{id:"deluxe_deity",name:"Deluxe Deity",emoji:"üëë‚ú®",description:"Delivered 100 Supreme Deluxe pizzas",pizzaType:"Supreme Deluxe",required:100},{id:"truffle_hunter",name:"Truffle Hunter",emoji:"üçÑ",description:"Delivered 15 Truffle Special pizzas",pizzaType:"Truffle Special",required:15},{id:"truffle_tycoon",name:"Truffle Tycoon",emoji:"üçÑüíé",description:"Delivered 50 Truffle Special pizzas",pizzaType:"Truffle Special",required:50},{id:"luxury_courier",name:"Luxury Courier",emoji:"ü¶û",description:"Delivered 10 Lobster & Gold Leaf pizzas",pizzaType:"Lobster & Gold Leaf",required:10},{id:"golden_god",name:"Golden God",emoji:"ü¶ûüåü",description:"Delivered 25 Lobster & Gold Leaf pizzas - The elite!",pizzaType:"Lobster & Gold Leaf",required:25}],jn=[{id:"first_delivery",name:"First Flight",emoji:"üõ´",description:"Completed your first delivery!",deliveries:1},{id:"getting_started",name:"Getting Started",emoji:"üì¶",description:"Completed 10 deliveries",deliveries:10},{id:"on_a_roll",name:"On a Roll",emoji:"üéØ",description:"Completed 50 deliveries",deliveries:50},{id:"century",name:"Century Club",emoji:"üíØ",description:"Completed 100 deliveries",deliveries:100},{id:"pizza_veteran",name:"Pizza Veteran",emoji:"üéñÔ∏è",description:"Completed 250 deliveries",deliveries:250},{id:"delivery_legend",name:"Delivery Legend",emoji:"üèÜ",description:"Completed 500 deliveries",deliveries:500},{id:"pizza_immortal",name:"Pizza Immortal",emoji:"‚ö°",description:"Completed 1000 deliveries",deliveries:1e3}],Pn=[{id:"first_perfect",name:"Flawless",emoji:"‚≠ê",description:"First perfect delivery!",perfectDeliveries:1},{id:"perfectionist",name:"Perfectionist",emoji:"üåü",description:"10 perfect deliveries",perfectDeliveries:10},{id:"untouchable",name:"Untouchable",emoji:"üí´",description:"50 perfect deliveries",perfectDeliveries:50},{id:"god_tier",name:"God Tier",emoji:"‚ú®",description:"100 perfect deliveries - You are a master!",perfectDeliveries:100}],In=[{id:"speed_demon",name:"Speed Demon",emoji:"‚ö°",description:"Delivered in under 20 seconds",fastestTime:20},{id:"lightning",name:"Lightning Fast",emoji:"üå©Ô∏è",description:"Delivered in under 15 seconds",fastestTime:15},{id:"time_bender",name:"Time Bender",emoji:"‚è±Ô∏è",description:"Delivered in under 10 seconds - Are you hacking?!",fastestTime:10}],Ln=[{id:"first_hundred",name:"First $100",emoji:"üíµ",description:"Earned $100 in tips",totalTips:100},{id:"high_roller",name:"High Roller",emoji:"üí∞",description:"Earned $500 in tips",totalTips:500},{id:"tip_tycoon",name:"Tip Tycoon",emoji:"ü§ë",description:"Earned $1000 in tips",totalTips:1e3},{id:"pizza_millionaire",name:"Pizza Millionaire",emoji:"üíé",description:"Earned $5000 in tips - Rolling in dough!",totalTips:5e3}],_n=["James","Mary","John","Patricia","Robert","Jennifer","Michael","Linda","David","Elizabeth","William","Barbara","Richard","Susan","Joseph","Jessica","Thomas","Sarah","Christopher","Karen","Charles","Lisa","Daniel","Nancy","Matthew","Betty","Anthony","Margaret","Mark","Sandra","Donald","Ashley","Steven","Kimberly","Paul","Emily","Andrew","Donna","Joshua","Michelle","Kevin","Dorothy","Brian","Carol","George","Amanda","Timothy","Melissa","Ronald","Deborah","Jason","Stephanie","Edward","Rebecca","Jeffrey","Sharon","Ryan","Laura","Jacob","Cynthia","Gary","Kathleen","Nicholas","Amy","Eric","Angela","Jonathan","Shirley","Stephen","Anna","Larry","Brenda","Justin","Pamela","Scott","Emma","Brandon","Nicole","Benjamin","Helen","Samuel","Samantha","Gregory","Katherine","Alexander","Christine","Frank","Debra","Patrick","Rachel","Raymond","Carolyn","Jack","Janet","Dennis","Catherine","Jerry","Maria","Tyler","Heather"],Nn=["Smith","Johnson","Williams","Brown","Jones","Garcia","Miller","Davis","Rodriguez","Martinez","Hernandez","Lopez","Gonzalez","Wilson","Anderson","Thomas","Taylor","Moore","Jackson","Martin","Lee","Perez","Thompson","White","Harris","Sanchez","Clark","Ramirez","Lewis","Robinson","Walker","Young","Allen","King","Wright","Scott","Torres","Nguyen","Hill","Flores","Green","Adams","Nelson","Baker","Hall","Rivera","Campbell","Mitchell","Carter","Roberts","Gomez","Phillips","Evans","Turner","Diaz","Parker","Cruz","Edwards","Collins","Reyes","Stewart","Morris","Morales","Murphy","Cook","Rogers","Gutierrez","Ortiz","Morgan","Cooper","Peterson","Bailey","Reed","Kelly","Howard","Ramos","Kim","Cox","Ward","Richardson","Watson","Brooks","Chavez","Wood","James","Bennett","Gray","Mendoza","Ruiz","Hughes","Price","Alvarez","Castillo","Sanders","Patel","Myers","Long","Ross","Foster","Jimenez"],Fn=[{name:"Trainee",emoji:"üê£",minXP:0,tipBonus:0,color:"#888888"},{name:"Rookie Pilot",emoji:"üõ´",minXP:100,tipBonus:.05,color:"#66bb6a"},{name:"Delivery Driver",emoji:"üöó",minXP:300,tipBonus:.1,color:"#42a5f5"},{name:"Pizza Pro",emoji:"üçï",minXP:600,tipBonus:.15,color:"#ab47bc"},{name:"Sky Captain",emoji:"‚úàÔ∏è",minXP:1e3,tipBonus:.2,color:"#ff7043"},{name:"Elite Flyer",emoji:"ü¶Ö",minXP:1500,tipBonus:.25,color:"#ffd54f"},{name:"Pizza Master",emoji:"üë®‚Äçüç≥",minXP:2200,tipBonus:.3,color:"#e91e63"},{name:"Drone Legend",emoji:"üèÜ",minXP:3e3,tipBonus:.35,color:"#ff9800"},{name:"Pizza Emperor",emoji:"üëë",minXP:4e3,tipBonus:.4,color:"#f44336"},{name:"PIZZA GOD",emoji:"üåü",minXP:5500,tipBonus:.5,color:"#ffd700"}],On=e=>{for(let t=Fn.length-1;t>=0;t--)if(e>=Fn[t].minXP)return Fn[t];return Fn[0]},Bn=(e,t,n,r,o)=>{if(o)return-150;let s=0;return e>=4.8?(s=50,r&&(s=75)):s=e>=4.5?40:e>=4?30:e>=3.5?20:e>=3?10:e>=2.5?0:e>=2?-25:-50,n<30&&s>0?s+=15:n<45&&s>0?s+=10:n<60&&s>0&&(s+=5),n>=90?(s=Math.min(s,0),s-=30):n>=120&&(s-=50),t<70?s-=20:t<50&&(s-=40),s<0&&(s=Math.floor(1.5*s)),s},Hn=(e,t,n)=>{if(e.name===t.name)return null;if(n){const e=[`üéâ PROMOTED to ${t.emoji} ${t.name}! Tips +${Math.round(100*t.tipBonus)}%!`,`üìà RANK UP! You're now a ${t.emoji} ${t.name}! More tips incoming!`,`üåü NICE! ${t.emoji} ${t.name} unlocked! +${Math.round(100*t.tipBonus)}% tip bonus!`,`üöÄ LEVEL UP! Welcome to ${t.emoji} ${t.name}! Tips are getting BIGGER!`];return e[Math.floor(Math.random()*e.length)]}{const e=[`üìâ DEMOTED to ${t.emoji} ${t.name}... Tips reduced to +${Math.round(100*t.tipBonus)}%`,`üò∞ RANK DOWN! Back to ${t.emoji} ${t.name}. Gotta do better!`,`üíî OUCH! Dropped to ${t.emoji} ${t.name}. Less tips now...`,`üîª Demoted to ${t.emoji} ${t.name}. The grind continues...`];return e[Math.floor(Math.random()*e.length)]}},Un="pizzaExpress_totalWages",Gn="pizzaExpress_totalDeliveries",Wn="pizzaExpress_totalDestroyed",$n="pizzaExpress_bestTime",Vn="pizzaExpress_playerName",Xn="pizzaExpress_xp",Kn="pizzaExpress_badges",qn="pizzaExpress_pizzaTypeDeliveries",Yn="pizzaExpress_perfectDeliveries",Jn="pizzaExpress_totalTips",Zn="pizzaExpress_fastestDelivery",Qn="pizzaExpress_storeEarnings",er="pizzaExpress_gamepadBindings",tr={fastest_delivery:[{rank:1,name:"SpeedDemon",value:12.5,unit:"s"},{rank:2,name:"PizzaPro",value:14.2,unit:"s"},{rank:3,name:"DroneKing",value:15.8,unit:"s"},{rank:4,name:"FastFlyer",value:16.1,unit:"s"},{rank:5,name:"QuickPizza",value:17.3,unit:"s"}],most_deliveries:[{rank:1,name:"Grinder99",value:1523,unit:""},{rank:2,name:"NeverStop",value:1201,unit:""},{rank:3,name:"PizzaBot",value:998,unit:""},{rank:4,name:"Delivery4Life",value:876,unit:""},{rank:5,name:"DroneQueen",value:754,unit:""}],store_earnings:[{rank:1,name:"PizzaTycoon",value:125420,unit:"$"},{rank:2,name:"DeliveryKing",value:98300,unit:"$"},{rank:3,name:"PizzaBoss",value:76800,unit:"$"},{rank:4,name:"TopContributor",value:54650,unit:"$"},{rank:5,name:"StoreHelper",value:32200,unit:"$"}],perfect_pizzas:[{rank:1,name:"SteadyHands",value:892,unit:""},{rank:2,name:"Perfectionist",value:756,unit:""},{rank:3,name:"NoSpill",value:623,unit:""},{rank:4,name:"CarefulOne",value:589,unit:""},{rank:5,name:"GentlePilot",value:512,unit:""}],most_dropped_pizzas:[{rank:1,name:"ButterFingers",value:247,unit:"üçïüí®"},{rank:2,name:"OopsieDoopsie",value:198,unit:"üçïüí®"},{rank:3,name:"Clumsy Carl",value:156,unit:"üçïüí®"},{rank:4,name:"WhoopsieDaisy",value:134,unit:"üçïüí®"},{rank:5,name:"PizzaChaos",value:112,unit:"üçïüí®"}],bestRating:[{rank:1,name:"PerfectPilot",value:5,unit:"‚≠ê"},{rank:2,name:"SteadyEddy",value:4.9,unit:"‚≠ê"},{rank:3,name:"CarefulCarl",value:4.8,unit:"‚≠ê"},{rank:4,name:"GentleGina",value:4.7,unit:"‚≠ê"},{rank:5,name:"SmoothOp",value:4.6,unit:"‚≠ê"}],total_wages:[{rank:1,name:"MoneyMaker",value:1250.5,unit:"$"},{rank:2,name:"TipKing",value:980.25,unit:"$"},{rank:3,name:"PizzaPro",value:756,unit:"$"},{rank:4,name:"SteadyEarner",value:543.75,unit:"$"},{rank:5,name:"JustStarted",value:125,unit:"$"},{rank:6,name:"BreakingEven",value:0,unit:"$"},{rank:7,name:"OopsMyBad",value:-45.5,unit:"$"},{rank:8,name:"PizzaCrasher",value:-156.97,unit:"$"},{rank:9,name:"PizzaFumbler",value:-378.9,unit:"$"},{rank:10,name:"OwesTheBoss",value:-892.45,unit:"$"}],daily_earnings:[{rank:1,name:"TodaysBest",value:450,unit:"$"},{rank:2,name:"DailyGrind",value:380,unit:"$"},{rank:3,name:"MorningRush",value:320,unit:"$"},{rank:4,name:"AfternoonAce",value:290,unit:"$"},{rank:5,name:"NightOwl",value:245,unit:"$"}]},nr=(e,t)=>{let n=0;n=e>=99?3:e>=90?2.7:e>=80?2.4:e>=70?2:e>=60?1.5:e>=50?1:e>=40?.7:.5;let r=0;return r=t<30?2:t<45?1.7:t<60?1.3:t<90?.8:t<120?.3:0,Math.min(5,n+r)},rr=(e,t,n,r)=>{const o=new Y,s=new ze(e,t),i=new H({color:4352}),a=new $(s,i);o.add(a);const l=document.createElement("canvas");l.width=256,l.height=128;const c=l.getContext("2d"),d=new we(l),p=new H({map:d,transparent:!0,side:B}),u=new $(new ze(.9*e,.9*t),p);return u.position.z=.001,o.add(u),o.userData.canvas=l,o.userData.ctx=c,o.userData.texture=d,o.userData.label=r,or(o,n),o},or=(e,t)=>{if(!e.userData.canvas)return;const n=e.userData.canvas,r=e.userData.ctx,o=e.userData.texture,s=e.userData.label||"";r.fillStyle="#001100",r.fillRect(0,0,n.width,n.height),r.fillStyle="#00aa00",r.font="bold 20px monospace",r.textAlign="center",r.fillText(s,n.width/2,30),r.fillStyle="#00ff00",r.font="bold 36px monospace",r.fillText(t,n.width/2,80),o.needsUpdate=!0},sr=()=>{const e=new Y,t=new ge(.8,.15,.8),n=new O({color:dt}),r=new $(t,n);r.castShadow=!0,e.add(r);const o=new ge(.82,.05,.82),s=new O({color:16733525}),i=new $(o,s);i.position.y=.1,e.add(i);const a=new ke(.2,32),l=new H({color:16763904}),c=new $(a,l);return c.rotation.x=-Math.PI/2,c.position.y=.13,e.add(c),e},ir=(e,t,n="#ffffff")=>{if(!e.userData.canvas)return;const r=e.userData.canvas,o=e.userData.ctx,s=e.userData.texture,i=e.userData.fontSize||24;o.clearRect(0,0,r.width,r.height),o.fillStyle=n,o.font=`bold ${i}px Arial`,o.textAlign="center",o.textBaseline="middle",o.fillText(t,r.width/2,r.height/2),s.needsUpdate=!0},ar=({score:t,pizzasDelivered:n,pizzasDestroyed:r,currentOrder:o,pilotMode:s,cameraView:i,pizzaHealth:a,playerStats:l,dronePosition:c,currentPizzaType:d,isMobile:p=!1})=>{const[u,h]=e.useState(p);o&&Ye.find(e=>e.num===o.base);const f=void 0!==l?.xp?(e=>{const t=On(e),n=Fn.findIndex(e=>e.name===t.name);if(n>=Fn.length-1)return{nextRank:null,xpNeeded:0,progress:100};const r=Fn[n+1],o=e-t.minXP,s=r.minXP-t.minXP,i=Math.min(100,o/s*100);return{nextRank:r,xpNeeded:r.minXP-e,progress:i}})(l.xp):null,m=l?.rank;return p&&u?Ve.jsxs("div",{onClick:()=>h(!1),style:{position:"absolute",top:8,left:8,color:"white",fontFamily:"Arial, sans-serif",fontSize:"12px",background:"rgba(0,0,0,0.8)",padding:"8px 12px",borderRadius:"8px",backdropFilter:"blur(5px)",cursor:"pointer",zIndex:100,display:"flex",alignItems:"center",gap:"8px"},children:[Ve.jsx("span",{style:{color:"#FFD700",fontSize:"16px"},children:"üçï"}),Ve.jsxs("span",{style:{color:t<0?"#ff4444":"#00ff00"},children:["$",Math.abs(t).toFixed(0)]}),Ve.jsx("span",{style:{opacity:.7},children:"|"}),Ve.jsxs("span",{children:["üì¶ ",n]}),o&&Ve.jsxs(Ve.Fragment,{children:[Ve.jsx("span",{style:{opacity:.7},children:"|"}),Ve.jsxs("span",{style:{color:"#00ff88"},children:["üöÅ",o.drone]})]}),Ve.jsx("span",{style:{fontSize:"10px",opacity:.6,marginLeft:"4px"},children:"‚ñº"})]}):Ve.jsxs("div",{style:{position:"absolute",top:p?8:20,left:p?8:20,color:"white",fontFamily:"Arial, sans-serif",fontSize:p?"13px":"18px",background:"rgba(0,0,0,0.8)",padding:p?"10px":"15px",borderRadius:"10px",minWidth:p?"200px":"300px",maxWidth:p?"280px":"none",backdropFilter:"blur(5px)",zIndex:100},children:[Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:p?"6px":"10px"},children:[Ve.jsx("div",{style:{fontSize:p?"16px":"24px",fontWeight:"bold",color:"#FFD700"},children:"üçï Pizza Express"}),p&&Ve.jsx("button",{onClick:()=>h(!0),style:{background:"rgba(255,255,255,0.1)",border:"none",color:"#fff",fontSize:"14px",padding:"4px 8px",borderRadius:"4px",cursor:"pointer"},children:"‚ñ≤"})]}),Ve.jsxs("div",{style:{color:t<0?"#ff4444":"#00ff00"},children:["üíµ $",t<0?`-${Math.abs(t).toFixed(2)}`:t.toFixed(2),t<0&&Ve.jsx("span",{style:{fontSize:"10px",marginLeft:"4px"},children:"üò¨"})]}),Ve.jsxs("div",{children:["üì¶ ",n," delivered"]}),r>0&&Ve.jsxs("div",{style:{color:"#ff6666",fontSize:p?"11px":"14px"},children:["üí® ",r," dropped"]}),Ve.jsxs("div",{style:{marginTop:"6px",padding:"6px",background:"rgba(255,255,255,0.1)",borderRadius:"5px",fontSize:p?"11px":"14px"},children:[Ve.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[Ve.jsx("span",{style:{fontSize:p?"14px":"20px"},children:m?.emoji||"üê£"}),Ve.jsx("span",{style:{color:m?.color||"#888"},children:m?.name||"Trainee"}),m?.tipBonus>0&&!p&&Ve.jsxs("span",{style:{fontSize:"10px",background:"rgba(0,255,100,0.3)",padding:"2px 4px",borderRadius:"3px",color:"#00ff88"},children:["+",Math.round(100*m.tipBonus),"%"]})]}),f&&f.nextRank&&Ve.jsx("div",{style:{marginTop:"4px"},children:Ve.jsx("div",{style:{height:"4px",background:"rgba(255,255,255,0.2)",borderRadius:"2px",overflow:"hidden"},children:Ve.jsx("div",{style:{height:"100%",width:`${f.progress}%`,background:m?.color||"#888",borderRadius:"2px"}})})})]}),o&&Ve.jsxs("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(255,215,0,0.15)",borderRadius:"5px",fontSize:p?"11px":"14px"},children:[Ve.jsx("div",{style:{fontWeight:"bold",color:"#FFD700",marginBottom:"4px"},children:"Order:"}),d&&Ve.jsxs("div",{style:{color:"#ffcc00"},children:[d.emoji," ",d.name]}),Ve.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"4px"},children:[Ve.jsxs("span",{children:["üöÅ ",o.drone]}),Ve.jsxs("span",{children:["üè¢ #",o.base]})]})]}),s&&c&&!p&&Ve.jsxs("div",{style:{marginTop:"8px",padding:"6px",background:"rgba(0,150,255,0.2)",borderRadius:"5px",fontSize:"12px"},children:[Ve.jsx("div",{style:{color:"#00aaff"},children:"üìç Position:"}),Ve.jsxs("div",{children:["X: ",c.x?.toFixed(1)," | Z: ",c.z?.toFixed(1)]})]})]})},lr=({pizzaHealth:e,pizzaTilt:t,isMobile:n=!1})=>{const r=()=>e>=80?"#00ff00":e>=50?"#ffff00":e>=25?"#ff9900":"#ff0000",o=e<100;return Ve.jsxs("div",{style:{position:"absolute",bottom:n?160:80,left:n?130:20,background:o?"rgba(80,0,0,0.7)":"rgba(0,0,0,0.5)",padding:"8px 12px",borderRadius:"8px",color:"white",fontFamily:"Arial, sans-serif",border:o?"1px solid #ff4444":"1px solid #333",transition:"all 0.3s"},children:[Ve.jsx("div",{style:{fontSize:"10px",marginBottom:"4px",color:"#aaa"},children:"üçï PIZZA"}),Ve.jsx("div",{style:{width:"120px",height:"8px",background:"#333",borderRadius:"4px",overflow:"hidden"},children:Ve.jsx("div",{style:{width:`${e}%`,height:"100%",background:r(),transition:"width 0.2s"}})}),Ve.jsxs("div",{style:{fontSize:"10px",marginTop:"3px",display:"flex",justifyContent:"space-between"},children:[Ve.jsx("span",{style:{color:r()},children:e>=80?"‚úì Good":e>=50?"‚ö† Tilted":"‚ö† Damaged"}),Ve.jsxs("span",{style:{color:"#666"},children:[Math.round(e),"%"]})]})]})},cr=({speed:e,isWarning:t,pizzaHealth:n,isMobile:r=!1})=>{const o=Math.min(100,e/12*100),s=()=>e<7?"#00ff00":e<8.5?"#ffaa00":"#ff0000",i=e>=8.5;return Ve.jsxs("div",{style:{position:"absolute",bottom:r?80:20,left:r?130:20,background:i?"rgba(100,0,0,0.7)":"rgba(0,0,0,0.6)",padding:"8px 12px",borderRadius:"8px",color:"white",fontFamily:"Arial, sans-serif",border:i?"2px solid #ff0000":"1px solid #444",transition:"all 0.2s",minWidth:"140px"},children:[Ve.jsx("div",{style:{fontSize:"10px",marginBottom:"4px",color:"#aaa"},children:"üö∂ SPEED"}),Ve.jsx("div",{style:{width:"120px",height:"8px",background:"#333",borderRadius:"4px",overflow:"hidden",position:"relative"},children:Ve.jsx("div",{style:{width:`${o}%`,height:"100%",background:s(),transition:"width 0.1s"}})}),Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"3px",fontSize:"10px"},children:[Ve.jsx("span",{style:{color:s(),fontWeight:"bold"},children:e<7?"‚úì SAFE":e<8.5?"‚ö† CAREFUL":"üî• TOO FAST!"}),Ve.jsx("span",{style:{color:"#666"},children:e.toFixed(1)})]})]})},dr=({dronePosition:e,targetBase:t,currentOrder:n,altitude:r,verticalSpeed:o,heading:s=0})=>{if(!e||!t)return null;const i=t.x-e.x,a=t.z-e.z,l=Math.max(-50,Math.min(50,2*i)),c=Math.max(-40,Math.min(40,2*a)),d=(s||0)*(180/Math.PI)+180,p=r||1.5,u=Math.min(100,p/50*100),h=o||0;return Ve.jsxs("div",{style:{position:"absolute",top:20,right:20,width:"220px",background:"rgba(0,0,0,0.85)",border:"2px solid #00ff00",borderRadius:"10px",padding:"10px"},children:[Ve.jsx("div",{style:{color:"#00ff00",fontSize:"12px",fontWeight:"bold",marginBottom:"5px",textAlign:"center"},children:"üì° GPS NAVIGATION"}),Ve.jsxs("div",{style:{display:"flex",gap:"10px"},children:[Ve.jsxs("div",{style:{position:"relative",width:"120px",height:"100px",background:"rgba(0,50,0,0.5)",borderRadius:"5px"},children:[Ve.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:"8px",height:"8px",background:"#00ff00",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"blink 1s infinite",boxShadow:"0 0 8px #00ff00"}}),Ve.jsx("div",{style:{position:"absolute",left:`calc(50% + ${l}px)`,top:`calc(50% + ${c}px)`,width:"10px",height:"10px",background:"#ff0000",borderRadius:"50%",transform:"translate(-50%, -50%)",border:"2px solid #fff",animation:"pulse 0.5s infinite"}}),Ve.jsx("div",{style:{position:"absolute",left:`calc(50% + ${l}px)`,top:`calc(50% + ${c}px)`,width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"14px solid #ff0000",transform:`translate(-50%, calc(-50% - 12px)) rotate(${d}deg)`,transformOrigin:"50% 100%",filter:"drop-shadow(0 0 4px rgba(255,0,0,0.6))"}}),Ve.jsx("svg",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none"},children:Ve.jsx("line",{x1:"50%",y1:"50%",x2:`calc(50% + ${l}px)`,y2:`calc(50% + ${c}px)`,stroke:"#00ff00",strokeWidth:"1",strokeDasharray:"4,4",opacity:"0.5"})})]}),Ve.jsxs("div",{style:{width:"60px",display:"flex",flexDirection:"column",alignItems:"center"},children:[Ve.jsx("div",{style:{color:"#00ff00",fontSize:"10px",marginBottom:"3px"},children:"ALTITUDE"}),Ve.jsxs("div",{style:{width:"20px",height:"70px",background:"rgba(0,50,0,0.8)",border:"1px solid #00ff00",borderRadius:"3px",position:"relative",overflow:"hidden"},children:[Ve.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:`${u}%`,background:`linear-gradient(to top, #004400, ${p>30?"#ffaa00":"#00ff00"})`,transition:"height 0.1s"}}),[10,20,30,40].map(e=>Ve.jsx("div",{style:{position:"absolute",bottom:e/50*100+"%",left:0,right:0,borderTop:"1px dashed rgba(0,255,0,0.3)"}},e))]}),Ve.jsxs("div",{style:{color:"#00ff00",fontSize:"14px",fontWeight:"bold",marginTop:"3px"},children:[p.toFixed(1),"m"]}),Ve.jsxs("div",{style:{color:Math.abs(h)<.5?"#888888":h>0?"#00ff00":"#ff6600",fontSize:"16px",marginTop:"2px"},children:[Math.abs(h)<.5?"‚óè":h>0?"‚ñ≤":"‚ñº",Ve.jsx("span",{style:{fontSize:"10px",marginLeft:"2px"},children:Math.abs(h).toFixed(1)})]})]})]}),Ve.jsxs("div",{style:{color:"#00ff00",fontSize:"11px",textAlign:"center",marginTop:"5px"},children:["üéØ Base ",n?.base]})]})},pr=({distanceToBase:e,canRelease:t,canDescend:n,horizontalDist:r,altitude:o})=>{if(null===e||e>=50)return null;const s=t?{color:"#00ff00",message:"‚úì RELEASE ZONE",subMessage:"Press SPACE to Release Pizza!",pulse:!0}:n?{color:"#00ff00",message:"‚¨áÔ∏è DESCEND NOW",subMessage:`Centered! Land on roof (Alt: ${o?.toFixed(1)||"?"}m ‚Üí 7m)`,pulse:!0}:null!==r?r<5?{color:"#ffff00",message:`‚ÜîÔ∏è ${r.toFixed(1)}m off center`,subMessage:"Get directly OVER the beacon!",pulse:!1}:{color:"#ff9900",message:`üéØ ${Math.floor(e)}m to target`,subMessage:"Fly toward the beacon",pulse:!1}:{color:"#ff6600",message:`${Math.floor(e)}m`,subMessage:"Approach Base",pulse:!1};return Ve.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"42px",fontWeight:"bold",color:s.color,textShadow:"0 0 20px rgba(0,0,0,0.8)",animation:s.pulse?"pulse 0.5s infinite":"none",pointerEvents:"none",textAlign:"center"},children:[s.message,Ve.jsx("div",{style:{fontSize:"16px",marginTop:"5px",color:s.color},children:s.subMessage})]})},ur=({message:e})=>Ve.jsx("div",{style:{position:"absolute",bottom:120,left:"50%",transform:"translateX(-50%)",color:"white",fontFamily:"Arial, sans-serif",fontSize:"16px",background:"rgba(0,100,200,0.85)",padding:"12px 20px",borderRadius:"10px",maxWidth:"500px",textAlign:"center",backdropFilter:"blur(5px)"},children:e}),hr=({step:e,onNext:t,onSkip:n})=>{const r=Qe[e];return r?Ve.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:100},children:Ve.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",padding:"30px",borderRadius:"15px",maxWidth:"450px",textAlign:"center",color:"white",border:"2px solid #00ff00",boxShadow:"0 0 30px rgba(0,255,0,0.3)"},children:[Ve.jsxs("div",{style:{fontSize:"14px",color:"#00ff00",marginBottom:"10px"},children:["Step ",e+1," of ",Qe.length]}),Ve.jsx("h2",{style:{color:"#FFD700",marginBottom:"15px",fontSize:"24px"},children:r.title}),Ve.jsx("p",{style:{fontSize:"16px",lineHeight:"1.6",marginBottom:"25px"},children:r.message}),Ve.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center"},children:[Ve.jsx("button",{onClick:n,style:{padding:"10px 20px",background:"#444",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:"Skip Tutorial"}),Ve.jsx("button",{onClick:t,style:{padding:"10px 30px",background:"#00ff00",color:"#000",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:e<Qe.length-1?"Next ‚Üí":"Start Playing!"})]})]})}):null},fr=()=>Ve.jsxs("div",{style:{position:"absolute",bottom:70,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.8)",color:"white",padding:"10px 20px",borderRadius:"8px",fontFamily:"Arial, sans-serif",fontSize:"13px"},children:[Ve.jsx("span",{style:{color:"#FFD700"},children:"W"}),": Forward |",Ve.jsx("span",{style:{color:"#FFD700"},children:" S"}),": Back |",Ve.jsx("span",{style:{color:"#FFD700"},children:" A/D"}),": Turn |",Ve.jsx("span",{style:{color:"#FFD700"},children:" Space"}),": Up |",Ve.jsx("span",{style:{color:"#FFD700"},children:" Shift"}),": Down |",Ve.jsx("span",{style:{color:"#FFD700"},children:" V"}),": Camera"]}),mr=({badge:e})=>e?Ve.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #4a1a6b 0%, #1a0a2e 100%)",padding:"30px",borderRadius:"20px",textAlign:"center",color:"white",border:"3px solid #9966ff",boxShadow:"0 0 50px #9966ff40, 0 0 100px #6633ff30",animation:"popIn 0.5s ease-out",zIndex:200,minWidth:"300px"},children:[Ve.jsx("div",{style:{fontSize:"14px",color:"#cc99ff",marginBottom:"10px"},children:"üéñÔ∏è NEW BADGE EARNED! üéñÔ∏è"}),Ve.jsx("div",{style:{fontSize:"60px",marginBottom:"10px"},children:e.emoji}),Ve.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#ffd700",marginBottom:"10px"},children:e.name}),Ve.jsx("div",{style:{fontSize:"14px",color:"#cc99ff",fontStyle:"italic"},children:e.description})]}):null,gr=({message:e})=>{if(!e)return null;const t=e.includes("PROMOTED")||e.includes("RANK UP");return Ve.jsx("div",{style:{position:"absolute",top:"25%",left:"50%",transform:"translate(-50%, -50%)",background:t?"linear-gradient(135deg, #1a4a2a 0%, #0a2e1a 100%)":"linear-gradient(135deg, #4a1a1a 0%, #2e0a0a 100%)",padding:"20px 40px",borderRadius:"15px",textAlign:"center",color:"white",border:"3px solid "+(t?"#00ff66":"#ff4444"),boxShadow:"0 0 30px "+(t?"#00ff6640":"#ff444440"),animation:"popIn 0.3s ease-out",zIndex:180,fontSize:"18px",fontWeight:"bold"},children:e})},xr=({info:t,actions:n={},bindings:r={},getButtonLabel:o,overlayVisible:s,onToggleOverlay:i,isMobile:a=!1})=>{const[l,c]=e.useState(!1),d=t?.connected;return a?Ve.jsx("div",{style:{position:"absolute",top:10,right:10,zIndex:s?210:140},children:l?Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.9)",borderRadius:"12px",padding:"12px",minWidth:"180px",border:d?"1px solid #00ff99":"1px solid rgba(255,255,255,0.2)"},children:[Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[Ve.jsx("span",{style:{color:d?"#00ff99":"#ffcc66",fontWeight:"bold",fontSize:"12px",animation:d?"none":"pulseText 1.5s ease-in-out infinite"},children:d?"üéÆ Connected":"üéÆ Press any button"}),Ve.jsx("button",{onClick:()=>c(!1),style:{background:"transparent",border:"none",color:"#fff",fontSize:"18px",cursor:"pointer",padding:"0 4px"},children:"√ó"})]}),d&&Ve.jsx("button",{onClick:i,style:{width:"100%",padding:"8px",borderRadius:"6px",border:"none",background:s?"#5555ff":"#1d8fff",color:"#fff",fontSize:"12px",fontWeight:"bold",cursor:"pointer"},children:s?"Close":"Customize"})]}):Ve.jsx("button",{onClick:()=>c(!0),style:{width:"44px",height:"44px",borderRadius:"50%",border:d?"2px solid #00ff99":"2px solid rgba(255,255,255,0.3)",background:"rgba(0,0,0,0.75)",color:d?"#00ff99":"#888",fontSize:"20px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"üéÆ"})}):Ve.jsxs("div",{style:{position:"absolute",top:20,right:20,minWidth:"220px",background:"rgba(0,0,0,0.75)",color:"#fff",borderRadius:"12px",padding:"14px 18px",fontFamily:"Arial, sans-serif",fontSize:"13px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)",border:d?"1px solid #00ff99":"1px solid rgba(255,255,255,0.2)",zIndex:s?210:140},children:[Ve.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"6px",color:d?"#00ff99":"#ffcc66"},children:d?"üéÆ Gamepad Connected":"üéÆ No Gamepad Detected"}),d?Ve.jsxs(Ve.Fragment,{children:[Ve.jsx("div",{style:{opacity:.8,marginBottom:"8px"},children:t?.id||"Unknown Controller"}),Ve.jsxs("div",{style:{fontSize:"11px",opacity:.6,marginBottom:"6px"},children:["Mapping: ",t?.mapping||"standard"," ‚Ä¢ Buttons: ",t?.buttons??"‚Äì"]}),Ve.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",marginBottom:"10px"},children:["primary","secondary","startOrder"].map(e=>n[e]?Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px"},children:[Ve.jsx("span",{style:{opacity:.8},children:n[e]}),Ve.jsx("span",{style:{color:"#FFD700"},children:o?o(r[e]):r[e]})]},e):null)})]}):Ve.jsxs("div",{style:{opacity:.8,marginBottom:"10px",animation:"pulseText 1.5s ease-in-out infinite",color:"#ffcc66"},children:["üéÆ Press any button to connect",Ve.jsx("style",{children:"\n            @keyframes pulseText {\n              0%, 100% { opacity: 0.5; }\n              50% { opacity: 1; }\n            }\n          "})]}),Ve.jsx("button",{onClick:i,disabled:!d,style:{width:"100%",padding:"8px 0",borderRadius:"8px",border:"none",cursor:d?"pointer":"not-allowed",background:d?s?"#5555ff":"#1d8fff":"#555",color:"#fff",fontWeight:"bold",transition:"background 0.2s"},children:s?"Close Remap":"Customize Controls"})]})},yr=({info:e,actions:t={},bindings:n={},getButtonLabel:r,pendingBinding:o,onStartRemap:s,onCancelRemap:i,onResetBindings:a,onClose:l})=>{const c=Object.entries(t);return Ve.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:220},children:Ve.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(10,20,40,0.95), rgba(5,10,25,0.95))",borderRadius:"18px",padding:"24px 28px",width:"420px",color:"#fff",border:"1px solid rgba(0,255,153,0.4)",boxShadow:"0 20px 40px rgba(0,0,0,0.5)"},children:[Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[Ve.jsx("h2",{style:{margin:0,fontSize:"20px"},children:"Gamepad Controls"}),Ve.jsx("button",{onClick:l,style:{background:"transparent",border:"none",color:"#fff",fontSize:"20px",cursor:"pointer"},children:"√ó"})]}),Ve.jsx("div",{style:{fontSize:"13px",opacity:.75,marginBottom:"14px"},children:e?.connected?`Remap buttons for ${e.id||"your controller"}.`:"Connect a controller to customize bindings."}),Ve.jsx("div",{style:{maxHeight:"240px",overflowY:"auto",paddingRight:"6px",marginBottom:"18px"},children:c.map(([e,t])=>{const a=n[e],l=o===e,c=r?r(a):a;return Ve.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.08)",background:l?"rgba(30,120,255,0.2)":"transparent"},children:[Ve.jsxs("div",{style:{flex:1},children:[Ve.jsx("div",{style:{fontWeight:"bold"},children:t}),Ve.jsx("div",{style:{fontSize:"12px",opacity:.7},children:l?"Waiting for button input‚Ä¶":c||"Unassigned"})]}),Ve.jsx("button",{onClick:()=>{l?i?.():s?.(e)},style:{padding:"6px 12px",borderRadius:"6px",border:"none",cursor:"pointer",background:l?"#aa3333":"#1d8fff",color:"#fff",fontWeight:"bold"},children:l?"Cancel":"Remap"})]},e)})}),Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Ve.jsx("button",{onClick:()=>a?.(),style:{background:"#333",border:"1px solid rgba(255,255,255,0.2)",color:"#fff",borderRadius:"6px",padding:"8px 12px",cursor:"pointer"},children:"Reset Defaults"}),o&&Ve.jsx("div",{style:{fontSize:"12px",opacity:.8},children:"Press a button to complete remap."})]})]})})},br=({visible:e})=>e?Ve.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.85)",color:"#fff",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",padding:"24px",zIndex:260,pointerEvents:"auto"},children:[Ve.jsx("div",{style:{fontSize:"54px",marginBottom:"12px"},children:"üîÑ"}),Ve.jsx("h2",{style:{fontSize:"24px",marginBottom:"10px"},children:"Rotate Your Device"}),Ve.jsx("p",{style:{fontSize:"16px",maxWidth:"320px",lineHeight:1.5,opacity:.85},children:"For the best mobile experience, play in landscape mode. Rotate your phone or tablet to continue delivering pizzas."})]}):null,vr=({visible:t,pilotMode:n,canRelease:r,onControlChange:o,onRelease:s,isTouchDevice:i=!1})=>{const[a,l]=e.useState(!1),[c,d]=e.useState({x:0,y:0}),p=e.useRef(null),u=e.useRef({x:0,y:0}),h="undefined"==typeof window||"ontouchstart"in window||"undefined"!=typeof navigator&&(navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);if(!t||!i&&!h)return null;const f=.15,m=e=>{e.preventDefault(),e.stopPropagation();const t=e.touches?e.touches[0]:e,n=p.current?.getBoundingClientRect();n&&(u.current={x:n.left+n.width/2,y:n.top+n.height/2}),l(!0),y(t.clientX,t.clientY)},g=e=>{if(!a)return;e.preventDefault();const t=e.touches?e.touches[0]:e;y(t.clientX,t.clientY)},x=e=>{e.preventDefault(),l(!1),d({x:0,y:0}),o?.("forward",!1),o?.("back",!1),o?.("left",!1),o?.("right",!1)},y=(e,t)=>{const n=u.current;let r=e-n.x,s=t-n.y;const i=Math.sqrt(r*r+s*s);i>50&&(r=r/i*50,s=s/i*50),d({x:r,y:s});const a=r/50,l=s/50;o?.("forward",l<-.15),o?.("back",l>f),o?.("left",a<-.15),o?.("right",a>f)},b=({action:e,icon:t,label:n,disabled:r})=>{const s=t=>n=>{r||(n.preventDefault(),n.stopPropagation(),o?.(e,t))};return Ve.jsx("button",{type:"button",onPointerDown:s(!0),onPointerUp:s(!1),onPointerLeave:s(!1),onPointerCancel:s(!1),onContextMenu:e=>e.preventDefault(),disabled:r,style:{width:"48px",height:"48px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.15)",background:r?"rgba(40,40,40,0.5)":"rgba(10,10,10,0.6)",color:"#fff",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:"16px",backdropFilter:"blur(6px)",touchAction:"none",opacity:r?.35:.9,pointerEvents:r?"none":"auto"},children:t})};return Ve.jsxs("div",{style:{position:"absolute",left:0,right:0,bottom:12,display:"flex",justifyContent:"space-between",padding:"0 16px",pointerEvents:"none",zIndex:200},children:[Ve.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px",pointerEvents:"auto"},children:[Ve.jsx("div",{style:{color:"#fff",fontSize:"10px",opacity:.6,marginBottom:"2px"},children:n?"‚úàÔ∏è FLY":"üö∂ WALK"}),Ve.jsx("div",{ref:p,onTouchStart:m,onTouchMove:g,onTouchEnd:x,onTouchCancel:x,onMouseDown:m,onMouseMove:g,onMouseUp:x,onMouseLeave:x,style:{width:"120px",height:"120px",borderRadius:"50%",background:"rgba(0,0,0,0.5)",border:"2px solid rgba(255,255,255,0.2)",position:"relative",touchAction:"none",backdropFilter:"blur(8px)"},children:Ve.jsx("div",{style:{position:"absolute",width:"50px",height:"50px",borderRadius:"50%",background:a?"linear-gradient(135deg, #1d8fff, #0066cc)":"rgba(255,255,255,0.3)",border:"2px solid rgba(255,255,255,0.5)",left:"50%",top:"50%",transform:`translate(calc(-50% + ${c.x}px), calc(-50% + ${c.y}px))`,transition:a?"none":"transform 0.15s ease-out",boxShadow:a?"0 0 15px rgba(29, 143, 255, 0.5)":"none"}})}),n&&Ve.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"6px"},children:[Ve.jsx(b,{action:"up",icon:"‚¨ÜÔ∏è",label:"Up",disabled:!1}),Ve.jsx(b,{action:"down",icon:"‚¨áÔ∏è",label:"Down",disabled:!1})]})]}),Ve.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px",alignItems:"flex-end",pointerEvents:"none"},children:[Ve.jsx("div",{style:{background:"rgba(0,0,0,0.6)",color:"#fff",padding:"6px 10px",borderRadius:"10px",fontSize:"10px",border:"1px solid rgba(255,255,255,0.2)"},children:'Tap "Release Pizza" button to drop'}),!n&&Ve.jsx("div",{style:{background:"rgba(0,0,0,0.5)",padding:"6px 8px",borderRadius:"8px",fontSize:"9px",color:"#bbb"},children:"Camera controls available while flying"})]})]})},wr=({isOpen:e,onClose:t,category:n,onCategoryChange:r,playerRank:o,playerScore:s})=>{if(!e)return null;const i=tr[n]||[],a=e=>{switch(e){case"fastest_delivery":return"‚ö° Fastest Delivery";case"most_deliveries":return"üì¶ Most Deliveries";case"store_earnings":return"üè™ Store Earnings";case"perfect_pizzas":return"‚≠ê Perfect Pizzas";case"most_dropped_pizzas":return"üí® Most Dropped";case"bestRating":return"üåü Best Rating";case"total_wages":return"üíµ Total Wages";case"daily_earnings":return"üìÖ Daily Earnings";default:return e}};return Ve.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},children:Ve.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #0f0f23 100%)",padding:"25px",borderRadius:"15px",minWidth:"400px",maxWidth:"500px",color:"white",border:"2px solid #FFD700",boxShadow:"0 0 40px rgba(255,215,0,0.3)"},children:[Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[Ve.jsx("h2",{style:{color:"#FFD700",margin:0,fontSize:"24px"},children:"üèÜ LEADERBOARDS"}),Ve.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#888",fontSize:"24px",cursor:"pointer"},children:"‚úï"})]}),Ve.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"20px"},children:Object.keys(tr).map(e=>Ve.jsx("button",{onClick:()=>r(e),style:{padding:"8px 12px",background:n===e?"#FFD700":"#333",color:n===e?"#000":"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"12px",fontWeight:n===e?"bold":"normal"},children:a(e)},e))}),Ve.jsx("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",padding:"15px"},children:i.map((e,t)=>Ve.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px",borderBottom:t<i.length-1?"1px solid #333":"none",background:t<3?"rgba(255,215,0,0.1)":"transparent"},children:[Ve.jsx("div",{style:{width:"35px",fontSize:"20px",textAlign:"center"},children:0===t?"ü•á":1===t?"ü•à":2===t?"ü•â":`#${e.rank}`}),Ve.jsx("div",{style:{flex:1,paddingLeft:"10px",fontWeight:t<3?"bold":"normal"},children:e.name}),Ve.jsx("div",{style:{color:e.value<0?"#ff4444":t<3?"#FFD700":"#aaa",fontWeight:"bold",fontSize:"16px"},children:"$"===e.unit?e.value<0?`-$${Math.abs(e.value).toLocaleString()}`:`$${e.value.toLocaleString()}`:"s"===e.unit?`${e.value}s`:e.value.toLocaleString()})]},t))}),o&&Ve.jsxs("div",{style:{marginTop:"15px",padding:"12px",background:"rgba(0,255,0,0.1)",borderRadius:"8px",border:"1px solid #00ff00",display:"flex",alignItems:"center"},children:[Ve.jsx("div",{style:{fontSize:"16px",marginRight:"10px"},children:"üìç"}),Ve.jsxs("div",{style:{flex:1},children:[Ve.jsx("div",{style:{fontSize:"12px",color:"#888"},children:"Your Position"}),Ve.jsxs("div",{style:{fontWeight:"bold"},children:["#",o]})]}),Ve.jsx("div",{style:{color:"#00ff00",fontWeight:"bold",fontSize:"18px"},children:s})]}),Ve.jsx("div",{style:{marginTop:"15px",fontSize:"11px",color:"#666",textAlign:"center"},children:"daily_earnings"===n?"‚è∞ Resets daily at midnight":"üîÑ Weekly reset every Sunday"})]})})},Sr=({topPlayers:t,playerRank:n,onExpand:r})=>{const[o,s]=e.useState(!1);return Ve.jsxs("div",{style:{position:"absolute",top:160,right:20,background:"rgba(0,0,0,0.8)",padding:"12px",borderRadius:"10px",minWidth:"180px",color:"white",fontFamily:"Arial, sans-serif"},children:[Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:o?0:"8px",borderBottom:o?"none":"1px solid #333",paddingBottom:o?0:"8px"},children:[Ve.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#FFD700"},children:"üèÜ Top Players"}),Ve.jsxs("div",{style:{display:"flex",gap:"6px"},children:[Ve.jsx("button",{onClick:()=>s(e=>!e),style:{background:"transparent",border:"1px solid #444",color:"#fff",padding:"2px 6px",borderRadius:"4px",cursor:"pointer",fontSize:"10px"},children:o?"‚ñº":"‚ñ≤"}),Ve.jsx("button",{onClick:r,style:{background:"transparent",border:"1px solid #FFD700",color:"#FFD700",padding:"2px 8px",borderRadius:"4px",cursor:"pointer",fontSize:"10px"},children:"View All"})]})]}),!o&&Ve.jsxs(Ve.Fragment,{children:[t?.slice(0,3).map((e,t)=>Ve.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",padding:"3px 0",color:0===t?"#FFD700":"#aaa"},children:[Ve.jsxs("span",{children:[0===t?"ü•á":1===t?"ü•à":"ü•â"," ",e.name]}),Ve.jsx("span",{children:e.value})]},t)),n&&Ve.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid #333",fontSize:"11px",color:"#00ff00"},children:["üìç You: #",n]})]})]})},Tr=({deliveryTime:e,tip:t,pizzaHealth:n,isPerfect:r,temperature:o,rating:s,tipMessage:i,pizzaType:a,xpChange:l,rankBonus:c,playerRank:d,totalDeliveries:p,onNextOrder:u,onViewLeaderboard:h})=>{const f=((e,t)=>{const n=(e>=99?3:e>=80?2.5:e>=60?2:e>=40?1:.5)+(t<30?2:t<45?1.5:t<60?1:t<90?.5:0);return n>=4.5?{label:"LEGENDARY",emoji:"üåüüåüüåüüåüüåü",color:"#FFD700"}:n>=4?{label:"EXCELLENT",emoji:"‚≠ê‚≠ê‚≠ê‚≠ê‚ú®",color:"#00ff00"}:n>=3.5?{label:"GREAT",emoji:"‚≠ê‚≠ê‚≠ê‚≠ê",color:"#88ff00"}:n>=3?{label:"GOOD",emoji:"‚≠ê‚≠ê‚≠ê‚ú®",color:"#ccff00"}:n>=2.5?{label:"OKAY",emoji:"‚≠ê‚≠ê‚≠ê",color:"#ffff00"}:n>=2?{label:"MEH",emoji:"‚≠ê‚≠ê‚ú®",color:"#ffcc00"}:n>=1.5?{label:"POOR",emoji:"‚≠ê‚≠ê",color:"#ff9900"}:n>=1?{label:"BAD",emoji:"‚≠ê‚ú®",color:"#ff6600"}:{label:"DISASTER",emoji:"üíÄ",color:"#ff0000"}})(n,e),m=o||{temp:e<30?"PIPING HOT":e<45?"HOT":e<60?"WARM":e<90?"LUKEWARM":"COLD",emoji:e<30?"üî•üî•üî•":e<45?"üî•üî•":e<60?"üî•":e<90?"üòê":"ü•∂",color:e<30?"#ff4400":e<45?"#ff6600":e<60?"#ff9900":e<90?"#ffcc00":"#0099ff"},g=0===t;return Ve.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:150},children:Ve.jsxs("div",{style:{background:g?"linear-gradient(135deg, #4a1a1a 0%, #2d0d0d 100%)":"linear-gradient(135deg, #1a472a 0%, #0d2818 100%)",padding:"30px",borderRadius:"20px",textAlign:"center",color:"white",border:`3px solid ${g?"#ff4444":f.color}`,boxShadow:"0 0 50px "+(g?"#ff444440":f.color+"40"),animation:"popIn 0.3s ease-out",minWidth:"400px"},children:[a&&Ve.jsxs("div",{style:{fontSize:"14px",color:"#ffcc00",marginBottom:"10px"},children:[a.emoji," ",a.name]}),Ve.jsx("div",{style:{fontSize:"50px",marginBottom:"5px"},children:g?"üò§":r?"üåü":n>=80?"‚úÖ":n>=50?"üòÖ":"üò¨"}),Ve.jsx("h2",{style:{color:g?"#ff4444":f.color,fontSize:"28px",marginBottom:"5px"},children:g?"DELIVERY... COMPLETE?":r?"PERFECT DELIVERY!":"DELIVERY COMPLETE!"}),Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.4)",padding:"15px",borderRadius:"12px",marginBottom:"15px"},children:[Ve.jsx("div",{style:{fontSize:"32px",letterSpacing:"3px",marginBottom:"5px"},children:f.emoji}),Ve.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:f.color,letterSpacing:"2px"},children:f.label})]}),Ve.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",marginBottom:"15px"},children:[Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[Ve.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"‚è±Ô∏è Time"}),Ve.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold"},children:[e.toFixed(1),"s"]})]}),Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[Ve.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üçï Condition"}),Ve.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:n>=80?"#00ff00":n>=50?"#ffcc00":"#ff6600"},children:[Math.round(n),"%"]})]}),Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[Ve.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üå°Ô∏è Temp"}),Ve.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:m.color},children:m.emoji}),Ve.jsx("div",{style:{fontSize:"10px",color:m.color},children:m.temp})]})]}),Ve.jsx("div",{style:{fontSize:g?"28px":"36px",fontWeight:"bold",color:g?"#ff4444":"#FFD700",marginBottom:"5px"},children:g?"üò§ NO TIP!":`üí∞ +$${t.toFixed(2)} TIP!`}),i&&Ve.jsxs("div",{style:{fontSize:"14px",color:g?"#ff9999":t<3?"#ffcc99":"#99ff99",marginBottom:"10px",fontStyle:"italic",padding:"8px",background:"rgba(0,0,0,0.3)",borderRadius:"8px"},children:["üí¨ ",i]}),Ve.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"15px",marginBottom:"15px"},children:[void 0!==l&&0!==l&&Ve.jsxs("div",{style:{background:l>0?"rgba(0,255,100,0.2)":"rgba(255,0,0,0.2)",border:"1px solid "+(l>0?"#00ff66":"#ff4444"),padding:"8px 15px",borderRadius:"8px"},children:[Ve.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"‚≠ê XP"}),Ve.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:l>0?"#00ff66":"#ff4444"},children:[l>0?"+":"",l]})]}),c>0&&Ve.jsxs("div",{style:{background:"rgba(255,215,0,0.2)",border:"1px solid #FFD700",padding:"8px 15px",borderRadius:"8px"},children:[Ve.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üëë Rank Bonus"}),Ve.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#FFD700"},children:["+",Math.round(100*c),"%"]})]})]}),d&&Ve.jsx("div",{style:{background:"rgba(100,50,200,0.2)",border:"1px solid #9966ff",padding:"8px 15px",borderRadius:"8px",marginBottom:"10px"},children:Ve.jsxs("div",{style:{fontSize:"16px",color:"#cc99ff"},children:[d.emoji," ",d.name]})}),Ve.jsxs("div",{style:{fontSize:"14px",color:"#888",marginBottom:"20px"},children:["Total Deliveries: ",p]}),Ve.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center"},children:[Ve.jsx("button",{onClick:h,style:{padding:"12px 24px",background:"#333",color:"#FFD700",border:"1px solid #FFD700",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:"üèÜ Leaderboard"}),Ve.jsx("button",{onClick:u,style:{padding:"12px 30px",background:"#00ff00",color:"#000",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:"Next Order ‚Üí"})]})]})})},zr={primary:{padding:"15px 30px",fontSize:"18px",fontWeight:"bold",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"all 0.2s ease"},secondary:{padding:"12px 24px",fontSize:"16px",fontWeight:"bold",background:"#555",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},danger:{padding:"15px 30px",fontSize:"18px",fontWeight:"bold",background:"#FF5722",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"}},Rr=["A / Cross","B / Circle","X / Square","Y / Triangle","LB / L1","RB / R1","LT / L2","RT / R2","View / Select","Menu / Start","Left Stick Press","Right Stick Press","D-Pad Up","D-Pad Down","D-Pad Left","D-Pad Right"],Ar={primary:"Primary Action",secondary:"Secondary Action",startOrder:"Start Order",recenter:"Recenter View",cameraToggle:"Toggle Camera"},Er={primary:0,secondary:1,startOrder:3,recenter:8,cameraToggle:9},kr=()=>{const t=e.useRef(null),[n,r]=e.useState("menu"),[o,s]=e.useState(null),[i,a]=e.useState(0),[l,c]=e.useState(0),[d,u]=e.useState(0),[h,f]=e.useState("Welcome to Pizza Express VR!"),[m,x]=e.useState(!1),[b,w]=e.useState(null),[S,T]=e.useState("third"),[z,R]=e.useState(null),[A,E]=e.useState(!1),[k,M]=e.useState(!1),[D,C]=e.useState(null),[j,P]=e.useState("ascending"),[I,L]=e.useState(!1),[_,N]=e.useState(null),[U,G]=e.useState(!1),[W,X]=e.useState(!1),[K,q]=e.useState(null),[Q,ee]=e.useState(null),[te,ne]=e.useState(100),[re,oe]=e.useState({x:0,z:0}),[se,ie]=e.useState(!1),[ae,le]=e.useState(0),[ce,de]=e.useState(!1),[pe,ue]=e.useState("fastest_delivery"),[he,fe]=e.useState(!1),[xe,Ne]=e.useState(null),[Fe,Oe]=e.useState(null),[Be,He]=e.useState({totalDeliveries:0,totalEarnings:0,destroyedPizzas:0,bestTime:null,rank:Fn[0],xp:0,level:1,badges:[],pizzaTypeDeliveries:{},perfectDeliveries:0,totalTips:0,fastestDelivery:null,storeEarnings:0}),[Ue,Ge]=e.useState(null),[We,$e]=e.useState(null),Xe=e.useRef(null),[Ke,dt]=e.useState(!1),[pt,ut]=e.useState(!1),[ht,ft]=e.useState(!1),mt=e.useRef(null),gt=e.useRef(100),xt=e.useRef(!1),yt=e.useRef(null),bt=e.useRef(null),vt=e.useRef(null),wt=e.useRef(null),St=e.useRef(null),Tt=e.useRef(null),zt=e.useRef(!1),Rt=e.useRef(null),At=e.useRef(!1),Et=e.useRef(null),kt=e.useRef(!1),Mt=e.useRef(!1),Dt=e.useRef(null),Ct=e.useRef(0),jt=e.useRef(0),Pt=e.useRef({connected:!1,index:null,mapping:"standard",lastButtons:[],lastAxes:[],lastTimestamp:0}),It=e.useRef({scene:null,camera:null,renderer:null,drones:[],bases:[],pizzaShop:null,currentDrone:null,pizzaAttached:!1,controls:{forward:!1,back:!1,left:!1,right:!1,up:!1,down:!1,turnLeft:!1,turnRight:!1},keyboardControls:{forward:!1,back:!1,left:!1,right:!1,up:!1,down:!1},gamepadControls:{forward:!1,back:!1,left:!1,right:!1,up:!1,down:!1,turnLeft:!1,turnRight:!1},lastDroneVelocity:{x:0,y:0,z:0},xrManager:null,vrButton:null,player:null,playerPizza:null,playerHeadset:null,playerControllers:[],playerPilotTablet:null,playerDirectionIndicator:null,playerControls:{forward:!1,back:!1,left:!1,right:!1,turnLeft:!1,turnRight:!1},keyboardPlayerControls:{forward:!1,back:!1,left:!1,right:!1},gamepadPlayerControls:{forward:!1,back:!1,left:!1,right:!1,turnLeft:!1,turnRight:!1},lastPlayerVelocity:{x:0,z:0},sustainedSpeed:0,lastMoveTime:0,moveAccumulator:0,activePizzaDrops:[]}),[Lt,_t]=e.useState({x:0,y:0,z:10}),[Nt,Ft]=e.useState(null),[Ot,Bt]=e.useState(!1),[Ht,Ut]=e.useState({connected:!1,id:null,mapping:"standard"}),[Gt,Wt]=e.useState({...Er}),[$t,Vt]=e.useState(null),[Xt,Kt]=e.useState(!1),[qt,Yt]=e.useState(!1),[Jt,Zt]=e.useState(!0),Qt=e.useRef(Gt),en=e.useRef(null),tn=e.useCallback(e=>null==e?"Unassigned":Rr[e]||`Button ${e}`,[]),nn=e.useCallback((e,t)=>{null!=t&&(Wt(n=>{const r={...n};return Object.keys(r).forEach(n=>{n!==e&&r[n]===t&&(r[n]=null)}),r[e]=t,r}),Vt(null),f(`üéÆ ${tn(t)} mapped to ${Ar[e]}`))},[tn]),rn=e.useCallback(()=>{Wt({...Er}),Vt(null),f("üéÆ Gamepad bindings reset to defaults")},[]),on=e.useCallback(e=>{Vt(e),Kt(!0);f(`üéÆ Press any button for ${Ar[e]||e}`)},[]),sn=e.useCallback(()=>{Vt(null),f("üéÆ Remap cancelled")},[]);e.useEffect(()=>{if("undefined"==typeof window)return;const e=()=>{Yt((()=>{const e=navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,t=!!window.matchMedia&&window.matchMedia("(pointer: coarse)").matches;return"ontouchstart"in window||e||t})())};let t;return e(),window.matchMedia&&(t=window.matchMedia("(pointer: coarse)"),t.addEventListener?t.addEventListener("change",e):t.addListener&&t.addListener(e)),()=>{t&&(t.removeEventListener?t.removeEventListener("change",e):t.removeListener&&t.removeListener(e))}},[]),e.useEffect(()=>{if("undefined"==typeof window)return;const e=()=>{Zt(window.innerWidth>=window.innerHeight)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]);const an=e.useCallback(()=>{T(e=>"third"===e?"pov":"pov"===e?"overhead":"third")},[]),ln=e.useCallback(e=>{const t=It.current.playerHeadset;t&&(t.visible=!!e);const n=It.current.playerControllers;n?.length&&n.forEach(t=>{t&&(t.visible=!!e)});const r=It.current.playerPilotTablet;r&&(r.visible=!!e);const o=It.current.playerDirectionIndicator;o&&(o.visible=!e);const s=It.current.player;s&&(s.userData.isPiloting=e)},[]),cn=e.useCallback((e,t)=>{if(!e||!t||!It.current.scene)return;const n=e.position.clone(),r=t.clone(),o=900+400*Math.random();It.current.activePizzaDrops.push({mesh:e,start:n,end:r,duration:o,startTime:performance.now(),spin:{x:.05*(Math.random()-.5),y:.05*(Math.random()-.5),z:.05*(Math.random()-.5)}})},[]),dn=e.useCallback((e,t)=>{const n=m?It.current.keyboardControls:It.current.keyboardPlayerControls;if(n&&Object.prototype.hasOwnProperty.call(n,e))n[e]=t;else if(m&&("up"===e||"down"===e)){const n=It.current.keyboardControls;n&&Object.prototype.hasOwnProperty.call(n,e)&&(n[e]=t)}},[m]),pn=e.useCallback(()=>{const e=It.current.keyboardControls;e&&Object.keys(e).forEach(t=>{e[t]=!1});const t=It.current.keyboardPlayerControls;t&&Object.keys(t).forEach(e=>{t[e]=!1})},[]);e.useEffect(()=>{qt||pn()},[qt,pn]),e.useEffect(()=>{qt&&pn()},[m,qt,pn]),e.useEffect(()=>{Jt||pn()},[Jt,pn]),e.useEffect(()=>{if("undefined"==typeof window)return;const e=It.current.renderer;if(e){const t=qt?1.5:2,n=Math.min(window.devicePixelRatio||1,t);e.setPixelRatio(n)}},[qt]);const[un,hn]=e.useState(1.5),[fn,mn]=e.useState(0),[gn,xn]=e.useState(0),[yn,bn]=e.useState(!1);e.useEffect(()=>{xt.current=m},[m]),e.useEffect(()=>{ln(m)},[m,ln]),e.useEffect(()=>{Et.current=o},[o]),e.useEffect(()=>{kt.current=I},[I]),e.useEffect(()=>{Mt.current=Ot},[Ot]),e.useEffect(()=>{Dt.current=Nt},[Nt]),e.useEffect(()=>{Ct.current=i},[i]),e.useEffect(()=>{jt.current=l},[l]),e.useEffect(()=>{Qt.current=Gt},[Gt]),e.useEffect(()=>{en.current=$t},[$t]),e.useEffect(()=>{zt.current=W},[W]),e.useEffect(()=>{Rt.current=K},[K]),e.useEffect(()=>{At.current=he},[he]),e.useEffect(()=>{const e=e=>{const t=e.gamepad;Pt.current={connected:!0,index:t.index,mapping:t.mapping||"standard",lastButtons:t.buttons.map(e=>e.pressed),lastAxes:[...t.axes],lastTimestamp:t.timestamp||performance.now()},Ut({connected:!0,id:t.id,mapping:t.mapping||"standard",buttons:t.buttons.length}),f("üéÆ Gamepad connected")},t=e=>{Pt.current.index===e.gamepad.index&&(Pt.current={connected:!1,index:null,mapping:"standard",lastButtons:[],lastAxes:[],lastTimestamp:0},Ut({connected:!1,id:null,mapping:"standard"}),f("üéÆ Gamepad disconnected"))};if(window.addEventListener("gamepadconnected",e),window.addEventListener("gamepaddisconnected",t),navigator.getGamepads){const t=navigator.getGamepads();for(const n of t)if(n){e({gamepad:n});break}}return()=>{window.removeEventListener("gamepadconnected",e),window.removeEventListener("gamepaddisconnected",t)}},[]),e.useEffect(()=>{const e=(()=>{try{const e=parseInt(localStorage.getItem(Xn))||0,t=On(e),n=localStorage.getItem(Kn),r=localStorage.getItem(qn),o=localStorage.getItem(er);return{totalWages:parseFloat(localStorage.getItem(Un))||0,totalDeliveries:parseInt(localStorage.getItem(Gn))||0,totalDestroyed:parseInt(localStorage.getItem(Wn))||0,bestTime:parseFloat(localStorage.getItem($n))||null,playerName:localStorage.getItem(Vn)||"Rookie Pilot",xp:e,rank:t,badges:n?JSON.parse(n):[],pizzaTypeDeliveries:r?JSON.parse(r):{},perfectDeliveries:parseInt(localStorage.getItem(Yn))||0,totalTips:parseFloat(localStorage.getItem(Jn))||0,fastestDelivery:parseFloat(localStorage.getItem(Zn))||null,storeEarnings:parseFloat(localStorage.getItem(Qn))||0,gamepadBindings:o?JSON.parse(o):null}}catch(e){return console.warn("Could not load persistent data:",e),{totalWages:0,totalDeliveries:0,totalDestroyed:0,bestTime:null,playerName:"Rookie Pilot",xp:0,rank:Fn[0],badges:[],pizzaTypeDeliveries:{},perfectDeliveries:0,totalTips:0,fastestDelivery:null,storeEarnings:0,gamepadBindings:null}}})();a(e.totalWages),c(e.totalDeliveries),u(e.totalDestroyed);const t=On(e.xp);He(n=>({...n,totalDeliveries:e.totalDeliveries,totalEarnings:e.totalWages,destroyedPizzas:e.totalDestroyed,bestTime:e.bestTime,xp:e.xp,rank:t,badges:e.badges||[],pizzaTypeDeliveries:e.pizzaTypeDeliveries||{},perfectDeliveries:e.perfectDeliveries||0,totalTips:e.totalTips||0,fastestDelivery:e.fastestDelivery||null,storeEarnings:e.storeEarnings||0})),e.gamepadBindings&&"object"==typeof e.gamepadBindings&&Wt(t=>({...t,...e.gamepadBindings})),dt(!0),e.totalWages<0?f(`üí∏ Welcome back! You owe the shop $${Math.abs(e.totalWages).toFixed(2)}. Time to work it off!`):t.tipBonus>0&&f(`${t.emoji} Welcome back, ${t.name}! +${Math.round(100*t.tipBonus)}% tip bonus!`)},[]),e.useEffect(()=>{Ke&&(e=>{try{void 0!==e.totalWages&&localStorage.setItem(Un,e.totalWages.toString()),void 0!==e.totalDeliveries&&localStorage.setItem(Gn,e.totalDeliveries.toString()),void 0!==e.totalDestroyed&&localStorage.setItem(Wn,e.totalDestroyed.toString()),void 0!==e.bestTime&&null!==e.bestTime&&localStorage.setItem($n,e.bestTime.toString()),void 0!==e.playerName&&localStorage.setItem(Vn,e.playerName),void 0!==e.xp&&localStorage.setItem(Xn,e.xp.toString()),void 0!==e.badges&&localStorage.setItem(Kn,JSON.stringify(e.badges)),void 0!==e.pizzaTypeDeliveries&&localStorage.setItem(qn,JSON.stringify(e.pizzaTypeDeliveries)),void 0!==e.perfectDeliveries&&localStorage.setItem(Yn,e.perfectDeliveries.toString()),void 0!==e.totalTips&&localStorage.setItem(Jn,e.totalTips.toString()),void 0!==e.fastestDelivery&&null!==e.fastestDelivery&&localStorage.setItem(Zn,e.fastestDelivery.toString()),void 0!==e.storeEarnings&&localStorage.setItem(Qn,e.storeEarnings.toString()),void 0!==e.gamepadBindings&&(null===e.gamepadBindings?localStorage.removeItem(er):localStorage.setItem(er,JSON.stringify(e.gamepadBindings)))}catch(t){console.warn("Could not save persistent data:",t)}})({totalWages:i,totalDeliveries:l,totalDestroyed:d,bestTime:Be.bestTime,xp:Be.xp,badges:Be.badges,pizzaTypeDeliveries:Be.pizzaTypeDeliveries,perfectDeliveries:Be.perfectDeliveries,totalTips:Be.totalTips,fastestDelivery:Be.fastestDelivery,storeEarnings:Be.storeEarnings,gamepadBindings:Gt})},[i,l,d,Be.bestTime,Be.xp,Be.badges,Be.pizzaTypeDeliveries,Be.perfectDeliveries,Be.totalTips,Be.fastestDelivery,Be.storeEarnings,Gt,Ke]),e.useEffect(()=>{if(!t.current)return;const e=new Me;e.background=new p(et),e.fog=new De(et,50,200);const r=new J(75,window.innerWidth/window.innerHeight,.1,1e3);r.position.set(0,15,30),r.lookAt(0,0,0);const s=new Y;s.add(r),e.add(s),It.current.vrPlayerRig=s;const i=new Ce({antialias:!0,powerPreference:"high-performance",alpha:!1});i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(Math.min(window.devicePixelRatio,2)),i.shadowMap.enabled=!0,i.shadowMap.type=je,i.xr.enabled=!0,t.current.appendChild(i.domElement);(async()=>{const n=await kn();if(ut(n.supported),n.supported){const n=new Mn(i,e,r,s);await n.init(),n.onControllerInput=e=>{if("selectstart"===e.type&&(xt.current?kr():Et.current&&!kt.current&&Mt.current&&bt.current?.()),"squeezestart"===e.type&&Et.current&&!xt.current&&kt.current){const e=Dt.current;e&&En(e)}},mt.current=n,It.current.xrManager=n;const o=((e,t,n,r={})=>{const{hideOnMobile:o=!0}=r,s=document.createElement("button"),i="ontouchstart"in window||navigator.maxTouchPoints>0||window.matchMedia("(pointer: coarse)").matches;return o&&i&&(s.style.display="none"),s.style.cssText=`\n    position: absolute;\n    top: 20px;\n    left: 20px;\n    padding: 12px 20px;\n    border: none;\n    border-radius: 8px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    font-size: 14px;\n    font-weight: bold;\n    cursor: pointer;\n    z-index: 1000;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);\n    ${o&&i?"display: none;":""}\n  `,s.onmouseover=()=>{s.style.transform="scale(1.05)",s.style.boxShadow="0 6px 20px rgba(102, 126, 234, 0.6)"},s.onmouseout=()=>{s.style.transform="scale(1)",s.style.boxShadow="0 4px 15px rgba(102, 126, 234, 0.4)"},(async()=>{if(!(await kn()).supported)return s.textContent="üö´ VR Not Supported",s.disabled=!0,s.style.background="#666",void(s.style.cursor="not-allowed");s.textContent="ü•Ω Enter VR",s.onclick=async()=>{if(e.xr.isPresenting)await e.xr.getSession().end(),s.textContent="ü•Ω Enter VR",n&&n();else try{const r=await navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor","hand-tracking","layers"]});e.xr.setSession(r),s.textContent="‚ùå Exit VR",t&&t(),r.addEventListener("end",()=>{s.textContent="ü•Ω Enter VR",n&&n()})}catch(r){console.error("Failed to start VR:",r)}}})(),s})(i,()=>{ft(!0),mt.current&&(mt.current.isInVR=!0);const e=It.current.vrPlayerRig,t=It.current.player,n=It.current.camera,r=t?t.position.x:0,o=t?t.position.z:12,s=t?t.rotation.y:Math.PI;e&&(e.position.set(r,0,o),e.rotation.y=s,console.log("VR Rig positioned at:",e.position)),It.current.vrHUD&&n&&(It.current.vrHUD.visible=!0,n.add(It.current.vrHUD),It.current.vrHUD.position.set(0,-.2,-.8),It.current.vrHUD.rotation.set(0,0,0)),console.log("VR Session Started - Auto-starting game!"),setTimeout(()=>{yt.current?.()},100)},()=>{if(ft(!1),mt.current&&(mt.current.isInVR=!1),It.current.vrHUD){It.current.vrHUD.visible=!1;const e=It.current.scene;It.current.vrHUD.parent!==e&&e.add(It.current.vrHUD)}});o.id="vr-button",t.current.appendChild(o),It.current.vrButton=o}})();const a=new Pe(16777215,.6);e.add(a);const l=new g(16777215,.8);l.position.set(50,50,50),l.castShadow=!0,l.shadow.mapSize.width=2048,l.shadow.mapSize.height=2048,l.shadow.camera.near=.5,l.shadow.camera.far=500,l.shadow.camera.left=-50,l.shadow.camera.right=50,l.shadow.camera.top=50,l.shadow.camera.bottom=-50,e.add(l);const c=new ze(200,200),d=new O({color:tt}),u=new $(c,d);u.rotation.x=-Math.PI/2,u.receiveShadow=!0,e.add(u);const h=new Ie(200,40,0,5592405);e.add(h);const m=(()=>{const e=new Y,t=new ge(6,4,6),n=new O({color:nt}),r=new $(t,n);r.position.y=2,r.castShadow=!0,e.add(r);const o=new be(5,2,4),s=new O({color:13382451}),i=new $(o,s);i.position.y=5,i.rotation.y=Math.PI/4,e.add(i);const a=new ge(7,1,.2),l=new O({color:rt}),c=new $(a,l);c.position.set(0,5,3.1),e.add(c);const d=new ge(1.5,2.5,.1),p=new O({color:9127187}),u=new $(d,p);u.position.set(0,1.25,3.05),e.add(u);const h=new ge(1,1,.1),f=new O({color:8900331,transparent:!0,opacity:.6});[-1.5,1.5].forEach(t=>{const n=new $(h,f);n.position.set(t,2.5,3.05),e.add(n)});const m=new ge(2,1,1),g=new O({color:9127187}),x=new $(m,g);x.position.set(0,.5,2),x.castShadow=!0,e.add(x);const y=new ve(1,1.5,32),b=new H({color:65280,transparent:!0,opacity:.7,side:B}),v=new $(y,b);v.rotation.x=-Math.PI/2,v.position.set(0,.05,4),v.userData.isPickupTrigger=!0,e.add(v);const w=new be(.3,.6,8),S=new H({color:65280}),T=new $(w,S);T.position.set(0,2.5,4),T.rotation.x=Math.PI,e.add(T);const z=new ge(1.5,.4,.1),R=new O({color:43520}),A=new $(z,R);return A.position.set(0,3.2,4),e.add(A),e})();e.add(m),It.current.pizzaShop=m,qe.forEach(t=>{const n=(()=>{const e=new Y,t=new ye(3,3,.3,32),n=new O({color:ot}),r=new $(t,n);r.position.y=.15,r.receiveShadow=!0,e.add(r);const o=new ve(2,2.2,32),s=new H({color:16776960,side:B}),i=new $(o,s);return i.rotation.x=-Math.PI/2,i.position.y=.31,e.add(i),e})();n.position.set(t.x,0,t.z),e.add(n);const r=(()=>{const e=new Y,t=new ge(1.5,.3,1.5),n=new O({color:at}),r=new $(t,n);r.castShadow=!0,e.add(r),[{x:.8,z:.8},{x:-.8,z:.8},{x:.8,z:-.8},{x:-.8,z:-.8}].forEach(t=>{const n=new ye(.05,.05,.8,8),r=new O({color:lt}),o=new $(n,r);o.position.set(t.x,0,t.z),e.add(o);const s=new ye(.5,.5,.05,32),i=new O({color:ct,transparent:!0,opacity:.7}),a=new $(s,i);a.position.set(t.x,.5,t.z),a.userData.isRotor=!0,e.add(a)});const o=new me(.1,16,16),s=new H({color:65280}),i=new $(o,s);return i.position.set(0,.2,.7),i.userData.isLED=!0,e.add(i),e})(t.label);r.position.set(t.x,1.5,t.z),r.userData={label:t.label,homePos:new y(t.x,1.5,t.z),hasPizza:!1,targetBase:null},e.add(r),It.current.drones.push(r);const o=((e,t="#ffffff",n=2)=>{const r=document.createElement("canvas"),o=r.getContext("2d");r.width=128,r.height=128,o.fillStyle=t,o.font="bold 80px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText(e,64,64);const s=new we(r),i=new Se({map:s}),a=new Te(i);return a.scale.set(n,n,1),a})(t.label);o.position.set(t.x,4,t.z),e.add(o)}),Ye.forEach(t=>{const n=(e=>{const t=new Y,n=6.5,r=new ye(.3,.8,30,16,1,!0),o=new H({color:65416,transparent:!0,opacity:.15,side:B}),s=new $(r,o);s.position.set(0,21.5,0),s.userData.isBeacon=!0,s.visible=!1,t.add(s),[15,22,30,40].forEach((e,r)=>{const o=new ve(2-.2*r,2.5-.2*r,32),s=new H({color:65416,transparent:!0,opacity:.4-.08*r,side:B}),i=new $(o,s);i.rotation.x=-Math.PI/2,i.position.set(0,n+e,0),i.userData.isHalo=!0,i.visible=!1,t.add(i)});const i=new me(.6,16,16),a=new H({color:65280,transparent:!0,opacity:.8}),l=new $(i,a);l.position.set(0,51.5,0),l.userData.isPulsingMarker=!0,l.visible=!1,t.add(l),t.userData.landingPadHeight=n;const c=new ge(5,6,5),d=new O({color:st}),p=new $(c,d);p.position.y=3,p.castShadow=!0,p.userData={baseNumber:e},t.add(p);const u=new ge(5.5,.3,5.5),h=new O({color:1668818}),f=new $(u,h);f.position.y=6.15,t.add(f);const m=new ye(.05,.05,1.5,8),g=new O({color:3355443}),x=new $(m,g);x.position.set(2,7,2),t.add(x);const y=new ye(2,2,.2,32),b=new O({color:it}),v=new $(y,b);v.position.y=6.35,v.userData.isLandingPad=!0,t.add(v),[1.5,1,.5].forEach((e,n)=>{const r=new ve(e-.05,e,32),o=new H({color:n%2==0?16777215:65280,side:B}),s=new $(r,o);s.rotation.x=-Math.PI/2,s.position.y=6.36,t.add(s)});const w=document.createElement("canvas"),S=w.getContext("2d");w.width=128,w.height=128,S.fillStyle="#ffffff",S.font="bold 80px Arial",S.textAlign="center",S.textBaseline="middle",S.fillText(e.toString(),64,64);const T=new we(w),z=new Se({map:T}),R=new Te(z);return R.position.y=8,R.scale.set(3,3,1),t.add(R),t})(t.num);n.position.set(t.x,0,t.z),n.userData={baseNumber:t.num},e.add(n),It.current.bases.push(n)});const x=new Y,b=new Le(.3,1,8,16),v=new O({color:4491519}),w=new $(b,v);w.position.y=1,w.castShadow=!0,x.add(w);const T=new be(.15,.3,8),z=new H({color:16776960}),A=new $(T,z);A.rotation.x=Math.PI/2,A.position.set(0,1,.5),x.add(A),It.current.playerDirectionIndicator=A;const k=new Y,D=new ge(.55,.22,.3),L=new O({color:1118481,emissive:2236962}),_=new $(D,L);_.castShadow=!0,k.add(_);const N=new _e(.32,.04,8,24),U=new O({color:3355443}),G=new $(N,U);G.rotation.y=Math.PI/2,k.add(G),k.position.set(0,1.6,.1),k.visible=!1,x.add(k),It.current.playerHeadset=k;const W=e=>{const t=new Y,n=new ye(.05,.08,.5,8),r=new O({color:3364266}),o=new $(n,r);o.rotation.z=e>0?-Math.PI/6:Math.PI/6,o.position.set(0,-.15,0),t.add(o);const s=new ye(.06,.07,.25,12),i=new O({color:2236962}),a=new $(s,i);return a.rotation.x=Math.PI/2,a.position.set(0,-.35,.07),t.add(a),t.position.set(e,1.2,.35),t.visible=!1,x.add(t),t},K=W(-.35),Q=W(.35);It.current.playerControllers=[K,Q];const ee=new ze(.8,.5),te=new O({color:1120807,emissive:662067,side:B}),re=new $(ee,te);re.rotation.x=-.6,re.position.set(0,1.05,.45),re.visible=!1,x.add(re),It.current.playerPilotTablet=re,x.position.set(0,0,12),x.rotation.y=Math.PI,x.userData.isPlayer=!0,e.add(x),It.current.player=x;const oe=(()=>{const e=new Y;e.userData.isVRHUD=!0;const t=new ze(.6,.4),n=new H({color:0,transparent:!0,opacity:.7,side:B}),r=new $(t,n);r.userData.isHUDPanel=!0,e.add(r);const o=new Re(t),s=new F({color:16766720}),i=new V(o,s);e.add(i);const a=(e,t,n,r=32)=>{const o=document.createElement("canvas");o.width=512,o.height=128;const s=o.getContext("2d"),i=new we(o);i.needsUpdate=!0;const a=new H({map:i,transparent:!0,side:B}),l=new ze(e,t),c=new $(l,a);return c.userData.canvas=o,c.userData.ctx=s,c.userData.texture=i,c.userData.fontSize=r,ir(c,n),c},l=a(.5,.08,"üçï Pizza Express VR",28);l.position.set(0,.14,.01),l.userData.textType="title",e.add(l);const c=a(.5,.06,"üíµ Wages: $0.00",24);c.position.set(0,.06,.01),c.userData.textType="wages",e.add(c);const d=a(.5,.06,"üì¶ Deliveries: 0",24);d.position.set(0,0,.01),d.userData.textType="deliveries",e.add(d);const p=a(.5,.06,"üìç No order yet",22);p.position.set(0,-.06,.01),p.userData.textType="order",e.add(p);const u=new ze(.4,.03),h=new H({color:3355443}),f=new $(u,h);f.position.set(0,-.12,.01),e.add(f);const m=new ze(.4,.03),g=new H({color:65280}),x=new $(m,g);x.position.set(0,-.12,.02),x.userData.isHealthBar=!0,e.add(x);const y=a(.3,.04,"üçï 100%",20);return y.position.set(0,-.16,.01),y.userData.textType="health",e.add(y),e.visible=!1,e})();e.add(oe),It.current.vrHUD=oe;const se=(()=>{const e=new Y;e.userData.isCockpit=!0;const t=new Ae;t.moveTo(-.4,0),t.lineTo(.4,0),t.lineTo(.35,.15),t.lineTo(-.35,.15),t.closePath();const n=new Ee(t,{depth:.02,bevelEnabled:!1}),r=new O({color:2236962,metalness:.8,roughness:.3}),o=new $(n,r);o.rotation.x=-Math.PI/6,o.position.set(0,-.15,-.5),e.add(o);const s=rr(.12,.08,"0 m/s","SPEED");s.position.set(-.2,-.08,-.48),s.rotation.x=-Math.PI/6,s.userData.displayType="speed",e.add(s);const i=rr(.15,.08,"0 m","ALT");i.position.set(0,-.08,-.48),i.rotation.x=-Math.PI/6,i.userData.displayType="altitude",e.add(i);const a=rr(.12,.08,"100%","PIZZA");a.position.set(.2,-.08,-.48),a.rotation.x=-Math.PI/6,a.userData.displayType="health",e.add(a);const l=new ve(.02,.025,32),c=new H({color:65280,transparent:!0,opacity:.7,side:B}),d=new $(l,c);d.position.set(0,0,-1),e.add(d);const p=new ke(.005,16),u=new H({color:65280,side:B}),h=new $(p,u);h.position.set(0,0,-.99),e.add(h);const f=new ge(.02,.3,.02),m=new O({color:3355443,metalness:.9}),g=new $(f,m);g.position.set(-.35,0,-.3),e.add(g);const x=new $(f,m);return x.position.set(.35,0,-.3),e.add(x),e.visible=!1,e})();r.add(se),It.current.droneCockpit=se,r.position.set(0,6,20),r.lookAt(0,2,0),It.current.scene=e,It.current.camera=r,It.current.renderer=i;const ie=(e,t=.22)=>Math.abs(e)<t?0:e,ae=()=>{if(!navigator.getGamepads)return;const e=Pt.current;if(!e.connected){const e=It.current.gamepadControls,t=It.current.gamepadPlayerControls;return e&&(e.forward=e.back=e.left=e.right=e.up=e.down=!1),void(t&&(t.forward=t.back=t.left=t.right=!1))}const t=navigator.getGamepads(),r=t?.[e.index];if(!r){e.connected=!1;const t=It.current.gamepadControls,n=It.current.gamepadPlayerControls;return t&&(t.forward=t.back=t.left=t.right=t.up=t.down=!1),void(n&&(n.forward=n.back=n.left=n.right=!1))}const o=r.axes||[],s=r.buttons||[],i=ie(o[0]||0),a=ie(o[1]||0),l=ie(o[2]||0),c=ie(o[3]||0),d=It.current.gamepadControls,p=It.current.gamepadPlayerControls;if(xt.current){d.forward=a<-.2,d.back=a>.2,d.left=i<-.25,d.right=i>.25;const e=s[4]?.pressed||s[6]?.pressed,t=s[5]?.pressed||s[7]?.pressed;d.up=c<-.25||e,d.down=c>.25||t,d.turnLeft=l<-.25,d.turnRight=l>.25,p.forward=!1,p.back=!1,p.left=!1,p.right=!1}else p.forward=a<-.2,p.back=a>.2,p.left=i<-.25,p.right=i>.25,p.turnLeft=l<-.25,p.turnRight=l>.25,d.forward=!1,d.back=!1,d.left=!1,d.right=!1,d.up=!1,d.down=!1,d.turnLeft=!1,d.turnRight=!1;const u=[];s.forEach((t,n)=>{!!t?.pressed&&!e.lastButtons[n]&&u.push(n)});const h=en.current;if(h&&u.length>0&&nn(h,u[0]),h)return e.lastButtons=s.map(e=>e.pressed),e.lastAxes=[...o],void(e.lastTimestamp=r.timestamp||performance.now());const f=Qt.current||{},m=(t,n)=>{null!=t&&(t>=s.length||(e=>!!s[e]?.pressed)(t)&&!(t=>!!e.lastButtons[t])(t)&&n())},g=(e,t)=>{const n=f[e];null!=n&&m(n,t)},x=()=>{if(zt.current){X(!1);const e=Rt.current;return e&&(Tt.current?.(e),q(null)),!0}return!!At.current&&(fe(!1),yt.current?.(),!0)};g("primary",()=>{x()||(xt.current?vt.current?.():Et.current&&!kt.current&&Mt.current?bt.current?.():Et.current&&kt.current&&Dt.current&&wt.current?.(Dt.current))}),g("secondary",()=>{zt.current||At.current||!xt.current&&Et.current&&kt.current&&Dt.current&&St.current?.(Dt.current)}),g("startOrder",()=>{x()||Et.current||"menu"!==n||yt.current?.()}),g("recenter",()=>{if(It.current.vrPlayerRig){const e=It.current.player;if(e){const t=It.current.vrPlayerRig;t.position.set(e.position.x,t.position.y,e.position.z)}}}),g("cameraToggle",()=>{x()||zt.current||At.current||an()}),e.lastButtons=s.map(e=>e.pressed),e.lastAxes=[...o],e.lastTimestamp=r.timestamp||performance.now()};performance.now();i.setAnimationLoop((t,n)=>{ae();const s=i.xr.isPresenting;if(!s){const e=It.current.keyboardControls,t=It.current.gamepadControls,n=It.current.controls;n.forward=e.forward||t.forward,n.back=e.back||t.back,n.left=e.left||t.left,n.right=e.right||t.right,n.up=e.up||t.up,n.down=e.down||t.down,n.turnLeft=t.turnLeft||!1,n.turnRight=t.turnRight||!1;const r=It.current.keyboardPlayerControls,o=It.current.gamepadPlayerControls,s=It.current.playerControls;s.forward=r.forward||o.forward,s.back=r.back||o.back,s.left=r.left||o.left,s.right=r.right||o.right,s.turnLeft=o.turnLeft||!1,s.turnRight=o.turnRight||!1}if(s){const e=mt.current.pollControllerInput();if(e){const t=e.right.thumbstick,n=e.left.thumbstick;xt.current?(Math.abs(t.y)>.1?(It.current.controls.forward=t.y<-.1,It.current.controls.back=t.y>.1):(It.current.controls.forward=!1,It.current.controls.back=!1),Math.abs(t.x)>.1?(It.current.controls.right=t.x>.1,It.current.controls.left=t.x<-.1):(It.current.controls.left=!1,It.current.controls.right=!1),Math.abs(n.y)>.1?(It.current.controls.up=n.y<-.1,It.current.controls.down=n.y>.1):(It.current.controls.up=!1,It.current.controls.down=!1)):(Math.abs(n.y)>.15?(It.current.playerControls.forward=n.y<-.15,It.current.playerControls.back=n.y>.15):(It.current.playerControls.forward=!1,It.current.playerControls.back=!1),Math.abs(t.x)>.15?(It.current.playerControls.right=t.x>.15,It.current.playerControls.left=t.x<-.15):(It.current.playerControls.left=!1,It.current.playerControls.right=!1))}if(wn(r,It.current,xt.current),It.current.vrHUD&&It.current.vrHUD.visible&&((e,t)=>{e&&e.children.forEach(e=>{const n=e.userData.textType;if("wages"===n){const n=t.score<0?`üíµ Wages: -$${Math.abs(t.score).toFixed(2)}`:`üíµ Wages: $${t.score.toFixed(2)}`,r=t.score<0?"#ff4444":"#00ff00";ir(e,n,r)}if("deliveries"===n&&ir(e,`üì¶ Deliveries: ${t.pizzasDelivered}`),"order"===n)if(t.currentOrder){const n=t.currentOrder;ir(e,`üìç ${n.pizzaType?.emoji||"üçï"} ‚Üí Base ${n.base}`,"#FFD700")}else ir(e,"üìç Get a pizza from the shop!","#aaaaaa");if("health"===n){const n=t.pizzaHealth>70?"#00ff00":t.pizzaHealth>40?"#ffff00":"#ff4444";ir(e,`üçï ${Math.round(t.pizzaHealth)}%`,n)}if(e.userData.isHealthBar){const n=t.pizzaHealth/100;e.scale.x=Math.max(.01,n),e.position.x=-.2*(1-n),t.pizzaHealth>70?e.material.color.setHex(65280):t.pizzaHealth>40?e.material.color.setHex(16776960):e.material.color.setHex(16729156)}})})(It.current.vrHUD,{score:Ct.current,pizzasDelivered:jt.current,currentOrder:Et.current,pizzaHealth:gt.current}),It.current.droneCockpit){const e=It.current.droneCockpit,t=xt.current&&It.current.currentDrone;if(t!==e.visible&&(e.visible=t),e.visible&&It.current.currentDrone){const t=It.current.currentDrone,n=It.current.lastDroneVelocity||{x:0,z:0};((e,t)=>{e&&e.children.forEach(e=>{const n=e.userData.displayType;if("speed"===n){const n=Math.round(t.speed||0);or(e,`${n} m/s`)}if("altitude"===n){const n=Math.round(t.altitude||0);or(e,`${n} m`)}if("health"===n){const n=Math.round(t.pizzaHealth||100);if(e.userData.canvas){const t=e.userData.ctx;t.fillStyle="#001100",t.fillRect(0,0,256,128),t.fillStyle="#00aa00",t.font="bold 20px monospace",t.textAlign="center",t.fillText("PIZZA",128,30),t.fillStyle=n>70?"#00ff00":n>40?"#ffff00":"#ff4444",t.font="bold 36px monospace",t.fillText(`${n}%`,128,80),e.userData.texture.needsUpdate=!0}}})})(e,{speed:60*Math.sqrt(n.x*n.x+n.z*n.z),altitude:t.position.y,pizzaHealth:gt.current})}}}It.current.drones.forEach(e=>{if(e.children.filter(e=>e.userData.isRotor).forEach(e=>{e.rotation.y+=.3}),xt.current&&It.current.currentDrone===e){const t=It.current.controls,n=.3,s=.05,i=e.position.clone(),a=e.position.y;let l="cruising",c=!1;if(o){const t=It.current.bases.find(e=>e.userData.baseNumber===o.base);if(t){const n=t.position.x,r=t.position.z;c=Math.sqrt(Math.pow(e.position.x-n,2)+Math.pow(e.position.z-r,2))<1}}l=a<10&&!c?"ascending":c?"descending":"cruising",l!==j&&(P(l),"ascending"===l?f("üöÅ ASCENDING - Reach 10m altitude to unlock controls!"):"cruising"===l?f(`‚úàÔ∏è CRUISING - Fly to Base ${o?.base}! ${qt?"Use the touch controls to steer.":"Use WASD to navigate."}`):"descending"===l&&f("üìç LANDING - Descend to drop zone! "+(qt?"Tap RELEASE when ready.":"Press RELEASE when ready."))),"ascending"===l?(t.up&&(e.position.y+=1*n*1.5),(t.left||t.turnLeft)&&(e.rotation.y+=s),(t.right||t.turnRight)&&(e.rotation.y-=s)):"cruising"===l?(t.forward&&(e.position.x+=Math.sin(e.rotation.y)*n,e.position.z+=Math.cos(e.rotation.y)*n),t.back&&(e.position.x-=Math.sin(e.rotation.y)*n,e.position.z-=Math.cos(e.rotation.y)*n),(t.left||t.turnLeft)&&(e.rotation.y+=s),(t.right||t.turnRight)&&(e.rotation.y-=s),t.up&&(e.position.y+=1*n),t.down&&(e.position.y=Math.max(1.5,e.position.y-1*n))):"descending"===l&&(t.up&&(e.position.y+=1*n),t.down&&(e.position.y=Math.max(6.5,e.position.y-1*n)),(t.left||t.turnLeft)&&(e.rotation.y+=s),(t.right||t.turnRight)&&(e.rotation.y-=s));const d={x:e.position.x-i.x,y:e.position.y-i.y,z:e.position.z-i.z};if(It.current.lastDroneVelocity=d,hn(e.position.y),mn(60*d.y),o){const t=It.current.bases.find(e=>e.userData.baseNumber===o.base);if(t){const n=t.position.x,r=t.position.z,s=Math.sqrt(Math.pow(e.position.x-n,2)+Math.pow(e.position.z-r,2));C(s);const i=Math.sqrt(Math.pow(e.position.x-n,2)+Math.pow(e.position.y,2)+Math.pow(e.position.z-r,2));R(i);const a=s<1,l=e.position.y>=6&&e.position.y<=8,c=e.position.y>8;M(a&&c),E(a&&l),It.current.bases.forEach(e=>{const t=e.userData.baseNumber===o.base;e.traverse(e=>{(e.userData.isBeacon||e.userData.isHalo||e.userData.isPulsingMarker)&&(e.visible=t,t&&e.material&&(a?(e.material.color.setHex(65280),e.material.opacity=e.userData.isPulsingMarker?1:.5):(e.material.color.setHex(65416),e.material.opacity=e.userData.isPulsingMarker?.8:.3)))})})}}else M(!1),C(null),It.current.bases.forEach(e=>{e.traverse(e=>{(e.userData.isBeacon||e.userData.isHalo||e.userData.isPulsingMarker)&&(e.visible=!1)})});const p=It.current.renderer;p?.xr?.isPresenting||vn(r,e,S)}});const a=It.current.player;if(a&&I&&!xt.current){const e=It.current.playerControls,t=.15,n=.12,o=.1,s=.05,i=a.position.clone();e.forward&&(a.position.x+=Math.sin(a.rotation.y)*t,a.position.z+=Math.cos(a.rotation.y)*t),e.back&&(a.position.x-=Math.sin(a.rotation.y)*o,a.position.z-=Math.cos(a.rotation.y)*o);const l=It.current.gamepadPlayerControls;if(l.forward||l.back||l.left||l.right||l.turnLeft||l.turnRight){if(e.left&&(a.position.x+=Math.cos(a.rotation.y)*n,a.position.z-=Math.sin(a.rotation.y)*n),e.right&&(a.position.x-=Math.cos(a.rotation.y)*n,a.position.z+=Math.sin(a.rotation.y)*n),e.turnLeft){a.rotation.y+=s;const e=It.current.vrPlayerRig,t=It.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y+=s)}if(e.turnRight){a.rotation.y-=s;const e=It.current.vrPlayerRig,t=It.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y-=s)}}else{if(e.left){a.rotation.y+=s;const e=It.current.vrPlayerRig,t=It.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y+=s)}if(e.right){a.rotation.y-=s;const e=It.current.vrPlayerRig,t=It.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y-=s)}}const c=-3.2,d=3.2,p=-3.2,u=2.8;if(a.position.x>c&&a.position.x<d&&a.position.z>p&&a.position.z<u){i.x,i.z;const e=Math.abs(a.position.x-c),t=Math.abs(a.position.x-d),n=Math.abs(a.position.z-p),r=Math.abs(a.position.z-u),o=Math.min(e,t,n,r);o===e?a.position.x=c-.1:o===t?a.position.x=d+.1:a.position.z=o===n?p-.1:u+.1}const h=a.position.x-i.x,f=a.position.z-i.z,m=Math.sqrt(h*h+f*f),g=Date.now(),x=m>.001,y=g-It.current.lastMoveTime;x?(It.current.moveAccumulator=y<100?Math.min(1.5,It.current.moveAccumulator+.02):Math.max(0,It.current.moveAccumulator-.4),It.current.lastMoveTime=g):It.current.moveAccumulator=Math.max(0,It.current.moveAccumulator-.08);const b=m*(1+It.current.moveAccumulator);It.current.sustainedSpeed=b,xn(60*b),It.current.lastPlayerVelocity={x:h,z:f};const v=It.current.playerPizza;if(v){const e=2,t=Math.PI/4,n=.2,r=.28,o=f*Math.cos(a.rotation.y)+h*Math.sin(a.rotation.y),s=h*Math.cos(a.rotation.y)-f*Math.sin(a.rotation.y),i=Math.max(-t,Math.min(t,o*e*10)),l=Math.max(-t,Math.min(t,-s*e*10));v.rotation.x+=.08*(i-v.rotation.x),v.rotation.z+=.08*(l-v.rotation.z);const c=b>r;if(bn(b>n),c){const e=2*(b-r),t=Math.max(0,gt.current-e);t!==gt.current&&(gt.current=t,ne(t),mt.current?.isInVR&&(mt.current.triggerHaptic("left",.3,50),mt.current.triggerHaptic("right",.3,50)))}const d=Math.abs(v.rotation.x)+Math.abs(v.rotation.z);if(d>1.5*t){const e=.2*(d-1.5*t),n=Math.max(0,gt.current-e);n!==gt.current&&(gt.current=n,ne(n),mt.current?.isInVR&&(mt.current.triggerHaptic("left",.6,100),mt.current.triggerHaptic("right",.6,100)))}}_t({x:a.position.x,z:a.position.z});let w=null,S=1/0;It.current.drones.forEach(e=>{const t=a.position.distanceTo(e.position);t<S&&(S=t,w=e)}),Ft(w&&S<3?w.userData.label:null);const T=It.current.renderer;T?.xr?.isPresenting||(r.position.x=a.position.x-8*Math.sin(a.rotation.y),r.position.y=6,r.position.z=a.position.z-8*Math.cos(a.rotation.y),r.lookAt(a.position.x,1.5,a.position.z))}if(a&&!I&&!xt.current){const e=It.current.playerControls,t=.18,n=.12,o=.06,s=.14;e.forward&&(a.position.x+=Math.sin(a.rotation.y)*t,a.position.z+=Math.cos(a.rotation.y)*t),e.back&&(a.position.x-=Math.sin(a.rotation.y)*n,a.position.z-=Math.cos(a.rotation.y)*n);const i=It.current.gamepadPlayerControls;if(i.forward||i.back||i.left||i.right||i.turnLeft||i.turnRight){if(e.left&&(a.position.x+=Math.cos(a.rotation.y)*s,a.position.z-=Math.sin(a.rotation.y)*s),e.right&&(a.position.x-=Math.cos(a.rotation.y)*s,a.position.z+=Math.sin(a.rotation.y)*s),e.turnLeft){a.rotation.y+=o;const e=It.current.vrPlayerRig,t=It.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y+=o)}if(e.turnRight){a.rotation.y-=o;const e=It.current.vrPlayerRig,t=It.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y-=o)}}else{if(e.left){a.rotation.y+=o;const e=It.current.vrPlayerRig,t=It.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y+=o)}if(e.right){a.rotation.y-=o;const e=It.current.vrPlayerRig,t=It.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y-=o)}}xn(0),bn(!1);const l=Math.sqrt(Math.pow(a.position.x-Je,2)+Math.pow(a.position.z-Ze,2));Bt(l<3);const c=It.current.renderer;c?.xr?.isPresenting||(r.position.x=a.position.x-8*Math.sin(a.rotation.y),r.position.y=6,r.position.z=a.position.z-8*Math.cos(a.rotation.y),r.lookAt(a.position.x+5*Math.sin(a.rotation.y),1.5,a.position.z+5*Math.cos(a.rotation.y)))}const l=.001*Date.now();It.current.bases.forEach(e=>{e.traverse(e=>{if(e.userData.isBeacon&&(e.material.opacity=.1+.08*Math.sin(2*l)),e.userData.isHalo&&(e.rotation.z+=.005,e.material.opacity=.25+.15*Math.sin(3*l+.5*e.position.y)),e.userData.isPulsingMarker){const t=.4+.4*Math.sin(4*l);e.material.opacity=t,e.scale.setScalar(.8+.3*Math.sin(3*l))}})});const c=It.current.activePizzaDrops||[];if(c.length){const e=performance.now();for(let t=c.length-1;t>=0;t--){const n=c[t],r=e-n.startTime,o=Math.min(1,r/n.duration),s=o*o,i=Z.lerp(n.start.x,n.end.x,o),a=Z.lerp(n.start.z,n.end.z,o),l=n.start.y-(n.start.y-n.end.y)*s;n.mesh.position.set(i,l,a),n.mesh.rotation.x+=n.spin.x,n.mesh.rotation.y+=n.spin.y,n.mesh.rotation.z+=n.spin.z,o>=1&&(It.current.scene&&n.mesh.parent===It.current.scene&&It.current.scene.remove(n.mesh),c.splice(t,1))}}i.render(e,r)});const le=e=>{const t=1===e.key.length?e.key.toLowerCase():e.key;xt.current&&("w"===t&&(It.current.keyboardControls.forward=!0),"s"===t&&(It.current.keyboardControls.back=!0),"a"===t&&(It.current.keyboardControls.left=!0),"d"===t&&(It.current.keyboardControls.right=!0)," "===e.key&&(e.preventDefault(),It.current.keyboardControls.up=!0),"Shift"===e.key&&(It.current.keyboardControls.down=!0),"v"===t&&an()),xt.current||("w"===t&&(It.current.keyboardPlayerControls.forward=!0),"s"===t&&(It.current.keyboardPlayerControls.back=!0),"a"===t&&(It.current.keyboardPlayerControls.left=!0),"d"===t&&(It.current.keyboardPlayerControls.right=!0))},ce=e=>{const t=1===e.key.length?e.key.toLowerCase():e.key;"w"===t&&(It.current.keyboardControls.forward=!1),"s"===t&&(It.current.keyboardControls.back=!1),"a"===t&&(It.current.keyboardControls.left=!1),"d"===t&&(It.current.keyboardControls.right=!1)," "===e.key&&(It.current.keyboardControls.up=!1),"Shift"===e.key&&(It.current.keyboardControls.down=!1),"w"===t&&(It.current.keyboardPlayerControls.forward=!1),"s"===t&&(It.current.keyboardPlayerControls.back=!1),"a"===t&&(It.current.keyboardPlayerControls.left=!1),"d"===t&&(It.current.keyboardPlayerControls.right=!1)};window.addEventListener("keydown",le),window.addEventListener("keyup",ce);const de=()=>{r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",de),()=>{window.removeEventListener("keydown",le),window.removeEventListener("keyup",ce),window.removeEventListener("resize",de),i.setAnimationLoop(null),It.current.vrButton&&t.current&&t.current.removeChild(It.current.vrButton),t.current&&i.domElement&&t.current.removeChild(i.domElement),mt.current?.session&&mt.current.endSession()}},[o,S,I,n]),e.useEffect(()=>{if(te<=0&&I){G(!0),L(!1),u(e=>e+1);const e=Bn(0,0,0,!1,!0),t=Be,n=Math.max(0,t.xp+e),r=t.rank,o=On(n);if(He(e=>({...e,destroyedPizzas:e.destroyedPizzas+1,xp:n,rank:o})),r.name!==o.name){const e=Hn(r,o,!1);e&&(Xe.current&&clearTimeout(Xe.current),Xe.current=setTimeout(()=>{$e(e),Xe.current=setTimeout(()=>$e(null),4e3)},3e3))}mt.current?.isInVR&&(mt.current.triggerHaptic("left",1,300),mt.current.triggerHaptic("right",1,300),setTimeout(()=>{mt.current.triggerHaptic("left",.7,200),mt.current.triggerHaptic("right",.7,200)},350));const s=It.current.player;s&&It.current.playerPizza&&(s.remove(It.current.playerPizza),It.current.playerPizza=null);const i=Q?.price||18.99;a(e=>e-i);let l="";l=i>=49.99?"ü¶û THE LOBSTER PIZZA?! Boss is going to FIRE you!":i>=24.99?"üçÑ A truffle pizza... that's coming out of your paycheck for WEEKS!":i>=21.99?"üëë The Supreme Deluxe! Management wants a word with you...":i<15?`üßÄ Lucky you - it was just ${Q?.name||"a cheap one"}!`:Q?.description||"That pizza is gone forever!",f(`üíÄ PIZZA DESTROYED! -$${i.toFixed(2)} | ${Math.abs(e)} XP lost! ${l}`)}},[te,I,Q,Be]);const vn=(e,t,n)=>{if("pov"===n){e.position.copy(t.position),e.position.y+=.3,e.position.x+=.2*Math.sin(t.rotation.y),e.position.z+=.2*Math.cos(t.rotation.y);const n=new y(t.position.x+50*Math.sin(t.rotation.y),t.position.y-2,t.position.z+50*Math.cos(t.rotation.y));e.lookAt(n),t.traverse(e=>{e.isMesh&&!e.userData.isRotor&&(e.material.transparent=!0,e.material.opacity=.3)})}else t.traverse(e=>{e.isMesh&&!e.userData.isRotor&&e.material.transparent&&(e.material.transparent=!1,e.material.opacity=1)}),"overhead"===n?(e.position.x=t.position.x,e.position.y=t.position.y+30,e.position.z=t.position.z+5,e.lookAt(t.position)):(e.position.x=t.position.x-12*Math.sin(t.rotation.y),e.position.y=t.position.y+5,e.position.z=t.position.z-12*Math.cos(t.rotation.y),e.lookAt(t.position))},wn=(e,t,n)=>{const r=It.current.renderer,o=t.vrPlayerRig;if(r?.xr?.isPresenting&&o)if(n&&t.currentDrone){const e=t.currentDrone;o.position.x=e.position.x,o.position.y=e.position.y+.3,o.position.z=e.position.z,e.traverse(e=>{e.isMesh&&!e.userData.isRotor&&(e.userData.originalOpacity||(e.userData.originalOpacity=e.material.opacity||1),e.material.transparent=!0,e.material.opacity=.15)})}else if(t.player){const e=t.player;o.position.x=e.position.x,o.position.y=0,o.position.z=e.position.z,t.drones?.forEach(e=>{e.traverse(e=>{e.isMesh&&void 0!==e.userData.originalOpacity&&(e.material.opacity=e.userData.originalOpacity)})})}},Sn=e.useCallback(()=>{Xe.current&&(clearTimeout(Xe.current),Xe.current=null),$e(null);const e=(()=>{const e=[25,20,15,12,10,8,5,4,1],t=e.reduce((e,t)=>e+t,0);let n=Math.random()*t;for(let r=0;r<e.length;r++)if(n-=e[r],n<=0)return Dn[r];return Dn[0]})(),t=`${_n[Math.floor(Math.random()*_n.length)]} ${Nn[Math.floor(Math.random()*Nn.length)]}`,n={drone:["A","B","C","D"][Math.floor(4*Math.random())],base:[1,2,3,4][Math.floor(4*Math.random())],pizzaType:e,customerName:t};s(n),ee(e),r("carrying"),f(`üçï ${e.emoji} ${e.name} ($${e.price.toFixed(2)}) for ${t}! Carry to Drone ${n.drone}`),x(!1),w(null),L(!1),ne(100),gt.current=100,oe({x:0,z:0}),fe(!1),Oe(Date.now())},[]);e.useEffect(()=>{yt.current=Sn},[Sn]);const Tn=e.useCallback(()=>{Xe.current&&(clearTimeout(Xe.current),Xe.current=null),$e(null),L(!1),ne(100),gt.current=100,oe({x:0,z:0}),bn(!1),It.current&&(It.current.sustainedSpeed=0,It.current.moveAccumulator=0),f(`üçï Walk back to the shop to grab a new pizza for Drone ${o?.drone}!`)},[o]),zn=e.useCallback(()=>{if("carrying"!==n||I)return;const e=It.current.player;if(e&&It.current.scene){It.current.playerPizza&&(e.remove(It.current.playerPizza),It.current.playerPizza=null);const t=sr();t.position.set(0,1.15,.55),t.rotation.x=-Math.PI/12,t.scale.set(1.1,1.1,1.1),t.visible=!0,t.userData.isPizza=!0,e.add(t),It.current.playerPizza=t,console.log("üçï Pizza box created and attached to player:",t)}L(!0),f(`üçï Carrying pizza! ${qt?"Use the on-screen controls to walk carefully":"Use WASD to walk carefully"} to Drone ${o?.drone}. Keep it level!`)},[n,I,o,qt]);e.useEffect(()=>{bt.current=zn},[zn]);const Rn=e.useCallback(e=>{if(o&&I)return e!==o.drone?(f(`‚ùå Wrong drone! You need Drone ${o.drone}`),void ne(e=>Math.max(0,e-5))):te<50?(q(e),void X(!0)):void An(e)},[o,I,te]);e.useEffect(()=>{St.current=Rn},[Rn]);const An=e.useCallback(e=>{const t=It.current.drones.find(t=>t.userData.label===e);if(!t)return;X(!1),q(null);const n=It.current.player;n&&It.current.playerPizza&&(n.remove(It.current.playerPizza),It.current.playerPizza=null);t.children.filter(e=>e.userData?.isPizza).forEach(e=>t.remove(e));const s=sr();s.position.set(0,-.7,0),s.visible=!0,s.userData.isPizza=!0,t.add(s),t.userData.hasPizza=!0,t.userData.targetBase=o.base,console.log("üçï Pizza box created and attached to drone:",s),It.current.currentDrone=t,w(e),L(!1),r("flying"),x(!0),P("ascending"),Ft(null),f("üöÅ TAKEOFF! "+(qt?"Hold the ASCEND button to reach 10m cruise altitude!":"Hold SPACE to ascend to 10m cruise altitude!"))},[o,qt]);e.useEffect(()=>{Tt.current=An},[An]),e.useCallback((e,t)=>{if(!I)return;oe(n=>({x:Math.max(-30,Math.min(30,n.x+2*e-.05*n.x)),z:Math.max(-30,Math.min(30,n.z+2*t-.05*n.z))}));const n=Math.sqrt(re.x**2+re.z**2);n>20&&ne(e=>Math.max(0,e-.05*n))},[I,re]);const En=e.useCallback(e=>{I&&Rn(e)},[I,Rn]);e.useEffect(()=>{wt.current=En},[En]);const kr=e.useCallback(()=>{if(!m||!It.current.currentDrone||!A)return void(A||f("‚ö†Ô∏è Get closer to the base! Wait for green indicator."));const e=It.current.currentDrone,t=e.children.find(e=>e.userData.isPizza);if(!t)return void f("‚ùå No pizza attached!");const n=It.current.bases.find(e=>e.userData.baseNumber===o?.base),s=n?new y(n.position.x,6.5,n.position.z):null;t.updateMatrixWorld(!0);const i=new y,l=new v;t.getWorldPosition(i),t.getWorldQuaternion(l);const d=(Date.now()-Fe)/1e3,p=te>=95&&d<45,u=(e=>e<30?{temp:"PIPING HOT",emoji:"üî•üî•üî•",color:"#ff4400",bonus:2,penalty:0}:e<45?{temp:"HOT",emoji:"üî•üî•",color:"#ff6600",bonus:1,penalty:0}:e<60?{temp:"WARM",emoji:"üî•",color:"#ff9900",bonus:.5,penalty:0}:e<90?{temp:"LUKEWARM",emoji:"üòê",color:"#ffcc00",bonus:0,penalty:-.5}:e<120?{temp:"COOL",emoji:"‚ùÑÔ∏è",color:"#66ccff",bonus:0,penalty:-1}:{temp:"COLD",emoji:"ü•∂",color:"#0099ff",bonus:0,penalty:-2})(d),h=Q?.price||15.99,g=nr(te,d),b=((e,t,n,r=15.99,o=null)=>{const s=nr(t,e),i=e>=90,a=t<70,l=t<50;if(t<30)return 0;if(e>=150&&l)return 0;if(s<1.5)return 0;let c=!1;e>=120&&!a&&(c=!0),l&&!i&&(c=!0),i&&a&&!l&&(c=!0);let d=1;const p=t>=97;s>=4.8?(d=2,p&&e<45&&(d=2.5)):s>=4.5?(d=1.7,p&&(d=2)):s>=4?(d=1.4,t>=95&&(d=1.6)):d=s>=3.5?1:s>=3?.7:s>=2.5?.3:s>=2?.1:0;let u=.15*r*d;n&&s>=4.5&&(u+=.15*r,r>=25&&(u+=5),r>=40&&(u+=10)),p&&!n&&e<60&&(u+=2),i&&u>0&&(u=Math.max(.5,.5*u)),c&&u>0&&(u=Math.max(.25,.3*u)),o&&o.tipBonus>0&&u>0&&(u+=u*o.tipBonus);return u>0&&u<.25&&(u=.25),Math.round(100*u)/100})(d,te,p,h,Be.rank),w=Bn(g,te,d,p,!1);e.remove(t),e.userData.hasPizza=!1,t.position.copy(i),t.quaternion.copy(l),t.userData.isPizza=!1,It.current.scene&&(It.current.scene.add(t),s?cn(t,s):It.current.scene.remove(t)),mt.current?.isInVR&&(mt.current.triggerHaptic("left",.8,150),mt.current.triggerHaptic("right",.8,150),setTimeout(()=>{mt.current.triggerHaptic("left",.5,100),mt.current.triggerHaptic("right",.5,100)},200)),a(e=>e+b),c(e=>e+1);const S=Q?.name||"Plain Cheese";He(e=>{const t=Math.max(0,e.xp+w),n=e.rank,r=On(t),o={...e.pizzaTypeDeliveries,[S]:(e.pizzaTypeDeliveries[S]||0)+1},s=p?e.perfectDeliveries+1:e.perfectDeliveries,i=e.totalTips+b,a=e.fastestDelivery?Math.min(e.fastestDelivery,d):d;if(n.name!==r.name){const o=Hn(n,r,t>e.xp);o&&(Xe.current&&clearTimeout(Xe.current),Xe.current=setTimeout(()=>{$e(o),Xe.current=setTimeout(()=>$e(null),4e3)},1500))}const l={totalDeliveries:e.totalDeliveries+1,totalEarnings:e.totalEarnings+b,bestTime:e.bestTime?Math.min(e.bestTime,d):d,xp:t,rank:r,pizzaTypeDeliveries:o,perfectDeliveries:s,totalTips:i,fastestDelivery:a,storeEarnings:e.storeEarnings+h,badges:e.badges},c=((e,t=[])=>{const n=[],r=new Set(t.map(e=>e.id));for(const o of Cn)r.has(o.id)||(e.pizzaTypeDeliveries?.[o.pizzaType]||0)>=o.required&&n.push(o);for(const o of jn)!r.has(o.id)&&e.totalDeliveries>=o.deliveries&&n.push(o);for(const o of Pn)!r.has(o.id)&&e.perfectDeliveries>=o.perfectDeliveries&&n.push(o);for(const o of In)!r.has(o.id)&&e.fastestDelivery&&e.fastestDelivery<=o.fastestTime&&n.push(o);for(const o of Ln)!r.has(o.id)&&e.totalTips>=o.totalTips&&n.push(o);return n})(l,e.badges);return c.length>0&&(l.badges=[...e.badges,...c],setTimeout(()=>{Ge(c[0]),setTimeout(()=>Ge(null),4e3)},2500)),l});const T=((e,t,n,r)=>{const o=e=>e[Math.floor(Math.random()*e.length)];return 0===e?r<30?o(["ü§¨ 'Is this even pizza anymore?! GET OUT!'","üò± 'I ordered a PIZZA, not a CRIME SCENE!'","üò§ 'My grandma could deliver better... with her eyes closed!'","üóëÔ∏è 'I've seen better looking pizzas in the GARBAGE!'","üò§ 'I'm calling your manager, your manager's manager, and the MAYOR!'"]):r<50?o(["üò§ 'This pizza is RUINED! No tip for you!'","ü§Æ 'Did you play SOCCER with my pizza?!'","üò† 'I wanted a pizza, not a PUZZLE!'","üëé 'This is a DISASTER. Never order from here again!'","ü§¶ 'My expectations were low but HOLY...'"]):n>=120?o(["ü•∂ 'An ICE COLD pizza?! Are you kidding me?!'","‚ùÑÔ∏è 'I could have frozen a FRESH pizza faster!'","üßä 'Did you stop for a NAP on the way?!'","‚è∞ 'Did you deliver this by HORSE?!'","üò¥ 'I ordered this pizza LAST WEEK!'"]):n>=90&&r<70?o(["üò† 'Cold AND damaged?! I'm calling the manager!'","ü§Ø 'HOW did you manage to mess up THIS badly?!'","üí¢ 'You had ONE JOB!'","üò§ 'This is insulting. Just... leave.'"]):t<2?o(["üëé 'Worst delivery ever. No tip!'","üö´ 'I'd give you negative stars if I could!'","üòí 'My 5-year-old could do better!'","üí© 'This deserves the poop emoji.'"]):"üòí 'Really? No tip for this disaster.'":o(e<1?["üòê 'I guess... here's some change.'","üôÑ 'It's not GREAT, but here's something.'","üòë 'Consider this a mercy tip.'","üí≠ 'At least you showed up... barely.'"]:e<3?["üôÇ 'It was... okay. Here.'","üòå 'Decent enough. Thanks.'","üëå 'Not bad, not great. Here you go.'","ü§∑ 'Could be worse I guess.'"]:e<5?["üòä 'Not bad! Thanks!'","üëç 'Good job! Appreciate it!'","üòÑ 'Nice delivery! Here you go!'","üôå 'That was quick! Thanks!'"]:e<8?["üòÑ 'Great service! Here you go!'","üåü 'Impressive! Well done!'","üëè 'Now THAT'S how you deliver pizza!'","üî• 'Fast AND fresh! Love it!'"]:e<15?["ü§© 'AMAZING! Best delivery ever! Keep the change!'","ü•≥ 'WOW! You're a LEGEND!'","üíØ 'PERFECTION! You deserve this!'","‚≠ê 'Five stars! Tell your boss you need a raise!'","üòç 'Marry me! Just kidding... unless?'"]:["ü§ë 'INCREDIBLE! Here's a HUGE tip!'","üí∞ 'You just made my WHOLE DAY! Take ALL of this!'","üéâ 'FLAWLESS! I'm telling EVERYONE about you!'","üëë 'You're the KING/QUEEN of pizza delivery!'","üèÜ 'I've NEVER had delivery this good! Here's everything I got!'","üíé 'This is what EXCELLENCE looks like! Legendary tip for you!'"])})(b,g,d,te),z=Be.rank?.tipBonus||0;Ne({deliveryTime:d,tip:b,pizzaHealth:te,isPerfect:p,temperature:u,rating:g,tipMessage:T,pizzaType:Q,xpChange:w,rankBonus:z,playerRank:Be.rank}),fe(!0),r("delivered"),x(!1),R(null),E(!1),setTimeout(()=>{e.position.copy(e.userData.homePos),e.rotation.y=0,It.current.currentDrone=null,It.current.camera.position.set(0,15,30),It.current.camera.lookAt(0,0,0)},100)},[m,A,te,Fe,o,Q,Be,cn]);e.useEffect(()=>{vt.current=kr},[kr]);const Mr=()=>It.current.currentDrone?{x:It.current.currentDrone.position.x,z:It.current.currentDrone.position.z}:null;return Ve.jsxs("div",{style:{width:"100%",height:"100dvh",minHeight:"100vh",position:"relative",overflow:"hidden"},children:[Ve.jsx("div",{ref:t,style:{width:"100%",height:"100%"}}),Ve.jsx(ar,{score:i,pizzasDelivered:l,pizzasDestroyed:d,currentOrder:o,pilotMode:m,cameraView:S,pizzaHealth:te,playerStats:Be,dronePosition:Mr(),currentPizzaType:Q,isMobile:qt}),Ve.jsx(br,{visible:qt&&!Jt}),m&&Ve.jsx(dr,{dronePosition:Mr(),targetBase:(()=>{if(!o)return null;const e=It.current.bases.find(e=>e.userData.baseNumber===o.base);return e?{x:e.position.x,z:e.position.z}:null})(),currentOrder:o,altitude:un,verticalSpeed:fn,heading:It.current.currentDrone?It.current.currentDrone.rotation.y:0}),m&&Ve.jsxs("div",{style:{position:"absolute",top:"240px",right:"20px",width:"220px",background:"ascending"===j?"rgba(255, 165, 0, 0.9)":"descending"===j?"rgba(0, 200, 255, 0.9)":"rgba(0, 200, 0, 0.9)",padding:"10px 15px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"14px",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",border:"2px solid white"},children:[Ve.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[Ve.jsx("span",{style:{fontSize:"20px"},children:"ascending"===j?"üöÄ":"descending"===j?"üìç":"‚úàÔ∏è"}),Ve.jsxs("div",{style:{flex:1},children:[Ve.jsx("div",{style:{textTransform:"uppercase",letterSpacing:"1px",fontSize:"13px"},children:"ascending"===j?"TAKEOFF":"descending"===j?"LANDING":"CRUISING - FULL CONTROL"}),Ve.jsx("div",{style:{fontSize:"10px",opacity:.9},children:"ascending"===j?`Altitude: ${Math.round(un)}m / 10m`:"descending"===j?`Land on roof (${un.toFixed(1)}m)`:`Alt: ${un.toFixed(1)}m`})]})]}),"ascending"===j&&Ve.jsx("div",{style:{marginTop:"8px",width:"100%",height:"6px",background:"rgba(0,0,0,0.3)",borderRadius:"3px",overflow:"hidden"},children:Ve.jsx("div",{style:{width:`${Math.min(100,un/10*100)}%`,height:"100%",background:"#fff",transition:"width 0.1s"}})}),Ve.jsx("div",{style:{marginTop:"8px",fontSize:"11px",opacity:.9,display:"flex",justifyContent:"space-between"},children:qt?Ve.jsx("span",{style:{width:"100%",textAlign:"center"},children:"Hold ASCEND / DESCEND buttons"}):Ve.jsxs(Ve.Fragment,{children:[Ve.jsx("span",{children:"‚¨ÜÔ∏è SPACE = UP"}),Ve.jsx("span",{children:"‚¨áÔ∏è SHIFT = DOWN"})]})}),Ve.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:fn>0?"#00ff00":fn<0?"#ff6600":"#888"},children:fn>.5?"‚Üë‚Üë‚Üë ASCENDING":fn<-.5?"‚Üì‚Üì‚Üì DESCENDING":"‚Äî HOVER"})]}),m&&Ve.jsx(pr,{distanceToBase:z,canRelease:A,canDescend:k,horizontalDist:D,altitude:un}),Ve.jsx(ur,{message:h}),se&&Ve.jsx(hr,{step:ae,onNext:()=>{ae<Qe.length-1?le(e=>e+1):(ie(!1),Sn())},onSkip:()=>{ie(!1),Sn()}}),he&&xe&&Ve.jsx(Tr,{deliveryTime:xe.deliveryTime,tip:xe.tip,pizzaHealth:xe.pizzaHealth,isPerfect:xe.isPerfect,temperature:xe.temperature,rating:xe.rating,tipMessage:xe.tipMessage,pizzaType:xe.pizzaType,xpChange:xe.xpChange,rankBonus:xe.rankBonus,playerRank:xe.playerRank,totalDeliveries:l,onNextOrder:()=>{fe(!1),Sn()},onViewLeaderboard:()=>{fe(!1),de(!0)}}),Ve.jsx(gr,{message:We}),Ve.jsx(mr,{badge:Ue}),U&&Ve.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(180, 0, 0, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3,animation:"flashRed 0.5s ease-in-out 3"},children:[Ve.jsxs("div",{style:{fontSize:"80px",marginBottom:"20px",animation:"shake 0.5s ease-in-out infinite"},children:[Q?.emoji||"üçï","üíÄüí∏"]}),Ve.jsx("h1",{style:{color:"white",fontSize:"48px",textShadow:"0 0 20px #ff0000",marginBottom:"10px",textTransform:"uppercase",letterSpacing:"5px"},children:"PIZZA DESTROYED!"}),Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"8px 20px",borderRadius:"20px",marginBottom:"10px",fontSize:"18px",color:"#ffcc00"},children:[Q?.emoji," ",Q?.name||"Pizza"]}),Ve.jsxs("p",{style:{color:"#ffcccc",fontSize:"20px",marginBottom:"15px",textAlign:"center",maxWidth:"500px",fontStyle:"italic"},children:['"',Q?.description||"That pizza is gone forever!",'"']}),Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"15px 30px",borderRadius:"10px",border:"3px solid "+((Q?.price||18.99)>25?"#ff0000":"#ff4444"),marginBottom:"20px"},children:[Ve.jsx("div",{style:{color:"#ff6666",fontSize:"16px",marginBottom:"5px"},children:"üí∏ CHARGED TO YOUR WAGES:"}),Ve.jsxs("div",{style:{color:(Q?.price||18.99)>25?"#ff0000":"#ff4444",fontSize:(Q?.price||18.99)>25?"42px":"36px",fontWeight:"bold"},children:["-$",(Q?.price||18.99).toFixed(2)]}),Ve.jsx("div",{style:{color:"#ffaaaa",fontSize:"12px"},children:(Q?.price||18.99)>=49.99?"üò± THE MOST EXPENSIVE ONE!":(Q?.price||18.99)>=24.99?"üò∞ That was a premium pizza!":(Q?.price||18.99)<15?"üòÖ At least it was cheap...":"Full price of destroyed pizza!"})]}),Ve.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginBottom:"30px"},children:[Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"15px 25px",borderRadius:"10px",color:"white",textAlign:"center"},children:[Ve.jsx("div",{style:{fontSize:"14px",opacity:.8},children:"Pizzas Destroyed"}),Ve.jsx("div",{style:{fontSize:"36px",fontWeight:"bold"},children:d})]}),Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"15px 25px",borderRadius:"10px",color:i<0?"#ff4444":"#00ff00",textAlign:"center"},children:[Ve.jsx("div",{style:{fontSize:"14px",opacity:.8},children:"Total Wages"}),Ve.jsx("div",{style:{fontSize:"36px",fontWeight:"bold"},children:i<0?`-$${Math.abs(i).toFixed(2)}`:`$${i.toFixed(2)}`})]})]}),Ve.jsxs("div",{style:{display:"flex",gap:"15px"},children:[Ve.jsx("button",{onClick:()=>{G(!1),Tn()},style:{...zr.primary,background:"linear-gradient(180deg, #22aa22 0%, #118811 100%)",fontSize:"20px",padding:"15px 40px"},children:"üçï Try Again"}),Ve.jsx("button",{onClick:()=>{Xe.current&&(clearTimeout(Xe.current),Xe.current=null),$e(null),G(!1),r("menu"),s(null)},style:{...zr.secondary,fontSize:"20px",padding:"15px 40px"},children:"üè† Back to Menu"})]}),Ve.jsx("p",{style:{color:"#ffaaaa",fontSize:"14px",marginTop:"30px",opacity:.7},children:"üí° Tip: Move slowly and keep the pizza box level!"})]}),W&&Ve.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(180, 100, 0, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3},children:[Ve.jsx("div",{style:{fontSize:"80px",marginBottom:"20px"},children:"üçïüò¨üçï"}),Ve.jsx("h1",{style:{color:"white",fontSize:"36px",textShadow:"0 0 20px #ff6600",marginBottom:"10px",textAlign:"center"},children:"WAIT... DELIVER THIS?!"}),Ve.jsxs("p",{style:{color:"#ffeecc",fontSize:"22px",marginBottom:"10px",textAlign:"center",maxWidth:"500px"},children:["This pizza is only ",Ve.jsxs("span",{style:{color:"#ff4444",fontWeight:"bold",fontSize:"28px"},children:[Math.round(te),"%"]})," intact!"]}),Ve.jsxs("p",{style:{color:"#ffcc88",fontSize:"18px",marginBottom:"30px",textAlign:"center",maxWidth:"500px",fontStyle:"italic"},children:['ü§î "Are you SURE you want to deliver this disaster?',Ve.jsx("br",{}),"The customer might not tip well... or at all...",Ve.jsx("br",{}),'They might even call your manager!"']}),Ve.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"15px 30px",borderRadius:"10px",marginBottom:"25px"},children:[Ve.jsx("div",{style:{color:"#ffcc00",fontSize:"16px",marginBottom:"5px"},children:"üí∞ Expected Tip Reduction:"}),Ve.jsxs("div",{style:{color:"#ff4444",fontSize:"24px",fontWeight:"bold"},children:["-",Math.round(.5*(100-te)),"% tips! üò¢"]})]}),Ve.jsxs("div",{style:{display:"flex",gap:"15px"},children:[Ve.jsx("button",{onClick:()=>{X(!1),K&&(An(K),q(null))},style:{...zr.primary,background:"linear-gradient(180deg, #cc6600 0%, #884400 100%)",fontSize:"18px",padding:"12px 30px"},children:"üòÖ YOLO! Deliver It Anyway"}),Ve.jsx("button",{onClick:()=>{X(!1),q(null),Tn()},style:{...zr.secondary,fontSize:"18px",padding:"12px 30px"},children:"üçï Get Fresh Pizza"})]}),Ve.jsx("p",{style:{color:"#ffddaa",fontSize:"12px",marginTop:"20px",opacity:.7},children:"Pro tip: Walk back to the shop for a perfect pizza! üèÉ‚Äç‚ôÇÔ∏è"})]}),Ve.jsx(wr,{isOpen:ce,onClose:()=>de(!1),category:pe,onCategoryChange:ue,playerRank:42,playerScore:i}),!ce&&!he&&"menu"!==n&&Ve.jsx(Sr,{topPlayers:tr.fastest_delivery,playerRank:42,onExpand:()=>de(!0)}),Ve.jsxs("div",{style:{position:"absolute",bottom:20,left:"50%",transform:"translateX(-50%)",display:"flex",gap:"10px"},children:["menu"===n&&Ve.jsxs(Ve.Fragment,{children:[Ve.jsx("button",{onClick:()=>ie(!0),style:zr.secondary,children:"üìñ Tutorial"}),Ve.jsx("button",{onClick:Sn,style:zr.primary,children:"üçï Start Delivering!"}),Ve.jsx("button",{onClick:()=>de(!0),style:zr.secondary,children:"üèÜ Leaderboards"})]}),"carrying"===n&&!I&&Ve.jsx(Ve.Fragment,{children:Ot?Ve.jsx("button",{onClick:zn,style:{...zr.primary,animation:"pulse 1s infinite"},children:"üçï Grab Pizza from Shop"}):Ve.jsxs("div",{style:{color:"white",background:"rgba(0,0,0,0.7)",padding:"10px 20px",borderRadius:"8px"},children:["üè™ Walk to the Pizza Shop! (",qt?"Use touch controls to move":"WASD to move",")"]})}),"carrying"===n&&I&&Ve.jsxs(Ve.Fragment,{children:[Ve.jsxs("div",{style:{color:"white",background:"rgba(0,0,0,0.7)",padding:"10px 20px",borderRadius:"8px",marginRight:"10px"},children:["üçï Walk to Drone ",o?.drone,"! (",qt?"Use touch controls to move":"WASD to move",")"]}),Nt&&Ve.jsxs("button",{onClick:()=>Rn(Nt),style:{...zr.primary,background:Nt===o?.drone?"#22cc22":"#cc8822",animation:Nt===o?.drone?"pulse 0.5s infinite":"none"},children:["üöÅ Load Drone ",Nt,Nt!==o?.drone&&" (Wrong!)"]})]}),"flying"===n&&m&&Ve.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[Ve.jsx("button",{onClick:an,style:{...zr.secondary,minWidth:"140px"},children:"Camera View"}),Ve.jsx("button",{onClick:kr,style:{...zr.danger,animation:A?"glow 1s infinite":"none"},children:"Release Pizza"})]})]}),I&&Ve.jsx(lr,{pizzaHealth:te,pizzaTilt:re,isMobile:qt}),I&&Ve.jsx(cr,{speed:gn,isWarning:yn,pizzaHealth:te,isMobile:qt}),Ve.jsx(vr,{visible:qt&&Jt&&("carrying"===n||"flying"===n),pilotMode:m,canRelease:A,onControlChange:dn,onRelease:()=>{m&&A&&kr()},isTouchDevice:qt}),Ve.jsx(xr,{info:Ht,actions:Ar,bindings:Gt,getButtonLabel:tn,overlayVisible:Xt,onToggleOverlay:()=>{Kt(e=>!e),$t&&sn()},isMobile:qt}),Xt&&Ve.jsx(yr,{info:Ht,actions:Ar,bindings:Gt,getButtonLabel:tn,pendingBinding:$t,onStartRemap:on,onCancelRemap:sn,onResetBindings:rn,onClose:()=>{Kt(!1),$t&&sn()}}),m&&!qt&&Ve.jsx(fr,{}),Ve.jsx("style",{children:"\n  @keyframes blink {\n    0%, 50% { opacity: 1; }\n    51%, 100% { opacity: 0.3; }\n  }\n  \n  @keyframes pulse {\n    0%, 100% { transform: translate(-50%, -50%) scale(1); }\n    50% { transform: translate(-50%, -50%) scale(1.2); }\n  }\n  \n  @keyframes popIn {\n    0% { transform: scale(0.8); opacity: 0; }\n    100% { transform: scale(1); opacity: 1; }\n  }\n  \n  @keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    25% { transform: translateX(-5px); }\n    75% { transform: translateX(5px); }\n  }\n  \n  @keyframes glow {\n    0%, 100% { box-shadow: 0 0 5px #00ff00; }\n    50% { box-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00; }\n  }\n  \n  @keyframes slideIn {\n    0% { transform: translateY(-100%); opacity: 0; }\n    100% { transform: translateY(0); opacity: 1; }\n  }\n  \n  @keyframes fadeIn {\n    0% { opacity: 0; }\n    100% { opacity: 1; }\n  }\n  \n  @keyframes bounce {\n    0%, 100% { transform: translateY(0); }\n    50% { transform: translateY(-10px); }\n  }\n  \n  @keyframes rotate {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n  \n  @keyframes warning {\n    0%, 100% { background-color: rgba(255, 0, 0, 0.2); }\n    50% { background-color: rgba(255, 0, 0, 0.5); }\n  }\n  \n  .game-button {\n    transition: all 0.2s ease;\n  }\n  \n  .game-button:hover {\n    transform: scale(1.05);\n    box-shadow: 0 6px 12px rgba(0,0,0,0.4);\n  }\n  \n  .game-button:active {\n    transform: scale(0.98);\n  }\n"})]})};function Mr(){return Ve.jsx("div",{className:"App",children:Ve.jsx(kr,{})})}Xe.createRoot(document.getElementById("root")).render(Ve.jsx(n.StrictMode,{children:Ve.jsx(Mr,{})}));

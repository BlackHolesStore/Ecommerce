import{r as e,a as t,R as r}from"./react-vendor-DENY9G7l.js";import{C as o,M as n,a as i,B as a,V as s,L as l,b as d,G as c,c as p,d as u,R as h,e as x,D as f,S as m,f as g,g as y,h as z,P as b,E as v,i as w,j as S,k as D,l as j,F as k,m as T,W as E,n as M,A as R,o as C,p as P,q as I}from"./three-glQnTbk0.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var A={exports:{}},B={},F=e,L=Symbol.for("react.element"),W=Symbol.for("react.fragment"),$=Object.prototype.hasOwnProperty,H=F.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,N={key:!0,ref:!0,__self:!0,__source:!0};function O(e,t,r){var o,n={},i=null,a=null;for(o in void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(a=t.ref),t)$.call(t,o)&&!N.hasOwnProperty(o)&&(n[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===n[o]&&(n[o]=t[o]);return{$$typeof:L,type:e,key:i,ref:a,props:n,_owner:H.current}}B.Fragment=W,B.jsx=O,B.jsxs=O,A.exports=B;var _=A.exports,G={},V=t;G.createRoot=V.createRoot,G.hydrateRoot=V.hydrateRoot;const U=[{x:-15,z:10,label:"A"},{x:15,z:10,label:"B"},{x:-15,z:-12,label:"C"},{x:15,z:-12,label:"D"}],q=[{x:-40,z:40,num:1},{x:40,z:40,num:2},{x:-40,z:-40,num:3},{x:40,z:-40,num:4}],X=0,Y=4,J=[{id:1,title:"Welcome to Pizza Express VR! üçï",message:"You are a drone pilot delivering pizzas across the city! Each customer has a name and is waiting for their delicious pizza!",highlight:null},{id:2,title:"Pick Up Pizza üì¶",message:"Grab a pizza from the shop. Each pizza has a different price - the more expensive, the bigger tips possible!",highlight:"shop"},{id:3,title:"Carry Carefully üéØ",message:"Tilt meter shows pizza condition. Keep it green! Damaged pizzas = angry customers = no tips!",highlight:"tiltMeter"},{id:4,title:"Climb the Ranks! üèÜ",message:"Earn XP with each delivery! Rise from Trainee to PIZZA GOD! Higher ranks = bigger tip bonuses! But beware - dropping pizzas costs more XP than you earn!",highlight:null},{id:5,title:"Earn Badges üéñÔ∏è",message:"Deliver specific pizza types to unlock badges! Each pizza type has special achievements. Collect them all!",highlight:null},{id:6,title:"Store Earnings üí∞",message:"Every pizza you deliver adds to the store's total earnings! Compete to be the top contributor!",highlight:null},{id:7,title:"Fly Controls ‚úàÔ∏è",message:"Use WASD to move, Space/Shift for altitude, V to switch camera. In VR, use your controllers!",highlight:"controls"},{id:8,title:"Deliver & Get Paid! üöÄ",message:"Land in the green zone and release the pizza! Fast + careful = big tips! Now go make some deliveries!",highlight:"deliveryZone"}],K=8900331,Z=4881468,Q=16729156,ee=16776960,te=3355443,re=2201331,oe=65280,ne=4473924,ie=2236962,ae=16750848,se=16739179,le=async()=>{if(!navigator.xr)return{supported:!1,reason:"WebXR not available in this browser"};try{const e=await navigator.xr.isSessionSupported("immersive-vr");return{supported:e,reason:e?"VR supported":"immersive-vr not supported"}}catch(e){return{supported:!1,reason:e.message}}};class de{constructor(e,t,r){this.renderer=e,this.scene=t,this.camera=r,this.session=null,this.referenceSpace=null,this.controllers=[],this.controllerGrips=[],this.isInVR=!1,this.controllerState={left:{connected:!1,squeezing:!1,selecting:!1,thumbstick:{x:0,y:0}},right:{connected:!1,squeezing:!1,selecting:!1,thumbstick:{x:0,y:0}}},this.onSessionStart=null,this.onSessionEnd=null,this.onControllerInput=null}async init(){const e=await le();return e.supported?(this.renderer.xr.enabled=!0,this.setupControllers(),!0):(console.warn("WebXR not supported:",e.reason),!1)}setupControllers(){const e=this.renderer.xr.getController(0);e.userData.handedness="left",this.setupControllerEvents(e,0),this.scene.add(e),this.controllers.push(e);const t=this.renderer.xr.getController(1);t.userData.handedness="right",this.setupControllerEvents(t,1),this.scene.add(t),this.controllers.push(t);const r=this.renderer.xr.getControllerGrip(0);this.scene.add(r),this.controllerGrips.push(r);const o=this.renderer.xr.getControllerGrip(1);this.scene.add(o),this.controllerGrips.push(o),this.addControllerVisuals()}addControllerVisuals(){const e=new o(.01,.02,.1,8),t=new n({color:4491519,emissive:2245768,emissiveIntensity:.3});this.controllers.forEach((r,o)=>{const n=new i(e,t);n.rotation.x=-Math.PI/2,r.add(n);const c=(new a).setFromPoints([new s(0,0,0),new s(0,0,-5)]),p=new l({color:4521864,transparent:!0,opacity:.5}),u=new d(c,p);r.add(u)})}setupControllerEvents(e,t){const r=0===t?"left":"right";e.addEventListener("connected",t=>{this.controllerState[r].connected=!0,e.userData.inputSource=t.data,t.data.handedness&&(e.userData.handedness=t.data.handedness),console.log(`Controller ${r} connected:`,t.data.handedness)}),e.addEventListener("disconnected",()=>{this.controllerState[r].connected=!1,console.log(`Controller ${r} disconnected`)}),e.addEventListener("selectstart",()=>{this.controllerState[r].selecting=!0,this.onControllerInput&&this.onControllerInput({type:"selectstart",hand:r,controller:e})}),e.addEventListener("selectend",()=>{this.controllerState[r].selecting=!1,this.onControllerInput&&this.onControllerInput({type:"selectend",hand:r,controller:e})}),e.addEventListener("squeezestart",()=>{this.controllerState[r].squeezing=!0,this.onControllerInput&&this.onControllerInput({type:"squeezestart",hand:r,controller:e})}),e.addEventListener("squeezeend",()=>{this.controllerState[r].squeezing=!1,this.onControllerInput&&this.onControllerInput({type:"squeezeend",hand:r,controller:e})})}async startSession(){try{const e={requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor","hand-tracking","layers"]};return this.session=await navigator.xr.requestSession("immersive-vr",e),this.isInVR=!0,this.renderer.xr.setSession(this.session),this.referenceSpace=await this.session.requestReferenceSpace("local-floor"),this.session.addEventListener("end",()=>{this.isInVR=!1,this.session=null,this.onSessionEnd&&this.onSessionEnd()}),this.onSessionStart&&this.onSessionStart(),console.log("VR session started"),!0}catch(e){return console.error("Failed to start VR session:",e),!1}}async endSession(){this.session&&await this.session.end()}pollControllerInput(){if(!this.session)return;const e=this.session.inputSources;for(const t of e){if(!t.gamepad)continue;const e=t.handedness||"unknown";if("left"!==e&&"right"!==e)continue;const r=t.gamepad;r.axes.length>=4&&(this.controllerState[e].thumbstick={x:r.axes[2]||0,y:r.axes[3]||0}),r.buttons.length>4&&(this.controllerState[e].primaryButton=r.buttons[4]?.pressed||!1,this.controllerState[e].secondaryButton=r.buttons[5]?.pressed||!1)}return this.controllerState}async triggerHaptic(e,t=.5,r=100){if(!this.session)return;const o=this.session.inputSources;for(const i of o)if(i.handedness===e&&i.gamepad){const e=i.gamepad;if(e.vibrationActuator)try{return void(await e.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:r,weakMagnitude:.5*t,strongMagnitude:t}))}catch(n){}if(e.hapticActuators&&e.hapticActuators[0])try{await e.hapticActuators[0].pulse(t,r)}catch(n){}}}getControllerPosition(e){const t="left"===e?0:1,r=this.controllers[t];if(!r)return null;const o=new s;return r.getWorldPosition(o),o}getControllerDirection(e){const t="left"===e?0:1,r=this.controllers[t];if(!r)return null;const o=new s(0,0,-1);return r.getWorldDirection(o),o}}const ce=[{name:"Plain Cheese",price:12.99,emoji:"üßÄ",description:"Lucky you! Just a basic cheese pizza."},{name:"Pepperoni",price:14.99,emoji:"üçï",description:"Classic pepperoni - not too bad."},{name:"Hawaiian",price:15.99,emoji:"üçç",description:"Pineapple lovers hate you now."},{name:"Veggie Supreme",price:16.99,emoji:"ü•¨",description:"All those veggies... wasted!"},{name:"Meat Lovers",price:18.99,emoji:"ü•ì",description:"So much meat... gone forever."},{name:"BBQ Chicken",price:17.99,emoji:"üçó",description:"That BBQ sauce is everywhere now!"},{name:"Supreme Deluxe",price:21.99,emoji:"üëë",description:"The EXPENSIVE one! Boss is MAD!"},{name:"Truffle Special",price:24.99,emoji:"üçÑ",description:"TRUFFLE?! That costs a fortune!"},{name:"Lobster & Gold Leaf",price:49.99,emoji:"ü¶û",description:"OH NO! The $50 LUXURY PIZZA! You're in DEEP trouble!"}],pe=[{id:"cheese_lover",name:"Cheese Lover",emoji:"üßÄ",description:"Delivered 25 Plain Cheese pizzas",pizzaType:"Plain Cheese",required:25},{id:"cheese_king",name:"Cheese King",emoji:"üßÄüëë",description:"Delivered 100 Plain Cheese pizzas",pizzaType:"Plain Cheese",required:100},{id:"pepperoni_pro",name:"Pepperoni Pro",emoji:"üçï",description:"Delivered 25 Pepperoni pizzas",pizzaType:"Pepperoni",required:25},{id:"pepperoni_legend",name:"Pepperoni Legend",emoji:"üçïüî•",description:"Delivered 100 Pepperoni pizzas",pizzaType:"Pepperoni",required:100},{id:"hawaiian_hero",name:"Hawaiian Hero",emoji:"üçç",description:"Delivered 25 Hawaiian pizzas",pizzaType:"Hawaiian",required:25},{id:"pineapple_defender",name:"Pineapple Defender",emoji:"üççüõ°Ô∏è",description:"Delivered 100 Hawaiian pizzas - You embrace the controversy!",pizzaType:"Hawaiian",required:100},{id:"veggie_friend",name:"Veggie Friend",emoji:"ü•¨",description:"Delivered 25 Veggie Supreme pizzas",pizzaType:"Veggie Supreme",required:25},{id:"green_machine",name:"Green Machine",emoji:"ü•¨üíö",description:"Delivered 100 Veggie Supreme pizzas",pizzaType:"Veggie Supreme",required:100},{id:"carnivore",name:"Carnivore",emoji:"ü•ì",description:"Delivered 25 Meat Lovers pizzas",pizzaType:"Meat Lovers",required:25},{id:"meat_master",name:"Meat Master",emoji:"ü•ìüèÜ",description:"Delivered 100 Meat Lovers pizzas",pizzaType:"Meat Lovers",required:100},{id:"bbq_boss",name:"BBQ Boss",emoji:"üçó",description:"Delivered 25 BBQ Chicken pizzas",pizzaType:"BBQ Chicken",required:25},{id:"grill_master",name:"Grill Master",emoji:"üçóüî•",description:"Delivered 100 BBQ Chicken pizzas",pizzaType:"BBQ Chicken",required:100},{id:"supreme_server",name:"Supreme Server",emoji:"üëë",description:"Delivered 25 Supreme Deluxe pizzas",pizzaType:"Supreme Deluxe",required:25},{id:"deluxe_deity",name:"Deluxe Deity",emoji:"üëë‚ú®",description:"Delivered 100 Supreme Deluxe pizzas",pizzaType:"Supreme Deluxe",required:100},{id:"truffle_hunter",name:"Truffle Hunter",emoji:"üçÑ",description:"Delivered 15 Truffle Special pizzas",pizzaType:"Truffle Special",required:15},{id:"truffle_tycoon",name:"Truffle Tycoon",emoji:"üçÑüíé",description:"Delivered 50 Truffle Special pizzas",pizzaType:"Truffle Special",required:50},{id:"luxury_courier",name:"Luxury Courier",emoji:"ü¶û",description:"Delivered 10 Lobster & Gold Leaf pizzas",pizzaType:"Lobster & Gold Leaf",required:10},{id:"golden_god",name:"Golden God",emoji:"ü¶ûüåü",description:"Delivered 25 Lobster & Gold Leaf pizzas - The elite!",pizzaType:"Lobster & Gold Leaf",required:25}],ue=[{id:"first_delivery",name:"First Flight",emoji:"üõ´",description:"Completed your first delivery!",deliveries:1},{id:"getting_started",name:"Getting Started",emoji:"üì¶",description:"Completed 10 deliveries",deliveries:10},{id:"on_a_roll",name:"On a Roll",emoji:"üéØ",description:"Completed 50 deliveries",deliveries:50},{id:"century",name:"Century Club",emoji:"üíØ",description:"Completed 100 deliveries",deliveries:100},{id:"pizza_veteran",name:"Pizza Veteran",emoji:"üéñÔ∏è",description:"Completed 250 deliveries",deliveries:250},{id:"delivery_legend",name:"Delivery Legend",emoji:"üèÜ",description:"Completed 500 deliveries",deliveries:500},{id:"pizza_immortal",name:"Pizza Immortal",emoji:"‚ö°",description:"Completed 1000 deliveries",deliveries:1e3}],he=[{id:"first_perfect",name:"Flawless",emoji:"‚≠ê",description:"First perfect delivery!",perfectDeliveries:1},{id:"perfectionist",name:"Perfectionist",emoji:"üåü",description:"10 perfect deliveries",perfectDeliveries:10},{id:"untouchable",name:"Untouchable",emoji:"üí´",description:"50 perfect deliveries",perfectDeliveries:50},{id:"god_tier",name:"God Tier",emoji:"‚ú®",description:"100 perfect deliveries - You are a master!",perfectDeliveries:100}],xe=[{id:"speed_demon",name:"Speed Demon",emoji:"‚ö°",description:"Delivered in under 20 seconds",fastestTime:20},{id:"lightning",name:"Lightning Fast",emoji:"üå©Ô∏è",description:"Delivered in under 15 seconds",fastestTime:15},{id:"time_bender",name:"Time Bender",emoji:"‚è±Ô∏è",description:"Delivered in under 10 seconds - Are you hacking?!",fastestTime:10}],fe=[{id:"first_hundred",name:"First $100",emoji:"üíµ",description:"Earned $100 in tips",totalTips:100},{id:"high_roller",name:"High Roller",emoji:"üí∞",description:"Earned $500 in tips",totalTips:500},{id:"tip_tycoon",name:"Tip Tycoon",emoji:"ü§ë",description:"Earned $1000 in tips",totalTips:1e3},{id:"pizza_millionaire",name:"Pizza Millionaire",emoji:"üíé",description:"Earned $5000 in tips - Rolling in dough!",totalTips:5e3}],me=["James","Mary","John","Patricia","Robert","Jennifer","Michael","Linda","David","Elizabeth","William","Barbara","Richard","Susan","Joseph","Jessica","Thomas","Sarah","Christopher","Karen","Charles","Lisa","Daniel","Nancy","Matthew","Betty","Anthony","Margaret","Mark","Sandra","Donald","Ashley","Steven","Kimberly","Paul","Emily","Andrew","Donna","Joshua","Michelle","Kevin","Dorothy","Brian","Carol","George","Amanda","Timothy","Melissa","Ronald","Deborah","Jason","Stephanie","Edward","Rebecca","Jeffrey","Sharon","Ryan","Laura","Jacob","Cynthia","Gary","Kathleen","Nicholas","Amy","Eric","Angela","Jonathan","Shirley","Stephen","Anna","Larry","Brenda","Justin","Pamela","Scott","Emma","Brandon","Nicole","Benjamin","Helen","Samuel","Samantha","Gregory","Katherine","Alexander","Christine","Frank","Debra","Patrick","Rachel","Raymond","Carolyn","Jack","Janet","Dennis","Catherine","Jerry","Maria","Tyler","Heather"],ge=["Smith","Johnson","Williams","Brown","Jones","Garcia","Miller","Davis","Rodriguez","Martinez","Hernandez","Lopez","Gonzalez","Wilson","Anderson","Thomas","Taylor","Moore","Jackson","Martin","Lee","Perez","Thompson","White","Harris","Sanchez","Clark","Ramirez","Lewis","Robinson","Walker","Young","Allen","King","Wright","Scott","Torres","Nguyen","Hill","Flores","Green","Adams","Nelson","Baker","Hall","Rivera","Campbell","Mitchell","Carter","Roberts","Gomez","Phillips","Evans","Turner","Diaz","Parker","Cruz","Edwards","Collins","Reyes","Stewart","Morris","Morales","Murphy","Cook","Rogers","Gutierrez","Ortiz","Morgan","Cooper","Peterson","Bailey","Reed","Kelly","Howard","Ramos","Kim","Cox","Ward","Richardson","Watson","Brooks","Chavez","Wood","James","Bennett","Gray","Mendoza","Ruiz","Hughes","Price","Alvarez","Castillo","Sanders","Patel","Myers","Long","Ross","Foster","Jimenez"],ye=[{name:"Trainee",emoji:"üê£",minXP:0,tipBonus:0,color:"#888888"},{name:"Rookie Pilot",emoji:"üõ´",minXP:100,tipBonus:.05,color:"#66bb6a"},{name:"Delivery Driver",emoji:"üöó",minXP:300,tipBonus:.1,color:"#42a5f5"},{name:"Pizza Pro",emoji:"üçï",minXP:600,tipBonus:.15,color:"#ab47bc"},{name:"Sky Captain",emoji:"‚úàÔ∏è",minXP:1e3,tipBonus:.2,color:"#ff7043"},{name:"Elite Flyer",emoji:"ü¶Ö",minXP:1500,tipBonus:.25,color:"#ffd54f"},{name:"Pizza Master",emoji:"üë®‚Äçüç≥",minXP:2200,tipBonus:.3,color:"#e91e63"},{name:"Drone Legend",emoji:"üèÜ",minXP:3e3,tipBonus:.35,color:"#ff9800"},{name:"Pizza Emperor",emoji:"üëë",minXP:4e3,tipBonus:.4,color:"#f44336"},{name:"PIZZA GOD",emoji:"üåü",minXP:5500,tipBonus:.5,color:"#ffd700"}],ze=e=>{for(let t=ye.length-1;t>=0;t--)if(e>=ye[t].minXP)return ye[t];return ye[0]},be=(e,t,r,o,n)=>{if(n)return-150;let i=0;return e>=4.8?(i=50,o&&(i=75)):i=e>=4.5?40:e>=4?30:e>=3.5?20:e>=3?10:e>=2.5?0:e>=2?-25:-50,r<30&&i>0?i+=15:r<45&&i>0?i+=10:r<60&&i>0&&(i+=5),r>=90?(i=Math.min(i,0),i-=30):r>=120&&(i-=50),t<70?i-=20:t<50&&(i-=40),i<0&&(i=Math.floor(1.5*i)),i},ve=(e,t,r)=>{if(e.name===t.name)return null;if(r){const e=[`üéâ PROMOTED to ${t.emoji} ${t.name}! Tips +${Math.round(100*t.tipBonus)}%!`,`üìà RANK UP! You're now a ${t.emoji} ${t.name}! More tips incoming!`,`üåü NICE! ${t.emoji} ${t.name} unlocked! +${Math.round(100*t.tipBonus)}% tip bonus!`,`üöÄ LEVEL UP! Welcome to ${t.emoji} ${t.name}! Tips are getting BIGGER!`];return e[Math.floor(Math.random()*e.length)]}{const e=[`üìâ DEMOTED to ${t.emoji} ${t.name}... Tips reduced to +${Math.round(100*t.tipBonus)}%`,`üò∞ RANK DOWN! Back to ${t.emoji} ${t.name}. Gotta do better!`,`üíî OUCH! Dropped to ${t.emoji} ${t.name}. Less tips now...`,`üîª Demoted to ${t.emoji} ${t.name}. The grind continues...`];return e[Math.floor(Math.random()*e.length)]}},we="pizzaExpress_totalWages",Se="pizzaExpress_totalDeliveries",De="pizzaExpress_totalDestroyed",je="pizzaExpress_bestTime",ke="pizzaExpress_playerName",Te="pizzaExpress_xp",Ee="pizzaExpress_badges",Me="pizzaExpress_pizzaTypeDeliveries",Re="pizzaExpress_perfectDeliveries",Ce="pizzaExpress_totalTips",Pe="pizzaExpress_fastestDelivery",Ie="pizzaExpress_storeEarnings",Ae={fastest_delivery:[{rank:1,name:"SpeedDemon",value:12.5,unit:"s"},{rank:2,name:"PizzaPro",value:14.2,unit:"s"},{rank:3,name:"DroneKing",value:15.8,unit:"s"},{rank:4,name:"FastFlyer",value:16.1,unit:"s"},{rank:5,name:"QuickPizza",value:17.3,unit:"s"}],most_deliveries:[{rank:1,name:"Grinder99",value:1523,unit:""},{rank:2,name:"NeverStop",value:1201,unit:""},{rank:3,name:"PizzaBot",value:998,unit:""},{rank:4,name:"Delivery4Life",value:876,unit:""},{rank:5,name:"DroneQueen",value:754,unit:""}],store_earnings:[{rank:1,name:"PizzaTycoon",value:125420,unit:"$"},{rank:2,name:"DeliveryKing",value:98300,unit:"$"},{rank:3,name:"PizzaBoss",value:76800,unit:"$"},{rank:4,name:"TopContributor",value:54650,unit:"$"},{rank:5,name:"StoreHelper",value:32200,unit:"$"}],perfect_pizzas:[{rank:1,name:"SteadyHands",value:892,unit:""},{rank:2,name:"Perfectionist",value:756,unit:""},{rank:3,name:"NoSpill",value:623,unit:""},{rank:4,name:"CarefulOne",value:589,unit:""},{rank:5,name:"GentlePilot",value:512,unit:""}],most_dropped_pizzas:[{rank:1,name:"ButterFingers",value:247,unit:"üçïüí®"},{rank:2,name:"OopsieDoopsie",value:198,unit:"üçïüí®"},{rank:3,name:"Clumsy Carl",value:156,unit:"üçïüí®"},{rank:4,name:"WhoopsieDaisy",value:134,unit:"üçïüí®"},{rank:5,name:"PizzaChaos",value:112,unit:"üçïüí®"}],bestRating:[{rank:1,name:"PerfectPilot",value:5,unit:"‚≠ê"},{rank:2,name:"SteadyEddy",value:4.9,unit:"‚≠ê"},{rank:3,name:"CarefulCarl",value:4.8,unit:"‚≠ê"},{rank:4,name:"GentleGina",value:4.7,unit:"‚≠ê"},{rank:5,name:"SmoothOp",value:4.6,unit:"‚≠ê"}],total_wages:[{rank:1,name:"MoneyMaker",value:1250.5,unit:"$"},{rank:2,name:"TipKing",value:980.25,unit:"$"},{rank:3,name:"PizzaPro",value:756,unit:"$"},{rank:4,name:"SteadyEarner",value:543.75,unit:"$"},{rank:5,name:"JustStarted",value:125,unit:"$"},{rank:6,name:"BreakingEven",value:0,unit:"$"},{rank:7,name:"OopsMyBad",value:-45.5,unit:"$"},{rank:8,name:"PizzaCrasher",value:-156.97,unit:"$"},{rank:9,name:"PizzaFumbler",value:-378.9,unit:"$"},{rank:10,name:"OwesTheBoss",value:-892.45,unit:"$"}],daily_earnings:[{rank:1,name:"TodaysBest",value:450,unit:"$"},{rank:2,name:"DailyGrind",value:380,unit:"$"},{rank:3,name:"MorningRush",value:320,unit:"$"},{rank:4,name:"AfternoonAce",value:290,unit:"$"},{rank:5,name:"NightOwl",value:245,unit:"$"}]},Be=(e,t)=>{let r=0;r=e>=99?3:e>=90?2.7:e>=80?2.4:e>=70?2:e>=60?1.5:e>=50?1:e>=40?.7:.5;let o=0;return o=t<30?2:t<45?1.7:t<60?1.3:t<90?.8:t<120?.3:0,Math.min(5,r+o)},Fe=(e,t,r="#ffffff")=>{if(!e.userData.canvas)return;const o=e.userData.canvas,n=e.userData.ctx,i=e.userData.texture,a=e.userData.fontSize||24;n.clearRect(0,0,o.width,o.height),n.fillStyle=r,n.font=`bold ${a}px Arial`,n.textAlign="center",n.textBaseline="middle",n.fillText(t,o.width/2,o.height/2),i.needsUpdate=!0},Le=({score:e,pizzasDelivered:t,pizzasDestroyed:r,currentOrder:o,pilotMode:n,cameraView:i,pizzaHealth:a,playerStats:s,dronePosition:l,currentPizzaType:d})=>{const c=o?q.find(e=>e.num===o.base):null,p=void 0!==s?.xp?(e=>{const t=ze(e),r=ye.findIndex(e=>e.name===t.name);if(r>=ye.length-1)return{nextRank:null,xpNeeded:0,progress:100};const o=ye[r+1],n=e-t.minXP,i=o.minXP-t.minXP,a=Math.min(100,n/i*100);return{nextRank:o,xpNeeded:o.minXP-e,progress:a}})(s.xp):null,u=s?.rank;return _.jsxs("div",{style:{position:"absolute",top:20,left:20,color:"white",fontFamily:"Arial, sans-serif",fontSize:"18px",background:"rgba(0,0,0,0.7)",padding:"15px",borderRadius:"10px",minWidth:"300px",backdropFilter:"blur(5px)"},children:[_.jsx("div",{style:{marginBottom:"10px",fontSize:"24px",fontWeight:"bold",color:"#FFD700"},children:"üçï Pizza Express VR"}),_.jsxs("div",{style:{color:e<0?"#ff4444":"#00ff00"},children:["üíµ Wages: ",e<0?`-$${Math.abs(e).toFixed(2)}`:`$${e.toFixed(2)}`,e<0&&_.jsx("span",{style:{fontSize:"12px",marginLeft:"5px"},children:"üò¨ IN DEBT!"})]}),_.jsxs("div",{children:["üì¶ Deliveries: ",t]}),r>0&&_.jsxs("div",{style:{color:"#ff6666"},children:["üí® Dropped: ",r]}),_.jsxs("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"5px"},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[_.jsx("span",{style:{fontSize:"20px"},children:u?.emoji||"üê£"}),_.jsx("span",{style:{color:u?.color||"#888"},children:u?.name||"Trainee"}),u?.tipBonus>0&&_.jsxs("span",{style:{fontSize:"12px",background:"rgba(0,255,100,0.3)",padding:"2px 6px",borderRadius:"3px",color:"#00ff88"},children:["+",Math.round(100*u.tipBonus),"% tips"]})]}),p&&p.nextRank&&_.jsxs("div",{style:{marginTop:"5px"},children:[_.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#aaa",marginBottom:"2px"},children:[_.jsxs("span",{children:["XP: ",s.xp]}),_.jsxs("span",{children:["Next: ",p.nextRank.emoji," ",p.nextRank.name," (",p.xpNeeded," XP)"]})]}),_.jsx("div",{style:{height:"6px",background:"rgba(255,255,255,0.2)",borderRadius:"3px",overflow:"hidden"},children:_.jsx("div",{style:{height:"100%",width:`${p.progress}%`,background:`linear-gradient(90deg, ${u?.color||"#888"}, ${p.nextRank.color})`,borderRadius:"3px",transition:"width 0.3s ease"}})})]}),p&&!p.nextRank&&_.jsx("div",{style:{fontSize:"10px",color:"#ffd700",marginTop:"3px"},children:"üåü MAX RANK! PIZZA GOD!"})]}),o&&_.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(255,215,0,0.2)",borderRadius:"5px"},children:[_.jsx("div",{style:{fontWeight:"bold",color:"#FFD700"},children:"Current Order:"}),o.customerName&&_.jsxs("div",{style:{fontSize:"14px",color:"#00ff88",marginBottom:"5px"},children:["üë§ ",o.customerName]}),d&&_.jsxs("div",{style:{fontSize:"14px",color:d.price>=25?"#ff6666":"#ffcc00",marginBottom:"5px"},children:[d.emoji," ",d.name,_.jsxs("span",{style:{fontSize:"12px",marginLeft:"5px"},children:["($",d.price.toFixed(2),")"]}),d.price>=25&&_.jsx("span",{children:" ‚ö†Ô∏è"})]}),_.jsxs("div",{children:["üöÅ Drone: ",o.drone]}),_.jsxs("div",{children:["üè¢ Base: #",o.base]}),c&&_.jsxs("div",{style:{fontSize:"12px",color:"#aaa"},children:["üìç Rooftop: (",c.x,", ",c.z,")"]})]}),n&&l&&_.jsxs("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(0,150,255,0.2)",borderRadius:"5px",fontSize:"14px"},children:[_.jsx("div",{style:{color:"#00aaff"},children:"üìç Drone Position:"}),_.jsxs("div",{children:["X: ",l.x?.toFixed(1)," | Z: ",l.z?.toFixed(1)]}),_.jsxs("div",{children:["Alt: ",l.y?.toFixed(1),"m"]}),c&&_.jsxs("div",{style:{marginTop:"5px",color:"#00ff88"},children:["üéØ Land on Roof: (",c.x,", ",c.z,")"]})]}),n&&_.jsxs("div",{style:{marginTop:"10px",fontSize:"14px",color:"#aaa"},children:["Camera: ","pov"===i?"POV":"overhead"===i?"Overhead":"Third Person"," (V to switch)"]})]})},We=({pizzaHealth:e,pizzaTilt:t})=>{const r=()=>e>=80?"#00ff00":e>=50?"#ffff00":e>=25?"#ff9900":"#ff0000",o=e<100;return _.jsxs("div",{style:{position:"absolute",bottom:80,left:20,background:o?"rgba(80,0,0,0.7)":"rgba(0,0,0,0.5)",padding:"8px 12px",borderRadius:"8px",color:"white",fontFamily:"Arial, sans-serif",border:o?"1px solid #ff4444":"1px solid #333",transition:"all 0.3s"},children:[_.jsx("div",{style:{fontSize:"10px",marginBottom:"4px",color:"#aaa"},children:"üçï PIZZA"}),_.jsx("div",{style:{width:"120px",height:"8px",background:"#333",borderRadius:"4px",overflow:"hidden"},children:_.jsx("div",{style:{width:`${e}%`,height:"100%",background:r(),transition:"width 0.2s"}})}),_.jsxs("div",{style:{fontSize:"10px",marginTop:"3px",display:"flex",justifyContent:"space-between"},children:[_.jsx("span",{style:{color:r()},children:e>=80?"‚úì Good":e>=50?"‚ö† Tilted":"‚ö† Damaged"}),_.jsxs("span",{style:{color:"#666"},children:[Math.round(e),"%"]})]})]})},$e=({speed:e,isWarning:t,pizzaHealth:r})=>{const o=Math.min(100,e/12*100),n=()=>e<7?"#00ff00":e<8.5?"#ffaa00":"#ff0000",i=e>=8.5;return _.jsxs("div",{style:{position:"absolute",bottom:20,left:20,background:i?"rgba(100,0,0,0.7)":"rgba(0,0,0,0.6)",padding:"8px 12px",borderRadius:"8px",color:"white",fontFamily:"Arial, sans-serif",border:i?"2px solid #ff0000":"1px solid #444",transition:"all 0.2s",minWidth:"140px"},children:[_.jsx("div",{style:{fontSize:"10px",marginBottom:"4px",color:"#aaa"},children:"üö∂ SPEED"}),_.jsx("div",{style:{width:"120px",height:"8px",background:"#333",borderRadius:"4px",overflow:"hidden",position:"relative"},children:_.jsx("div",{style:{width:`${o}%`,height:"100%",background:n(),transition:"width 0.1s"}})}),_.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"3px",fontSize:"10px"},children:[_.jsx("span",{style:{color:n(),fontWeight:"bold"},children:e<7?"‚úì SAFE":e<8.5?"‚ö† CAREFUL":"üî• TOO FAST!"}),_.jsx("span",{style:{color:"#666"},children:e.toFixed(1)})]})]})},He=({dronePosition:e,targetBase:t,currentOrder:r,altitude:o,verticalSpeed:n})=>{if(!e||!t)return null;const i=t.x-e.x,a=t.z-e.z,s=Math.max(-50,Math.min(50,2*i)),l=Math.max(-40,Math.min(40,2*a)),d=o||1.5,c=Math.min(100,d/50*100),p=n||0;return _.jsxs("div",{style:{position:"absolute",top:20,right:20,width:"220px",background:"rgba(0,0,0,0.85)",border:"2px solid #00ff00",borderRadius:"10px",padding:"10px"},children:[_.jsx("div",{style:{color:"#00ff00",fontSize:"12px",fontWeight:"bold",marginBottom:"5px",textAlign:"center"},children:"üì° GPS NAVIGATION"}),_.jsxs("div",{style:{display:"flex",gap:"10px"},children:[_.jsxs("div",{style:{position:"relative",width:"120px",height:"100px",background:"rgba(0,50,0,0.5)",borderRadius:"5px"},children:[_.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:"8px",height:"8px",background:"#00ff00",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"blink 1s infinite",boxShadow:"0 0 8px #00ff00"}}),_.jsx("div",{style:{position:"absolute",left:`calc(50% + ${s}px)`,top:`calc(50% + ${l}px)`,width:"10px",height:"10px",background:"#ff0000",borderRadius:"50%",transform:"translate(-50%, -50%)",border:"2px solid #fff",animation:"pulse 0.5s infinite"}}),_.jsx("svg",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none"},children:_.jsx("line",{x1:"50%",y1:"50%",x2:`calc(50% + ${s}px)`,y2:`calc(50% + ${l}px)`,stroke:"#00ff00",strokeWidth:"1",strokeDasharray:"4,4",opacity:"0.5"})})]}),_.jsxs("div",{style:{width:"60px",display:"flex",flexDirection:"column",alignItems:"center"},children:[_.jsx("div",{style:{color:"#00ff00",fontSize:"10px",marginBottom:"3px"},children:"ALTITUDE"}),_.jsxs("div",{style:{width:"20px",height:"70px",background:"rgba(0,50,0,0.8)",border:"1px solid #00ff00",borderRadius:"3px",position:"relative",overflow:"hidden"},children:[_.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:`${c}%`,background:`linear-gradient(to top, #004400, ${d>30?"#ffaa00":"#00ff00"})`,transition:"height 0.1s"}}),[10,20,30,40].map(e=>_.jsx("div",{style:{position:"absolute",bottom:e/50*100+"%",left:0,right:0,borderTop:"1px dashed rgba(0,255,0,0.3)"}},e))]}),_.jsxs("div",{style:{color:"#00ff00",fontSize:"14px",fontWeight:"bold",marginTop:"3px"},children:[d.toFixed(1),"m"]}),_.jsxs("div",{style:{color:Math.abs(p)<.5?"#888888":p>0?"#00ff00":"#ff6600",fontSize:"16px",marginTop:"2px"},children:[Math.abs(p)<.5?"‚óè":p>0?"‚ñ≤":"‚ñº",_.jsx("span",{style:{fontSize:"10px",marginLeft:"2px"},children:Math.abs(p).toFixed(1)})]})]})]}),_.jsxs("div",{style:{color:"#00ff00",fontSize:"11px",textAlign:"center",marginTop:"5px"},children:["üéØ Base ",r?.base]})]})},Ne=({distanceToBase:e,canRelease:t,canDescend:r,horizontalDist:o,altitude:n})=>{if(null===e||e>=50)return null;const i=t?{color:"#00ff00",message:"‚úì RELEASE ZONE",subMessage:"Press SPACE to Release Pizza!",pulse:!0}:r?{color:"#00ff00",message:"‚¨áÔ∏è DESCEND NOW",subMessage:`Centered! Land on roof (Alt: ${n?.toFixed(1)||"?"}m ‚Üí 7m)`,pulse:!0}:null!==o?o<5?{color:"#ffff00",message:`‚ÜîÔ∏è ${o.toFixed(1)}m off center`,subMessage:"Get directly OVER the beacon!",pulse:!1}:{color:"#ff9900",message:`üéØ ${Math.floor(e)}m to target`,subMessage:"Fly toward the beacon",pulse:!1}:{color:"#ff6600",message:`${Math.floor(e)}m`,subMessage:"Approach Base",pulse:!1};return _.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"42px",fontWeight:"bold",color:i.color,textShadow:"0 0 20px rgba(0,0,0,0.8)",animation:i.pulse?"pulse 0.5s infinite":"none",pointerEvents:"none",textAlign:"center"},children:[i.message,_.jsx("div",{style:{fontSize:"16px",marginTop:"5px",color:i.color},children:i.subMessage})]})},Oe=({message:e})=>_.jsx("div",{style:{position:"absolute",bottom:120,left:"50%",transform:"translateX(-50%)",color:"white",fontFamily:"Arial, sans-serif",fontSize:"16px",background:"rgba(0,100,200,0.85)",padding:"12px 20px",borderRadius:"10px",maxWidth:"500px",textAlign:"center",backdropFilter:"blur(5px)"},children:e}),_e=({step:e,onNext:t,onSkip:r})=>{const o=J[e];return o?_.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:100},children:_.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",padding:"30px",borderRadius:"15px",maxWidth:"450px",textAlign:"center",color:"white",border:"2px solid #00ff00",boxShadow:"0 0 30px rgba(0,255,0,0.3)"},children:[_.jsxs("div",{style:{fontSize:"14px",color:"#00ff00",marginBottom:"10px"},children:["Step ",e+1," of ",J.length]}),_.jsx("h2",{style:{color:"#FFD700",marginBottom:"15px",fontSize:"24px"},children:o.title}),_.jsx("p",{style:{fontSize:"16px",lineHeight:"1.6",marginBottom:"25px"},children:o.message}),_.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center"},children:[_.jsx("button",{onClick:r,style:{padding:"10px 20px",background:"#444",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:"Skip Tutorial"}),_.jsx("button",{onClick:t,style:{padding:"10px 30px",background:"#00ff00",color:"#000",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:e<J.length-1?"Next ‚Üí":"Start Playing!"})]})]})}):null},Ge=()=>_.jsxs("div",{style:{position:"absolute",bottom:70,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.8)",color:"white",padding:"10px 20px",borderRadius:"8px",fontFamily:"Arial, sans-serif",fontSize:"13px"},children:[_.jsx("span",{style:{color:"#FFD700"},children:"W"}),": Forward |",_.jsx("span",{style:{color:"#FFD700"},children:" S"}),": Back |",_.jsx("span",{style:{color:"#FFD700"},children:" A/D"}),": Turn |",_.jsx("span",{style:{color:"#FFD700"},children:" Space"}),": Up |",_.jsx("span",{style:{color:"#FFD700"},children:" Shift"}),": Down |",_.jsx("span",{style:{color:"#FFD700"},children:" V"}),": Camera"]}),Ve=({badge:e})=>e?_.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #4a1a6b 0%, #1a0a2e 100%)",padding:"30px",borderRadius:"20px",textAlign:"center",color:"white",border:"3px solid #9966ff",boxShadow:"0 0 50px #9966ff40, 0 0 100px #6633ff30",animation:"popIn 0.5s ease-out",zIndex:200,minWidth:"300px"},children:[_.jsx("div",{style:{fontSize:"14px",color:"#cc99ff",marginBottom:"10px"},children:"üéñÔ∏è NEW BADGE EARNED! üéñÔ∏è"}),_.jsx("div",{style:{fontSize:"60px",marginBottom:"10px"},children:e.emoji}),_.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#ffd700",marginBottom:"10px"},children:e.name}),_.jsx("div",{style:{fontSize:"14px",color:"#cc99ff",fontStyle:"italic"},children:e.description})]}):null,Ue=({message:e})=>{if(!e)return null;const t=e.includes("PROMOTED")||e.includes("RANK UP");return _.jsx("div",{style:{position:"absolute",top:"25%",left:"50%",transform:"translate(-50%, -50%)",background:t?"linear-gradient(135deg, #1a4a2a 0%, #0a2e1a 100%)":"linear-gradient(135deg, #4a1a1a 0%, #2e0a0a 100%)",padding:"20px 40px",borderRadius:"15px",textAlign:"center",color:"white",border:"3px solid "+(t?"#00ff66":"#ff4444"),boxShadow:"0 0 30px "+(t?"#00ff6640":"#ff444440"),animation:"popIn 0.3s ease-out",zIndex:180,fontSize:"18px",fontWeight:"bold"},children:e})},qe=({isOpen:e,onClose:t,category:r,onCategoryChange:o,playerRank:n,playerScore:i})=>{if(!e)return null;const a=Ae[r]||[],s=e=>{switch(e){case"fastest_delivery":return"‚ö° Fastest Delivery";case"most_deliveries":return"üì¶ Most Deliveries";case"store_earnings":return"üè™ Store Earnings";case"perfect_pizzas":return"‚≠ê Perfect Pizzas";case"most_dropped_pizzas":return"üí® Most Dropped";case"bestRating":return"üåü Best Rating";case"total_wages":return"üíµ Total Wages";case"daily_earnings":return"üìÖ Daily Earnings";default:return e}};return _.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},children:_.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #0f0f23 100%)",padding:"25px",borderRadius:"15px",minWidth:"400px",maxWidth:"500px",color:"white",border:"2px solid #FFD700",boxShadow:"0 0 40px rgba(255,215,0,0.3)"},children:[_.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[_.jsx("h2",{style:{color:"#FFD700",margin:0,fontSize:"24px"},children:"üèÜ LEADERBOARDS"}),_.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#888",fontSize:"24px",cursor:"pointer"},children:"‚úï"})]}),_.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"20px"},children:Object.keys(Ae).map(e=>_.jsx("button",{onClick:()=>o(e),style:{padding:"8px 12px",background:r===e?"#FFD700":"#333",color:r===e?"#000":"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"12px",fontWeight:r===e?"bold":"normal"},children:s(e)},e))}),_.jsx("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",padding:"15px"},children:a.map((e,t)=>_.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px",borderBottom:t<a.length-1?"1px solid #333":"none",background:t<3?"rgba(255,215,0,0.1)":"transparent"},children:[_.jsx("div",{style:{width:"35px",fontSize:"20px",textAlign:"center"},children:0===t?"ü•á":1===t?"ü•à":2===t?"ü•â":`#${e.rank}`}),_.jsx("div",{style:{flex:1,paddingLeft:"10px",fontWeight:t<3?"bold":"normal"},children:e.name}),_.jsx("div",{style:{color:e.value<0?"#ff4444":t<3?"#FFD700":"#aaa",fontWeight:"bold",fontSize:"16px"},children:"$"===e.unit?e.value<0?`-$${Math.abs(e.value).toLocaleString()}`:`$${e.value.toLocaleString()}`:"s"===e.unit?`${e.value}s`:e.value.toLocaleString()})]},t))}),n&&_.jsxs("div",{style:{marginTop:"15px",padding:"12px",background:"rgba(0,255,0,0.1)",borderRadius:"8px",border:"1px solid #00ff00",display:"flex",alignItems:"center"},children:[_.jsx("div",{style:{fontSize:"16px",marginRight:"10px"},children:"üìç"}),_.jsxs("div",{style:{flex:1},children:[_.jsx("div",{style:{fontSize:"12px",color:"#888"},children:"Your Position"}),_.jsxs("div",{style:{fontWeight:"bold"},children:["#",n]})]}),_.jsx("div",{style:{color:"#00ff00",fontWeight:"bold",fontSize:"18px"},children:i})]}),_.jsx("div",{style:{marginTop:"15px",fontSize:"11px",color:"#666",textAlign:"center"},children:"daily_earnings"===r?"‚è∞ Resets daily at midnight":"üîÑ Weekly reset every Sunday"})]})})},Xe=({topPlayers:e,playerRank:t,onExpand:r})=>_.jsxs("div",{style:{position:"absolute",bottom:20,right:20,background:"rgba(0,0,0,0.8)",padding:"12px",borderRadius:"10px",minWidth:"180px",color:"white",fontFamily:"Arial, sans-serif"},children:[_.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",borderBottom:"1px solid #333",paddingBottom:"8px"},children:[_.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#FFD700"},children:"üèÜ Top Players"}),_.jsx("button",{onClick:r,style:{background:"transparent",border:"1px solid #FFD700",color:"#FFD700",padding:"2px 8px",borderRadius:"4px",cursor:"pointer",fontSize:"10px"},children:"View All"})]}),e?.slice(0,3).map((e,t)=>_.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",padding:"3px 0",color:0===t?"#FFD700":"#aaa"},children:[_.jsxs("span",{children:[0===t?"ü•á":1===t?"ü•à":"ü•â"," ",e.name]}),_.jsx("span",{children:e.value})]},t)),t&&_.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid #333",fontSize:"11px",color:"#00ff00"},children:["üìç You: #",t]})]}),Ye=({deliveryTime:e,tip:t,pizzaHealth:r,isPerfect:o,temperature:n,rating:i,tipMessage:a,pizzaType:s,xpChange:l,rankBonus:d,playerRank:c,totalDeliveries:p,onNextOrder:u,onViewLeaderboard:h})=>{const x=((e,t)=>{const r=(e>=99?3:e>=80?2.5:e>=60?2:e>=40?1:.5)+(t<30?2:t<45?1.5:t<60?1:t<90?.5:0);return r>=4.5?{label:"LEGENDARY",emoji:"üåüüåüüåüüåüüåü",color:"#FFD700"}:r>=4?{label:"EXCELLENT",emoji:"‚≠ê‚≠ê‚≠ê‚≠ê‚ú®",color:"#00ff00"}:r>=3.5?{label:"GREAT",emoji:"‚≠ê‚≠ê‚≠ê‚≠ê",color:"#88ff00"}:r>=3?{label:"GOOD",emoji:"‚≠ê‚≠ê‚≠ê‚ú®",color:"#ccff00"}:r>=2.5?{label:"OKAY",emoji:"‚≠ê‚≠ê‚≠ê",color:"#ffff00"}:r>=2?{label:"MEH",emoji:"‚≠ê‚≠ê‚ú®",color:"#ffcc00"}:r>=1.5?{label:"POOR",emoji:"‚≠ê‚≠ê",color:"#ff9900"}:r>=1?{label:"BAD",emoji:"‚≠ê‚ú®",color:"#ff6600"}:{label:"DISASTER",emoji:"üíÄ",color:"#ff0000"}})(r,e),f=n||{temp:e<30?"PIPING HOT":e<45?"HOT":e<60?"WARM":e<90?"LUKEWARM":"COLD",emoji:e<30?"üî•üî•üî•":e<45?"üî•üî•":e<60?"üî•":e<90?"üòê":"ü•∂",color:e<30?"#ff4400":e<45?"#ff6600":e<60?"#ff9900":e<90?"#ffcc00":"#0099ff"},m=0===t;return _.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:150},children:_.jsxs("div",{style:{background:m?"linear-gradient(135deg, #4a1a1a 0%, #2d0d0d 100%)":"linear-gradient(135deg, #1a472a 0%, #0d2818 100%)",padding:"30px",borderRadius:"20px",textAlign:"center",color:"white",border:`3px solid ${m?"#ff4444":x.color}`,boxShadow:"0 0 50px "+(m?"#ff444440":x.color+"40"),animation:"popIn 0.3s ease-out",minWidth:"400px"},children:[s&&_.jsxs("div",{style:{fontSize:"14px",color:"#ffcc00",marginBottom:"10px"},children:[s.emoji," ",s.name]}),_.jsx("div",{style:{fontSize:"50px",marginBottom:"5px"},children:m?"üò§":o?"üåü":r>=80?"‚úÖ":r>=50?"üòÖ":"üò¨"}),_.jsx("h2",{style:{color:m?"#ff4444":x.color,fontSize:"28px",marginBottom:"5px"},children:m?"DELIVERY... COMPLETE?":o?"PERFECT DELIVERY!":"DELIVERY COMPLETE!"}),_.jsxs("div",{style:{background:"rgba(0,0,0,0.4)",padding:"15px",borderRadius:"12px",marginBottom:"15px"},children:[_.jsx("div",{style:{fontSize:"32px",letterSpacing:"3px",marginBottom:"5px"},children:x.emoji}),_.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:x.color,letterSpacing:"2px"},children:x.label})]}),_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",marginBottom:"15px"},children:[_.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[_.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"‚è±Ô∏è Time"}),_.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold"},children:[e.toFixed(1),"s"]})]}),_.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[_.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üçï Condition"}),_.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:r>=80?"#00ff00":r>=50?"#ffcc00":"#ff6600"},children:[Math.round(r),"%"]})]}),_.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[_.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üå°Ô∏è Temp"}),_.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:f.color},children:f.emoji}),_.jsx("div",{style:{fontSize:"10px",color:f.color},children:f.temp})]})]}),_.jsx("div",{style:{fontSize:m?"28px":"36px",fontWeight:"bold",color:m?"#ff4444":"#FFD700",marginBottom:"5px"},children:m?"üò§ NO TIP!":`üí∞ +$${t.toFixed(2)} TIP!`}),a&&_.jsxs("div",{style:{fontSize:"14px",color:m?"#ff9999":t<3?"#ffcc99":"#99ff99",marginBottom:"10px",fontStyle:"italic",padding:"8px",background:"rgba(0,0,0,0.3)",borderRadius:"8px"},children:["üí¨ ",a]}),_.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"15px",marginBottom:"15px"},children:[void 0!==l&&0!==l&&_.jsxs("div",{style:{background:l>0?"rgba(0,255,100,0.2)":"rgba(255,0,0,0.2)",border:"1px solid "+(l>0?"#00ff66":"#ff4444"),padding:"8px 15px",borderRadius:"8px"},children:[_.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"‚≠ê XP"}),_.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:l>0?"#00ff66":"#ff4444"},children:[l>0?"+":"",l]})]}),d>0&&_.jsxs("div",{style:{background:"rgba(255,215,0,0.2)",border:"1px solid #FFD700",padding:"8px 15px",borderRadius:"8px"},children:[_.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üëë Rank Bonus"}),_.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#FFD700"},children:["+",Math.round(100*d),"%"]})]})]}),c&&_.jsx("div",{style:{background:"rgba(100,50,200,0.2)",border:"1px solid #9966ff",padding:"8px 15px",borderRadius:"8px",marginBottom:"10px"},children:_.jsxs("div",{style:{fontSize:"16px",color:"#cc99ff"},children:[c.emoji," ",c.name]})}),_.jsxs("div",{style:{fontSize:"14px",color:"#888",marginBottom:"20px"},children:["Total Deliveries: ",p]}),_.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center"},children:[_.jsx("button",{onClick:h,style:{padding:"12px 24px",background:"#333",color:"#FFD700",border:"1px solid #FFD700",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:"üèÜ Leaderboard"}),_.jsx("button",{onClick:u,style:{padding:"12px 30px",background:"#00ff00",color:"#000",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:"Next Order ‚Üí"})]})]})})},Je={primary:{padding:"15px 30px",fontSize:"18px",fontWeight:"bold",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"all 0.2s ease"},secondary:{padding:"12px 24px",fontSize:"16px",fontWeight:"bold",background:"#555",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},danger:{padding:"15px 30px",fontSize:"18px",fontWeight:"bold",background:"#FF5722",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"}},Ke=()=>{const t=e.useRef(null),[r,a]=e.useState("menu"),[d,A]=e.useState(null),[B,F]=e.useState(0),[L,W]=e.useState(0),[$,H]=e.useState(0),[N,O]=e.useState("Welcome to Pizza Express VR!"),[G,V]=e.useState(!1),[Ke,Ze]=e.useState(null),[Qe,et]=e.useState("third"),[tt,rt]=e.useState(null),[ot,nt]=e.useState(!1),[it,at]=e.useState(!1),[st,lt]=e.useState(null),[dt,ct]=e.useState("ascending"),[pt,ut]=e.useState(!1),[ht,xt]=e.useState(null),[ft,mt]=e.useState(!1),[gt,yt]=e.useState(!1),[zt,bt]=e.useState(null),[vt,wt]=e.useState(null),[St,Dt]=e.useState(100),[jt,kt]=e.useState({x:0,z:0}),[Tt,Et]=e.useState(!1),[Mt,Rt]=e.useState(0),[Ct,Pt]=e.useState(!1),[It,At]=e.useState("fastest_delivery"),[Bt,Ft]=e.useState(!1),[Lt,Wt]=e.useState(null),[$t,Ht]=e.useState(null),[Nt,Ot]=e.useState({totalDeliveries:0,totalEarnings:0,destroyedPizzas:0,bestTime:null,rank:ye[0],xp:0,level:1,badges:[],pizzaTypeDeliveries:{},perfectDeliveries:0,totalTips:0,fastestDelivery:null,storeEarnings:0}),[_t,Gt]=e.useState(null),[Vt,Ut]=e.useState(null),[qt,Xt]=e.useState(!1),[Yt,Jt]=e.useState(!1),[Kt,Zt]=e.useState(!1),Qt=e.useRef(null),er=e.useRef(100),tr=e.useRef(!1),rr=e.useRef({scene:null,camera:null,renderer:null,drones:[],bases:[],pizzaShop:null,currentDrone:null,pizzaAttached:!1,controls:{forward:!1,back:!1,left:!1,right:!1,up:!1,down:!1},lastDroneVelocity:{x:0,y:0,z:0},xrManager:null,vrButton:null,player:null,playerPizza:null,playerControls:{forward:!1,back:!1,left:!1,right:!1},lastPlayerVelocity:{x:0,z:0},sustainedSpeed:0,lastMoveTime:0,moveAccumulator:0}),[or,nr]=e.useState({x:0,y:0,z:10}),[ir,ar]=e.useState(null),[sr,lr]=e.useState(!1),[dr,cr]=e.useState(1.5),[pr,ur]=e.useState(0),[hr,xr]=e.useState(0),[fr,mr]=e.useState(!1);e.useEffect(()=>{tr.current=G},[G]),e.useEffect(()=>{const e=(()=>{try{const e=parseInt(localStorage.getItem(Te))||0,t=ze(e),r=localStorage.getItem(Ee),o=localStorage.getItem(Me);return{totalWages:parseFloat(localStorage.getItem(we))||0,totalDeliveries:parseInt(localStorage.getItem(Se))||0,totalDestroyed:parseInt(localStorage.getItem(De))||0,bestTime:parseFloat(localStorage.getItem(je))||null,playerName:localStorage.getItem(ke)||"Rookie Pilot",xp:e,rank:t,badges:r?JSON.parse(r):[],pizzaTypeDeliveries:o?JSON.parse(o):{},perfectDeliveries:parseInt(localStorage.getItem(Re))||0,totalTips:parseFloat(localStorage.getItem(Ce))||0,fastestDelivery:parseFloat(localStorage.getItem(Pe))||null,storeEarnings:parseFloat(localStorage.getItem(Ie))||0}}catch(e){return console.warn("Could not load persistent data:",e),{totalWages:0,totalDeliveries:0,totalDestroyed:0,bestTime:null,playerName:"Rookie Pilot",xp:0,rank:ye[0],badges:[],pizzaTypeDeliveries:{},perfectDeliveries:0,totalTips:0,fastestDelivery:null,storeEarnings:0}}})();F(e.totalWages),W(e.totalDeliveries),H(e.totalDestroyed);const t=ze(e.xp);Ot(r=>({...r,totalDeliveries:e.totalDeliveries,totalEarnings:e.totalWages,destroyedPizzas:e.totalDestroyed,bestTime:e.bestTime,xp:e.xp,rank:t,badges:e.badges||[],pizzaTypeDeliveries:e.pizzaTypeDeliveries||{},perfectDeliveries:e.perfectDeliveries||0,totalTips:e.totalTips||0,fastestDelivery:e.fastestDelivery||null,storeEarnings:e.storeEarnings||0})),Xt(!0),e.totalWages<0?O(`üí∏ Welcome back! You owe the shop $${Math.abs(e.totalWages).toFixed(2)}. Time to work it off!`):t.tipBonus>0&&O(`${t.emoji} Welcome back, ${t.name}! +${Math.round(100*t.tipBonus)}% tip bonus!`)},[]),e.useEffect(()=>{qt&&(e=>{try{void 0!==e.totalWages&&localStorage.setItem(we,e.totalWages.toString()),void 0!==e.totalDeliveries&&localStorage.setItem(Se,e.totalDeliveries.toString()),void 0!==e.totalDestroyed&&localStorage.setItem(De,e.totalDestroyed.toString()),void 0!==e.bestTime&&null!==e.bestTime&&localStorage.setItem(je,e.bestTime.toString()),void 0!==e.playerName&&localStorage.setItem(ke,e.playerName),void 0!==e.xp&&localStorage.setItem(Te,e.xp.toString()),void 0!==e.badges&&localStorage.setItem(Ee,JSON.stringify(e.badges)),void 0!==e.pizzaTypeDeliveries&&localStorage.setItem(Me,JSON.stringify(e.pizzaTypeDeliveries)),void 0!==e.perfectDeliveries&&localStorage.setItem(Re,e.perfectDeliveries.toString()),void 0!==e.totalTips&&localStorage.setItem(Ce,e.totalTips.toString()),void 0!==e.fastestDelivery&&null!==e.fastestDelivery&&localStorage.setItem(Pe,e.fastestDelivery.toString()),void 0!==e.storeEarnings&&localStorage.setItem(Ie,e.storeEarnings.toString())}catch(t){console.warn("Could not save persistent data:",t)}})({totalWages:B,totalDeliveries:L,totalDestroyed:$,bestTime:Nt.bestTime,xp:Nt.xp,badges:Nt.badges,pizzaTypeDeliveries:Nt.pizzaTypeDeliveries,perfectDeliveries:Nt.perfectDeliveries,totalTips:Nt.totalTips,fastestDelivery:Nt.fastestDelivery,storeEarnings:Nt.storeEarnings})},[B,L,$,Nt.bestTime,Nt.xp,Nt.badges,Nt.pizzaTypeDeliveries,Nt.perfectDeliveries,Nt.totalTips,Nt.fastestDelivery,Nt.storeEarnings,qt]),e.useEffect(()=>{if(!t.current)return;const e=new D;e.background=new j(K),e.fog=new k(K,50,200);const r=new T(75,window.innerWidth/window.innerHeight,.1,1e3);r.position.set(0,15,30),r.lookAt(0,0,0);const a=new c;a.add(r),e.add(a),rr.current.vrPlayerRig=a;const S=new E({antialias:!0,powerPreference:"high-performance",alpha:!1});S.setSize(window.innerWidth,window.innerHeight),S.setPixelRatio(Math.min(window.devicePixelRatio,2)),S.shadowMap.enabled=!0,S.shadowMap.type=M,S.xr.enabled=!0,t.current.appendChild(S.domElement);(async()=>{const o=await le();if(Jt(o.supported),o.supported){const o=new de(S,e,r);await o.init(),o.onControllerInput=e=>{"selectstart"===e.type&&G&&jr(),"squeezestart"===e.type&&d&&!tr.current&&Dr(d.drone)},Qt.current=o,rr.current.xrManager=o;const n=((e,t,r)=>{const o=document.createElement("button");return o.style.cssText="\n    position: absolute;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    padding: 15px 30px;\n    border: none;\n    border-radius: 8px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    font-size: 16px;\n    font-weight: bold;\n    cursor: pointer;\n    z-index: 1000;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);\n  ",o.onmouseover=()=>{o.style.transform="translateX(-50%) scale(1.05)",o.style.boxShadow="0 6px 20px rgba(102, 126, 234, 0.6)"},o.onmouseout=()=>{o.style.transform="translateX(-50%) scale(1)",o.style.boxShadow="0 4px 15px rgba(102, 126, 234, 0.4)"},(async()=>{if(!(await le()).supported)return o.textContent="üö´ VR Not Supported",o.disabled=!0,o.style.background="#666",void(o.style.cursor="not-allowed");o.textContent="ü•Ω Enter VR",o.onclick=async()=>{if(e.xr.isPresenting)await e.xr.getSession().end(),o.textContent="ü•Ω Enter VR",r&&r();else try{const n=await navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor","hand-tracking","layers"]});e.xr.setSession(n),o.textContent="‚ùå Exit VR",t&&t(),n.addEventListener("end",()=>{o.textContent="ü•Ω Enter VR",r&&r()})}catch(n){console.error("Failed to start VR:",n)}}})(),o})(S,()=>{Zt(!0);const e=rr.current.vrPlayerRig,t=rr.current.player;if(e&&t&&(e.position.set(t.position.x,0,t.position.z),e.rotation.y=t.rotation.y),rr.current.vrHUD){rr.current.vrHUD.visible=!0;rr.current.camera.add(rr.current.vrHUD),rr.current.vrHUD.position.set(0,-.2,-.8),rr.current.vrHUD.rotation.set(0,0,0)}},()=>{if(Zt(!1),rr.current.vrHUD){rr.current.vrHUD.visible=!1;const e=rr.current.scene;rr.current.vrHUD.parent!==e&&e.add(rr.current.vrHUD)}});n.id="vr-button",t.current.appendChild(n),rr.current.vrButton=n}})();const A=new R(16777215,.6);e.add(A);const B=new C(16777215,.8);B.position.set(50,50,50),B.castShadow=!0,B.shadow.mapSize.width=2048,B.shadow.mapSize.height=2048,B.shadow.camera.near=.5,B.shadow.camera.far=500,B.shadow.camera.left=-50,B.shadow.camera.right=50,B.shadow.camera.top=50,B.shadow.camera.bottom=-50,e.add(B);const F=new b(200,200),L=new n({color:Z}),W=new i(F,L);W.rotation.x=-Math.PI/2,W.receiveShadow=!0,e.add(W);const $=new P(200,40,0,5592405);e.add($);const H=(()=>{const e=new c,t=new p(6,4,6),r=new n({color:Q}),o=new i(t,r);o.position.y=2,o.castShadow=!0,e.add(o);const a=new u(5,2,4),s=new n({color:13382451}),l=new i(a,s);l.position.y=5,l.rotation.y=Math.PI/4,e.add(l);const d=new p(7,1,.2),m=new n({color:ee}),g=new i(d,m);g.position.set(0,5,3.1),e.add(g);const y=new p(1.5,2.5,.1),z=new n({color:9127187}),b=new i(y,z);b.position.set(0,1.25,3.05),e.add(b);const v=new p(1,1,.1),w=new n({color:8900331,transparent:!0,opacity:.6});[-1.5,1.5].forEach(t=>{const r=new i(v,w);r.position.set(t,2.5,3.05),e.add(r)});const S=new p(2,1,1),D=new n({color:9127187}),j=new i(S,D);j.position.set(0,.5,2),j.castShadow=!0,e.add(j);const k=new h(1,1.5,32),T=new x({color:65280,transparent:!0,opacity:.7,side:f}),E=new i(k,T);E.rotation.x=-Math.PI/2,E.position.set(0,.05,4),E.userData.isPickupTrigger=!0,e.add(E);const M=new u(.3,.6,8),R=new x({color:65280}),C=new i(M,R);C.position.set(0,2.5,4),C.rotation.x=Math.PI,e.add(C);const P=new p(1.5,.4,.1),I=new n({color:43520}),A=new i(P,I);return A.position.set(0,3.2,4),e.add(A),e})();e.add(H),rr.current.pizzaShop=H,U.forEach(t=>{const r=(()=>{const e=new c,t=new o(3,3,.3,32),r=new n({color:te}),a=new i(t,r);a.position.y=.15,a.receiveShadow=!0,e.add(a);const s=new h(2,2.2,32),l=new x({color:16776960,side:f}),d=new i(s,l);return d.rotation.x=-Math.PI/2,d.position.y=.31,e.add(d),e})();r.position.set(t.x,0,t.z),e.add(r);const a=(()=>{const e=new c,t=new p(1.5,.3,1.5),r=new n({color:ne}),a=new i(t,r);a.castShadow=!0,e.add(a),[{x:.8,z:.8},{x:-.8,z:.8},{x:.8,z:-.8},{x:-.8,z:-.8}].forEach(t=>{const r=new o(.05,.05,.8,8),a=new n({color:ie}),s=new i(r,a);s.position.set(t.x,0,t.z),e.add(s);const l=new o(.5,.5,.05,32),d=new n({color:ae,transparent:!0,opacity:.7}),c=new i(l,d);c.position.set(t.x,.5,t.z),c.userData.isRotor=!0,e.add(c)});const s=new m(.1,16,16),l=new x({color:65280}),d=new i(s,l);return d.position.set(0,.2,.7),d.userData.isLED=!0,e.add(d),e})(t.label);a.position.set(t.x,1.5,t.z),a.userData={label:t.label,homePos:new s(t.x,1.5,t.z),hasPizza:!1,targetBase:null},e.add(a),rr.current.drones.push(a);const l=((e,t="#ffffff",r=2)=>{const o=document.createElement("canvas"),n=o.getContext("2d");o.width=128,o.height=128,n.fillStyle=t,n.font="bold 80px Arial",n.textAlign="center",n.textBaseline="middle",n.fillText(e,64,64);const i=new g(o),a=new y({map:i}),s=new z(a);return s.scale.set(r,r,1),s})(t.label);l.position.set(t.x,4,t.z),e.add(l)}),q.forEach(t=>{const r=(e=>{const t=new c,r=6.5,a=new o(.3,.8,30,16,1,!0),s=new x({color:65416,transparent:!0,opacity:.15,side:f}),l=new i(a,s);l.position.set(0,21.5,0),l.userData.isBeacon=!0,l.visible=!1,t.add(l),[15,22,30,40].forEach((e,o)=>{const n=new h(2-.2*o,2.5-.2*o,32),a=new x({color:65416,transparent:!0,opacity:.4-.08*o,side:f}),s=new i(n,a);s.rotation.x=-Math.PI/2,s.position.set(0,r+e,0),s.userData.isHalo=!0,s.visible=!1,t.add(s)});const d=new m(.6,16,16),u=new x({color:65280,transparent:!0,opacity:.8}),b=new i(d,u);b.position.set(0,51.5,0),b.userData.isPulsingMarker=!0,b.visible=!1,t.add(b),t.userData.landingPadHeight=r;const v=new p(5,6,5),w=new n({color:re}),S=new i(v,w);S.position.y=3,S.castShadow=!0,S.userData={baseNumber:e},t.add(S);const D=new p(5.5,.3,5.5),j=new n({color:1668818}),k=new i(D,j);k.position.y=6.15,t.add(k);const T=new o(.05,.05,1.5,8),E=new n({color:3355443}),M=new i(T,E);M.position.set(2,7,2),t.add(M);const R=new o(2,2,.2,32),C=new n({color:oe}),P=new i(R,C);P.position.y=6.35,P.userData.isLandingPad=!0,t.add(P),[1.5,1,.5].forEach((e,r)=>{const o=new h(e-.05,e,32),n=new x({color:r%2==0?16777215:65280,side:f}),a=new i(o,n);a.rotation.x=-Math.PI/2,a.position.y=6.36,t.add(a)});const I=document.createElement("canvas"),A=I.getContext("2d");I.width=128,I.height=128,A.fillStyle="#ffffff",A.font="bold 80px Arial",A.textAlign="center",A.textBaseline="middle",A.fillText(e.toString(),64,64);const B=new g(I),F=new y({map:B}),L=new z(F);return L.position.y=8,L.scale.set(3,3,1),t.add(L),t})(t.num);r.position.set(t.x,0,t.z),r.userData={baseNumber:t.num},e.add(r),rr.current.bases.push(r)});const N=new c,_=new I(.3,1,8,16),V=new n({color:4491519}),J=new i(_,V);J.position.y=1,J.castShadow=!0,N.add(J);const se=new u(.15,.3,8),ce=new x({color:16776960}),pe=new i(se,ce);pe.rotation.x=Math.PI/2,pe.position.set(0,1,.5),N.add(pe),N.position.set(0,0,12),N.rotation.y=Math.PI,N.userData.isPlayer=!0,e.add(N),rr.current.player=N;const ue=(()=>{const e=new c;e.userData.isVRHUD=!0;const t=new b(.6,.4),r=new x({color:0,transparent:!0,opacity:.7,side:f}),o=new i(t,r);o.userData.isHUDPanel=!0,e.add(o);const n=new v(t),a=new l({color:16766720}),s=new w(n,a);e.add(s);const d=(e,t,r,o=32)=>{const n=document.createElement("canvas");n.width=512,n.height=128;const a=n.getContext("2d"),s=new g(n);s.needsUpdate=!0;const l=new x({map:s,transparent:!0,side:f}),d=new b(e,t),c=new i(d,l);return c.userData.canvas=n,c.userData.ctx=a,c.userData.texture=s,c.userData.fontSize=o,Fe(c,r),c},p=d(.5,.08,"üçï Pizza Express VR",28);p.position.set(0,.14,.01),p.userData.textType="title",e.add(p);const u=d(.5,.06,"üíµ Wages: $0.00",24);u.position.set(0,.06,.01),u.userData.textType="wages",e.add(u);const h=d(.5,.06,"üì¶ Deliveries: 0",24);h.position.set(0,0,.01),h.userData.textType="deliveries",e.add(h);const m=d(.5,.06,"üìç No order yet",22);m.position.set(0,-.06,.01),m.userData.textType="order",e.add(m);const y=new b(.4,.03),z=new x({color:3355443}),S=new i(y,z);S.position.set(0,-.12,.01),e.add(S);const D=new b(.4,.03),j=new x({color:65280}),k=new i(D,j);k.position.set(0,-.12,.02),k.userData.isHealthBar=!0,e.add(k);const T=d(.3,.04,"üçï 100%",20);return T.position.set(0,-.16,.01),T.userData.textType="health",e.add(T),e.visible=!1,e})();e.add(ue),rr.current.vrHUD=ue,r.position.set(0,6,20),r.lookAt(0,2,0),rr.current.scene=e,rr.current.camera=r,rr.current.renderer=S,performance.now();S.setAnimationLoop((t,o)=>{if(Qt.current&&Qt.current.isInVR){const e=Qt.current.pollControllerInput();if(e){const t=e.right.thumbstick,o=e.left.thumbstick;tr.current?(Math.abs(t.y)>.1?(rr.current.controls.forward=t.y<-.1,rr.current.controls.back=t.y>.1):(rr.current.controls.forward=!1,rr.current.controls.back=!1),Math.abs(t.x)>.1?(rr.current.controls.right=t.x>.1,rr.current.controls.left=t.x<-.1):(rr.current.controls.left=!1,rr.current.controls.right=!1),Math.abs(o.y)>.1?(rr.current.controls.up=o.y<-.1,rr.current.controls.down=o.y>.1):(rr.current.controls.up=!1,rr.current.controls.down=!1)):(Math.abs(o.y)>.15?(rr.current.playerControls.forward=o.y<-.15,rr.current.playerControls.back=o.y>.15):(rr.current.playerControls.forward=!1,rr.current.playerControls.back=!1),Math.abs(t.x)>.15?(rr.current.playerControls.right=t.x>.15,rr.current.playerControls.left=t.x<-.15):(rr.current.playerControls.left=!1,rr.current.playerControls.right=!1)),yr(r,rr.current,tr.current),rr.current.vrHUD&&rr.current.vrHUD.visible&&((e,t)=>{e&&e.children.forEach(e=>{const r=e.userData.textType;if("wages"===r){const r=t.score<0?`üíµ Wages: -$${Math.abs(t.score).toFixed(2)}`:`üíµ Wages: $${t.score.toFixed(2)}`,o=t.score<0?"#ff4444":"#00ff00";Fe(e,r,o)}if("deliveries"===r&&Fe(e,`üì¶ Deliveries: ${t.pizzasDelivered}`),"order"===r)if(t.currentOrder){const r=t.currentOrder;Fe(e,`üìç ${r.pizzaType?.emoji||"üçï"} ‚Üí Base ${r.base}`,"#FFD700")}else Fe(e,"üìç Get a pizza from the shop!","#aaaaaa");if("health"===r){const r=t.pizzaHealth>70?"#00ff00":t.pizzaHealth>40?"#ffff00":"#ff4444";Fe(e,`üçï ${Math.round(t.pizzaHealth)}%`,r)}if(e.userData.isHealthBar){const r=t.pizzaHealth/100;e.scale.x=Math.max(.01,r),e.position.x=-.2*(1-r),t.pizzaHealth>70?e.material.color.setHex(65280):t.pizzaHealth>40?e.material.color.setHex(16776960):e.material.color.setHex(16729156)}})})(rr.current.vrHUD,{score:scoreRef.current,pizzasDelivered:pizzasDeliveredRef.current,currentOrder:currentOrderRef.current,pizzaHealth:er.current})}}rr.current.drones.forEach(e=>{if(e.children.filter(e=>e.userData.isRotor).forEach(e=>{e.rotation.y+=.3}),tr.current&&rr.current.currentDrone===e){const t=rr.current.controls,o=.3,n=.05,i=e.position.clone(),a=e.position.y;let s="cruising",l=!1;if(d){const t=rr.current.bases.find(e=>e.userData.baseNumber===d.base);if(t){const r=t.position.x,o=t.position.z;l=Math.sqrt(Math.pow(e.position.x-r,2)+Math.pow(e.position.z-o,2))<1}}s=a<10&&!l?"ascending":l?"descending":"cruising",s!==dt&&(ct(s),"ascending"===s?O("üöÅ ASCENDING - Reach 10m altitude to unlock controls!"):"cruising"===s?O(`‚úàÔ∏è CRUISING - Fly to Base ${d?.base}! Use WASD to navigate.`):"descending"===s&&O("üìç LANDING - Descend to drop zone! Press RELEASE when ready.")),"ascending"===s?(t.up&&(e.position.y+=1*o*1.5),t.left&&(e.rotation.y+=n),t.right&&(e.rotation.y-=n)):"cruising"===s?(t.forward&&(e.position.x+=Math.sin(e.rotation.y)*o,e.position.z+=Math.cos(e.rotation.y)*o),t.back&&(e.position.x-=Math.sin(e.rotation.y)*o,e.position.z-=Math.cos(e.rotation.y)*o),t.left&&(e.rotation.y+=n),t.right&&(e.rotation.y-=n),t.up&&(e.position.y+=1*o),t.down&&(e.position.y=Math.max(1.5,e.position.y-1*o))):"descending"===s&&(t.up&&(e.position.y+=1*o),t.down&&(e.position.y=Math.max(6.5,e.position.y-1*o)),t.left&&(e.rotation.y+=n),t.right&&(e.rotation.y-=n));const c={x:e.position.x-i.x,y:e.position.y-i.y,z:e.position.z-i.z};if(rr.current.lastDroneVelocity=c,cr(e.position.y),ur(60*c.y),d){const t=rr.current.bases.find(e=>e.userData.baseNumber===d.base);if(t){const r=t.position.x,o=t.position.z,n=Math.sqrt(Math.pow(e.position.x-r,2)+Math.pow(e.position.z-o,2));lt(n);const i=Math.sqrt(Math.pow(e.position.x-r,2)+Math.pow(e.position.y,2)+Math.pow(e.position.z-o,2));rt(i);const a=n<1,s=e.position.y>=6&&e.position.y<=8,l=e.position.y>8;at(a&&l),nt(a&&s),rr.current.bases.forEach(e=>{const t=e.userData.baseNumber===d.base;e.traverse(e=>{(e.userData.isBeacon||e.userData.isHalo||e.userData.isPulsingMarker)&&(e.visible=t,t&&e.material&&(a?(e.material.color.setHex(65280),e.material.opacity=e.userData.isPulsingMarker?1:.5):(e.material.color.setHex(65416),e.material.opacity=e.userData.isPulsingMarker?.8:.3)))})})}}else at(!1),lt(null),rr.current.bases.forEach(e=>{e.traverse(e=>{(e.userData.isBeacon||e.userData.isHalo||e.userData.isPulsingMarker)&&(e.visible=!1)})});gr(r,e,Qe)}});const n=rr.current.player;if(n&&pt&&!tr.current){const e=rr.current.playerControls,t=.15,o=.1,i=.05,a=n.position.clone();e.forward&&(n.position.x+=Math.sin(n.rotation.y)*t,n.position.z+=Math.cos(n.rotation.y)*t),e.back&&(n.position.x-=Math.sin(n.rotation.y)*o,n.position.z-=Math.cos(n.rotation.y)*o),e.left&&(n.rotation.y+=i),e.right&&(n.rotation.y-=i);const s=n.position.x-a.x,l=n.position.z-a.z,d=Math.sqrt(s*s+l*l),c=Date.now(),p=d>.001,u=c-rr.current.lastMoveTime;p?(rr.current.moveAccumulator=u<100?Math.min(2,rr.current.moveAccumulator+.03):Math.max(0,rr.current.moveAccumulator-.3),rr.current.lastMoveTime=c):rr.current.moveAccumulator=Math.max(0,rr.current.moveAccumulator-.05);const h=d*(.5+rr.current.moveAccumulator);rr.current.sustainedSpeed=h,xr(60*h),rr.current.lastPlayerVelocity={x:s,z:l};const x=rr.current.playerPizza;if(x){const e=2,t=Math.PI/4,r=.12,o=.14,i=l*Math.cos(n.rotation.y)+s*Math.sin(n.rotation.y),a=s*Math.cos(n.rotation.y)-l*Math.sin(n.rotation.y),d=Math.max(-t,Math.min(t,i*e*10)),c=Math.max(-t,Math.min(t,-a*e*10));x.rotation.x+=.08*(d-x.rotation.x),x.rotation.z+=.08*(c-x.rotation.z);const p=h>o;if(mr(h>r),p){const e=2*(h-o),t=Math.max(0,er.current-e);t!==er.current&&(er.current=t,Dt(t),Qt.current?.isInVR&&(Qt.current.triggerHaptic("left",.3,50),Qt.current.triggerHaptic("right",.3,50)))}const u=Math.abs(x.rotation.x)+Math.abs(x.rotation.z);if(u>1.5*t){const e=.2*(u-1.5*t),r=Math.max(0,er.current-e);r!==er.current&&(er.current=r,Dt(r),Qt.current?.isInVR&&(Qt.current.triggerHaptic("left",.6,100),Qt.current.triggerHaptic("right",.6,100)))}}nr({x:n.position.x,z:n.position.z});let f=null,m=1/0;rr.current.drones.forEach(e=>{const t=n.position.distanceTo(e.position);t<m&&(m=t,f=e)}),ar(f&&m<3?f.userData.label:null),r.position.x=n.position.x-8*Math.sin(n.rotation.y),r.position.y=6,r.position.z=n.position.z-8*Math.cos(n.rotation.y),r.lookAt(n.position.x,1.5,n.position.z)}if(n&&!pt&&!tr.current){const e=rr.current.playerControls,t=.18,o=.12,i=.06;e.forward&&(n.position.x+=Math.sin(n.rotation.y)*t,n.position.z+=Math.cos(n.rotation.y)*t),e.back&&(n.position.x-=Math.sin(n.rotation.y)*o,n.position.z-=Math.cos(n.rotation.y)*o),e.left&&(n.rotation.y+=i),e.right&&(n.rotation.y-=i),xr(0),mr(!1);const a=Math.sqrt(Math.pow(n.position.x-X,2)+Math.pow(n.position.z-Y,2));lr(a<3),r.position.x=n.position.x-8*Math.sin(n.rotation.y),r.position.y=6,r.position.z=n.position.z-8*Math.cos(n.rotation.y),r.lookAt(n.position.x+5*Math.sin(n.rotation.y),1.5,n.position.z+5*Math.cos(n.rotation.y))}const i=.001*Date.now();rr.current.bases.forEach(e=>{e.traverse(e=>{if(e.userData.isBeacon&&(e.material.opacity=.1+.08*Math.sin(2*i)),e.userData.isHalo&&(e.rotation.z+=.005,e.material.opacity=.25+.15*Math.sin(3*i+.5*e.position.y)),e.userData.isPulsingMarker){const t=.4+.4*Math.sin(4*i);e.material.opacity=t,e.scale.setScalar(.8+.3*Math.sin(3*i))}})}),S.render(e,r)});const he=e=>{const t=e.key.toLowerCase();tr.current&&("w"===t&&(rr.current.controls.forward=!0),"s"===t&&(rr.current.controls.back=!0),"a"===t&&(rr.current.controls.left=!0),"d"===t&&(rr.current.controls.right=!0)," "===e.key&&(e.preventDefault(),rr.current.controls.up=!0),"Shift"===e.key&&(rr.current.controls.down=!0),"v"===t&&et(e=>"third"===e?"pov":"pov"===e?"overhead":"third")),tr.current||("w"===t&&(rr.current.playerControls.forward=!0),"s"===t&&(rr.current.playerControls.back=!0),"a"===t&&(rr.current.playerControls.left=!0),"d"===t&&(rr.current.playerControls.right=!0))},xe=e=>{const t=e.key.toLowerCase();"w"===t&&(rr.current.controls.forward=!1),"s"===t&&(rr.current.controls.back=!1),"a"===t&&(rr.current.controls.left=!1),"d"===t&&(rr.current.controls.right=!1)," "===e.key&&(rr.current.controls.up=!1),"Shift"===e.key&&(rr.current.controls.down=!1),"w"===t&&(rr.current.playerControls.forward=!1),"s"===t&&(rr.current.playerControls.back=!1),"a"===t&&(rr.current.playerControls.left=!1),"d"===t&&(rr.current.playerControls.right=!1)};window.addEventListener("keydown",he),window.addEventListener("keyup",xe);const fe=()=>{r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),S.setSize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",fe),()=>{window.removeEventListener("keydown",he),window.removeEventListener("keyup",xe),window.removeEventListener("resize",fe),S.setAnimationLoop(null),rr.current.vrButton&&t.current&&t.current.removeChild(rr.current.vrButton),t.current&&S.domElement&&t.current.removeChild(S.domElement),Qt.current?.session&&Qt.current.endSession()}},[d,Qe,pt,r]),e.useEffect(()=>{if(St<=0&&pt){mt(!0),ut(!1),H(e=>e+1);const e=be(0,0,0,!1,!0);Ot(t=>{const r=Math.max(0,t.xp+e),o=t.rank,n=ze(r);if(o.name!==n.name){const e=ve(o,n,!1);e&&setTimeout(()=>{Ut(e),setTimeout(()=>Ut(null),4e3)},2e3)}return{...t,destroyedPizzas:t.destroyedPizzas+1,xp:r,rank:n}}),Qt.current?.isInVR&&(Qt.current.triggerHaptic("left",1,300),Qt.current.triggerHaptic("right",1,300),setTimeout(()=>{Qt.current.triggerHaptic("left",.7,200),Qt.current.triggerHaptic("right",.7,200)},350));const t=rr.current.player;t&&rr.current.playerPizza&&(t.remove(rr.current.playerPizza),rr.current.playerPizza=null);const r=vt?.price||18.99;F(e=>e-r);let o="";o=r>=49.99?"ü¶û THE LOBSTER PIZZA?! Boss is going to FIRE you!":r>=24.99?"üçÑ A truffle pizza... that's coming out of your paycheck for WEEKS!":r>=21.99?"üëë The Supreme Deluxe! Management wants a word with you...":r<15?`üßÄ Lucky you - it was just ${vt?.name||"a cheap one"}!`:vt?.description||"That pizza is gone forever!",O(`üíÄ PIZZA DESTROYED! -$${r.toFixed(2)} | ${Math.abs(e)} XP lost! ${o}`)}},[St,pt,vt]);const gr=(e,t,r)=>{if("pov"===r){e.position.copy(t.position),e.position.y+=.3,e.position.x+=.2*Math.sin(t.rotation.y),e.position.z+=.2*Math.cos(t.rotation.y);const r=new s(t.position.x+50*Math.sin(t.rotation.y),t.position.y-2,t.position.z+50*Math.cos(t.rotation.y));e.lookAt(r),t.traverse(e=>{e.isMesh&&!e.userData.isRotor&&(e.material.transparent=!0,e.material.opacity=.3)})}else t.traverse(e=>{e.isMesh&&!e.userData.isRotor&&e.material.transparent&&(e.material.transparent=!1,e.material.opacity=1)}),"overhead"===r?(e.position.x=t.position.x,e.position.y=t.position.y+30,e.position.z=t.position.z+5,e.lookAt(t.position)):(e.position.x=t.position.x-12*Math.sin(t.rotation.y),e.position.y=t.position.y+5,e.position.z=t.position.z-12*Math.cos(t.rotation.y),e.lookAt(t.position))},yr=(e,t,r)=>{const o=rr.current.renderer,n=rr.current.vrPlayerRig;if(o?.xr?.isPresenting&&n)if(r&&t.currentDrone){const e=t.currentDrone;n.position.set(e.position.x,e.position.y+.3,e.position.z),n.rotation.y=e.rotation.y,e.traverse(e=>{e.isMesh&&!e.userData.isRotor&&(e.userData.originalOpacity||(e.userData.originalOpacity=e.material.opacity||1),e.material.transparent=!0,e.material.opacity=.15)})}else if(t.player){const e=t.player;n.position.set(e.position.x,0,e.position.z),n.rotation.y=e.rotation.y,t.drones?.forEach(e=>{e.traverse(e=>{e.isMesh&&void 0!==e.userData.originalOpacity&&(e.material.opacity=e.userData.originalOpacity)})})}},zr=e.useCallback(()=>{const e=(()=>{const e=[25,20,15,12,10,8,5,4,1],t=e.reduce((e,t)=>e+t,0);let r=Math.random()*t;for(let o=0;o<e.length;o++)if(r-=e[o],r<=0)return ce[o];return ce[0]})(),t=`${me[Math.floor(Math.random()*me.length)]} ${ge[Math.floor(Math.random()*ge.length)]}`,r={drone:["A","B","C","D"][Math.floor(4*Math.random())],base:[1,2,3,4][Math.floor(4*Math.random())],pizzaType:e,customerName:t};A(r),wt(e),a("carrying"),O(`üçï ${e.emoji} ${e.name} ($${e.price.toFixed(2)}) for ${t}! Carry to Drone ${r.drone}`),V(!1),Ze(null),ut(!1),Dt(100),er.current=100,kt({x:0,z:0}),Ft(!1),Ht(Date.now())},[]),br=e.useCallback(()=>{ut(!1),Dt(100),er.current=100,kt({x:0,z:0}),mr(!1),rr.current&&(rr.current.sustainedSpeed=0,rr.current.moveAccumulator=0),O(`üçï Walk back to the shop to grab a new pizza for Drone ${d?.drone}!`)},[d]),vr=e.useCallback(()=>{if("carrying"!==r||pt)return;const e=rr.current.player;if(e&&rr.current.scene){const t=new c,r=new p(.8,.15,.8),a=new n({color:13395507}),s=new i(r,a);s.castShadow=!0,t.add(s);const l=new o(.35,.35,.05,16),d=new n({color:16763904}),u=new i(l,d);u.position.y=.1,t.add(u);const h=new o(.05,.05,.02,8),x=new n({color:11149858});for(let e=0;e<8;e++){const r=new i(h,x),o=e/8*Math.PI*2,n=.15+.15*Math.random();r.position.set(Math.cos(o)*n,.13,Math.sin(o)*n),t.add(r)}t.position.set(0,1.2,.6),e.add(t),rr.current.playerPizza=t}ut(!0),O(`üçï Carrying pizza! Use WASD to walk carefully to Drone ${d?.drone}. Keep it level!`)},[r,pt,d]),wr=e.useCallback(e=>{if(d&&pt)return e!==d.drone?(O(`‚ùå Wrong drone! You need Drone ${d.drone}`),void Dt(e=>Math.max(0,e-5))):St<50?(bt(e),void yt(!0)):void Sr(e)},[d,pt,St]),Sr=e.useCallback(e=>{const t=rr.current.drones.find(t=>t.userData.label===e);if(!t)return;const r=rr.current.player;r&&rr.current.playerPizza&&(r.remove(rr.current.playerPizza),rr.current.playerPizza=null);const o=(()=>{const e=new c,t=new p(.8,.15,.8),r=new n({color:se}),o=new i(t,r);o.castShadow=!0,e.add(o);const a=new p(.82,.05,.82),s=new n({color:16733525}),l=new i(a,s);l.position.y=.1,e.add(l);const d=new S(.2,32),u=new x({color:16763904}),h=new i(d,u);return h.rotation.x=-Math.PI/2,h.position.y=.13,e.add(h),e})();o.position.set(0,-.5,0),o.userData.isPizza=!0,t.add(o),t.userData.hasPizza=!0,t.userData.targetBase=d.base,rr.current.currentDrone=t,Ze(e),ut(!1),a("flying"),V(!0),ct("ascending"),ar(null),O("üöÅ TAKEOFF! Hold SPACE to ascend to 10m cruise altitude!")},[d,pt,St]);e.useCallback((e,t)=>{if(!pt)return;kt(r=>({x:Math.max(-30,Math.min(30,r.x+2*e-.05*r.x)),z:Math.max(-30,Math.min(30,r.z+2*t-.05*r.z))}));const r=Math.sqrt(jt.x**2+jt.z**2);r>20&&Dt(e=>Math.max(0,e-.05*r))},[pt,jt]);const Dr=e.useCallback(e=>{pt&&wr(e)},[pt,wr]),jr=e.useCallback(()=>{if(!G||!rr.current.currentDrone||!ot)return void(ot||O("‚ö†Ô∏è Get closer to the base! Wait for green indicator."));const e=rr.current.currentDrone,t=e.children.find(e=>e.userData.isPizza);if(!t)return void O("‚ùå No pizza attached!");const r=(Date.now()-$t)/1e3,o=St>=95&&r<45,n=(e=>e<30?{temp:"PIPING HOT",emoji:"üî•üî•üî•",color:"#ff4400",bonus:2,penalty:0}:e<45?{temp:"HOT",emoji:"üî•üî•",color:"#ff6600",bonus:1,penalty:0}:e<60?{temp:"WARM",emoji:"üî•",color:"#ff9900",bonus:.5,penalty:0}:e<90?{temp:"LUKEWARM",emoji:"üòê",color:"#ffcc00",bonus:0,penalty:-.5}:e<120?{temp:"COOL",emoji:"‚ùÑÔ∏è",color:"#66ccff",bonus:0,penalty:-1}:{temp:"COLD",emoji:"ü•∂",color:"#0099ff",bonus:0,penalty:-2})(r),i=vt?.price||15.99,s=Be(St,r),l=((e,t,r,o=15.99,n=null)=>{const i=Be(t,e),a=e>=90,s=t<70,l=t<50;if(t<30)return 0;if(e>=150&&l)return 0;if(i<1.5)return 0;let d=!1;e>=120&&!s&&(d=!0),l&&!a&&(d=!0),a&&s&&!l&&(d=!0);let c=1;const p=t>=97;i>=4.8?(c=2,p&&e<45&&(c=2.5)):i>=4.5?(c=1.7,p&&(c=2)):i>=4?(c=1.4,t>=95&&(c=1.6)):c=i>=3.5?1:i>=3?.7:i>=2.5?.3:i>=2?.1:0;let u=.15*o*c;r&&i>=4.5&&(u+=.15*o,o>=25&&(u+=5),o>=40&&(u+=10)),p&&!r&&e<60&&(u+=2),a&&u>0&&(u=Math.max(.5,.5*u)),d&&u>0&&(u=Math.max(.25,.3*u)),n&&n.tipBonus>0&&u>0&&(u+=u*n.tipBonus);return u>0&&u<.25&&(u=.25),Math.round(100*u)/100})(r,St,o,i,Nt.rank),d=be(s,St,r,o,!1);e.remove(t),e.userData.hasPizza=!1,Qt.current?.isInVR&&(Qt.current.triggerHaptic("left",.8,150),Qt.current.triggerHaptic("right",.8,150),setTimeout(()=>{Qt.current.triggerHaptic("left",.5,100),Qt.current.triggerHaptic("right",.5,100)},200)),F(e=>e+l),W(e=>e+1);const c=vt?.name||"Plain Cheese";Ot(e=>{const t=Math.max(0,e.xp+d),n=e.rank,a=ze(t),s={...e.pizzaTypeDeliveries,[c]:(e.pizzaTypeDeliveries[c]||0)+1},p=o?e.perfectDeliveries+1:e.perfectDeliveries,u=e.totalTips+l,h=e.fastestDelivery?Math.min(e.fastestDelivery,r):r;if(n.name!==a.name){const r=ve(n,a,t>e.xp);r&&setTimeout(()=>{Ut(r),setTimeout(()=>Ut(null),4e3)},1500)}const x={totalDeliveries:e.totalDeliveries+1,totalEarnings:e.totalEarnings+l,bestTime:e.bestTime?Math.min(e.bestTime,r):r,xp:t,rank:a,pizzaTypeDeliveries:s,perfectDeliveries:p,totalTips:u,fastestDelivery:h,storeEarnings:e.storeEarnings+i,badges:e.badges},f=((e,t=[])=>{const r=[],o=new Set(t.map(e=>e.id));for(const n of pe)o.has(n.id)||(e.pizzaTypeDeliveries?.[n.pizzaType]||0)>=n.required&&r.push(n);for(const n of ue)!o.has(n.id)&&e.totalDeliveries>=n.deliveries&&r.push(n);for(const n of he)!o.has(n.id)&&e.perfectDeliveries>=n.perfectDeliveries&&r.push(n);for(const n of xe)!o.has(n.id)&&e.fastestDelivery&&e.fastestDelivery<=n.fastestTime&&r.push(n);for(const n of fe)!o.has(n.id)&&e.totalTips>=n.totalTips&&r.push(n);return r})(x,e.badges);return f.length>0&&(x.badges=[...e.badges,...f],setTimeout(()=>{Gt(f[0]),setTimeout(()=>Gt(null),4e3)},2500)),x});const p=((e,t,r,o)=>{const n=e=>e[Math.floor(Math.random()*e.length)];return 0===e?o<30?n(["ü§¨ 'Is this even pizza anymore?! GET OUT!'","üò± 'I ordered a PIZZA, not a CRIME SCENE!'","üò§ 'My grandma could deliver better... with her eyes closed!'","üóëÔ∏è 'I've seen better looking pizzas in the GARBAGE!'","üò§ 'I'm calling your manager, your manager's manager, and the MAYOR!'"]):o<50?n(["üò§ 'This pizza is RUINED! No tip for you!'","ü§Æ 'Did you play SOCCER with my pizza?!'","üò† 'I wanted a pizza, not a PUZZLE!'","üëé 'This is a DISASTER. Never order from here again!'","ü§¶ 'My expectations were low but HOLY...'"]):r>=120?n(["ü•∂ 'An ICE COLD pizza?! Are you kidding me?!'","‚ùÑÔ∏è 'I could have frozen a FRESH pizza faster!'","üßä 'Did you stop for a NAP on the way?!'","‚è∞ 'Did you deliver this by HORSE?!'","üò¥ 'I ordered this pizza LAST WEEK!'"]):r>=90&&o<70?n(["üò† 'Cold AND damaged?! I'm calling the manager!'","ü§Ø 'HOW did you manage to mess up THIS badly?!'","üí¢ 'You had ONE JOB!'","üò§ 'This is insulting. Just... leave.'"]):t<2?n(["üëé 'Worst delivery ever. No tip!'","üö´ 'I'd give you negative stars if I could!'","üòí 'My 5-year-old could do better!'","üí© 'This deserves the poop emoji.'"]):"üòí 'Really? No tip for this disaster.'":n(e<1?["üòê 'I guess... here's some change.'","üôÑ 'It's not GREAT, but here's something.'","üòë 'Consider this a mercy tip.'","üí≠ 'At least you showed up... barely.'"]:e<3?["üôÇ 'It was... okay. Here.'","üòå 'Decent enough. Thanks.'","üëå 'Not bad, not great. Here you go.'","ü§∑ 'Could be worse I guess.'"]:e<5?["üòä 'Not bad! Thanks!'","üëç 'Good job! Appreciate it!'","üòÑ 'Nice delivery! Here you go!'","üôå 'That was quick! Thanks!'"]:e<8?["üòÑ 'Great service! Here you go!'","üåü 'Impressive! Well done!'","üëè 'Now THAT'S how you deliver pizza!'","üî• 'Fast AND fresh! Love it!'"]:e<15?["ü§© 'AMAZING! Best delivery ever! Keep the change!'","ü•≥ 'WOW! You're a LEGEND!'","üíØ 'PERFECTION! You deserve this!'","‚≠ê 'Five stars! Tell your boss you need a raise!'","üòç 'Marry me! Just kidding... unless?'"]:["ü§ë 'INCREDIBLE! Here's a HUGE tip!'","üí∞ 'You just made my WHOLE DAY! Take ALL of this!'","üéâ 'FLAWLESS! I'm telling EVERYONE about you!'","üëë 'You're the KING/QUEEN of pizza delivery!'","üèÜ 'I've NEVER had delivery this good! Here's everything I got!'","üíé 'This is what EXCELLENCE looks like! Legendary tip for you!'"])})(l,s,r,St),u=Nt.rank?.tipBonus||0;Wt({deliveryTime:r,tip:l,pizzaHealth:St,isPerfect:o,temperature:n,rating:s,tipMessage:p,pizzaType:vt,xpChange:d,rankBonus:u,playerRank:Nt.rank}),Ft(!0),a("delivered"),V(!1),rt(null),nt(!1),setTimeout(()=>{e.position.copy(e.userData.homePos),e.rotation.y=0,rr.current.currentDrone=null,rr.current.camera.position.set(0,15,30),rr.current.camera.lookAt(0,0,0)},100)},[G,ot,St,$t]),kr=()=>rr.current.currentDrone?{x:rr.current.currentDrone.position.x,z:rr.current.currentDrone.position.z}:null;return _.jsxs("div",{style:{width:"100%",height:"100vh",position:"relative",overflow:"hidden"},children:[_.jsx("div",{ref:t,style:{width:"100%",height:"100%"}}),_.jsx(Le,{score:B,pizzasDelivered:L,pizzasDestroyed:$,currentOrder:d,pilotMode:G,cameraView:Qe,pizzaHealth:St,playerStats:Nt,dronePosition:kr(),currentPizzaType:vt}),G&&_.jsx(He,{dronePosition:kr(),targetBase:(()=>{if(!d)return null;const e=rr.current.bases.find(e=>e.userData.baseNumber===d.base);return e?{x:e.position.x,z:e.position.z}:null})(),currentOrder:d,altitude:dr,verticalSpeed:pr}),G&&_.jsxs("div",{style:{position:"absolute",top:"240px",right:"20px",width:"220px",background:"ascending"===dt?"rgba(255, 165, 0, 0.9)":"descending"===dt?"rgba(0, 200, 255, 0.9)":"rgba(0, 200, 0, 0.9)",padding:"10px 15px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"14px",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",border:"2px solid white"},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[_.jsx("span",{style:{fontSize:"20px"},children:"ascending"===dt?"üöÄ":"descending"===dt?"üìç":"‚úàÔ∏è"}),_.jsxs("div",{style:{flex:1},children:[_.jsx("div",{style:{textTransform:"uppercase",letterSpacing:"1px",fontSize:"13px"},children:"ascending"===dt?"TAKEOFF":"descending"===dt?"LANDING":"CRUISING - FULL CONTROL"}),_.jsx("div",{style:{fontSize:"10px",opacity:.9},children:"ascending"===dt?`Altitude: ${Math.round(dr)}m / 10m`:"descending"===dt?`Land on roof (${dr.toFixed(1)}m)`:`Alt: ${dr.toFixed(1)}m`})]})]}),"ascending"===dt&&_.jsx("div",{style:{marginTop:"8px",width:"100%",height:"6px",background:"rgba(0,0,0,0.3)",borderRadius:"3px",overflow:"hidden"},children:_.jsx("div",{style:{width:`${Math.min(100,dr/10*100)}%`,height:"100%",background:"#fff",transition:"width 0.1s"}})}),_.jsxs("div",{style:{marginTop:"8px",fontSize:"11px",opacity:.9,display:"flex",justifyContent:"space-between"},children:[_.jsx("span",{children:"‚¨ÜÔ∏è SPACE = UP"}),_.jsx("span",{children:"‚¨áÔ∏è SHIFT = DOWN"})]}),_.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:pr>0?"#00ff00":pr<0?"#ff6600":"#888"},children:pr>.5?"‚Üë‚Üë‚Üë ASCENDING":pr<-.5?"‚Üì‚Üì‚Üì DESCENDING":"‚Äî HOVER"})]}),G&&_.jsx(Ne,{distanceToBase:tt,canRelease:ot,canDescend:it,horizontalDist:st,altitude:dr}),_.jsx(Oe,{message:N}),Tt&&_.jsx(_e,{step:Mt,onNext:()=>{Mt<J.length-1?Rt(e=>e+1):(Et(!1),zr())},onSkip:()=>{Et(!1),zr()}}),Bt&&Lt&&_.jsx(Ye,{deliveryTime:Lt.deliveryTime,tip:Lt.tip,pizzaHealth:Lt.pizzaHealth,isPerfect:Lt.isPerfect,temperature:Lt.temperature,rating:Lt.rating,tipMessage:Lt.tipMessage,pizzaType:Lt.pizzaType,xpChange:Lt.xpChange,rankBonus:Lt.rankBonus,playerRank:Lt.playerRank,totalDeliveries:L,onNextOrder:()=>{Ft(!1),zr()},onViewLeaderboard:()=>{Ft(!1),Pt(!0)}}),_.jsx(Ue,{message:Vt}),_.jsx(Ve,{badge:_t}),ft&&_.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(180, 0, 0, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3,animation:"flashRed 0.5s ease-in-out 3"},children:[_.jsxs("div",{style:{fontSize:"80px",marginBottom:"20px",animation:"shake 0.5s ease-in-out infinite"},children:[vt?.emoji||"üçï","üíÄüí∏"]}),_.jsx("h1",{style:{color:"white",fontSize:"48px",textShadow:"0 0 20px #ff0000",marginBottom:"10px",textTransform:"uppercase",letterSpacing:"5px"},children:"PIZZA DESTROYED!"}),_.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"8px 20px",borderRadius:"20px",marginBottom:"10px",fontSize:"18px",color:"#ffcc00"},children:[vt?.emoji," ",vt?.name||"Pizza"]}),_.jsxs("p",{style:{color:"#ffcccc",fontSize:"20px",marginBottom:"15px",textAlign:"center",maxWidth:"500px",fontStyle:"italic"},children:['"',vt?.description||"That pizza is gone forever!",'"']}),_.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"15px 30px",borderRadius:"10px",border:"3px solid "+((vt?.price||18.99)>25?"#ff0000":"#ff4444"),marginBottom:"20px"},children:[_.jsx("div",{style:{color:"#ff6666",fontSize:"16px",marginBottom:"5px"},children:"üí∏ CHARGED TO YOUR WAGES:"}),_.jsxs("div",{style:{color:(vt?.price||18.99)>25?"#ff0000":"#ff4444",fontSize:(vt?.price||18.99)>25?"42px":"36px",fontWeight:"bold"},children:["-$",(vt?.price||18.99).toFixed(2)]}),_.jsx("div",{style:{color:"#ffaaaa",fontSize:"12px"},children:(vt?.price||18.99)>=49.99?"üò± THE MOST EXPENSIVE ONE!":(vt?.price||18.99)>=24.99?"üò∞ That was a premium pizza!":(vt?.price||18.99)<15?"üòÖ At least it was cheap...":"Full price of destroyed pizza!"})]}),_.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginBottom:"30px"},children:[_.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"15px 25px",borderRadius:"10px",color:"white",textAlign:"center"},children:[_.jsx("div",{style:{fontSize:"14px",opacity:.8},children:"Pizzas Destroyed"}),_.jsx("div",{style:{fontSize:"36px",fontWeight:"bold"},children:$})]}),_.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"15px 25px",borderRadius:"10px",color:B<0?"#ff4444":"#00ff00",textAlign:"center"},children:[_.jsx("div",{style:{fontSize:"14px",opacity:.8},children:"Total Wages"}),_.jsx("div",{style:{fontSize:"36px",fontWeight:"bold"},children:B<0?`-$${Math.abs(B).toFixed(2)}`:`$${B.toFixed(2)}`})]})]}),_.jsxs("div",{style:{display:"flex",gap:"15px"},children:[_.jsx("button",{onClick:()=>{mt(!1),br()},style:{...Je.primary,background:"linear-gradient(180deg, #22aa22 0%, #118811 100%)",fontSize:"20px",padding:"15px 40px"},children:"üçï Try Again"}),_.jsx("button",{onClick:()=>{mt(!1),a("menu"),A(null)},style:{...Je.secondary,fontSize:"20px",padding:"15px 40px"},children:"üè† Back to Menu"})]}),_.jsx("p",{style:{color:"#ffaaaa",fontSize:"14px",marginTop:"30px",opacity:.7},children:"üí° Tip: Move slowly and keep the pizza box level!"})]}),gt&&_.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(180, 100, 0, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3},children:[_.jsx("div",{style:{fontSize:"80px",marginBottom:"20px"},children:"üçïüò¨üçï"}),_.jsx("h1",{style:{color:"white",fontSize:"36px",textShadow:"0 0 20px #ff6600",marginBottom:"10px",textAlign:"center"},children:"WAIT... DELIVER THIS?!"}),_.jsxs("p",{style:{color:"#ffeecc",fontSize:"22px",marginBottom:"10px",textAlign:"center",maxWidth:"500px"},children:["This pizza is only ",_.jsxs("span",{style:{color:"#ff4444",fontWeight:"bold",fontSize:"28px"},children:[Math.round(St),"%"]})," intact!"]}),_.jsxs("p",{style:{color:"#ffcc88",fontSize:"18px",marginBottom:"30px",textAlign:"center",maxWidth:"500px",fontStyle:"italic"},children:['ü§î "Are you SURE you want to deliver this disaster?',_.jsx("br",{}),"The customer might not tip well... or at all...",_.jsx("br",{}),'They might even call your manager!"']}),_.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"15px 30px",borderRadius:"10px",marginBottom:"25px"},children:[_.jsx("div",{style:{color:"#ffcc00",fontSize:"16px",marginBottom:"5px"},children:"üí∞ Expected Tip Reduction:"}),_.jsxs("div",{style:{color:"#ff4444",fontSize:"24px",fontWeight:"bold"},children:["-",Math.round(.5*(100-St)),"% tips! üò¢"]})]}),_.jsxs("div",{style:{display:"flex",gap:"15px"},children:[_.jsx("button",{onClick:()=>{yt(!1),zt&&(Sr(zt),bt(null))},style:{...Je.primary,background:"linear-gradient(180deg, #cc6600 0%, #884400 100%)",fontSize:"18px",padding:"12px 30px"},children:"üòÖ YOLO! Deliver It Anyway"}),_.jsx("button",{onClick:()=>{yt(!1),bt(null),br()},style:{...Je.secondary,fontSize:"18px",padding:"12px 30px"},children:"üçï Get Fresh Pizza"})]}),_.jsx("p",{style:{color:"#ffddaa",fontSize:"12px",marginTop:"20px",opacity:.7},children:"Pro tip: Walk back to the shop for a perfect pizza! üèÉ‚Äç‚ôÇÔ∏è"})]}),_.jsx(qe,{isOpen:Ct,onClose:()=>Pt(!1),category:It,onCategoryChange:At,playerRank:42,playerScore:B}),!Ct&&!Bt&&"menu"!==r&&_.jsx(Xe,{topPlayers:Ae.fastest_delivery,playerRank:42,onExpand:()=>Pt(!0)}),_.jsxs("div",{style:{position:"absolute",bottom:20,left:"50%",transform:"translateX(-50%)",display:"flex",gap:"10px"},children:["menu"===r&&_.jsxs(_.Fragment,{children:[_.jsx("button",{onClick:()=>Et(!0),style:Je.secondary,children:"üìñ Tutorial"}),_.jsx("button",{onClick:zr,style:Je.primary,children:"üçï Start Delivering!"}),_.jsx("button",{onClick:()=>Pt(!0),style:Je.secondary,children:"üèÜ Leaderboards"})]}),"carrying"===r&&!pt&&_.jsx(_.Fragment,{children:sr?_.jsx("button",{onClick:vr,style:{...Je.primary,animation:"pulse 1s infinite"},children:"üçï Grab Pizza from Shop"}):_.jsx("div",{style:{color:"white",background:"rgba(0,0,0,0.7)",padding:"10px 20px",borderRadius:"8px"},children:"üè™ Walk to the Pizza Shop! (WASD to move)"})}),"carrying"===r&&pt&&_.jsxs(_.Fragment,{children:[_.jsxs("div",{style:{color:"white",background:"rgba(0,0,0,0.7)",padding:"10px 20px",borderRadius:"8px",marginRight:"10px"},children:["üçï Walk to Drone ",d?.drone,"! (WASD to move)"]}),ir&&_.jsxs("button",{onClick:()=>wr(ir),style:{...Je.primary,background:ir===d?.drone?"#22cc22":"#cc8822",animation:ir===d?.drone?"pulse 0.5s infinite":"none"},children:["üöÅ Load Drone ",ir,ir!==d?.drone&&" (Wrong!)"]})]}),"flying"===r&&G&&_.jsx("button",{onClick:jr,style:{...Je.danger,animation:ot?"glow 1s infinite":"none"},children:"üì¶ Release Pizza"})]}),pt&&_.jsx(We,{pizzaHealth:St,pizzaTilt:jt}),pt&&_.jsx($e,{speed:hr,isWarning:fr,pizzaHealth:St}),G&&_.jsx(Ge,{}),_.jsx("style",{children:"\n  @keyframes blink {\n    0%, 50% { opacity: 1; }\n    51%, 100% { opacity: 0.3; }\n  }\n  \n  @keyframes pulse {\n    0%, 100% { transform: translate(-50%, -50%) scale(1); }\n    50% { transform: translate(-50%, -50%) scale(1.2); }\n  }\n  \n  @keyframes popIn {\n    0% { transform: scale(0.8); opacity: 0; }\n    100% { transform: scale(1); opacity: 1; }\n  }\n  \n  @keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    25% { transform: translateX(-5px); }\n    75% { transform: translateX(5px); }\n  }\n  \n  @keyframes glow {\n    0%, 100% { box-shadow: 0 0 5px #00ff00; }\n    50% { box-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00; }\n  }\n  \n  @keyframes slideIn {\n    0% { transform: translateY(-100%); opacity: 0; }\n    100% { transform: translateY(0); opacity: 1; }\n  }\n  \n  @keyframes fadeIn {\n    0% { opacity: 0; }\n    100% { opacity: 1; }\n  }\n  \n  @keyframes bounce {\n    0%, 100% { transform: translateY(0); }\n    50% { transform: translateY(-10px); }\n  }\n  \n  @keyframes rotate {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n  \n  @keyframes warning {\n    0%, 100% { background-color: rgba(255, 0, 0, 0.2); }\n    50% { background-color: rgba(255, 0, 0, 0.5); }\n  }\n  \n  .game-button {\n    transition: all 0.2s ease;\n  }\n  \n  .game-button:hover {\n    transform: scale(1.05);\n    box-shadow: 0 6px 12px rgba(0,0,0,0.4);\n  }\n  \n  .game-button:active {\n    transform: scale(0.98);\n  }\n"})]})};function Ze(){return _.jsx("div",{className:"App",children:_.jsx(Ke,{})})}G.createRoot(document.getElementById("root")).render(_.jsx(r.StrictMode,{children:_.jsx(Ze,{})}));

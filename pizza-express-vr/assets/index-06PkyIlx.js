import{r as e,a as t,R as n}from"./react-vendor-DENY9G7l.js";import{T as r,a as s,b as o,L as i,c as a,F as l,M as c,V as d,C as p,d as u,S as h,e as f,P as m,D as g,f as x,g as y,I as b,Q as v,h as w,O as S,i as T,j as z,B as A,k as R,l as E,N as k,m as D,n as M,o as C,p as j,R as P,q as I,r as L,s as _,t as N,u as O,v as F,w as B,x as H,y as G,z as U,A as W,E as $,G as V,H as X,J as K,K as q,U as Y,W as Z,X as J,Y as Q,Z as ee,_ as te,$ as ne,a0 as re,a1 as se,a2 as oe,a3 as ie,a4 as ae,a5 as le,a6 as ce,a7 as de,a8 as pe,a9 as ue,aa as he,ab as fe,ac as me,ad as ge,ae as xe,af as ye,ag as be,ah as ve,ai as we,aj as Se,ak as Te,al as ze,am as Ae,an as Re,ao as Ee,ap as ke,aq as De,ar as Me,as as Ce,at as je,au as Pe,av as Ie,aw as Le}from"./three-Xo84ugVp.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var _e={exports:{}},Ne={},Oe=e,Fe=Symbol.for("react.element"),Be=Symbol.for("react.fragment"),He=Object.prototype.hasOwnProperty,Ge=Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ue={key:!0,ref:!0,__self:!0,__source:!0};function We(e,t,n){var r,s={},o=null,i=null;for(r in void 0!==n&&(o=""+n),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(i=t.ref),t)He.call(t,r)&&!Ue.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:Fe,type:e,key:o,ref:i,props:s,_owner:Ge.current}}Ne.Fragment=Be,Ne.jsx=We,Ne.jsxs=We,_e.exports=Ne;var $e=_e.exports,Ve={},Xe=t;Ve.createRoot=Xe.createRoot,Ve.hydrateRoot=Xe.hydrateRoot;const Ke=[{x:-15,z:10,label:"A"},{x:15,z:10,label:"B"},{x:-15,z:-12,label:"C"},{x:15,z:-12,label:"D"}],qe=[{x:-40,z:40,num:1},{x:40,z:40,num:2},{x:-40,z:-40,num:3},{x:40,z:-40,num:4}],Ye=0,Ze=4,Je=[{id:1,title:"Welcome to Pizza Express VR! üçï",message:"You are a drone pilot delivering pizzas across the city! Each customer has a name and is waiting for their delicious pizza!",highlight:null},{id:2,title:"Pick Up Pizza üì¶",message:"Grab a pizza from the shop. Each pizza has a different price - the more expensive, the bigger tips possible!",highlight:"shop"},{id:3,title:"Carry Carefully üéØ",message:"Tilt meter shows pizza condition. Keep it green! Damaged pizzas = angry customers = no tips!",highlight:"tiltMeter"},{id:4,title:"Climb the Ranks! üèÜ",message:"Earn XP with each delivery! Rise from Trainee to PIZZA GOD! Higher ranks = bigger tip bonuses! But beware - dropping pizzas costs more XP than you earn!",highlight:null},{id:5,title:"Earn Badges üéñÔ∏è",message:"Deliver specific pizza types to unlock badges! Each pizza type has special achievements. Collect them all!",highlight:null},{id:6,title:"Store Earnings üí∞",message:"Every pizza you deliver adds to the store's total earnings! Compete to be the top contributor!",highlight:null},{id:7,title:"Fly Controls ‚úàÔ∏è",message:"Use WASD to move, Space/Shift for altitude, V to switch camera. In VR, use your controllers!",highlight:"controls"},{id:8,title:"Deliver & Get Paid! üöÄ",message:"Land in the green zone and release the pizza! Fast + careful = big tips! Now go make some deliveries!",highlight:"deliveryZone"}],Qe=8900331,et=4881468,tt=16729156,nt=16776960,rt=3355443,st=2201331,ot=65280,it=4473924,at=2236962,lt=16750848,ct=16739179;function dt(e,t){if(t===r)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===s||t===o){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,o=[];if(t===s)for(let e=1;e<=r;e++)o.push(n.getX(0)),o.push(n.getX(e)),o.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(o.push(n.getX(e)),o.push(n.getX(e+1)),o.push(n.getX(e+2))):(o.push(n.getX(e+2)),o.push(n.getX(e+1)),o.push(n.getX(e)));o.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(o),i.clearGroups(),i}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class pt extends i{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new xt(e)}),this.register(function(e){return new Rt(e)}),this.register(function(e){return new Et(e)}),this.register(function(e){return new kt(e)}),this.register(function(e){return new bt(e)}),this.register(function(e){return new vt(e)}),this.register(function(e){return new wt(e)}),this.register(function(e){return new St(e)}),this.register(function(e){return new gt(e)}),this.register(function(e){return new Tt(e)}),this.register(function(e){return new yt(e)}),this.register(function(e){return new At(e)}),this.register(function(e){return new zt(e)}),this.register(function(e){return new ft(e)}),this.register(function(e){return new Dt(e)}),this.register(function(e){return new Mt(e)})}load(e,t,n,r){const s=this;let o;if(""!==this.resourcePath)o=this.resourcePath;else if(""!==this.path){const t=a.extractUrlBase(e);o=a.resolveURL(t,this.path)}else o=a.extractUrlBase(e);this.manager.itemStart(e);const i=function(t){r?r(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},c=new l(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(n){try{s.parse(n,o,function(n){t(n),s.manager.itemEnd(e)},i)}catch(r){i(r)}},n,i)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let s;const o={},i={},a=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer){if(a.decode(new Uint8Array(e,0,4))===Ct){try{o[ht.KHR_BINARY_GLTF]=new It(e)}catch(c){return void(r&&r(c))}s=JSON.parse(o[ht.KHR_BINARY_GLTF].content)}else s=JSON.parse(a.decode(e))}else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new an(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const e=this.pluginCallbacks[d](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),i[e.name]=e,o[e.name]=!0}if(s.extensionsUsed)for(let d=0;d<s.extensionsUsed.length;++d){const e=s.extensionsUsed[d],t=s.extensionsRequired||[];switch(e){case ht.KHR_MATERIALS_UNLIT:o[e]=new mt;break;case ht.KHR_DRACO_MESH_COMPRESSION:o[e]=new Lt(s,this.dracoLoader);break;case ht.KHR_TEXTURE_TRANSFORM:o[e]=new _t;break;case ht.KHR_MESH_QUANTIZATION:o[e]=new Nt;break;default:t.indexOf(e)>=0&&void 0===i[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(o),l.setPlugins(i),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,t,r,s)})}}function ut(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const ht={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ft{constructor(e){this.parser=e,this.name=ht.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let i;const a=new p(16777215);void 0!==o.color&&a.setRGB(o.color[0],o.color[1],o.color[2],u);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":i=new g(a),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new m(a),i.distance=l;break;case"spot":i=new f(a),i.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return i.position.set(0,0,0),i.decay=2,en(i,o),void 0!==o.intensity&&(i.intensity=o.intensity),i.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(i),t.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],s=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then(function(e){return n._getNodeRef(t.cache,s,e)})}}class mt{constructor(){this.name=ht.KHR_MATERIALS_UNLIT}getMaterialType(){return H}extendParams(e,t,n){const r=[];e.color=new p(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],u),e.opacity=t[3]}void 0!==s.baseColorTexture&&r.push(n.assignTexture(e,"map",s.baseColorTexture,h))}return Promise.all(r)}}class gt{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class xt{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new d(e,e)}return Promise.all(s)}}class yt{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&s.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&s.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class bt{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new p(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];if(void 0!==o.sheenColorFactor){const e=o.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],u)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,h)),void 0!==o.sheenRoughnessTexture&&s.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class vt{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&s.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class wt{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const i=o.attenuationColor||[1,1,1];return t.attenuationColor=(new p).setRGB(i[0],i[1],i[2],u),Promise.all(s)}}class St{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class Tt{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const i=o.specularColorFactor||[1,1,1];return t.specularColor=(new p).setRGB(i[0],i[1],i[2],u),void 0!==o.specularColorTexture&&s.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,h)),Promise.all(s)}}class zt{constructor(e){this.parser=e,this.name=ht.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return t.bumpScale=void 0!==o.bumpFactor?o.bumpFactor:1,void 0!==o.bumpTexture&&s.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class At{constructor(e){this.parser=e,this.name=ht.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&s.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class Rt{constructor(e){this.parser=e,this.name=ht.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class Et{constructor(e){this.parser=e,this.name=ht.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],i=r.images[o.source];let a=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(a=e)}return this.detectSupport().then(function(s){if(s)return n.loadTextureImage(e,o.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class kt{constructor(e){this.parser=e,this.name=ht.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],i=r.images[o.source];let a=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(a=e)}return this.detectSupport().then(function(s){if(s)return n.loadTextureImage(e,o.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Dt{constructor(e){this.name=ht.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(t){const n=e.byteOffset||0,r=e.byteLength||0,o=e.count,i=e.byteStride,a=new Uint8Array(t,n,r);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(o,i,a,e.mode,e.filter).then(function(e){return e.buffer}):s.ready.then(function(){const t=new ArrayBuffer(o*i);return s.decodeGltfBuffer(new Uint8Array(t),o,i,a,e.mode,e.filter),t})})}return null}}class Mt{constructor(e){this.name=ht.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=t.meshes[n.mesh];for(const a of r.primitives)if(a.mode!==Ht.TRIANGLES&&a.mode!==Ht.TRIANGLE_STRIP&&a.mode!==Ht.TRIANGLE_FAN&&void 0!==a.mode)return null;const s=n.extensions[this.name].attributes,o=[],i={};for(const a in s)o.push(this.parser.getDependency("accessor",s[a]).then(e=>(i[a]=e,i[a])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],r=e[0].count,s=[];for(const o of n){const e=new x,t=new y,n=new v,a=new y(1,1,1),l=new b(o.geometry,o.material,r);for(let s=0;s<r;s++)i.TRANSLATION&&t.fromBufferAttribute(i.TRANSLATION,s),i.ROTATION&&n.fromBufferAttribute(i.ROTATION,s),i.SCALE&&a.fromBufferAttribute(i.SCALE,s),l.setMatrixAt(s,e.compose(t,n,a));for(const r in i)if("_COLOR_0"===r){const e=i[r];l.instanceColor=new w(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&o.geometry.setAttribute(r,i[r]);S.prototype.copy.call(l,o),this.parser.assignFinalMaterial(l),s.push(l)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]}))}}const Ct="glTF",jt=1313821514,Pt=5130562;class It{constructor(e){this.name=ht.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ct)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<r;){const t=s.getUint32(o,!0);o+=4;const r=s.getUint32(o,!0);if(o+=4,r===jt){const r=new Uint8Array(e,12+o,t);this.content=n.decode(r)}else if(r===Pt){const n=12+o;this.body=e.slice(n,n+t)}o+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Lt{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ht.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,i={},a={},l={};for(const c in o){const e=Vt[c]||c.toLowerCase();i[e]=o[c]}for(const c in e.attributes){const t=Vt[c]||c.toLowerCase();if(void 0!==o[c]){const r=n.accessors[e.attributes[c]],s=Gt[r.componentType];l[t]=s.name,a[t]=!0===r.normalized}}return t.getDependency("bufferView",s).then(function(e){return new Promise(function(t,n){r.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)},i,l,u,n)})})}}class _t{constructor(){this.name=ht.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Nt{constructor(){this.name=ht.KHR_MESH_QUANTIZATION}}class Ot extends ue{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=n[s+o];return t}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,i=this.valueSize,a=2*i,l=3*i,c=r-t,d=(n-t)/c,p=d*d,u=p*d,h=e*l,f=h-l,m=-2*u+3*p,g=u-p,x=1-m,y=g-p+d;for(let b=0;b!==i;b++){const e=o[f+b+i],t=o[f+b+a]*c,n=o[h+b+i],r=o[h+b]*c;s[b]=x*e+y*t+m*n+g*r}return s}}const Ft=new v;class Bt extends Ot{interpolate_(e,t,n,r){const s=super.interpolate_(e,t,n,r);return Ft.fromArray(s).normalize().toArray(s),s}}const Ht={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Gt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ut={9728:j,9729:C,9984:M,9985:D,9986:k,9987:E},Wt={33071:L,33648:I,10497:P},$t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Vt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Xt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Kt={CUBICSPLINE:void 0,LINEAR:se,STEP:re},qt="OPAQUE",Yt="MASK",Zt="BLEND";function Jt(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new F({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:pe})),e.DefaultMaterial}function Qt(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function en(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function tn(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function nn(e){let t;const n=e.extensions&&e.extensions[ht.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+rn(n.attributes):e.indices+":"+rn(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,s=e.targets.length;r<s;r++)t+=":"+rn(e.targets[r]);return t}function rn(e){let t="";const n=Object.keys(e).sort();for(let r=0,s=n.length;r<s;r++)t+=n[r]+":"+e[n[r]]+";";return t}function sn(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const on=new x;class an{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ut,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,s=-1;"undefined"!=typeof navigator&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||r&&s<98?this.textureLoader=new T(this.options.manager):this.textureLoader=new z(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};return Qt(s,o,r),en(o,r),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(o)})).then(function(){e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const t=e[r];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),s=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[r,o]of e.children.entries())s(o,t.children[r])};return s(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[ht.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(e,s){n.load(a.resolveURL(t.uri,r.path),e,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=$t[r.type],t=Gt[r.componentType],n=!0===r.normalized,s=new t(r.count*e);return Promise.resolve(new A(s,e,n))}const s=[];return void 0!==r.bufferView?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(e){const s=e[0],o=$t[r.type],i=Gt[r.componentType],a=i.BYTES_PER_ELEMENT,l=a*o,c=r.byteOffset||0,d=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;let u,h;if(d&&d!==l){const e=Math.floor(c/d),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let l=t.cache.get(n);l||(u=new i(s,e*d,r.count*d/a),l=new R(u,d/a),t.cache.add(n,l)),h=new oe(l,o,c%d/a,p)}else u=null===s?new i(r.count*o):new i(s,c,r.count*o),h=new A(u,o,p);if(void 0!==r.sparse){const t=$t.SCALAR,n=Gt[r.sparse.indices.componentType],a=r.sparse.indices.byteOffset||0,l=r.sparse.values.byteOffset||0,c=new n(e[1],a,r.sparse.count*t),d=new i(e[2],l,r.sparse.count*o);null!==s&&(h=new A(h.array.slice(),h.itemSize,h.normalized));for(let e=0,r=c.length;e<r;e++){const t=c[e];if(h.setX(t,d[e*o]),o>=2&&h.setY(t,d[e*o+1]),o>=3&&h.setZ(t,d[e*o+2]),o>=4&&h.setW(t,d[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return h})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,s=t.images[r];let o=this.textureLoader;if(s.uri){const e=n.manager.getHandler(s.uri);null!==e&&(o=e)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,n){const r=this,s=this.json,o=s.textures[e],i=s.images[t],a=(i.uri||i.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=o.name||i.name||"",""===t.name&&"string"==typeof i.uri&&!1===i.uri.startsWith("data:image/")&&(t.name=i.uri);const n=(s.samplers||{})[o.sampler]||{};return t.magFilter=Ut[n.magFilter]||C,t.minFilter=Ut[n.minFilter]||E,t.wrapS=Wt[n.wrapS]||P,t.wrapT=Wt[n.wrapT]||P,r.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,r=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const o=r.images[e],i=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(void 0!==o.bufferView)l=n.getDependency("bufferView",o.bufferView).then(function(e){c=!0;const t=new Blob([e],{type:o.mimeType});return l=i.createObjectURL(t),l});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(l).then(function(e){return new Promise(function(n,r){let o=n;!0===t.isImageBitmapLoader&&(o=function(e){const t=new ie(e);t.needsUpdate=!0,n(t)}),t.load(a.resolveURL(e,s.path),o,void 0,r)})}).then(function(e){var t;return!0===c&&i.revokeObjectURL(l),e.userData.mimeType=o.mimeType||((t=o.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e});return this.sourceCache[e]=d,d}assignTexture(e,t,n,r){const s=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((o=o.clone()).channel=n.texCoord),s.extensions[ht.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[ht.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=s.associations.get(o);o=s.extensions[ht.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),s.associations.set(o,t)}}return void 0!==r&&(o.colorSpace=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new _,N.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new O,N.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(r||s||o){let e="ClonedMaterial:"+n.uuid+":";r&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),s&&(t.vertexColors=!0),o&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return F}loadMaterial(e){const t=this,n=this.json,r=this.extensions,s=n.materials[e];let o;const i={},a=[];if((s.extensions||{})[ht.KHR_MATERIALS_UNLIT]){const e=r[ht.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),a.push(e.extendParams(i,s,t))}else{const n=s.pbrMetallicRoughness||{};if(i.color=new p(1,1,1),i.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;i.color.setRGB(e[0],e[1],e[2],u),i.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(i,"map",n.baseColorTexture,h)),i.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,i.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(i,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(i,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),a.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,i)})))}!0===s.doubleSided&&(i.side=B);const l=s.alphaMode||qt;if(l===Zt?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,l===Yt&&(i.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==H&&(a.push(t.assignTexture(i,"normalMap",s.normalTexture)),i.normalScale=new d(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;i.normalScale.set(e,e)}if(void 0!==s.occlusionTexture&&o!==H&&(a.push(t.assignTexture(i,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(i.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==H){const e=s.emissiveFactor;i.emissive=(new p).setRGB(e[0],e[1],e[2],u)}return void 0!==s.emissiveTexture&&o!==H&&a.push(t.assignTexture(i,"emissiveMap",s.emissiveTexture,h)),Promise.all(a).then(function(){const n=new o(i);return s.name&&(n.name=s.name),en(n,s),t.associations.set(n,{materials:e}),s.extensions&&Qt(r,n,s),n})}createUniqueName(e){const t=G.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function s(e){return n[ht.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return ln(n,e,t)})}const o=[];for(let i=0,a=e.length;i<a;i++){const n=e[i],a=nn(n),l=r[a];if(l)o.push(l.promise);else{let e;e=n.extensions&&n.extensions[ht.KHR_DRACO_MESH_COMPRESSION]?s(n):ln(new U,n,t),r[a]={primitive:n,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],a=i.primitives,l=[];for(let s=0,o=a.length;s<o;s++){const e=void 0===a[s].material?Jt(this.cache):this.getDependency("material",a[s].material);l.push(e)}return l.push(t.loadGeometries(a)),Promise.all(l).then(function(n){const l=n.slice(0,n.length-1),c=n[n.length-1],d=[];for(let u=0,h=c.length;u<h;u++){const n=c[u],p=a[u];let h;const f=l[u];if(p.mode===Ht.TRIANGLES||p.mode===Ht.TRIANGLE_STRIP||p.mode===Ht.TRIANGLE_FAN||void 0===p.mode)h=!0===i.isSkinnedMesh?new W(n,f):new $(n,f),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),p.mode===Ht.TRIANGLE_STRIP?h.geometry=dt(h.geometry,o):p.mode===Ht.TRIANGLE_FAN&&(h.geometry=dt(h.geometry,s));else if(p.mode===Ht.LINES)h=new V(n,f);else if(p.mode===Ht.LINE_STRIP)h=new X(n,f);else if(p.mode===Ht.LINE_LOOP)h=new K(n,f);else{if(p.mode!==Ht.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);h=new q(n,f)}Object.keys(h.geometry.morphAttributes).length>0&&tn(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),en(h,i),p.extensions&&Qt(r,h,p),t.assignFinalMaterial(h),d.push(h)}for(let r=0,s=d.length;r<s;r++)t.associations.set(d[r],{meshes:e,primitives:r});if(1===d.length)return i.extensions&&Qt(r,d[0],i),d[0];const p=new Y;i.extensions&&Qt(r,p,i),t.associations.set(p,{meshes:e});for(let e=0,t=d.length;e<t;e++)p.add(d[e]);return p})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new Z(J.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new Q(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),en(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,s=t.joints.length;r<s;r++)n.push(this._loadNodeShallow(t.joints[r]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const n=e.pop(),r=e,s=[],o=[];for(let i=0,a=r.length;i<a;i++){const e=r[i];if(e){s.push(e);const t=new x;null!==n&&t.fromArray(n.array,16*i),o.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[i])}return new ee(s,o)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,o=[],i=[],a=[],l=[],c=[];for(let d=0,p=r.channels.length;d<p;d++){const e=r.channels[d],t=r.samplers[e.sampler],n=e.target,s=n.node,p=void 0!==r.parameters?r.parameters[t.input]:t.input,u=void 0!==r.parameters?r.parameters[t.output]:t.output;void 0!==n.node&&(o.push(this.getDependency("node",s)),i.push(this.getDependency("accessor",p)),a.push(this.getDependency("accessor",u)),l.push(t),c.push(n))}return Promise.all([Promise.all(o),Promise.all(i),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],r=e[1],o=e[2],i=e[3],a=e[4],l=[];for(let s=0,c=t.length;s<c;s++){const e=t[s],c=r[s],d=o[s],p=i[s],u=a[s];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const h=n._createAnimationTracks(e,c,d,p,u);if(h)for(let t=0;t<h.length;t++)l.push(h[t])}return new te(s,void 0,l)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),s=[],o=n.children||[];for(let a=0,l=o.length;a<l;a++)s.push(t.getDependency("node",o[a]));const i=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(s),i]).then(function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(r,on)});for(let s=0,o=n.length;s<o;s++)t.add(n[s]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"",i=[],a=r._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return a&&i.push(a),void 0!==s.camera&&i.push(r.getDependency("camera",s.camera).then(function(e){return r._getNodeRef(r.cameraCache,s.camera,e)})),r._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){i.push(e)}),this.nodeCache[e]=Promise.all(i).then(function(t){let i;if(i=!0===s.isBone?new ne:t.length>1?new Y:1===t.length?t[0]:new S,i!==t[0])for(let e=0,n=t.length;e<n;e++)i.add(t[e]);if(s.name&&(i.userData.name=s.name,i.name=o),en(i,s),s.extensions&&Qt(n,i,s),void 0!==s.matrix){const e=new x;e.fromArray(s.matrix),i.applyMatrix4(e)}else void 0!==s.translation&&i.position.fromArray(s.translation),void 0!==s.rotation&&i.quaternion.fromArray(s.rotation),void 0!==s.scale&&i.scale.fromArray(s.scale);return r.associations.has(i)||r.associations.set(i,{}),r.associations.get(i).nodes=e,i}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,s=new Y;n.name&&(s.name=r.createUniqueName(n.name)),en(s,n),n.extensions&&Qt(t,s,n);const o=n.nodes||[],i=[];for(let a=0,l=o.length;a<l;a++)i.push(r.getDependency("node",o[a]));return Promise.all(i).then(function(e){for(let t=0,n=e.length;t<n;t++)s.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[n,s]of r.associations)(n instanceof N||n instanceof ie)&&t.set(n,s);return e.traverse(e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)}),t})(s),s})}_createAnimationTracks(e,t,n,r,s){const o=[],i=e.name?e.name:e.uuid,a=[];let l;switch(Xt[s.path]===Xt.weights?e.traverse(function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)}):a.push(i),Xt[s.path]){case Xt.weights:l=le;break;case Xt.rotation:l=ce;break;case Xt.position:case Xt.scale:l=ae;break;default:if(1===n.itemSize)l=le;else l=ae}const c=void 0!==r.interpolation?Kt[r.interpolation]:se,d=this._getArrayFromAccessor(n);for(let p=0,u=a.length;p<u;p++){const e=new l(a[p]+"."+Xt[s.path],t.array,d,c);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(e),o.push(e)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=sn(t.constructor),n=new Float32Array(t.length);for(let r=0,s=t.length;r<s;r++)n[r]=t[r]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof ce?Bt:Ot)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ln(e,t,n){const r=t.attributes,s=[];function o(t,r){return n.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(const i in r){const t=Vt[i]||i.toLowerCase();t in e.attributes||s.push(o(r[i],t))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});s.push(r)}return de.workingColorSpace!==u&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${de.workingColorSpace}" not supported.`),en(e,t),function(e,t,n){const r=t.attributes,s=new he;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new y(t[0],t[1],t[2]),new y(o[0],o[1],o[2])),e.normalized){const t=sn(Gt[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new y,t=new y;for(let r=0,s=o.length;r<s;r++){const s=o[r];if(void 0!==s.POSITION){const r=n.json.accessors[s.POSITION],o=r.min,i=r.max;if(void 0!==o&&void 0!==i){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(i[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(i[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(i[2]))),r.normalized){const e=sn(Gt[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const i=new fe;s.getCenter(i.center),i.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=i}(e,t,n),Promise.all(s).then(function(){return void 0!==t.targets?function(e,t,n){let r=!1,s=!1,o=!1;for(let c=0,d=t.length;c<d;c++){const e=t[c];if(void 0!==e.POSITION&&(r=!0),void 0!==e.NORMAL&&(s=!0),void 0!==e.COLOR_0&&(o=!0),r&&s&&o)break}if(!r&&!s&&!o)return Promise.resolve(e);const i=[],a=[],l=[];for(let c=0,d=t.length;c<d;c++){const d=t[c];if(r){const t=void 0!==d.POSITION?n.getDependency("accessor",d.POSITION):e.attributes.position;i.push(t)}if(s){const t=void 0!==d.NORMAL?n.getDependency("accessor",d.NORMAL):e.attributes.normal;a.push(t)}if(o){const t=void 0!==d.COLOR_0?n.getDependency("accessor",d.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(l)]).then(function(t){const n=t[0],i=t[1],a=t[2];return r&&(e.morphAttributes.position=n),s&&(e.morphAttributes.normal=i),o&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}const cn={ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function dn(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function pn(e,t,n=null,r=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const s=await async function(e){if(!e)throw new Error("No basePath supplied");return await dn(`${e}/profilesList.json`)}(t);let o;if(e.profiles.some(e=>{const n=s[e];return n&&(o={profileId:e,profilePath:`${t}/${n.path}`,deprecated:!!n.deprecated}),!!o}),!o){if(!n)throw new Error("No matching profile name found");const e=s[n];if(!e)throw new Error(`No matching profile name found and default profile "${n}" missing.`);o={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const i=await dn(o.profilePath);let a;if(r){let t;if(t="any"===e.handedness?i.layouts[Object.keys(i.layouts)[0]]:i.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${o.profileId}`);t.assetPath&&(a=o.profilePath.replace("profile.json",t.assetPath))}return{profile:i,assetPath:a}}const un={xAxis:0,yAxis:0,button:0,state:cn.ComponentState.DEFAULT};class hn{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===cn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(un)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:r}){const{normalizedXAxis:s,normalizedYAxis:o}=function(e=0,t=0){let n=e,r=t;if(Math.sqrt(e*e+t*t)>1){const s=Math.atan2(t,e);n=Math.cos(s),r=Math.sin(s)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*r+.5}}(e,t);switch(this.componentProperty){case cn.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?s:.5;break;case cn.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?o:.5;break;case cn.ComponentProperty.BUTTON:this.value=this.states.includes(r)?n:0;break;case cn.ComponentProperty.STATE:this.valueNodeProperty===cn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class fn{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(e=>{const n=new hn(t.visualResponses[e]);this.visualResponses[e]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:cn.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=cn.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=cn.ComponentState.PRESSED:(t.touched||this.values.button>cn.ButtonTouchThreshold)&&(this.values.state=cn.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===cn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>cn.AxisTouchThreshold&&(this.values.state=cn.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===cn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>cn.AxisTouchThreshold&&(this.values.state=cn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}}class mn{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(e=>{const t=this.layoutDescription.components[e];this.components[e]=new fn(e,t)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}class gn extends S{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)})),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(e=>{const{valueNode:t,minNode:n,maxNode:r,value:s,valueNodeProperty:o}=e;t&&(o===cn.VisualResponseProperty.VISIBILITY?t.visible=s:o===cn.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(n.quaternion,r.quaternion,s),t.position.lerpVectors(n.position,r.position,s)))})}))}}function xn(e,t){!function(e,t){Object.values(e.components).forEach(e=>{const{type:n,touchPointNodeName:r,visualResponses:s}=e;if(n===cn.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(r),e.touchPointNode){const t=new me(.001),n=new H({color:255}),r=new $(t,n);e.touchPointNode.add(r)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(s).forEach(e=>{const{valueNodeName:n,minNodeName:r,maxNodeName:s,valueNodeProperty:o}=e;if(o===cn.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(r),e.maxNode=t.getObjectByName(s),!e.minNode)return void console.warn(`Could not find ${r} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${s} in the model`)}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn(`Could not find ${n} in the model`)})})}(e.motionController,t),e.envMap&&t.traverse(t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)}),e.add(t)}class yn{constructor(e=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new pt)}createControllerModel(e){const t=new gn;let n=null;return e.addEventListener("connected",e=>{const r=e.data;"tracked-pointer"===r.targetRayMode&&r.gamepad&&pn(r,this.path,"generic-trigger").then(({profile:e,assetPath:s})=>{t.motionController=new mn(r,e,s);const o=this._assetCache[t.motionController.assetUrl];if(o)n=o.scene.clone(),xn(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,e=>{this._assetCache[t.motionController.assetUrl]=e,n=e.scene.clone(),xn(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(e=>{console.warn(e)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}}const bn=new x,vn=new y;class wn{constructor(e,t,n,r,s){let o;this.controller=t,this.handModel=e,this.envMap=null,s&&s.primitive&&"sphere"!==s.primitive?"box"===s.primitive&&(o=new ge(1,1,1)):o=new me(1,10,10);const i=new F;this.handMesh=new b(o,i,30),this.handMesh.frustumCulled=!1,this.handMesh.instanceMatrix.setUsage(xe),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){const e=this.controller.joints;let t=0;for(let n=0;n<this.joints.length;n++){const r=e[this.joints[n]];r.visible&&(vn.setScalar(r.jointRadius||.008),bn.compose(r.position,r.quaternion,vn),this.handMesh.setMatrixAt(n,bn),t++)}this.handMesh.count=t,this.handMesh.instanceMatrix.needsUpdate=!0}}class Sn{constructor(e,t,n,r,s=null){this.controller=t,this.handModel=e,this.bones=[],null===s&&(s=new pt).setPath(n||"https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/"),s.load(`${r}.glb`,e=>{const t=e.scene.children[0];this.handModel.add(t);const n=t.getObjectByProperty("type","SkinnedMesh");n.frustumCulled=!1,n.castShadow=!0,n.receiveShadow=!0;["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(e=>{const n=t.getObjectByName(e);void 0!==n?n.jointName=e:console.warn(`Couldn't find ${e} in ${r} hand mesh`),this.bones.push(n)})})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const n=this.bones[t];if(n){const t=e[n.jointName];if(t.visible){const e=t.position;n.position.copy(e),n.quaternion.copy(t.quaternion)}}}}}class Tn extends S{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}}class zn{constructor(){this.path=null}setPath(e){return this.path=e,this}createHandModel(e,t){const n=new Tn(e);return e.addEventListener("connected",r=>{const s=r.data;s.hand&&!n.motionController&&(n.xrInputSource=s,void 0===t||"spheres"===t?n.motionController=new wn(n,e,this.path,s.handedness,{primitive:"sphere"}):"boxes"===t?n.motionController=new wn(n,e,this.path,s.handedness,{primitive:"box"}):"mesh"===t&&(n.motionController=new Sn(n,e,this.path,s.handedness))),e.visible=!0}),e.addEventListener("disconnected",()=>{e.visible=!1}),n}}const An={requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor","hand-tracking","layers","anchors","secondary-views"],preferredFrameRate:90,framebufferScaleFactor:1,foveation:1,enableHands:!0,worldScale:1,snapTurn:!0,snapAngle:J.degToRad(30),smoothTurnSpeed:J.degToRad(90),hapticsIntensity:1,allowRecenter:!0},Rn={left:{pinch:"grab",squeeze:"menu"},right:{pinch:"primary",squeeze:"secondary"}},En=async()=>{if(!navigator.xr)return{supported:!1,reason:"WebXR not available in this browser"};try{const e=await navigator.xr.isSessionSupported("immersive-vr");return{supported:e,reason:e?"VR supported":"immersive-vr not supported"}}catch(e){return{supported:!1,reason:e.message}}};class kn{constructor(e,t,n,r=null,s={}){this.renderer=e,this.scene=t,this.camera=n,this.playerRig=r,this.session=null,this.referenceSpace=null,this.controllers=[],this.controllerGrips=[],this.hands=[],this.isInVR=!1,this.options={...An,...s},this.controllerModelFactory=new yn,this.handModelFactory=new zn,this.handBindings={...Rn},this.snapTurnAccumulator=0,this.onSnapTurn=null,this.onSmoothTurn=null,this.onRecenter=null,this.baseReferenceSpace=null,this.visibilityState="visible",this.supportsAnchors=!1,this.lastViewerPose=null,this.worldScale=this.options.worldScale,this.pendingFrameRate=null,this.dynamicResolutionEnabled=!1,this.controllerState={left:{connected:!1,squeezing:!1,selecting:!1,thumbstick:{x:0,y:0}},right:{connected:!1,squeezing:!1,selecting:!1,thumbstick:{x:0,y:0}}},this.onSessionStart=null,this.onSessionEnd=null,this.onControllerInput=null,this.handActionCallback=null,this.onVisibilityChange=null}async init(){const e=await En();return e.supported?(this.renderer.xr.enabled=!0,"function"==typeof this.renderer.xr.setFoveation&&void 0!==this.options.foveation&&this.renderer.xr.setFoveation(this.options.foveation),this.setupControllers(),!0):(console.warn("WebXR not supported:",e.reason),!1)}setupControllers(){const e=this.playerRig||this.scene,t=this.renderer.xr.getController(0);t.userData.handedness="left",this.setupControllerEvents(t,0),e.add(t),this.controllers.push(t);const n=this.renderer.xr.getController(1);n.userData.handedness="right",this.setupControllerEvents(n,1),e.add(n),this.controllers.push(n);const r=this.renderer.xr.getControllerGrip(0);e.add(r),this.controllerGrips.push(r);const s=this.renderer.xr.getControllerGrip(1);e.add(s),this.controllerGrips.push(s);try{const e=this.controllerModelFactory.createControllerModel(r);r.add(e);const t=this.controllerModelFactory.createControllerModel(s);s.add(t)}catch(o){console.warn("Controller model factory unavailable:",o),this.addControllerVisuals()}this.options.enableHands&&this.setupHands(e),this.options.allowRecenter&&this.renderer.xr.addEventListener("sessionstart",()=>{this.snapTurnAccumulator=0})}addControllerVisuals(){const e=new ye(.01,.02,.1,8),t=new F({color:4491519,emissive:2245768,emissiveIntensity:.3});this.controllers.forEach((n,r)=>{const s=new $(e,t);s.rotation.x=-Math.PI/2,n.add(s);const o=(new U).setFromPoints([new y(0,0,0),new y(0,0,-5)]),i=new O({color:4521864,transparent:!0,opacity:.5}),a=new X(o,i);n.add(a)})}setupHands(e){try{const t=this.renderer.xr.getHand(0);t.userData.handedness="left";const n=this.handModelFactory.createHandModel(t,"spheres");t.add(n),e.add(t),this.hands.push(t);const r=this.renderer.xr.getHand(1);r.userData.handedness="right";const s=this.handModelFactory.createHandModel(r,"spheres");r.add(s),e.add(r),this.hands.push(r),this.hands.forEach(e=>{e.addEventListener("pinchstart",()=>{this.dispatchHandAction("pinch",e.userData.handedness,"start")}),e.addEventListener("pinchend",()=>{this.dispatchHandAction("pinch",e.userData.handedness,"end")}),e.addEventListener("squeezestart",()=>{this.dispatchHandAction("squeeze",e.userData.handedness,"start")}),e.addEventListener("squeezeend",()=>{this.dispatchHandAction("squeeze",e.userData.handedness,"end")})})}catch(t){console.warn("Hand tracking not available:",t)}}setupControllerEvents(e,t){const n=0===t?"left":"right";e.addEventListener("connected",t=>{this.controllerState[n].connected=!0,e.userData.inputSource=t.data,t.data.handedness&&(e.userData.handedness=t.data.handedness),console.log(`Controller ${n} connected:`,t.data.handedness)}),e.addEventListener("disconnected",()=>{this.controllerState[n].connected=!1,console.log(`Controller ${n} disconnected`)}),e.addEventListener("selectstart",()=>{this.controllerState[n].selecting=!0,this.onControllerInput&&this.onControllerInput({type:"selectstart",hand:n,controller:e})}),e.addEventListener("selectend",()=>{this.controllerState[n].selecting=!1,this.onControllerInput&&this.onControllerInput({type:"selectend",hand:n,controller:e})}),e.addEventListener("squeezestart",()=>{this.controllerState[n].squeezing=!0,this.onControllerInput&&this.onControllerInput({type:"squeezestart",hand:n,controller:e})}),e.addEventListener("squeezeend",()=>{this.controllerState[n].squeezing=!1,this.onControllerInput&&this.onControllerInput({type:"squeezeend",hand:n,controller:e})})}async startSession(){try{const e={requiredFeatures:this.options.requiredFeatures,optionalFeatures:this.options.optionalFeatures};return this.session=await navigator.xr.requestSession("immersive-vr",e),this.isInVR=!0,this.renderer.xr.setSession(this.session),await this.configureRenderState(),this.baseReferenceSpace=await this.session.requestReferenceSpace("local-floor"),this.referenceSpace=this.baseReferenceSpace,this.supportsAnchors=void 0!==this.session?.requestReferenceSpace&&this.options.optionalFeatures.includes("anchors"),this.session.addEventListener("inputsourceschange",e=>{this.handleInputSourcesChange(e)}),this.session.addEventListener("visibilitychange",()=>{this.visibilityState=this.session.visibilityState,this.onVisibilityChange&&this.onVisibilityChange(this.visibilityState)}),this.session.addEventListener("end",()=>{this.isInVR=!1,this.session=null,this.onSessionEnd&&this.onSessionEnd()}),this.options.preferredFrameRate&&this.setPreferredFrameRate(this.options.preferredFrameRate),this.onSessionStart&&this.onSessionStart(),this.applyWorldScale(this.worldScale),console.log("VR session started"),!0}catch(e){return console.error("Failed to start VR session:",e),!1}}async configureRenderState(){if(!this.session)return;const e=this.renderer.getContext();e&&"function"==typeof e.makeXRCompatible&&await e.makeXRCompatible();const t={};this.options.framebufferScaleFactor&&(t.framebufferScaleFactor=this.options.framebufferScaleFactor);const n="undefined"!=typeof XRWebGLLayer?XRWebGLLayer:null;if(n)try{const r=new n(this.session,e,t);this.session.updateRenderState({baseLayer:r})}catch(r){console.warn("XRWebGLLayer configuration failed, using default:",r)}}async endSession(){this.session&&await this.session.end()}pollControllerInput(){const e=this.session||(this.renderer.xr.isPresenting?this.renderer.xr.getSession():null);if(!e)return;const t=e.inputSources;for(const n of t){if(!n.gamepad)continue;const e=n.handedness||"unknown";if("left"!==e&&"right"!==e)continue;const t=n.gamepad;if(t.axes.length>=2){const n=t.axes.length>=4&&(Math.abs(t.axes[2])>.01||Math.abs(t.axes[3])>.01)?t.axes[2]:t.axes[0],r=t.axes.length>=4&&(Math.abs(t.axes[2])>.01||Math.abs(t.axes[3])>.01)?t.axes[3]:t.axes[1];this.controllerState[e].thumbstick={x:n||0,y:r||0},"left"!==e&&"right"!==e||this.handleTurnInput(e)}t.buttons.length>4&&(this.controllerState[e].primaryButton=t.buttons[4]?.pressed||!1,this.controllerState[e].secondaryButton=t.buttons[5]?.pressed||!1)}return this.controllerState}async triggerHaptic(e,t=.5,n=100){const r=this.session||(this.renderer.xr.isPresenting?this.renderer.xr.getSession():null);if(!r)return;const s=r.inputSources;for(const i of s)if(i.handedness===e&&i.gamepad){const e=i.gamepad;if("function"==typeof e.getHapticActuator)try{const r=e.getHapticActuator(0);if(r)return void(await r.pulse(t*this.options.hapticsIntensity,n))}catch(o){}if(e.vibrationActuator)try{return void(await e.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:n,weakMagnitude:.5*t*this.options.hapticsIntensity,strongMagnitude:t*this.options.hapticsIntensity}))}catch(o){}if(e.hapticActuators&&e.hapticActuators[0])try{await e.hapticActuators[0].pulse(t*this.options.hapticsIntensity,n)}catch(o){}}}getControllerPosition(e){const t="left"===e?0:1,n=this.controllers[t];if(!n)return null;const r=new y;return n.getWorldPosition(r),r}getControllerDirection(e){const t="left"===e?0:1,n=this.controllers[t];if(!n)return null;const r=new y(0,0,-1);return n.getWorldDirection(r),r}handleInputSourcesChange(e){e.added?.forEach(e=>{e.hand&&this.options.enableHands&&this.registerHandSource(e)}),e.removed?.forEach(e=>{e.hand&&this.unregisterHandSource(e)})}registerHandSource(e){const t="left"===e.handedness?this.hands[0]:this.hands[1];t&&(t.userData.inputSource=e)}unregisterHandSource(e){const t=e.handedness;this.hands.forEach(e=>{e.userData.handedness===t&&(e.userData.inputSource=null)})}dispatchHandAction(e,t,n){if(!this.handActionCallback)return;const r=this.handBindings?.[t]?.[e];r&&this.handActionCallback({action:r,hand:t,phase:n})}setHandBindings(e){this.handBindings={left:{...Rn.left,...e?.left||{}},right:{...Rn.right,...e?.right||{}}}}onHandAction(e){this.handActionCallback=e}setComfortOptions(e={}){this.options={...this.options,...e}}setPreferredFrameRate(e){this.pendingFrameRate=e,this.session?.updateTargetFrameRate&&this.session.updateTargetFrameRate(e).catch(e=>{console.warn("Preferred frame rate unsupported:",e)})}enableDynamicResolution(e,t=.75,n=1.15){this.dynamicResolutionEnabled=e,this.dynamicResolutionRange={minScale:t,maxScale:n}}applyDynamicResolution(e){if(!this.dynamicResolutionEnabled)return;if(!this.renderer.xr.isPresenting)return;const t=1e3/(this.pendingFrameRate||72),n=.15*t;e>t+n?(this.options.framebufferScaleFactor=Math.max(this.dynamicResolutionRange.minScale,this.options.framebufferScaleFactor-.05),this.configureRenderState()):e<t-n&&(this.options.framebufferScaleFactor=Math.min(this.dynamicResolutionRange.maxScale,this.options.framebufferScaleFactor+.05),this.configureRenderState())}update(e,t){if(!t)return;const n=t.getViewerPose(this.referenceSpace);n&&(this.lastViewerPose=n)}handleTurnInput(e){if(!this.options.snapTurn&&!this.onSmoothTurn)return;const t=this.controllerState[e];if(!t)return;const n=t.thumbstick?.x||0;if(Math.abs(n)<.2)this.snapTurnAccumulator=0;else if(this.options.snapTurn){const t=Math.sign(n);if(this.snapTurnAccumulator+=n,Math.abs(this.snapTurnAccumulator)>=.8){const n=t*this.options.snapAngle;this.onSnapTurn&&this.onSnapTurn(n,e),this.snapTurnAccumulator=0}}else if(this.onSmoothTurn){const t=n*this.options.smoothTurnSpeed;this.onSmoothTurn(t,e)}}setSnapTurnHandler(e){this.onSnapTurn=e}setSmoothTurnHandler(e){this.onSmoothTurn=e}setRecenterHandler(e){this.onRecenter=e}recenter(e=new y,t=new y(0,0,-1)){if(this.baseReferenceSpace)try{const n=new XRRigidTransform({x:-e.x,y:-e.y,z:-e.z},this.vectorToQuaternion(t));this.referenceSpace=this.baseReferenceSpace.getOffsetReferenceSpace(n),this.onRecenter&&this.onRecenter()}catch(n){console.warn("Recentering failed:",n)}}vectorToQuaternion(e){const t=e.clone().normalize(),n=new y(0,1,0),r=(new y).crossVectors(n,t).normalize();n.crossVectors(t,r);const s=(new x).makeBasis(r,n,t),o=(new v).setFromRotationMatrix(s);return{x:o.x,y:o.y,z:o.z,w:o.w}}applyWorldScale(e=1){this.worldScale=e,this.playerRig&&this.playerRig.scale.setScalar(e)}dispose(){this.controllers.forEach(e=>{e.removeFromParent()}),this.controllerGrips.forEach(e=>{e.removeFromParent()}),this.hands.forEach(e=>{e.removeFromParent()}),this.controllers=[],this.controllerGrips=[],this.hands=[]}}const Dn=[{name:"Plain Cheese",price:12.99,emoji:"üßÄ",description:"Lucky you! Just a basic cheese pizza."},{name:"Pepperoni",price:14.99,emoji:"üçï",description:"Classic pepperoni - not too bad."},{name:"Hawaiian",price:15.99,emoji:"üçç",description:"Pineapple lovers hate you now."},{name:"Veggie Supreme",price:16.99,emoji:"ü•¨",description:"All those veggies... wasted!"},{name:"Meat Lovers",price:18.99,emoji:"ü•ì",description:"So much meat... gone forever."},{name:"BBQ Chicken",price:17.99,emoji:"üçó",description:"That BBQ sauce is everywhere now!"},{name:"Supreme Deluxe",price:21.99,emoji:"üëë",description:"The EXPENSIVE one! Boss is MAD!"},{name:"Truffle Special",price:24.99,emoji:"üçÑ",description:"TRUFFLE?! That costs a fortune!"},{name:"Lobster & Gold Leaf",price:49.99,emoji:"ü¶û",description:"OH NO! The $50 LUXURY PIZZA! You're in DEEP trouble!"}],Mn=[{id:"cheese_lover",name:"Cheese Lover",emoji:"üßÄ",description:"Delivered 25 Plain Cheese pizzas",pizzaType:"Plain Cheese",required:25},{id:"cheese_king",name:"Cheese King",emoji:"üßÄüëë",description:"Delivered 100 Plain Cheese pizzas",pizzaType:"Plain Cheese",required:100},{id:"pepperoni_pro",name:"Pepperoni Pro",emoji:"üçï",description:"Delivered 25 Pepperoni pizzas",pizzaType:"Pepperoni",required:25},{id:"pepperoni_legend",name:"Pepperoni Legend",emoji:"üçïüî•",description:"Delivered 100 Pepperoni pizzas",pizzaType:"Pepperoni",required:100},{id:"hawaiian_hero",name:"Hawaiian Hero",emoji:"üçç",description:"Delivered 25 Hawaiian pizzas",pizzaType:"Hawaiian",required:25},{id:"pineapple_defender",name:"Pineapple Defender",emoji:"üççüõ°Ô∏è",description:"Delivered 100 Hawaiian pizzas - You embrace the controversy!",pizzaType:"Hawaiian",required:100},{id:"veggie_friend",name:"Veggie Friend",emoji:"ü•¨",description:"Delivered 25 Veggie Supreme pizzas",pizzaType:"Veggie Supreme",required:25},{id:"green_machine",name:"Green Machine",emoji:"ü•¨üíö",description:"Delivered 100 Veggie Supreme pizzas",pizzaType:"Veggie Supreme",required:100},{id:"carnivore",name:"Carnivore",emoji:"ü•ì",description:"Delivered 25 Meat Lovers pizzas",pizzaType:"Meat Lovers",required:25},{id:"meat_master",name:"Meat Master",emoji:"ü•ìüèÜ",description:"Delivered 100 Meat Lovers pizzas",pizzaType:"Meat Lovers",required:100},{id:"bbq_boss",name:"BBQ Boss",emoji:"üçó",description:"Delivered 25 BBQ Chicken pizzas",pizzaType:"BBQ Chicken",required:25},{id:"grill_master",name:"Grill Master",emoji:"üçóüî•",description:"Delivered 100 BBQ Chicken pizzas",pizzaType:"BBQ Chicken",required:100},{id:"supreme_server",name:"Supreme Server",emoji:"üëë",description:"Delivered 25 Supreme Deluxe pizzas",pizzaType:"Supreme Deluxe",required:25},{id:"deluxe_deity",name:"Deluxe Deity",emoji:"üëë‚ú®",description:"Delivered 100 Supreme Deluxe pizzas",pizzaType:"Supreme Deluxe",required:100},{id:"truffle_hunter",name:"Truffle Hunter",emoji:"üçÑ",description:"Delivered 15 Truffle Special pizzas",pizzaType:"Truffle Special",required:15},{id:"truffle_tycoon",name:"Truffle Tycoon",emoji:"üçÑüíé",description:"Delivered 50 Truffle Special pizzas",pizzaType:"Truffle Special",required:50},{id:"luxury_courier",name:"Luxury Courier",emoji:"ü¶û",description:"Delivered 10 Lobster & Gold Leaf pizzas",pizzaType:"Lobster & Gold Leaf",required:10},{id:"golden_god",name:"Golden God",emoji:"ü¶ûüåü",description:"Delivered 25 Lobster & Gold Leaf pizzas - The elite!",pizzaType:"Lobster & Gold Leaf",required:25}],Cn=[{id:"first_delivery",name:"First Flight",emoji:"üõ´",description:"Completed your first delivery!",deliveries:1},{id:"getting_started",name:"Getting Started",emoji:"üì¶",description:"Completed 10 deliveries",deliveries:10},{id:"on_a_roll",name:"On a Roll",emoji:"üéØ",description:"Completed 50 deliveries",deliveries:50},{id:"century",name:"Century Club",emoji:"üíØ",description:"Completed 100 deliveries",deliveries:100},{id:"pizza_veteran",name:"Pizza Veteran",emoji:"üéñÔ∏è",description:"Completed 250 deliveries",deliveries:250},{id:"delivery_legend",name:"Delivery Legend",emoji:"üèÜ",description:"Completed 500 deliveries",deliveries:500},{id:"pizza_immortal",name:"Pizza Immortal",emoji:"‚ö°",description:"Completed 1000 deliveries",deliveries:1e3}],jn=[{id:"first_perfect",name:"Flawless",emoji:"‚≠ê",description:"First perfect delivery!",perfectDeliveries:1},{id:"perfectionist",name:"Perfectionist",emoji:"üåü",description:"10 perfect deliveries",perfectDeliveries:10},{id:"untouchable",name:"Untouchable",emoji:"üí´",description:"50 perfect deliveries",perfectDeliveries:50},{id:"god_tier",name:"God Tier",emoji:"‚ú®",description:"100 perfect deliveries - You are a master!",perfectDeliveries:100}],Pn=[{id:"speed_demon",name:"Speed Demon",emoji:"‚ö°",description:"Delivered in under 20 seconds",fastestTime:20},{id:"lightning",name:"Lightning Fast",emoji:"üå©Ô∏è",description:"Delivered in under 15 seconds",fastestTime:15},{id:"time_bender",name:"Time Bender",emoji:"‚è±Ô∏è",description:"Delivered in under 10 seconds - Are you hacking?!",fastestTime:10}],In=[{id:"first_hundred",name:"First $100",emoji:"üíµ",description:"Earned $100 in tips",totalTips:100},{id:"high_roller",name:"High Roller",emoji:"üí∞",description:"Earned $500 in tips",totalTips:500},{id:"tip_tycoon",name:"Tip Tycoon",emoji:"ü§ë",description:"Earned $1000 in tips",totalTips:1e3},{id:"pizza_millionaire",name:"Pizza Millionaire",emoji:"üíé",description:"Earned $5000 in tips - Rolling in dough!",totalTips:5e3}],Ln=["James","Mary","John","Patricia","Robert","Jennifer","Michael","Linda","David","Elizabeth","William","Barbara","Richard","Susan","Joseph","Jessica","Thomas","Sarah","Christopher","Karen","Charles","Lisa","Daniel","Nancy","Matthew","Betty","Anthony","Margaret","Mark","Sandra","Donald","Ashley","Steven","Kimberly","Paul","Emily","Andrew","Donna","Joshua","Michelle","Kevin","Dorothy","Brian","Carol","George","Amanda","Timothy","Melissa","Ronald","Deborah","Jason","Stephanie","Edward","Rebecca","Jeffrey","Sharon","Ryan","Laura","Jacob","Cynthia","Gary","Kathleen","Nicholas","Amy","Eric","Angela","Jonathan","Shirley","Stephen","Anna","Larry","Brenda","Justin","Pamela","Scott","Emma","Brandon","Nicole","Benjamin","Helen","Samuel","Samantha","Gregory","Katherine","Alexander","Christine","Frank","Debra","Patrick","Rachel","Raymond","Carolyn","Jack","Janet","Dennis","Catherine","Jerry","Maria","Tyler","Heather"],_n=["Smith","Johnson","Williams","Brown","Jones","Garcia","Miller","Davis","Rodriguez","Martinez","Hernandez","Lopez","Gonzalez","Wilson","Anderson","Thomas","Taylor","Moore","Jackson","Martin","Lee","Perez","Thompson","White","Harris","Sanchez","Clark","Ramirez","Lewis","Robinson","Walker","Young","Allen","King","Wright","Scott","Torres","Nguyen","Hill","Flores","Green","Adams","Nelson","Baker","Hall","Rivera","Campbell","Mitchell","Carter","Roberts","Gomez","Phillips","Evans","Turner","Diaz","Parker","Cruz","Edwards","Collins","Reyes","Stewart","Morris","Morales","Murphy","Cook","Rogers","Gutierrez","Ortiz","Morgan","Cooper","Peterson","Bailey","Reed","Kelly","Howard","Ramos","Kim","Cox","Ward","Richardson","Watson","Brooks","Chavez","Wood","James","Bennett","Gray","Mendoza","Ruiz","Hughes","Price","Alvarez","Castillo","Sanders","Patel","Myers","Long","Ross","Foster","Jimenez"],Nn=[{name:"Trainee",emoji:"üê£",minXP:0,tipBonus:0,color:"#888888"},{name:"Rookie Pilot",emoji:"üõ´",minXP:100,tipBonus:.05,color:"#66bb6a"},{name:"Delivery Driver",emoji:"üöó",minXP:300,tipBonus:.1,color:"#42a5f5"},{name:"Pizza Pro",emoji:"üçï",minXP:600,tipBonus:.15,color:"#ab47bc"},{name:"Sky Captain",emoji:"‚úàÔ∏è",minXP:1e3,tipBonus:.2,color:"#ff7043"},{name:"Elite Flyer",emoji:"ü¶Ö",minXP:1500,tipBonus:.25,color:"#ffd54f"},{name:"Pizza Master",emoji:"üë®‚Äçüç≥",minXP:2200,tipBonus:.3,color:"#e91e63"},{name:"Drone Legend",emoji:"üèÜ",minXP:3e3,tipBonus:.35,color:"#ff9800"},{name:"Pizza Emperor",emoji:"üëë",minXP:4e3,tipBonus:.4,color:"#f44336"},{name:"PIZZA GOD",emoji:"üåü",minXP:5500,tipBonus:.5,color:"#ffd700"}],On=e=>{for(let t=Nn.length-1;t>=0;t--)if(e>=Nn[t].minXP)return Nn[t];return Nn[0]},Fn=(e,t,n,r,s)=>{if(s)return-150;let o=0;return e>=4.8?(o=50,r&&(o=75)):o=e>=4.5?40:e>=4?30:e>=3.5?20:e>=3?10:e>=2.5?0:e>=2?-25:-50,n<30&&o>0?o+=15:n<45&&o>0?o+=10:n<60&&o>0&&(o+=5),n>=90?(o=Math.min(o,0),o-=30):n>=120&&(o-=50),t<70?o-=20:t<50&&(o-=40),o<0&&(o=Math.floor(1.5*o)),o},Bn=(e,t,n)=>{if(e.name===t.name)return null;if(n){const e=[`üéâ PROMOTED to ${t.emoji} ${t.name}! Tips +${Math.round(100*t.tipBonus)}%!`,`üìà RANK UP! You're now a ${t.emoji} ${t.name}! More tips incoming!`,`üåü NICE! ${t.emoji} ${t.name} unlocked! +${Math.round(100*t.tipBonus)}% tip bonus!`,`üöÄ LEVEL UP! Welcome to ${t.emoji} ${t.name}! Tips are getting BIGGER!`];return e[Math.floor(Math.random()*e.length)]}{const e=[`üìâ DEMOTED to ${t.emoji} ${t.name}... Tips reduced to +${Math.round(100*t.tipBonus)}%`,`üò∞ RANK DOWN! Back to ${t.emoji} ${t.name}. Gotta do better!`,`üíî OUCH! Dropped to ${t.emoji} ${t.name}. Less tips now...`,`üîª Demoted to ${t.emoji} ${t.name}. The grind continues...`];return e[Math.floor(Math.random()*e.length)]}},Hn="pizzaExpress_totalWages",Gn="pizzaExpress_totalDeliveries",Un="pizzaExpress_totalDestroyed",Wn="pizzaExpress_bestTime",$n="pizzaExpress_playerName",Vn="pizzaExpress_xp",Xn="pizzaExpress_badges",Kn="pizzaExpress_pizzaTypeDeliveries",qn="pizzaExpress_perfectDeliveries",Yn="pizzaExpress_totalTips",Zn="pizzaExpress_fastestDelivery",Jn="pizzaExpress_storeEarnings",Qn="pizzaExpress_gamepadBindings",er={fastest_delivery:[{rank:1,name:"SpeedDemon",value:12.5,unit:"s"},{rank:2,name:"PizzaPro",value:14.2,unit:"s"},{rank:3,name:"DroneKing",value:15.8,unit:"s"},{rank:4,name:"FastFlyer",value:16.1,unit:"s"},{rank:5,name:"QuickPizza",value:17.3,unit:"s"}],most_deliveries:[{rank:1,name:"Grinder99",value:1523,unit:""},{rank:2,name:"NeverStop",value:1201,unit:""},{rank:3,name:"PizzaBot",value:998,unit:""},{rank:4,name:"Delivery4Life",value:876,unit:""},{rank:5,name:"DroneQueen",value:754,unit:""}],store_earnings:[{rank:1,name:"PizzaTycoon",value:125420,unit:"$"},{rank:2,name:"DeliveryKing",value:98300,unit:"$"},{rank:3,name:"PizzaBoss",value:76800,unit:"$"},{rank:4,name:"TopContributor",value:54650,unit:"$"},{rank:5,name:"StoreHelper",value:32200,unit:"$"}],perfect_pizzas:[{rank:1,name:"SteadyHands",value:892,unit:""},{rank:2,name:"Perfectionist",value:756,unit:""},{rank:3,name:"NoSpill",value:623,unit:""},{rank:4,name:"CarefulOne",value:589,unit:""},{rank:5,name:"GentlePilot",value:512,unit:""}],most_dropped_pizzas:[{rank:1,name:"ButterFingers",value:247,unit:"üçïüí®"},{rank:2,name:"OopsieDoopsie",value:198,unit:"üçïüí®"},{rank:3,name:"Clumsy Carl",value:156,unit:"üçïüí®"},{rank:4,name:"WhoopsieDaisy",value:134,unit:"üçïüí®"},{rank:5,name:"PizzaChaos",value:112,unit:"üçïüí®"}],bestRating:[{rank:1,name:"PerfectPilot",value:5,unit:"‚≠ê"},{rank:2,name:"SteadyEddy",value:4.9,unit:"‚≠ê"},{rank:3,name:"CarefulCarl",value:4.8,unit:"‚≠ê"},{rank:4,name:"GentleGina",value:4.7,unit:"‚≠ê"},{rank:5,name:"SmoothOp",value:4.6,unit:"‚≠ê"}],total_wages:[{rank:1,name:"MoneyMaker",value:1250.5,unit:"$"},{rank:2,name:"TipKing",value:980.25,unit:"$"},{rank:3,name:"PizzaPro",value:756,unit:"$"},{rank:4,name:"SteadyEarner",value:543.75,unit:"$"},{rank:5,name:"JustStarted",value:125,unit:"$"},{rank:6,name:"BreakingEven",value:0,unit:"$"},{rank:7,name:"OopsMyBad",value:-45.5,unit:"$"},{rank:8,name:"PizzaCrasher",value:-156.97,unit:"$"},{rank:9,name:"PizzaFumbler",value:-378.9,unit:"$"},{rank:10,name:"OwesTheBoss",value:-892.45,unit:"$"}],daily_earnings:[{rank:1,name:"TodaysBest",value:450,unit:"$"},{rank:2,name:"DailyGrind",value:380,unit:"$"},{rank:3,name:"MorningRush",value:320,unit:"$"},{rank:4,name:"AfternoonAce",value:290,unit:"$"},{rank:5,name:"NightOwl",value:245,unit:"$"}]},tr=(e,t)=>{let n=0;n=e>=99?3:e>=90?2.7:e>=80?2.4:e>=70?2:e>=60?1.5:e>=50?1:e>=40?.7:.5;let r=0;return r=t<30?2:t<45?1.7:t<60?1.3:t<90?.8:t<120?.3:0,Math.min(5,n+r)},nr=(e,t,n,r)=>{const s=new Y,o=new ze(e,t),i=new H({color:4352}),a=new $(o,i);s.add(a);const l=document.createElement("canvas");l.width=256,l.height=128;const c=l.getContext("2d"),d=new we(l),p=new H({map:d,transparent:!0,side:B}),u=new $(new ze(.9*e,.9*t),p);return u.position.z=.001,s.add(u),s.userData.canvas=l,s.userData.ctx=c,s.userData.texture=d,s.userData.label=r,rr(s,n),s},rr=(e,t)=>{if(!e.userData.canvas)return;const n=e.userData.canvas,r=e.userData.ctx,s=e.userData.texture,o=e.userData.label||"";r.fillStyle="#001100",r.fillRect(0,0,n.width,n.height),r.fillStyle="#00aa00",r.font="bold 20px monospace",r.textAlign="center",r.fillText(o,n.width/2,30),r.fillStyle="#00ff00",r.font="bold 36px monospace",r.fillText(t,n.width/2,80),s.needsUpdate=!0},sr=(e,t,n="#ffffff")=>{if(!e.userData.canvas)return;const r=e.userData.canvas,s=e.userData.ctx,o=e.userData.texture,i=e.userData.fontSize||24;s.clearRect(0,0,r.width,r.height),s.fillStyle=n,s.font=`bold ${i}px Arial`,s.textAlign="center",s.textBaseline="middle",s.fillText(t,r.width/2,r.height/2),o.needsUpdate=!0},or=({score:e,pizzasDelivered:t,pizzasDestroyed:n,currentOrder:r,pilotMode:s,cameraView:o,pizzaHealth:i,playerStats:a,dronePosition:l,currentPizzaType:c})=>{const d=r?qe.find(e=>e.num===r.base):null,p=void 0!==a?.xp?(e=>{const t=On(e),n=Nn.findIndex(e=>e.name===t.name);if(n>=Nn.length-1)return{nextRank:null,xpNeeded:0,progress:100};const r=Nn[n+1],s=e-t.minXP,o=r.minXP-t.minXP,i=Math.min(100,s/o*100);return{nextRank:r,xpNeeded:r.minXP-e,progress:i}})(a.xp):null,u=a?.rank;return $e.jsxs("div",{style:{position:"absolute",top:20,left:20,color:"white",fontFamily:"Arial, sans-serif",fontSize:"18px",background:"rgba(0,0,0,0.7)",padding:"15px",borderRadius:"10px",minWidth:"300px",backdropFilter:"blur(5px)"},children:[$e.jsx("div",{style:{marginBottom:"10px",fontSize:"24px",fontWeight:"bold",color:"#FFD700"},children:"üçï Pizza Express VR"}),$e.jsxs("div",{style:{color:e<0?"#ff4444":"#00ff00"},children:["üíµ Wages: ",e<0?`-$${Math.abs(e).toFixed(2)}`:`$${e.toFixed(2)}`,e<0&&$e.jsx("span",{style:{fontSize:"12px",marginLeft:"5px"},children:"üò¨ IN DEBT!"})]}),$e.jsxs("div",{children:["üì¶ Deliveries: ",t]}),n>0&&$e.jsxs("div",{style:{color:"#ff6666"},children:["üí® Dropped: ",n]}),$e.jsxs("div",{style:{marginTop:"8px",padding:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"5px"},children:[$e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[$e.jsx("span",{style:{fontSize:"20px"},children:u?.emoji||"üê£"}),$e.jsx("span",{style:{color:u?.color||"#888"},children:u?.name||"Trainee"}),u?.tipBonus>0&&$e.jsxs("span",{style:{fontSize:"12px",background:"rgba(0,255,100,0.3)",padding:"2px 6px",borderRadius:"3px",color:"#00ff88"},children:["+",Math.round(100*u.tipBonus),"% tips"]})]}),p&&p.nextRank&&$e.jsxs("div",{style:{marginTop:"5px"},children:[$e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#aaa",marginBottom:"2px"},children:[$e.jsxs("span",{children:["XP: ",a.xp]}),$e.jsxs("span",{children:["Next: ",p.nextRank.emoji," ",p.nextRank.name," (",p.xpNeeded," XP)"]})]}),$e.jsx("div",{style:{height:"6px",background:"rgba(255,255,255,0.2)",borderRadius:"3px",overflow:"hidden"},children:$e.jsx("div",{style:{height:"100%",width:`${p.progress}%`,background:`linear-gradient(90deg, ${u?.color||"#888"}, ${p.nextRank.color})`,borderRadius:"3px",transition:"width 0.3s ease"}})})]}),p&&!p.nextRank&&$e.jsx("div",{style:{fontSize:"10px",color:"#ffd700",marginTop:"3px"},children:"üåü MAX RANK! PIZZA GOD!"})]}),r&&$e.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(255,215,0,0.2)",borderRadius:"5px"},children:[$e.jsx("div",{style:{fontWeight:"bold",color:"#FFD700"},children:"Current Order:"}),r.customerName&&$e.jsxs("div",{style:{fontSize:"14px",color:"#00ff88",marginBottom:"5px"},children:["üë§ ",r.customerName]}),c&&$e.jsxs("div",{style:{fontSize:"14px",color:c.price>=25?"#ff6666":"#ffcc00",marginBottom:"5px"},children:[c.emoji," ",c.name,$e.jsxs("span",{style:{fontSize:"12px",marginLeft:"5px"},children:["($",c.price.toFixed(2),")"]}),c.price>=25&&$e.jsx("span",{children:" ‚ö†Ô∏è"})]}),$e.jsxs("div",{children:["üöÅ Drone: ",r.drone]}),$e.jsxs("div",{children:["üè¢ Base: #",r.base]}),d&&$e.jsxs("div",{style:{fontSize:"12px",color:"#aaa"},children:["üìç Rooftop: (",d.x,", ",d.z,")"]})]}),s&&l&&$e.jsxs("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(0,150,255,0.2)",borderRadius:"5px",fontSize:"14px"},children:[$e.jsx("div",{style:{color:"#00aaff"},children:"üìç Drone Position:"}),$e.jsxs("div",{children:["X: ",l.x?.toFixed(1)," | Z: ",l.z?.toFixed(1)]}),$e.jsxs("div",{children:["Alt: ",l.y?.toFixed(1),"m"]}),d&&$e.jsxs("div",{style:{marginTop:"5px",color:"#00ff88"},children:["üéØ Land on Roof: (",d.x,", ",d.z,")"]})]}),s&&$e.jsxs("div",{style:{marginTop:"10px",fontSize:"14px",color:"#aaa"},children:["Camera: ","pov"===o?"POV":"overhead"===o?"Overhead":"Third Person"," (V to switch)"]})]})},ir=({pizzaHealth:e,pizzaTilt:t})=>{const n=()=>e>=80?"#00ff00":e>=50?"#ffff00":e>=25?"#ff9900":"#ff0000",r=e<100;return $e.jsxs("div",{style:{position:"absolute",bottom:80,left:20,background:r?"rgba(80,0,0,0.7)":"rgba(0,0,0,0.5)",padding:"8px 12px",borderRadius:"8px",color:"white",fontFamily:"Arial, sans-serif",border:r?"1px solid #ff4444":"1px solid #333",transition:"all 0.3s"},children:[$e.jsx("div",{style:{fontSize:"10px",marginBottom:"4px",color:"#aaa"},children:"üçï PIZZA"}),$e.jsx("div",{style:{width:"120px",height:"8px",background:"#333",borderRadius:"4px",overflow:"hidden"},children:$e.jsx("div",{style:{width:`${e}%`,height:"100%",background:n(),transition:"width 0.2s"}})}),$e.jsxs("div",{style:{fontSize:"10px",marginTop:"3px",display:"flex",justifyContent:"space-between"},children:[$e.jsx("span",{style:{color:n()},children:e>=80?"‚úì Good":e>=50?"‚ö† Tilted":"‚ö† Damaged"}),$e.jsxs("span",{style:{color:"#666"},children:[Math.round(e),"%"]})]})]})},ar=({speed:e,isWarning:t,pizzaHealth:n})=>{const r=Math.min(100,e/12*100),s=()=>e<7?"#00ff00":e<8.5?"#ffaa00":"#ff0000",o=e>=8.5;return $e.jsxs("div",{style:{position:"absolute",bottom:20,left:20,background:o?"rgba(100,0,0,0.7)":"rgba(0,0,0,0.6)",padding:"8px 12px",borderRadius:"8px",color:"white",fontFamily:"Arial, sans-serif",border:o?"2px solid #ff0000":"1px solid #444",transition:"all 0.2s",minWidth:"140px"},children:[$e.jsx("div",{style:{fontSize:"10px",marginBottom:"4px",color:"#aaa"},children:"üö∂ SPEED"}),$e.jsx("div",{style:{width:"120px",height:"8px",background:"#333",borderRadius:"4px",overflow:"hidden",position:"relative"},children:$e.jsx("div",{style:{width:`${r}%`,height:"100%",background:s(),transition:"width 0.1s"}})}),$e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"3px",fontSize:"10px"},children:[$e.jsx("span",{style:{color:s(),fontWeight:"bold"},children:e<7?"‚úì SAFE":e<8.5?"‚ö† CAREFUL":"üî• TOO FAST!"}),$e.jsx("span",{style:{color:"#666"},children:e.toFixed(1)})]})]})},lr=({dronePosition:e,targetBase:t,currentOrder:n,altitude:r,verticalSpeed:s})=>{if(!e||!t)return null;const o=t.x-e.x,i=t.z-e.z,a=Math.max(-50,Math.min(50,2*o)),l=Math.max(-40,Math.min(40,2*i)),c=r||1.5,d=Math.min(100,c/50*100),p=s||0;return $e.jsxs("div",{style:{position:"absolute",top:20,right:20,width:"220px",background:"rgba(0,0,0,0.85)",border:"2px solid #00ff00",borderRadius:"10px",padding:"10px"},children:[$e.jsx("div",{style:{color:"#00ff00",fontSize:"12px",fontWeight:"bold",marginBottom:"5px",textAlign:"center"},children:"üì° GPS NAVIGATION"}),$e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[$e.jsxs("div",{style:{position:"relative",width:"120px",height:"100px",background:"rgba(0,50,0,0.5)",borderRadius:"5px"},children:[$e.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:"8px",height:"8px",background:"#00ff00",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"blink 1s infinite",boxShadow:"0 0 8px #00ff00"}}),$e.jsx("div",{style:{position:"absolute",left:`calc(50% + ${a}px)`,top:`calc(50% + ${l}px)`,width:"10px",height:"10px",background:"#ff0000",borderRadius:"50%",transform:"translate(-50%, -50%)",border:"2px solid #fff",animation:"pulse 0.5s infinite"}}),$e.jsx("svg",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none"},children:$e.jsx("line",{x1:"50%",y1:"50%",x2:`calc(50% + ${a}px)`,y2:`calc(50% + ${l}px)`,stroke:"#00ff00",strokeWidth:"1",strokeDasharray:"4,4",opacity:"0.5"})})]}),$e.jsxs("div",{style:{width:"60px",display:"flex",flexDirection:"column",alignItems:"center"},children:[$e.jsx("div",{style:{color:"#00ff00",fontSize:"10px",marginBottom:"3px"},children:"ALTITUDE"}),$e.jsxs("div",{style:{width:"20px",height:"70px",background:"rgba(0,50,0,0.8)",border:"1px solid #00ff00",borderRadius:"3px",position:"relative",overflow:"hidden"},children:[$e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:`${d}%`,background:`linear-gradient(to top, #004400, ${c>30?"#ffaa00":"#00ff00"})`,transition:"height 0.1s"}}),[10,20,30,40].map(e=>$e.jsx("div",{style:{position:"absolute",bottom:e/50*100+"%",left:0,right:0,borderTop:"1px dashed rgba(0,255,0,0.3)"}},e))]}),$e.jsxs("div",{style:{color:"#00ff00",fontSize:"14px",fontWeight:"bold",marginTop:"3px"},children:[c.toFixed(1),"m"]}),$e.jsxs("div",{style:{color:Math.abs(p)<.5?"#888888":p>0?"#00ff00":"#ff6600",fontSize:"16px",marginTop:"2px"},children:[Math.abs(p)<.5?"‚óè":p>0?"‚ñ≤":"‚ñº",$e.jsx("span",{style:{fontSize:"10px",marginLeft:"2px"},children:Math.abs(p).toFixed(1)})]})]})]}),$e.jsxs("div",{style:{color:"#00ff00",fontSize:"11px",textAlign:"center",marginTop:"5px"},children:["üéØ Base ",n?.base]})]})},cr=({distanceToBase:e,canRelease:t,canDescend:n,horizontalDist:r,altitude:s})=>{if(null===e||e>=50)return null;const o=t?{color:"#00ff00",message:"‚úì RELEASE ZONE",subMessage:"Press SPACE to Release Pizza!",pulse:!0}:n?{color:"#00ff00",message:"‚¨áÔ∏è DESCEND NOW",subMessage:`Centered! Land on roof (Alt: ${s?.toFixed(1)||"?"}m ‚Üí 7m)`,pulse:!0}:null!==r?r<5?{color:"#ffff00",message:`‚ÜîÔ∏è ${r.toFixed(1)}m off center`,subMessage:"Get directly OVER the beacon!",pulse:!1}:{color:"#ff9900",message:`üéØ ${Math.floor(e)}m to target`,subMessage:"Fly toward the beacon",pulse:!1}:{color:"#ff6600",message:`${Math.floor(e)}m`,subMessage:"Approach Base",pulse:!1};return $e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"42px",fontWeight:"bold",color:o.color,textShadow:"0 0 20px rgba(0,0,0,0.8)",animation:o.pulse?"pulse 0.5s infinite":"none",pointerEvents:"none",textAlign:"center"},children:[o.message,$e.jsx("div",{style:{fontSize:"16px",marginTop:"5px",color:o.color},children:o.subMessage})]})},dr=({message:e})=>$e.jsx("div",{style:{position:"absolute",bottom:120,left:"50%",transform:"translateX(-50%)",color:"white",fontFamily:"Arial, sans-serif",fontSize:"16px",background:"rgba(0,100,200,0.85)",padding:"12px 20px",borderRadius:"10px",maxWidth:"500px",textAlign:"center",backdropFilter:"blur(5px)"},children:e}),pr=({step:e,onNext:t,onSkip:n})=>{const r=Je[e];return r?$e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:100},children:$e.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",padding:"30px",borderRadius:"15px",maxWidth:"450px",textAlign:"center",color:"white",border:"2px solid #00ff00",boxShadow:"0 0 30px rgba(0,255,0,0.3)"},children:[$e.jsxs("div",{style:{fontSize:"14px",color:"#00ff00",marginBottom:"10px"},children:["Step ",e+1," of ",Je.length]}),$e.jsx("h2",{style:{color:"#FFD700",marginBottom:"15px",fontSize:"24px"},children:r.title}),$e.jsx("p",{style:{fontSize:"16px",lineHeight:"1.6",marginBottom:"25px"},children:r.message}),$e.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center"},children:[$e.jsx("button",{onClick:n,style:{padding:"10px 20px",background:"#444",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:"Skip Tutorial"}),$e.jsx("button",{onClick:t,style:{padding:"10px 30px",background:"#00ff00",color:"#000",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:e<Je.length-1?"Next ‚Üí":"Start Playing!"})]})]})}):null},ur=()=>$e.jsxs("div",{style:{position:"absolute",bottom:70,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.8)",color:"white",padding:"10px 20px",borderRadius:"8px",fontFamily:"Arial, sans-serif",fontSize:"13px"},children:[$e.jsx("span",{style:{color:"#FFD700"},children:"W"}),": Forward |",$e.jsx("span",{style:{color:"#FFD700"},children:" S"}),": Back |",$e.jsx("span",{style:{color:"#FFD700"},children:" A/D"}),": Turn |",$e.jsx("span",{style:{color:"#FFD700"},children:" Space"}),": Up |",$e.jsx("span",{style:{color:"#FFD700"},children:" Shift"}),": Down |",$e.jsx("span",{style:{color:"#FFD700"},children:" V"}),": Camera"]}),hr=({badge:e})=>e?$e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #4a1a6b 0%, #1a0a2e 100%)",padding:"30px",borderRadius:"20px",textAlign:"center",color:"white",border:"3px solid #9966ff",boxShadow:"0 0 50px #9966ff40, 0 0 100px #6633ff30",animation:"popIn 0.5s ease-out",zIndex:200,minWidth:"300px"},children:[$e.jsx("div",{style:{fontSize:"14px",color:"#cc99ff",marginBottom:"10px"},children:"üéñÔ∏è NEW BADGE EARNED! üéñÔ∏è"}),$e.jsx("div",{style:{fontSize:"60px",marginBottom:"10px"},children:e.emoji}),$e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#ffd700",marginBottom:"10px"},children:e.name}),$e.jsx("div",{style:{fontSize:"14px",color:"#cc99ff",fontStyle:"italic"},children:e.description})]}):null,fr=({message:e})=>{if(!e)return null;const t=e.includes("PROMOTED")||e.includes("RANK UP");return $e.jsx("div",{style:{position:"absolute",top:"25%",left:"50%",transform:"translate(-50%, -50%)",background:t?"linear-gradient(135deg, #1a4a2a 0%, #0a2e1a 100%)":"linear-gradient(135deg, #4a1a1a 0%, #2e0a0a 100%)",padding:"20px 40px",borderRadius:"15px",textAlign:"center",color:"white",border:"3px solid "+(t?"#00ff66":"#ff4444"),boxShadow:"0 0 30px "+(t?"#00ff6640":"#ff444440"),animation:"popIn 0.3s ease-out",zIndex:180,fontSize:"18px",fontWeight:"bold"},children:e})},mr=({info:e,actions:t={},bindings:n={},getButtonLabel:r,overlayVisible:s,onToggleOverlay:o})=>{const i=e?.connected;return $e.jsxs("div",{style:{position:"absolute",top:20,right:20,minWidth:"220px",background:"rgba(0,0,0,0.75)",color:"#fff",borderRadius:"12px",padding:"14px 18px",fontFamily:"Arial, sans-serif",fontSize:"13px",boxShadow:"0 4px 12px rgba(0,0,0,0.4)",border:i?"1px solid #00ff99":"1px solid rgba(255,255,255,0.2)",zIndex:s?210:140},children:[$e.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"6px",color:i?"#00ff99":"#ffcc66"},children:i?"üéÆ Gamepad Connected":"üéÆ No Gamepad Detected"}),i?$e.jsxs($e.Fragment,{children:[$e.jsx("div",{style:{opacity:.8,marginBottom:"8px"},children:e?.id||"Unknown Controller"}),$e.jsxs("div",{style:{fontSize:"11px",opacity:.6,marginBottom:"6px"},children:["Mapping: ",e?.mapping||"standard"," ‚Ä¢ Buttons: ",e?.buttons??"‚Äì"]}),$e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",marginBottom:"10px"},children:["primary","secondary","startOrder"].map(e=>t[e]?$e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px"},children:[$e.jsx("span",{style:{opacity:.8},children:t[e]}),$e.jsx("span",{style:{color:"#FFD700"},children:r?r(n[e]):n[e]})]},e):null)})]}):$e.jsx("div",{style:{opacity:.8,marginBottom:"10px"},children:"Press any button on your controller to connect it."}),$e.jsx("button",{onClick:o,disabled:!i,style:{width:"100%",padding:"8px 0",borderRadius:"8px",border:"none",cursor:i?"pointer":"not-allowed",background:i?s?"#5555ff":"#1d8fff":"#555",color:"#fff",fontWeight:"bold",transition:"background 0.2s"},children:s?"Close Remap":"Customize Controls"})]})},gr=({info:e,actions:t={},bindings:n={},getButtonLabel:r,pendingBinding:s,onStartRemap:o,onCancelRemap:i,onResetBindings:a,onClose:l})=>{const c=Object.entries(t);return $e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:220},children:$e.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(10,20,40,0.95), rgba(5,10,25,0.95))",borderRadius:"18px",padding:"24px 28px",width:"420px",color:"#fff",border:"1px solid rgba(0,255,153,0.4)",boxShadow:"0 20px 40px rgba(0,0,0,0.5)"},children:[$e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[$e.jsx("h2",{style:{margin:0,fontSize:"20px"},children:"Gamepad Controls"}),$e.jsx("button",{onClick:l,style:{background:"transparent",border:"none",color:"#fff",fontSize:"20px",cursor:"pointer"},children:"√ó"})]}),$e.jsx("div",{style:{fontSize:"13px",opacity:.75,marginBottom:"14px"},children:e?.connected?`Remap buttons for ${e.id||"your controller"}.`:"Connect a controller to customize bindings."}),$e.jsx("div",{style:{maxHeight:"240px",overflowY:"auto",paddingRight:"6px",marginBottom:"18px"},children:c.map(([e,t])=>{const a=n[e],l=s===e,c=r?r(a):a;return $e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.08)",background:l?"rgba(30,120,255,0.2)":"transparent"},children:[$e.jsxs("div",{style:{flex:1},children:[$e.jsx("div",{style:{fontWeight:"bold"},children:t}),$e.jsx("div",{style:{fontSize:"12px",opacity:.7},children:l?"Waiting for button input‚Ä¶":c||"Unassigned"})]}),$e.jsx("button",{onClick:()=>{l?i?.():o?.(e)},style:{padding:"6px 12px",borderRadius:"6px",border:"none",cursor:"pointer",background:l?"#aa3333":"#1d8fff",color:"#fff",fontWeight:"bold"},children:l?"Cancel":"Remap"})]},e)})}),$e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[$e.jsx("button",{onClick:()=>a?.(),style:{background:"#333",border:"1px solid rgba(255,255,255,0.2)",color:"#fff",borderRadius:"6px",padding:"8px 12px",cursor:"pointer"},children:"Reset Defaults"}),s&&$e.jsx("div",{style:{fontSize:"12px",opacity:.8},children:"Press a button to complete remap."})]})]})})},xr=({isOpen:e,onClose:t,category:n,onCategoryChange:r,playerRank:s,playerScore:o})=>{if(!e)return null;const i=er[n]||[],a=e=>{switch(e){case"fastest_delivery":return"‚ö° Fastest Delivery";case"most_deliveries":return"üì¶ Most Deliveries";case"store_earnings":return"üè™ Store Earnings";case"perfect_pizzas":return"‚≠ê Perfect Pizzas";case"most_dropped_pizzas":return"üí® Most Dropped";case"bestRating":return"üåü Best Rating";case"total_wages":return"üíµ Total Wages";case"daily_earnings":return"üìÖ Daily Earnings";default:return e}};return $e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200},children:$e.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #0f0f23 100%)",padding:"25px",borderRadius:"15px",minWidth:"400px",maxWidth:"500px",color:"white",border:"2px solid #FFD700",boxShadow:"0 0 40px rgba(255,215,0,0.3)"},children:[$e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[$e.jsx("h2",{style:{color:"#FFD700",margin:0,fontSize:"24px"},children:"üèÜ LEADERBOARDS"}),$e.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#888",fontSize:"24px",cursor:"pointer"},children:"‚úï"})]}),$e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"20px"},children:Object.keys(er).map(e=>$e.jsx("button",{onClick:()=>r(e),style:{padding:"8px 12px",background:n===e?"#FFD700":"#333",color:n===e?"#000":"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"12px",fontWeight:n===e?"bold":"normal"},children:a(e)},e))}),$e.jsx("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:"10px",padding:"15px"},children:i.map((e,t)=>$e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px",borderBottom:t<i.length-1?"1px solid #333":"none",background:t<3?"rgba(255,215,0,0.1)":"transparent"},children:[$e.jsx("div",{style:{width:"35px",fontSize:"20px",textAlign:"center"},children:0===t?"ü•á":1===t?"ü•à":2===t?"ü•â":`#${e.rank}`}),$e.jsx("div",{style:{flex:1,paddingLeft:"10px",fontWeight:t<3?"bold":"normal"},children:e.name}),$e.jsx("div",{style:{color:e.value<0?"#ff4444":t<3?"#FFD700":"#aaa",fontWeight:"bold",fontSize:"16px"},children:"$"===e.unit?e.value<0?`-$${Math.abs(e.value).toLocaleString()}`:`$${e.value.toLocaleString()}`:"s"===e.unit?`${e.value}s`:e.value.toLocaleString()})]},t))}),s&&$e.jsxs("div",{style:{marginTop:"15px",padding:"12px",background:"rgba(0,255,0,0.1)",borderRadius:"8px",border:"1px solid #00ff00",display:"flex",alignItems:"center"},children:[$e.jsx("div",{style:{fontSize:"16px",marginRight:"10px"},children:"üìç"}),$e.jsxs("div",{style:{flex:1},children:[$e.jsx("div",{style:{fontSize:"12px",color:"#888"},children:"Your Position"}),$e.jsxs("div",{style:{fontWeight:"bold"},children:["#",s]})]}),$e.jsx("div",{style:{color:"#00ff00",fontWeight:"bold",fontSize:"18px"},children:o})]}),$e.jsx("div",{style:{marginTop:"15px",fontSize:"11px",color:"#666",textAlign:"center"},children:"daily_earnings"===n?"‚è∞ Resets daily at midnight":"üîÑ Weekly reset every Sunday"})]})})},yr=({topPlayers:e,playerRank:t,onExpand:n})=>$e.jsxs("div",{style:{position:"absolute",bottom:20,right:20,background:"rgba(0,0,0,0.8)",padding:"12px",borderRadius:"10px",minWidth:"180px",color:"white",fontFamily:"Arial, sans-serif"},children:[$e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",borderBottom:"1px solid #333",paddingBottom:"8px"},children:[$e.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#FFD700"},children:"üèÜ Top Players"}),$e.jsx("button",{onClick:n,style:{background:"transparent",border:"1px solid #FFD700",color:"#FFD700",padding:"2px 8px",borderRadius:"4px",cursor:"pointer",fontSize:"10px"},children:"View All"})]}),e?.slice(0,3).map((e,t)=>$e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",padding:"3px 0",color:0===t?"#FFD700":"#aaa"},children:[$e.jsxs("span",{children:[0===t?"ü•á":1===t?"ü•à":"ü•â"," ",e.name]}),$e.jsx("span",{children:e.value})]},t)),t&&$e.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid #333",fontSize:"11px",color:"#00ff00"},children:["üìç You: #",t]})]}),br=({deliveryTime:e,tip:t,pizzaHealth:n,isPerfect:r,temperature:s,rating:o,tipMessage:i,pizzaType:a,xpChange:l,rankBonus:c,playerRank:d,totalDeliveries:p,onNextOrder:u,onViewLeaderboard:h})=>{const f=((e,t)=>{const n=(e>=99?3:e>=80?2.5:e>=60?2:e>=40?1:.5)+(t<30?2:t<45?1.5:t<60?1:t<90?.5:0);return n>=4.5?{label:"LEGENDARY",emoji:"üåüüåüüåüüåüüåü",color:"#FFD700"}:n>=4?{label:"EXCELLENT",emoji:"‚≠ê‚≠ê‚≠ê‚≠ê‚ú®",color:"#00ff00"}:n>=3.5?{label:"GREAT",emoji:"‚≠ê‚≠ê‚≠ê‚≠ê",color:"#88ff00"}:n>=3?{label:"GOOD",emoji:"‚≠ê‚≠ê‚≠ê‚ú®",color:"#ccff00"}:n>=2.5?{label:"OKAY",emoji:"‚≠ê‚≠ê‚≠ê",color:"#ffff00"}:n>=2?{label:"MEH",emoji:"‚≠ê‚≠ê‚ú®",color:"#ffcc00"}:n>=1.5?{label:"POOR",emoji:"‚≠ê‚≠ê",color:"#ff9900"}:n>=1?{label:"BAD",emoji:"‚≠ê‚ú®",color:"#ff6600"}:{label:"DISASTER",emoji:"üíÄ",color:"#ff0000"}})(n,e),m=s||{temp:e<30?"PIPING HOT":e<45?"HOT":e<60?"WARM":e<90?"LUKEWARM":"COLD",emoji:e<30?"üî•üî•üî•":e<45?"üî•üî•":e<60?"üî•":e<90?"üòê":"ü•∂",color:e<30?"#ff4400":e<45?"#ff6600":e<60?"#ff9900":e<90?"#ffcc00":"#0099ff"},g=0===t;return $e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:150},children:$e.jsxs("div",{style:{background:g?"linear-gradient(135deg, #4a1a1a 0%, #2d0d0d 100%)":"linear-gradient(135deg, #1a472a 0%, #0d2818 100%)",padding:"30px",borderRadius:"20px",textAlign:"center",color:"white",border:`3px solid ${g?"#ff4444":f.color}`,boxShadow:"0 0 50px "+(g?"#ff444440":f.color+"40"),animation:"popIn 0.3s ease-out",minWidth:"400px"},children:[a&&$e.jsxs("div",{style:{fontSize:"14px",color:"#ffcc00",marginBottom:"10px"},children:[a.emoji," ",a.name]}),$e.jsx("div",{style:{fontSize:"50px",marginBottom:"5px"},children:g?"üò§":r?"üåü":n>=80?"‚úÖ":n>=50?"üòÖ":"üò¨"}),$e.jsx("h2",{style:{color:g?"#ff4444":f.color,fontSize:"28px",marginBottom:"5px"},children:g?"DELIVERY... COMPLETE?":r?"PERFECT DELIVERY!":"DELIVERY COMPLETE!"}),$e.jsxs("div",{style:{background:"rgba(0,0,0,0.4)",padding:"15px",borderRadius:"12px",marginBottom:"15px"},children:[$e.jsx("div",{style:{fontSize:"32px",letterSpacing:"3px",marginBottom:"5px"},children:f.emoji}),$e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:f.color,letterSpacing:"2px"},children:f.label})]}),$e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",marginBottom:"15px"},children:[$e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[$e.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"‚è±Ô∏è Time"}),$e.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold"},children:[e.toFixed(1),"s"]})]}),$e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[$e.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üçï Condition"}),$e.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:n>=80?"#00ff00":n>=50?"#ffcc00":"#ff6600"},children:[Math.round(n),"%"]})]}),$e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"10px",borderRadius:"8px"},children:[$e.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üå°Ô∏è Temp"}),$e.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:m.color},children:m.emoji}),$e.jsx("div",{style:{fontSize:"10px",color:m.color},children:m.temp})]})]}),$e.jsx("div",{style:{fontSize:g?"28px":"36px",fontWeight:"bold",color:g?"#ff4444":"#FFD700",marginBottom:"5px"},children:g?"üò§ NO TIP!":`üí∞ +$${t.toFixed(2)} TIP!`}),i&&$e.jsxs("div",{style:{fontSize:"14px",color:g?"#ff9999":t<3?"#ffcc99":"#99ff99",marginBottom:"10px",fontStyle:"italic",padding:"8px",background:"rgba(0,0,0,0.3)",borderRadius:"8px"},children:["üí¨ ",i]}),$e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"15px",marginBottom:"15px"},children:[void 0!==l&&0!==l&&$e.jsxs("div",{style:{background:l>0?"rgba(0,255,100,0.2)":"rgba(255,0,0,0.2)",border:"1px solid "+(l>0?"#00ff66":"#ff4444"),padding:"8px 15px",borderRadius:"8px"},children:[$e.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"‚≠ê XP"}),$e.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:l>0?"#00ff66":"#ff4444"},children:[l>0?"+":"",l]})]}),c>0&&$e.jsxs("div",{style:{background:"rgba(255,215,0,0.2)",border:"1px solid #FFD700",padding:"8px 15px",borderRadius:"8px"},children:[$e.jsx("div",{style:{fontSize:"11px",color:"#888"},children:"üëë Rank Bonus"}),$e.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#FFD700"},children:["+",Math.round(100*c),"%"]})]})]}),d&&$e.jsx("div",{style:{background:"rgba(100,50,200,0.2)",border:"1px solid #9966ff",padding:"8px 15px",borderRadius:"8px",marginBottom:"10px"},children:$e.jsxs("div",{style:{fontSize:"16px",color:"#cc99ff"},children:[d.emoji," ",d.name]})}),$e.jsxs("div",{style:{fontSize:"14px",color:"#888",marginBottom:"20px"},children:["Total Deliveries: ",p]}),$e.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center"},children:[$e.jsx("button",{onClick:h,style:{padding:"12px 24px",background:"#333",color:"#FFD700",border:"1px solid #FFD700",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:"üèÜ Leaderboard"}),$e.jsx("button",{onClick:u,style:{padding:"12px 30px",background:"#00ff00",color:"#000",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:"bold"},children:"Next Order ‚Üí"})]})]})})},vr={primary:{padding:"15px 30px",fontSize:"18px",fontWeight:"bold",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"all 0.2s ease"},secondary:{padding:"12px 24px",fontSize:"16px",fontWeight:"bold",background:"#555",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},danger:{padding:"15px 30px",fontSize:"18px",fontWeight:"bold",background:"#FF5722",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"}},wr=["A / Cross","B / Circle","X / Square","Y / Triangle","LB / L1","RB / R1","LT / L2","RT / R2","View / Select","Menu / Start","Left Stick Press","Right Stick Press","D-Pad Up","D-Pad Down","D-Pad Left","D-Pad Right"],Sr={primary:"Primary Action",secondary:"Secondary Action",startOrder:"Start Order",recenter:"Recenter View",cameraToggle:"Toggle Camera"},Tr={primary:0,secondary:1,startOrder:3,recenter:8,cameraToggle:9},zr=()=>{const t=e.useRef(null),[n,r]=e.useState("menu"),[s,o]=e.useState(null),[i,a]=e.useState(0),[l,c]=e.useState(0),[d,u]=e.useState(0),[h,f]=e.useState("Welcome to Pizza Express VR!"),[m,x]=e.useState(!1),[b,v]=e.useState(null),[w,S]=e.useState("third"),[T,z]=e.useState(null),[A,R]=e.useState(!1),[E,k]=e.useState(!1),[D,M]=e.useState(null),[C,j]=e.useState("ascending"),[P,I]=e.useState(!1),[L,_]=e.useState(null),[N,G]=e.useState(!1),[U,W]=e.useState(!1),[X,K]=e.useState(null),[q,J]=e.useState(null),[Q,ee]=e.useState(100),[te,ne]=e.useState({x:0,z:0}),[re,se]=e.useState(!1),[oe,ie]=e.useState(0),[ae,le]=e.useState(!1),[ce,de]=e.useState("fastest_delivery"),[pe,ue]=e.useState(!1),[he,fe]=e.useState(null),[xe,_e]=e.useState(null),[Ne,Oe]=e.useState({totalDeliveries:0,totalEarnings:0,destroyedPizzas:0,bestTime:null,rank:Nn[0],xp:0,level:1,badges:[],pizzaTypeDeliveries:{},perfectDeliveries:0,totalTips:0,fastestDelivery:null,storeEarnings:0}),[Fe,Be]=e.useState(null),[He,Ge]=e.useState(null),[Ue,We]=e.useState(!1),[Ve,Xe]=e.useState(!1),[dt,pt]=e.useState(!1),ut=e.useRef(null),ht=e.useRef(100),ft=e.useRef(!1),mt=e.useRef(null),gt=e.useRef(null),xt=e.useRef(null),yt=e.useRef(null),bt=e.useRef(null),vt=e.useRef(null),wt=e.useRef(!1),St=e.useRef(!1),Tt=e.useRef(null),zt=e.useRef(0),At=e.useRef(0),Rt=e.useRef({connected:!1,index:null,mapping:"standard",lastButtons:[],lastAxes:[],lastTimestamp:0}),Et=e.useRef({scene:null,camera:null,renderer:null,drones:[],bases:[],pizzaShop:null,currentDrone:null,pizzaAttached:!1,controls:{forward:!1,back:!1,left:!1,right:!1,up:!1,down:!1},keyboardControls:{forward:!1,back:!1,left:!1,right:!1,up:!1,down:!1},gamepadControls:{forward:!1,back:!1,left:!1,right:!1,up:!1,down:!1},lastDroneVelocity:{x:0,y:0,z:0},xrManager:null,vrButton:null,player:null,playerPizza:null,playerControls:{forward:!1,back:!1,left:!1,right:!1},keyboardPlayerControls:{forward:!1,back:!1,left:!1,right:!1},gamepadPlayerControls:{forward:!1,back:!1,left:!1,right:!1},lastPlayerVelocity:{x:0,z:0},sustainedSpeed:0,lastMoveTime:0,moveAccumulator:0}),[kt,Dt]=e.useState({x:0,y:0,z:10}),[Mt,Ct]=e.useState(null),[jt,Pt]=e.useState(!1),[It,Lt]=e.useState({connected:!1,id:null,mapping:"standard"}),[_t,Nt]=e.useState({...Tr}),[Ot,Ft]=e.useState(null),[Bt,Ht]=e.useState(!1),Gt=e.useRef(_t),Ut=e.useRef(null),Wt=e.useCallback(e=>null==e?"Unassigned":wr[e]||`Button ${e}`,[]),$t=e.useCallback((e,t)=>{null!=t&&(Nt(n=>{const r={...n};return Object.keys(r).forEach(n=>{n!==e&&r[n]===t&&(r[n]=null)}),r[e]=t,r}),Ft(null),f(`üéÆ ${Wt(t)} mapped to ${Sr[e]}`))},[Wt]),Vt=e.useCallback(()=>{Nt({...Tr}),Ft(null),f("üéÆ Gamepad bindings reset to defaults")},[]),Xt=e.useCallback(e=>{Ft(e),Ht(!0);f(`üéÆ Press any button for ${Sr[e]||e}`)},[]),Kt=e.useCallback(()=>{Ft(null),f("üéÆ Remap cancelled")},[]),[qt,Yt]=e.useState(1.5),[Zt,Jt]=e.useState(0),[Qt,en]=e.useState(0),[tn,nn]=e.useState(!1);e.useEffect(()=>{ft.current=m},[m]),e.useEffect(()=>{vt.current=s},[s]),e.useEffect(()=>{wt.current=P},[P]),e.useEffect(()=>{St.current=jt},[jt]),e.useEffect(()=>{Tt.current=Mt},[Mt]),e.useEffect(()=>{zt.current=i},[i]),e.useEffect(()=>{At.current=l},[l]),e.useEffect(()=>{Gt.current=_t},[_t]),e.useEffect(()=>{Ut.current=Ot},[Ot]),e.useEffect(()=>{const e=e=>{const t=e.gamepad;Rt.current={connected:!0,index:t.index,mapping:t.mapping||"standard",lastButtons:t.buttons.map(e=>e.pressed),lastAxes:[...t.axes],lastTimestamp:t.timestamp||performance.now()},Lt({connected:!0,id:t.id,mapping:t.mapping||"standard",buttons:t.buttons.length}),f("üéÆ Gamepad connected")},t=e=>{Rt.current.index===e.gamepad.index&&(Rt.current={connected:!1,index:null,mapping:"standard",lastButtons:[],lastAxes:[],lastTimestamp:0},Lt({connected:!1,id:null,mapping:"standard"}),f("üéÆ Gamepad disconnected"))};if(window.addEventListener("gamepadconnected",e),window.addEventListener("gamepaddisconnected",t),navigator.getGamepads){const t=navigator.getGamepads();for(const n of t)if(n){e({gamepad:n});break}}return()=>{window.removeEventListener("gamepadconnected",e),window.removeEventListener("gamepaddisconnected",t)}},[]),e.useEffect(()=>{const e=(()=>{try{const e=parseInt(localStorage.getItem(Vn))||0,t=On(e),n=localStorage.getItem(Xn),r=localStorage.getItem(Kn),s=localStorage.getItem(Qn);return{totalWages:parseFloat(localStorage.getItem(Hn))||0,totalDeliveries:parseInt(localStorage.getItem(Gn))||0,totalDestroyed:parseInt(localStorage.getItem(Un))||0,bestTime:parseFloat(localStorage.getItem(Wn))||null,playerName:localStorage.getItem($n)||"Rookie Pilot",xp:e,rank:t,badges:n?JSON.parse(n):[],pizzaTypeDeliveries:r?JSON.parse(r):{},perfectDeliveries:parseInt(localStorage.getItem(qn))||0,totalTips:parseFloat(localStorage.getItem(Yn))||0,fastestDelivery:parseFloat(localStorage.getItem(Zn))||null,storeEarnings:parseFloat(localStorage.getItem(Jn))||0,gamepadBindings:s?JSON.parse(s):null}}catch(e){return console.warn("Could not load persistent data:",e),{totalWages:0,totalDeliveries:0,totalDestroyed:0,bestTime:null,playerName:"Rookie Pilot",xp:0,rank:Nn[0],badges:[],pizzaTypeDeliveries:{},perfectDeliveries:0,totalTips:0,fastestDelivery:null,storeEarnings:0,gamepadBindings:null}}})();a(e.totalWages),c(e.totalDeliveries),u(e.totalDestroyed);const t=On(e.xp);Oe(n=>({...n,totalDeliveries:e.totalDeliveries,totalEarnings:e.totalWages,destroyedPizzas:e.totalDestroyed,bestTime:e.bestTime,xp:e.xp,rank:t,badges:e.badges||[],pizzaTypeDeliveries:e.pizzaTypeDeliveries||{},perfectDeliveries:e.perfectDeliveries||0,totalTips:e.totalTips||0,fastestDelivery:e.fastestDelivery||null,storeEarnings:e.storeEarnings||0})),e.gamepadBindings&&"object"==typeof e.gamepadBindings&&Nt(t=>({...t,...e.gamepadBindings})),We(!0),e.totalWages<0?f(`üí∏ Welcome back! You owe the shop $${Math.abs(e.totalWages).toFixed(2)}. Time to work it off!`):t.tipBonus>0&&f(`${t.emoji} Welcome back, ${t.name}! +${Math.round(100*t.tipBonus)}% tip bonus!`)},[]),e.useEffect(()=>{Ue&&(e=>{try{void 0!==e.totalWages&&localStorage.setItem(Hn,e.totalWages.toString()),void 0!==e.totalDeliveries&&localStorage.setItem(Gn,e.totalDeliveries.toString()),void 0!==e.totalDestroyed&&localStorage.setItem(Un,e.totalDestroyed.toString()),void 0!==e.bestTime&&null!==e.bestTime&&localStorage.setItem(Wn,e.bestTime.toString()),void 0!==e.playerName&&localStorage.setItem($n,e.playerName),void 0!==e.xp&&localStorage.setItem(Vn,e.xp.toString()),void 0!==e.badges&&localStorage.setItem(Xn,JSON.stringify(e.badges)),void 0!==e.pizzaTypeDeliveries&&localStorage.setItem(Kn,JSON.stringify(e.pizzaTypeDeliveries)),void 0!==e.perfectDeliveries&&localStorage.setItem(qn,e.perfectDeliveries.toString()),void 0!==e.totalTips&&localStorage.setItem(Yn,e.totalTips.toString()),void 0!==e.fastestDelivery&&null!==e.fastestDelivery&&localStorage.setItem(Zn,e.fastestDelivery.toString()),void 0!==e.storeEarnings&&localStorage.setItem(Jn,e.storeEarnings.toString()),void 0!==e.gamepadBindings&&(null===e.gamepadBindings?localStorage.removeItem(Qn):localStorage.setItem(Qn,JSON.stringify(e.gamepadBindings)))}catch(t){console.warn("Could not save persistent data:",t)}})({totalWages:i,totalDeliveries:l,totalDestroyed:d,bestTime:Ne.bestTime,xp:Ne.xp,badges:Ne.badges,pizzaTypeDeliveries:Ne.pizzaTypeDeliveries,perfectDeliveries:Ne.perfectDeliveries,totalTips:Ne.totalTips,fastestDelivery:Ne.fastestDelivery,storeEarnings:Ne.storeEarnings,gamepadBindings:_t})},[i,l,d,Ne.bestTime,Ne.xp,Ne.badges,Ne.pizzaTypeDeliveries,Ne.perfectDeliveries,Ne.totalTips,Ne.fastestDelivery,Ne.storeEarnings,_t,Ue]),e.useEffect(()=>{if(!t.current)return;const e=new De;e.background=new p(Qe),e.fog=new Me(Qe,50,200);const r=new Z(75,window.innerWidth/window.innerHeight,.1,1e3);r.position.set(0,15,30),r.lookAt(0,0,0);const o=new Y;o.add(r),e.add(o),Et.current.vrPlayerRig=o;const i=new Ce({antialias:!0,powerPreference:"high-performance",alpha:!1});i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(Math.min(window.devicePixelRatio,2)),i.shadowMap.enabled=!0,i.shadowMap.type=je,i.xr.enabled=!0,t.current.appendChild(i.domElement);(async()=>{const n=await En();if(Xe(n.supported),n.supported){const n=new kn(i,e,r,o);await n.init(),n.onControllerInput=e=>{if("selectstart"===e.type&&(ft.current?un():vt.current&&!wt.current&&St.current&&gt.current?.()),"squeezestart"===e.type&&vt.current&&!ft.current&&wt.current){const e=Tt.current;e&&pn(e)}},ut.current=n,Et.current.xrManager=n;const s=((e,t,n)=>{const r=document.createElement("button");return r.style.cssText="\n    position: absolute;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    padding: 15px 30px;\n    border: none;\n    border-radius: 8px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    font-size: 16px;\n    font-weight: bold;\n    cursor: pointer;\n    z-index: 1000;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);\n  ",r.onmouseover=()=>{r.style.transform="translateX(-50%) scale(1.05)",r.style.boxShadow="0 6px 20px rgba(102, 126, 234, 0.6)"},r.onmouseout=()=>{r.style.transform="translateX(-50%) scale(1)",r.style.boxShadow="0 4px 15px rgba(102, 126, 234, 0.4)"},(async()=>{if(!(await En()).supported)return r.textContent="üö´ VR Not Supported",r.disabled=!0,r.style.background="#666",void(r.style.cursor="not-allowed");r.textContent="ü•Ω Enter VR",r.onclick=async()=>{if(e.xr.isPresenting)await e.xr.getSession().end(),r.textContent="ü•Ω Enter VR",n&&n();else try{const s=await navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor","hand-tracking","layers"]});e.xr.setSession(s),r.textContent="‚ùå Exit VR",t&&t(),s.addEventListener("end",()=>{r.textContent="ü•Ω Enter VR",n&&n()})}catch(s){console.error("Failed to start VR:",s)}}})(),r})(i,()=>{pt(!0),ut.current&&(ut.current.isInVR=!0);const e=Et.current.vrPlayerRig,t=Et.current.player,n=Et.current.camera,r=t?t.position.x:0,s=t?t.position.z:12,o=t?t.rotation.y:Math.PI;e&&(e.position.set(r,0,s),e.rotation.y=o,console.log("VR Rig positioned at:",e.position)),Et.current.vrHUD&&n&&(Et.current.vrHUD.visible=!0,n.add(Et.current.vrHUD),Et.current.vrHUD.position.set(0,-.2,-.8),Et.current.vrHUD.rotation.set(0,0,0)),console.log("VR Session Started - Auto-starting game!"),setTimeout(()=>{mt.current?.()},100)},()=>{if(pt(!1),ut.current&&(ut.current.isInVR=!1),Et.current.vrHUD){Et.current.vrHUD.visible=!1;const e=Et.current.scene;Et.current.vrHUD.parent!==e&&e.add(Et.current.vrHUD)}});s.id="vr-button",t.current.appendChild(s),Et.current.vrButton=s}})();const a=new Pe(16777215,.6);e.add(a);const l=new g(16777215,.8);l.position.set(50,50,50),l.castShadow=!0,l.shadow.mapSize.width=2048,l.shadow.mapSize.height=2048,l.shadow.camera.near=.5,l.shadow.camera.far=500,l.shadow.camera.left=-50,l.shadow.camera.right=50,l.shadow.camera.top=50,l.shadow.camera.bottom=-50,e.add(l);const c=new ze(200,200),d=new F({color:et}),u=new $(c,d);u.rotation.x=-Math.PI/2,u.receiveShadow=!0,e.add(u);const h=new Ie(200,40,0,5592405);e.add(h);const m=(()=>{const e=new Y,t=new ge(6,4,6),n=new F({color:tt}),r=new $(t,n);r.position.y=2,r.castShadow=!0,e.add(r);const s=new be(5,2,4),o=new F({color:13382451}),i=new $(s,o);i.position.y=5,i.rotation.y=Math.PI/4,e.add(i);const a=new ge(7,1,.2),l=new F({color:nt}),c=new $(a,l);c.position.set(0,5,3.1),e.add(c);const d=new ge(1.5,2.5,.1),p=new F({color:9127187}),u=new $(d,p);u.position.set(0,1.25,3.05),e.add(u);const h=new ge(1,1,.1),f=new F({color:8900331,transparent:!0,opacity:.6});[-1.5,1.5].forEach(t=>{const n=new $(h,f);n.position.set(t,2.5,3.05),e.add(n)});const m=new ge(2,1,1),g=new F({color:9127187}),x=new $(m,g);x.position.set(0,.5,2),x.castShadow=!0,e.add(x);const y=new ve(1,1.5,32),b=new H({color:65280,transparent:!0,opacity:.7,side:B}),v=new $(y,b);v.rotation.x=-Math.PI/2,v.position.set(0,.05,4),v.userData.isPickupTrigger=!0,e.add(v);const w=new be(.3,.6,8),S=new H({color:65280}),T=new $(w,S);T.position.set(0,2.5,4),T.rotation.x=Math.PI,e.add(T);const z=new ge(1.5,.4,.1),A=new F({color:43520}),R=new $(z,A);return R.position.set(0,3.2,4),e.add(R),e})();e.add(m),Et.current.pizzaShop=m,Ke.forEach(t=>{const n=(()=>{const e=new Y,t=new ye(3,3,.3,32),n=new F({color:rt}),r=new $(t,n);r.position.y=.15,r.receiveShadow=!0,e.add(r);const s=new ve(2,2.2,32),o=new H({color:16776960,side:B}),i=new $(s,o);return i.rotation.x=-Math.PI/2,i.position.y=.31,e.add(i),e})();n.position.set(t.x,0,t.z),e.add(n);const r=(()=>{const e=new Y,t=new ge(1.5,.3,1.5),n=new F({color:it}),r=new $(t,n);r.castShadow=!0,e.add(r),[{x:.8,z:.8},{x:-.8,z:.8},{x:.8,z:-.8},{x:-.8,z:-.8}].forEach(t=>{const n=new ye(.05,.05,.8,8),r=new F({color:at}),s=new $(n,r);s.position.set(t.x,0,t.z),e.add(s);const o=new ye(.5,.5,.05,32),i=new F({color:lt,transparent:!0,opacity:.7}),a=new $(o,i);a.position.set(t.x,.5,t.z),a.userData.isRotor=!0,e.add(a)});const s=new me(.1,16,16),o=new H({color:65280}),i=new $(s,o);return i.position.set(0,.2,.7),i.userData.isLED=!0,e.add(i),e})(t.label);r.position.set(t.x,1.5,t.z),r.userData={label:t.label,homePos:new y(t.x,1.5,t.z),hasPizza:!1,targetBase:null},e.add(r),Et.current.drones.push(r);const s=((e,t="#ffffff",n=2)=>{const r=document.createElement("canvas"),s=r.getContext("2d");r.width=128,r.height=128,s.fillStyle=t,s.font="bold 80px Arial",s.textAlign="center",s.textBaseline="middle",s.fillText(e,64,64);const o=new we(r),i=new Se({map:o}),a=new Te(i);return a.scale.set(n,n,1),a})(t.label);s.position.set(t.x,4,t.z),e.add(s)}),qe.forEach(t=>{const n=(e=>{const t=new Y,n=6.5,r=new ye(.3,.8,30,16,1,!0),s=new H({color:65416,transparent:!0,opacity:.15,side:B}),o=new $(r,s);o.position.set(0,21.5,0),o.userData.isBeacon=!0,o.visible=!1,t.add(o),[15,22,30,40].forEach((e,r)=>{const s=new ve(2-.2*r,2.5-.2*r,32),o=new H({color:65416,transparent:!0,opacity:.4-.08*r,side:B}),i=new $(s,o);i.rotation.x=-Math.PI/2,i.position.set(0,n+e,0),i.userData.isHalo=!0,i.visible=!1,t.add(i)});const i=new me(.6,16,16),a=new H({color:65280,transparent:!0,opacity:.8}),l=new $(i,a);l.position.set(0,51.5,0),l.userData.isPulsingMarker=!0,l.visible=!1,t.add(l),t.userData.landingPadHeight=n;const c=new ge(5,6,5),d=new F({color:st}),p=new $(c,d);p.position.y=3,p.castShadow=!0,p.userData={baseNumber:e},t.add(p);const u=new ge(5.5,.3,5.5),h=new F({color:1668818}),f=new $(u,h);f.position.y=6.15,t.add(f);const m=new ye(.05,.05,1.5,8),g=new F({color:3355443}),x=new $(m,g);x.position.set(2,7,2),t.add(x);const y=new ye(2,2,.2,32),b=new F({color:ot}),v=new $(y,b);v.position.y=6.35,v.userData.isLandingPad=!0,t.add(v),[1.5,1,.5].forEach((e,n)=>{const r=new ve(e-.05,e,32),s=new H({color:n%2==0?16777215:65280,side:B}),o=new $(r,s);o.rotation.x=-Math.PI/2,o.position.y=6.36,t.add(o)});const w=document.createElement("canvas"),S=w.getContext("2d");w.width=128,w.height=128,S.fillStyle="#ffffff",S.font="bold 80px Arial",S.textAlign="center",S.textBaseline="middle",S.fillText(e.toString(),64,64);const T=new we(w),z=new Se({map:T}),A=new Te(z);return A.position.y=8,A.scale.set(3,3,1),t.add(A),t})(t.num);n.position.set(t.x,0,t.z),n.userData={baseNumber:t.num},e.add(n),Et.current.bases.push(n)});const x=new Y,b=new Le(.3,1,8,16),v=new F({color:4491519}),T=new $(b,v);T.position.y=1,T.castShadow=!0,x.add(T);const A=new be(.15,.3,8),E=new H({color:16776960}),D=new $(A,E);D.rotation.x=Math.PI/2,D.position.set(0,1,.5),x.add(D),x.position.set(0,0,12),x.rotation.y=Math.PI,x.userData.isPlayer=!0,e.add(x),Et.current.player=x;const I=(()=>{const e=new Y;e.userData.isVRHUD=!0;const t=new ze(.6,.4),n=new H({color:0,transparent:!0,opacity:.7,side:B}),r=new $(t,n);r.userData.isHUDPanel=!0,e.add(r);const s=new Ae(t),o=new O({color:16766720}),i=new V(s,o);e.add(i);const a=(e,t,n,r=32)=>{const s=document.createElement("canvas");s.width=512,s.height=128;const o=s.getContext("2d"),i=new we(s);i.needsUpdate=!0;const a=new H({map:i,transparent:!0,side:B}),l=new ze(e,t),c=new $(l,a);return c.userData.canvas=s,c.userData.ctx=o,c.userData.texture=i,c.userData.fontSize=r,sr(c,n),c},l=a(.5,.08,"üçï Pizza Express VR",28);l.position.set(0,.14,.01),l.userData.textType="title",e.add(l);const c=a(.5,.06,"üíµ Wages: $0.00",24);c.position.set(0,.06,.01),c.userData.textType="wages",e.add(c);const d=a(.5,.06,"üì¶ Deliveries: 0",24);d.position.set(0,0,.01),d.userData.textType="deliveries",e.add(d);const p=a(.5,.06,"üìç No order yet",22);p.position.set(0,-.06,.01),p.userData.textType="order",e.add(p);const u=new ze(.4,.03),h=new H({color:3355443}),f=new $(u,h);f.position.set(0,-.12,.01),e.add(f);const m=new ze(.4,.03),g=new H({color:65280}),x=new $(m,g);x.position.set(0,-.12,.02),x.userData.isHealthBar=!0,e.add(x);const y=a(.3,.04,"üçï 100%",20);return y.position.set(0,-.16,.01),y.userData.textType="health",e.add(y),e.visible=!1,e})();e.add(I),Et.current.vrHUD=I;const L=(()=>{const e=new Y;e.userData.isCockpit=!0;const t=new Re;t.moveTo(-.4,0),t.lineTo(.4,0),t.lineTo(.35,.15),t.lineTo(-.35,.15),t.closePath();const n=new Ee(t,{depth:.02,bevelEnabled:!1}),r=new F({color:2236962,metalness:.8,roughness:.3}),s=new $(n,r);s.rotation.x=-Math.PI/6,s.position.set(0,-.15,-.5),e.add(s);const o=nr(.12,.08,"0 m/s","SPEED");o.position.set(-.2,-.08,-.48),o.rotation.x=-Math.PI/6,o.userData.displayType="speed",e.add(o);const i=nr(.15,.08,"0 m","ALT");i.position.set(0,-.08,-.48),i.rotation.x=-Math.PI/6,i.userData.displayType="altitude",e.add(i);const a=nr(.12,.08,"100%","PIZZA");a.position.set(.2,-.08,-.48),a.rotation.x=-Math.PI/6,a.userData.displayType="health",e.add(a);const l=new ve(.02,.025,32),c=new H({color:65280,transparent:!0,opacity:.7,side:B}),d=new $(l,c);d.position.set(0,0,-1),e.add(d);const p=new ke(.005,16),u=new H({color:65280,side:B}),h=new $(p,u);h.position.set(0,0,-.99),e.add(h);const f=new ge(.02,.3,.02),m=new F({color:3355443,metalness:.9}),g=new $(f,m);g.position.set(-.35,0,-.3),e.add(g);const x=new $(f,m);return x.position.set(.35,0,-.3),e.add(x),e.visible=!1,e})();r.add(L),Et.current.droneCockpit=L,r.position.set(0,6,20),r.lookAt(0,2,0),Et.current.scene=e,Et.current.camera=r,Et.current.renderer=i;const _=(e,t=.22)=>Math.abs(e)<t?0:e,N=()=>{if(!navigator.getGamepads)return;const e=Rt.current;if(!e.connected){const e=Et.current.gamepadControls,t=Et.current.gamepadPlayerControls;return e&&(e.forward=e.back=e.left=e.right=e.up=e.down=!1),void(t&&(t.forward=t.back=t.left=t.right=!1))}const t=navigator.getGamepads(),r=t?.[e.index];if(!r){e.connected=!1;const t=Et.current.gamepadControls,n=Et.current.gamepadPlayerControls;return t&&(t.forward=t.back=t.left=t.right=t.up=t.down=!1),void(n&&(n.forward=n.back=n.left=n.right=!1))}const s=r.axes||[],o=r.buttons||[],i=_(s[0]||0),a=_(s[1]||0);_(s[2]||0);const l=_(s[3]||0),c=Et.current.gamepadControls,d=Et.current.gamepadPlayerControls;if(ft.current){c.forward=a<-.2,c.back=a>.2,c.left=i<-.25,c.right=i>.25;const e=o[4]?.pressed||o[6]?.pressed,t=o[5]?.pressed||o[7]?.pressed;c.up=l<-.25||e,c.down=l>.25||t,d.forward=!1,d.back=!1,d.left=!1,d.right=!1}else d.forward=a<-.2,d.back=a>.2,d.left=i<-.25,d.right=i>.25,c.forward=!1,c.back=!1,c.left=!1,c.right=!1,c.up=!1,c.down=!1;const p=[];o.forEach((t,n)=>{!!t?.pressed&&!e.lastButtons[n]&&p.push(n)});const u=Ut.current;if(u&&p.length>0&&$t(u,p[0]),u)return e.lastButtons=o.map(e=>e.pressed),e.lastAxes=[...s],void(e.lastTimestamp=r.timestamp||performance.now());const h=Gt.current||{},f=(t,n)=>{null!=t&&(t>=o.length||(e=>!!o[e]?.pressed)(t)&&!(t=>!!e.lastButtons[t])(t)&&n())},m=(e,t)=>{const n=h[e];null!=n&&f(n,t)};m("primary",()=>{ft.current?xt.current?.():vt.current&&!wt.current&&St.current?gt.current?.():vt.current&&wt.current&&Tt.current&&yt.current?.(Tt.current)}),m("secondary",()=>{!ft.current&&vt.current&&wt.current&&Tt.current&&bt.current?.(Tt.current)}),m("startOrder",()=>{vt.current||"menu"!==n||mt.current?.()}),m("recenter",()=>{if(Et.current.vrPlayerRig){const e=Et.current.player;if(e){const t=Et.current.vrPlayerRig;t.position.set(e.position.x,t.position.y,e.position.z)}}}),m("cameraToggle",()=>{S(e=>"third"===e?"pov":"pov"===e?"overhead":"third")}),e.lastButtons=o.map(e=>e.pressed),e.lastAxes=[...s],e.lastTimestamp=r.timestamp||performance.now()};performance.now();i.setAnimationLoop((t,n)=>{N();const o=i.xr.isPresenting;if(!o){const e=Et.current.keyboardControls,t=Et.current.gamepadControls,n=Et.current.controls;n.forward=e.forward||t.forward,n.back=e.back||t.back,n.left=e.left||t.left,n.right=e.right||t.right,n.up=e.up||t.up,n.down=e.down||t.down;const r=Et.current.keyboardPlayerControls,s=Et.current.gamepadPlayerControls,o=Et.current.playerControls;o.forward=r.forward||s.forward,o.back=r.back||s.back,o.left=r.left||s.left,o.right=r.right||s.right}if(o){const e=ut.current.pollControllerInput();if(e){const t=e.right.thumbstick,n=e.left.thumbstick;ft.current?(Math.abs(t.y)>.1?(Et.current.controls.forward=t.y<-.1,Et.current.controls.back=t.y>.1):(Et.current.controls.forward=!1,Et.current.controls.back=!1),Math.abs(t.x)>.1?(Et.current.controls.right=t.x>.1,Et.current.controls.left=t.x<-.1):(Et.current.controls.left=!1,Et.current.controls.right=!1),Math.abs(n.y)>.1?(Et.current.controls.up=n.y<-.1,Et.current.controls.down=n.y>.1):(Et.current.controls.up=!1,Et.current.controls.down=!1)):(Math.abs(n.y)>.15?(Et.current.playerControls.forward=n.y<-.15,Et.current.playerControls.back=n.y>.15):(Et.current.playerControls.forward=!1,Et.current.playerControls.back=!1),Math.abs(t.x)>.15?(Et.current.playerControls.right=t.x>.15,Et.current.playerControls.left=t.x<-.15):(Et.current.playerControls.left=!1,Et.current.playerControls.right=!1))}if(sn(r,Et.current,ft.current),Et.current.vrHUD&&Et.current.vrHUD.visible&&((e,t)=>{e&&e.children.forEach(e=>{const n=e.userData.textType;if("wages"===n){const n=t.score<0?`üíµ Wages: -$${Math.abs(t.score).toFixed(2)}`:`üíµ Wages: $${t.score.toFixed(2)}`,r=t.score<0?"#ff4444":"#00ff00";sr(e,n,r)}if("deliveries"===n&&sr(e,`üì¶ Deliveries: ${t.pizzasDelivered}`),"order"===n)if(t.currentOrder){const n=t.currentOrder;sr(e,`üìç ${n.pizzaType?.emoji||"üçï"} ‚Üí Base ${n.base}`,"#FFD700")}else sr(e,"üìç Get a pizza from the shop!","#aaaaaa");if("health"===n){const n=t.pizzaHealth>70?"#00ff00":t.pizzaHealth>40?"#ffff00":"#ff4444";sr(e,`üçï ${Math.round(t.pizzaHealth)}%`,n)}if(e.userData.isHealthBar){const n=t.pizzaHealth/100;e.scale.x=Math.max(.01,n),e.position.x=-.2*(1-n),t.pizzaHealth>70?e.material.color.setHex(65280):t.pizzaHealth>40?e.material.color.setHex(16776960):e.material.color.setHex(16729156)}})})(Et.current.vrHUD,{score:zt.current,pizzasDelivered:At.current,currentOrder:vt.current,pizzaHealth:ht.current}),Et.current.droneCockpit){const e=Et.current.droneCockpit,t=ft.current&&Et.current.currentDrone;if(t!==e.visible&&(e.visible=t),e.visible&&Et.current.currentDrone){const t=Et.current.currentDrone,n=Et.current.lastDroneVelocity||{x:0,z:0};((e,t)=>{e&&e.children.forEach(e=>{const n=e.userData.displayType;if("speed"===n){const n=Math.round(t.speed||0);rr(e,`${n} m/s`)}if("altitude"===n){const n=Math.round(t.altitude||0);rr(e,`${n} m`)}if("health"===n){const n=Math.round(t.pizzaHealth||100);if(e.userData.canvas){const t=e.userData.ctx;t.fillStyle="#001100",t.fillRect(0,0,256,128),t.fillStyle="#00aa00",t.font="bold 20px monospace",t.textAlign="center",t.fillText("PIZZA",128,30),t.fillStyle=n>70?"#00ff00":n>40?"#ffff00":"#ff4444",t.font="bold 36px monospace",t.fillText(`${n}%`,128,80),e.userData.texture.needsUpdate=!0}}})})(e,{speed:60*Math.sqrt(n.x*n.x+n.z*n.z),altitude:t.position.y,pizzaHealth:ht.current})}}}Et.current.drones.forEach(e=>{if(e.children.filter(e=>e.userData.isRotor).forEach(e=>{e.rotation.y+=.3}),ft.current&&Et.current.currentDrone===e){const t=Et.current.controls,n=.3,o=.05,i=e.position.clone(),a=e.position.y;let l="cruising",c=!1;if(s){const t=Et.current.bases.find(e=>e.userData.baseNumber===s.base);if(t){const n=t.position.x,r=t.position.z;c=Math.sqrt(Math.pow(e.position.x-n,2)+Math.pow(e.position.z-r,2))<1}}l=a<10&&!c?"ascending":c?"descending":"cruising",l!==C&&(j(l),"ascending"===l?f("üöÅ ASCENDING - Reach 10m altitude to unlock controls!"):"cruising"===l?f(`‚úàÔ∏è CRUISING - Fly to Base ${s?.base}! Use WASD to navigate.`):"descending"===l&&f("üìç LANDING - Descend to drop zone! Press RELEASE when ready.")),"ascending"===l?(t.up&&(e.position.y+=1*n*1.5),t.left&&(e.rotation.y+=o),t.right&&(e.rotation.y-=o)):"cruising"===l?(t.forward&&(e.position.x+=Math.sin(e.rotation.y)*n,e.position.z+=Math.cos(e.rotation.y)*n),t.back&&(e.position.x-=Math.sin(e.rotation.y)*n,e.position.z-=Math.cos(e.rotation.y)*n),t.left&&(e.rotation.y+=o),t.right&&(e.rotation.y-=o),t.up&&(e.position.y+=1*n),t.down&&(e.position.y=Math.max(1.5,e.position.y-1*n))):"descending"===l&&(t.up&&(e.position.y+=1*n),t.down&&(e.position.y=Math.max(6.5,e.position.y-1*n)),t.left&&(e.rotation.y+=o),t.right&&(e.rotation.y-=o));const d={x:e.position.x-i.x,y:e.position.y-i.y,z:e.position.z-i.z};if(Et.current.lastDroneVelocity=d,Yt(e.position.y),Jt(60*d.y),s){const t=Et.current.bases.find(e=>e.userData.baseNumber===s.base);if(t){const n=t.position.x,r=t.position.z,o=Math.sqrt(Math.pow(e.position.x-n,2)+Math.pow(e.position.z-r,2));M(o);const i=Math.sqrt(Math.pow(e.position.x-n,2)+Math.pow(e.position.y,2)+Math.pow(e.position.z-r,2));z(i);const a=o<1,l=e.position.y>=6&&e.position.y<=8,c=e.position.y>8;k(a&&c),R(a&&l),Et.current.bases.forEach(e=>{const t=e.userData.baseNumber===s.base;e.traverse(e=>{(e.userData.isBeacon||e.userData.isHalo||e.userData.isPulsingMarker)&&(e.visible=t,t&&e.material&&(a?(e.material.color.setHex(65280),e.material.opacity=e.userData.isPulsingMarker?1:.5):(e.material.color.setHex(65416),e.material.opacity=e.userData.isPulsingMarker?.8:.3)))})})}}else k(!1),M(null),Et.current.bases.forEach(e=>{e.traverse(e=>{(e.userData.isBeacon||e.userData.isHalo||e.userData.isPulsingMarker)&&(e.visible=!1)})});const p=Et.current.renderer;p?.xr?.isPresenting||rn(r,e,w)}});const a=Et.current.player;if(a&&P&&!ft.current){const e=Et.current.playerControls,t=.15,n=.1,s=.05,o=a.position.clone();if(e.forward&&(a.position.x+=Math.sin(a.rotation.y)*t,a.position.z+=Math.cos(a.rotation.y)*t),e.back&&(a.position.x-=Math.sin(a.rotation.y)*n,a.position.z-=Math.cos(a.rotation.y)*n),e.left){a.rotation.y+=s;const e=Et.current.vrPlayerRig,t=Et.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y+=s)}if(e.right){a.rotation.y-=s;const e=Et.current.vrPlayerRig,t=Et.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y-=s)}const i=a.position.x-o.x,l=a.position.z-o.z,c=Math.sqrt(i*i+l*l),d=Date.now(),p=c>.001,u=d-Et.current.lastMoveTime;p?(Et.current.moveAccumulator=u<100?Math.min(2,Et.current.moveAccumulator+.03):Math.max(0,Et.current.moveAccumulator-.3),Et.current.lastMoveTime=d):Et.current.moveAccumulator=Math.max(0,Et.current.moveAccumulator-.05);const h=c*(.5+Et.current.moveAccumulator);Et.current.sustainedSpeed=h,en(60*h),Et.current.lastPlayerVelocity={x:i,z:l};const f=Et.current.playerPizza;if(f){const e=2,t=Math.PI/4,n=.12,r=.14,s=l*Math.cos(a.rotation.y)+i*Math.sin(a.rotation.y),o=i*Math.cos(a.rotation.y)-l*Math.sin(a.rotation.y),c=Math.max(-t,Math.min(t,s*e*10)),d=Math.max(-t,Math.min(t,-o*e*10));f.rotation.x+=.08*(c-f.rotation.x),f.rotation.z+=.08*(d-f.rotation.z);const p=h>r;if(nn(h>n),p){const e=2*(h-r),t=Math.max(0,ht.current-e);t!==ht.current&&(ht.current=t,ee(t),ut.current?.isInVR&&(ut.current.triggerHaptic("left",.3,50),ut.current.triggerHaptic("right",.3,50)))}const u=Math.abs(f.rotation.x)+Math.abs(f.rotation.z);if(u>1.5*t){const e=.2*(u-1.5*t),n=Math.max(0,ht.current-e);n!==ht.current&&(ht.current=n,ee(n),ut.current?.isInVR&&(ut.current.triggerHaptic("left",.6,100),ut.current.triggerHaptic("right",.6,100)))}}Dt({x:a.position.x,z:a.position.z});let m=null,g=1/0;Et.current.drones.forEach(e=>{const t=a.position.distanceTo(e.position);t<g&&(g=t,m=e)}),Ct(m&&g<3?m.userData.label:null);const x=Et.current.renderer;x?.xr?.isPresenting||(r.position.x=a.position.x-8*Math.sin(a.rotation.y),r.position.y=6,r.position.z=a.position.z-8*Math.cos(a.rotation.y),r.lookAt(a.position.x,1.5,a.position.z))}if(a&&!P&&!ft.current){const e=Et.current.playerControls,t=.18,n=.12,s=.06;if(e.forward&&(a.position.x+=Math.sin(a.rotation.y)*t,a.position.z+=Math.cos(a.rotation.y)*t),e.back&&(a.position.x-=Math.sin(a.rotation.y)*n,a.position.z-=Math.cos(a.rotation.y)*n),e.left){a.rotation.y+=s;const e=Et.current.vrPlayerRig,t=Et.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y+=s)}if(e.right){a.rotation.y-=s;const e=Et.current.vrPlayerRig,t=Et.current.renderer;t?.xr?.isPresenting&&e&&(e.rotation.y-=s)}en(0),nn(!1);const o=Math.sqrt(Math.pow(a.position.x-Ye,2)+Math.pow(a.position.z-Ze,2));Pt(o<3);const i=Et.current.renderer;i?.xr?.isPresenting||(r.position.x=a.position.x-8*Math.sin(a.rotation.y),r.position.y=6,r.position.z=a.position.z-8*Math.cos(a.rotation.y),r.lookAt(a.position.x+5*Math.sin(a.rotation.y),1.5,a.position.z+5*Math.cos(a.rotation.y)))}const l=.001*Date.now();Et.current.bases.forEach(e=>{e.traverse(e=>{if(e.userData.isBeacon&&(e.material.opacity=.1+.08*Math.sin(2*l)),e.userData.isHalo&&(e.rotation.z+=.005,e.material.opacity=.25+.15*Math.sin(3*l+.5*e.position.y)),e.userData.isPulsingMarker){const t=.4+.4*Math.sin(4*l);e.material.opacity=t,e.scale.setScalar(.8+.3*Math.sin(3*l))}})}),i.render(e,r)});const G=e=>{const t=1===e.key.length?e.key.toLowerCase():e.key;ft.current&&("w"===t&&(Et.current.keyboardControls.forward=!0),"s"===t&&(Et.current.keyboardControls.back=!0),"a"===t&&(Et.current.keyboardControls.left=!0),"d"===t&&(Et.current.keyboardControls.right=!0)," "===e.key&&(e.preventDefault(),Et.current.keyboardControls.up=!0),"Shift"===e.key&&(Et.current.keyboardControls.down=!0),"v"===t&&S(e=>"third"===e?"pov":"pov"===e?"overhead":"third")),ft.current||("w"===t&&(Et.current.keyboardPlayerControls.forward=!0),"s"===t&&(Et.current.keyboardPlayerControls.back=!0),"a"===t&&(Et.current.keyboardPlayerControls.left=!0),"d"===t&&(Et.current.keyboardPlayerControls.right=!0))},U=e=>{const t=1===e.key.length?e.key.toLowerCase():e.key;"w"===t&&(Et.current.keyboardControls.forward=!1),"s"===t&&(Et.current.keyboardControls.back=!1),"a"===t&&(Et.current.keyboardControls.left=!1),"d"===t&&(Et.current.keyboardControls.right=!1)," "===e.key&&(Et.current.keyboardControls.up=!1),"Shift"===e.key&&(Et.current.keyboardControls.down=!1),"w"===t&&(Et.current.keyboardPlayerControls.forward=!1),"s"===t&&(Et.current.keyboardPlayerControls.back=!1),"a"===t&&(Et.current.keyboardPlayerControls.left=!1),"d"===t&&(Et.current.keyboardPlayerControls.right=!1)};window.addEventListener("keydown",G),window.addEventListener("keyup",U);const W=()=>{r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",W),()=>{window.removeEventListener("keydown",G),window.removeEventListener("keyup",U),window.removeEventListener("resize",W),i.setAnimationLoop(null),Et.current.vrButton&&t.current&&t.current.removeChild(Et.current.vrButton),t.current&&i.domElement&&t.current.removeChild(i.domElement),ut.current?.session&&ut.current.endSession()}},[s,w,P,n]),e.useEffect(()=>{if(Q<=0&&P){G(!0),I(!1),u(e=>e+1);const e=Fn(0,0,0,!1,!0);Oe(t=>{const n=Math.max(0,t.xp+e),r=t.rank,s=On(n);if(r.name!==s.name){const e=Bn(r,s,!1);e&&setTimeout(()=>{Ge(e),setTimeout(()=>Ge(null),4e3)},2e3)}return{...t,destroyedPizzas:t.destroyedPizzas+1,xp:n,rank:s}}),ut.current?.isInVR&&(ut.current.triggerHaptic("left",1,300),ut.current.triggerHaptic("right",1,300),setTimeout(()=>{ut.current.triggerHaptic("left",.7,200),ut.current.triggerHaptic("right",.7,200)},350));const t=Et.current.player;t&&Et.current.playerPizza&&(t.remove(Et.current.playerPizza),Et.current.playerPizza=null);const n=q?.price||18.99;a(e=>e-n);let r="";r=n>=49.99?"ü¶û THE LOBSTER PIZZA?! Boss is going to FIRE you!":n>=24.99?"üçÑ A truffle pizza... that's coming out of your paycheck for WEEKS!":n>=21.99?"üëë The Supreme Deluxe! Management wants a word with you...":n<15?`üßÄ Lucky you - it was just ${q?.name||"a cheap one"}!`:q?.description||"That pizza is gone forever!",f(`üíÄ PIZZA DESTROYED! -$${n.toFixed(2)} | ${Math.abs(e)} XP lost! ${r}`)}},[Q,P,q]);const rn=(e,t,n)=>{if("pov"===n){e.position.copy(t.position),e.position.y+=.3,e.position.x+=.2*Math.sin(t.rotation.y),e.position.z+=.2*Math.cos(t.rotation.y);const n=new y(t.position.x+50*Math.sin(t.rotation.y),t.position.y-2,t.position.z+50*Math.cos(t.rotation.y));e.lookAt(n),t.traverse(e=>{e.isMesh&&!e.userData.isRotor&&(e.material.transparent=!0,e.material.opacity=.3)})}else t.traverse(e=>{e.isMesh&&!e.userData.isRotor&&e.material.transparent&&(e.material.transparent=!1,e.material.opacity=1)}),"overhead"===n?(e.position.x=t.position.x,e.position.y=t.position.y+30,e.position.z=t.position.z+5,e.lookAt(t.position)):(e.position.x=t.position.x-12*Math.sin(t.rotation.y),e.position.y=t.position.y+5,e.position.z=t.position.z-12*Math.cos(t.rotation.y),e.lookAt(t.position))},sn=(e,t,n)=>{const r=Et.current.renderer,s=t.vrPlayerRig;if(r?.xr?.isPresenting&&s)if(n&&t.currentDrone){const e=t.currentDrone;s.position.x=e.position.x,s.position.y=e.position.y+.3,s.position.z=e.position.z,e.traverse(e=>{e.isMesh&&!e.userData.isRotor&&(e.userData.originalOpacity||(e.userData.originalOpacity=e.material.opacity||1),e.material.transparent=!0,e.material.opacity=.15)})}else if(t.player){const e=t.player;s.position.x=e.position.x,s.position.y=0,s.position.z=e.position.z,t.drones?.forEach(e=>{e.traverse(e=>{e.isMesh&&void 0!==e.userData.originalOpacity&&(e.material.opacity=e.userData.originalOpacity)})})}},on=e.useCallback(()=>{const e=(()=>{const e=[25,20,15,12,10,8,5,4,1],t=e.reduce((e,t)=>e+t,0);let n=Math.random()*t;for(let r=0;r<e.length;r++)if(n-=e[r],n<=0)return Dn[r];return Dn[0]})(),t=`${Ln[Math.floor(Math.random()*Ln.length)]} ${_n[Math.floor(Math.random()*_n.length)]}`,n={drone:["A","B","C","D"][Math.floor(4*Math.random())],base:[1,2,3,4][Math.floor(4*Math.random())],pizzaType:e,customerName:t};o(n),J(e),r("carrying"),f(`üçï ${e.emoji} ${e.name} ($${e.price.toFixed(2)}) for ${t}! Carry to Drone ${n.drone}`),x(!1),v(null),I(!1),ee(100),ht.current=100,ne({x:0,z:0}),ue(!1),_e(Date.now())},[]);e.useEffect(()=>{mt.current=on},[on]);const an=e.useCallback(()=>{I(!1),ee(100),ht.current=100,ne({x:0,z:0}),nn(!1),Et.current&&(Et.current.sustainedSpeed=0,Et.current.moveAccumulator=0),f(`üçï Walk back to the shop to grab a new pizza for Drone ${s?.drone}!`)},[s]),ln=e.useCallback(()=>{if("carrying"!==n||P)return;const e=Et.current.player;if(e&&Et.current.scene){const t=new Y,n=new ge(.8,.15,.8),r=new F({color:13395507}),s=new $(n,r);s.castShadow=!0,t.add(s);const o=new ye(.35,.35,.05,16),i=new F({color:16763904}),a=new $(o,i);a.position.y=.1,t.add(a);const l=new ye(.05,.05,.02,8),c=new F({color:11149858});for(let e=0;e<8;e++){const n=new $(l,c),r=e/8*Math.PI*2,s=.15+.15*Math.random();n.position.set(Math.cos(r)*s,.13,Math.sin(r)*s),t.add(n)}t.position.set(0,1.2,.6),e.add(t),Et.current.playerPizza=t}I(!0),f(`üçï Carrying pizza! Use WASD to walk carefully to Drone ${s?.drone}. Keep it level!`)},[n,P,s]);e.useEffect(()=>{gt.current=ln},[ln]);const cn=e.useCallback(e=>{if(s&&P)return e!==s.drone?(f(`‚ùå Wrong drone! You need Drone ${s.drone}`),void ee(e=>Math.max(0,e-5))):Q<50?(K(e),void W(!0)):void dn(e)},[s,P,Q]);e.useEffect(()=>{bt.current=cn},[cn]);const dn=e.useCallback(e=>{const t=Et.current.drones.find(t=>t.userData.label===e);if(!t)return;const n=Et.current.player;n&&Et.current.playerPizza&&(n.remove(Et.current.playerPizza),Et.current.playerPizza=null);const o=(()=>{const e=new Y,t=new ge(.8,.15,.8),n=new F({color:ct}),r=new $(t,n);r.castShadow=!0,e.add(r);const s=new ge(.82,.05,.82),o=new F({color:16733525}),i=new $(s,o);i.position.y=.1,e.add(i);const a=new ke(.2,32),l=new H({color:16763904}),c=new $(a,l);return c.rotation.x=-Math.PI/2,c.position.y=.13,e.add(c),e})();o.position.set(0,-.5,0),o.userData.isPizza=!0,t.add(o),t.userData.hasPizza=!0,t.userData.targetBase=s.base,Et.current.currentDrone=t,v(e),I(!1),r("flying"),x(!0),j("ascending"),Ct(null),f("üöÅ TAKEOFF! Hold SPACE to ascend to 10m cruise altitude!")},[s,P,Q]);e.useCallback((e,t)=>{if(!P)return;ne(n=>({x:Math.max(-30,Math.min(30,n.x+2*e-.05*n.x)),z:Math.max(-30,Math.min(30,n.z+2*t-.05*n.z))}));const n=Math.sqrt(te.x**2+te.z**2);n>20&&ee(e=>Math.max(0,e-.05*n))},[P,te]);const pn=e.useCallback(e=>{P&&cn(e)},[P,cn]);e.useEffect(()=>{yt.current=pn},[pn]);const un=e.useCallback(()=>{if(!m||!Et.current.currentDrone||!A)return void(A||f("‚ö†Ô∏è Get closer to the base! Wait for green indicator."));const e=Et.current.currentDrone,t=e.children.find(e=>e.userData.isPizza);if(!t)return void f("‚ùå No pizza attached!");const n=(Date.now()-xe)/1e3,s=Q>=95&&n<45,o=(e=>e<30?{temp:"PIPING HOT",emoji:"üî•üî•üî•",color:"#ff4400",bonus:2,penalty:0}:e<45?{temp:"HOT",emoji:"üî•üî•",color:"#ff6600",bonus:1,penalty:0}:e<60?{temp:"WARM",emoji:"üî•",color:"#ff9900",bonus:.5,penalty:0}:e<90?{temp:"LUKEWARM",emoji:"üòê",color:"#ffcc00",bonus:0,penalty:-.5}:e<120?{temp:"COOL",emoji:"‚ùÑÔ∏è",color:"#66ccff",bonus:0,penalty:-1}:{temp:"COLD",emoji:"ü•∂",color:"#0099ff",bonus:0,penalty:-2})(n),i=q?.price||15.99,l=tr(Q,n),d=((e,t,n,r=15.99,s=null)=>{const o=tr(t,e),i=e>=90,a=t<70,l=t<50;if(t<30)return 0;if(e>=150&&l)return 0;if(o<1.5)return 0;let c=!1;e>=120&&!a&&(c=!0),l&&!i&&(c=!0),i&&a&&!l&&(c=!0);let d=1;const p=t>=97;o>=4.8?(d=2,p&&e<45&&(d=2.5)):o>=4.5?(d=1.7,p&&(d=2)):o>=4?(d=1.4,t>=95&&(d=1.6)):d=o>=3.5?1:o>=3?.7:o>=2.5?.3:o>=2?.1:0;let u=.15*r*d;n&&o>=4.5&&(u+=.15*r,r>=25&&(u+=5),r>=40&&(u+=10)),p&&!n&&e<60&&(u+=2),i&&u>0&&(u=Math.max(.5,.5*u)),c&&u>0&&(u=Math.max(.25,.3*u)),s&&s.tipBonus>0&&u>0&&(u+=u*s.tipBonus);return u>0&&u<.25&&(u=.25),Math.round(100*u)/100})(n,Q,s,i,Ne.rank),p=Fn(l,Q,n,s,!1);e.remove(t),e.userData.hasPizza=!1,ut.current?.isInVR&&(ut.current.triggerHaptic("left",.8,150),ut.current.triggerHaptic("right",.8,150),setTimeout(()=>{ut.current.triggerHaptic("left",.5,100),ut.current.triggerHaptic("right",.5,100)},200)),a(e=>e+d),c(e=>e+1);const u=q?.name||"Plain Cheese";Oe(e=>{const t=Math.max(0,e.xp+p),r=e.rank,o=On(t),a={...e.pizzaTypeDeliveries,[u]:(e.pizzaTypeDeliveries[u]||0)+1},l=s?e.perfectDeliveries+1:e.perfectDeliveries,c=e.totalTips+d,h=e.fastestDelivery?Math.min(e.fastestDelivery,n):n;if(r.name!==o.name){const n=Bn(r,o,t>e.xp);n&&setTimeout(()=>{Ge(n),setTimeout(()=>Ge(null),4e3)},1500)}const f={totalDeliveries:e.totalDeliveries+1,totalEarnings:e.totalEarnings+d,bestTime:e.bestTime?Math.min(e.bestTime,n):n,xp:t,rank:o,pizzaTypeDeliveries:a,perfectDeliveries:l,totalTips:c,fastestDelivery:h,storeEarnings:e.storeEarnings+i,badges:e.badges},m=((e,t=[])=>{const n=[],r=new Set(t.map(e=>e.id));for(const s of Mn)r.has(s.id)||(e.pizzaTypeDeliveries?.[s.pizzaType]||0)>=s.required&&n.push(s);for(const s of Cn)!r.has(s.id)&&e.totalDeliveries>=s.deliveries&&n.push(s);for(const s of jn)!r.has(s.id)&&e.perfectDeliveries>=s.perfectDeliveries&&n.push(s);for(const s of Pn)!r.has(s.id)&&e.fastestDelivery&&e.fastestDelivery<=s.fastestTime&&n.push(s);for(const s of In)!r.has(s.id)&&e.totalTips>=s.totalTips&&n.push(s);return n})(f,e.badges);return m.length>0&&(f.badges=[...e.badges,...m],setTimeout(()=>{Be(m[0]),setTimeout(()=>Be(null),4e3)},2500)),f});const h=((e,t,n,r)=>{const s=e=>e[Math.floor(Math.random()*e.length)];return 0===e?r<30?s(["ü§¨ 'Is this even pizza anymore?! GET OUT!'","üò± 'I ordered a PIZZA, not a CRIME SCENE!'","üò§ 'My grandma could deliver better... with her eyes closed!'","üóëÔ∏è 'I've seen better looking pizzas in the GARBAGE!'","üò§ 'I'm calling your manager, your manager's manager, and the MAYOR!'"]):r<50?s(["üò§ 'This pizza is RUINED! No tip for you!'","ü§Æ 'Did you play SOCCER with my pizza?!'","üò† 'I wanted a pizza, not a PUZZLE!'","üëé 'This is a DISASTER. Never order from here again!'","ü§¶ 'My expectations were low but HOLY...'"]):n>=120?s(["ü•∂ 'An ICE COLD pizza?! Are you kidding me?!'","‚ùÑÔ∏è 'I could have frozen a FRESH pizza faster!'","üßä 'Did you stop for a NAP on the way?!'","‚è∞ 'Did you deliver this by HORSE?!'","üò¥ 'I ordered this pizza LAST WEEK!'"]):n>=90&&r<70?s(["üò† 'Cold AND damaged?! I'm calling the manager!'","ü§Ø 'HOW did you manage to mess up THIS badly?!'","üí¢ 'You had ONE JOB!'","üò§ 'This is insulting. Just... leave.'"]):t<2?s(["üëé 'Worst delivery ever. No tip!'","üö´ 'I'd give you negative stars if I could!'","üòí 'My 5-year-old could do better!'","üí© 'This deserves the poop emoji.'"]):"üòí 'Really? No tip for this disaster.'":s(e<1?["üòê 'I guess... here's some change.'","üôÑ 'It's not GREAT, but here's something.'","üòë 'Consider this a mercy tip.'","üí≠ 'At least you showed up... barely.'"]:e<3?["üôÇ 'It was... okay. Here.'","üòå 'Decent enough. Thanks.'","üëå 'Not bad, not great. Here you go.'","ü§∑ 'Could be worse I guess.'"]:e<5?["üòä 'Not bad! Thanks!'","üëç 'Good job! Appreciate it!'","üòÑ 'Nice delivery! Here you go!'","üôå 'That was quick! Thanks!'"]:e<8?["üòÑ 'Great service! Here you go!'","üåü 'Impressive! Well done!'","üëè 'Now THAT'S how you deliver pizza!'","üî• 'Fast AND fresh! Love it!'"]:e<15?["ü§© 'AMAZING! Best delivery ever! Keep the change!'","ü•≥ 'WOW! You're a LEGEND!'","üíØ 'PERFECTION! You deserve this!'","‚≠ê 'Five stars! Tell your boss you need a raise!'","üòç 'Marry me! Just kidding... unless?'"]:["ü§ë 'INCREDIBLE! Here's a HUGE tip!'","üí∞ 'You just made my WHOLE DAY! Take ALL of this!'","üéâ 'FLAWLESS! I'm telling EVERYONE about you!'","üëë 'You're the KING/QUEEN of pizza delivery!'","üèÜ 'I've NEVER had delivery this good! Here's everything I got!'","üíé 'This is what EXCELLENCE looks like! Legendary tip for you!'"])})(d,l,n,Q),g=Ne.rank?.tipBonus||0;fe({deliveryTime:n,tip:d,pizzaHealth:Q,isPerfect:s,temperature:o,rating:l,tipMessage:h,pizzaType:q,xpChange:p,rankBonus:g,playerRank:Ne.rank}),ue(!0),r("delivered"),x(!1),z(null),R(!1),setTimeout(()=>{e.position.copy(e.userData.homePos),e.rotation.y=0,Et.current.currentDrone=null,Et.current.camera.position.set(0,15,30),Et.current.camera.lookAt(0,0,0)},100)},[m,A,Q,xe]);e.useEffect(()=>{xt.current=un},[un]);const hn=()=>Et.current.currentDrone?{x:Et.current.currentDrone.position.x,z:Et.current.currentDrone.position.z}:null;return $e.jsxs("div",{style:{width:"100%",height:"100vh",position:"relative",overflow:"hidden"},children:[$e.jsx("div",{ref:t,style:{width:"100%",height:"100%"}}),$e.jsx(or,{score:i,pizzasDelivered:l,pizzasDestroyed:d,currentOrder:s,pilotMode:m,cameraView:w,pizzaHealth:Q,playerStats:Ne,dronePosition:hn(),currentPizzaType:q}),m&&$e.jsx(lr,{dronePosition:hn(),targetBase:(()=>{if(!s)return null;const e=Et.current.bases.find(e=>e.userData.baseNumber===s.base);return e?{x:e.position.x,z:e.position.z}:null})(),currentOrder:s,altitude:qt,verticalSpeed:Zt}),m&&$e.jsxs("div",{style:{position:"absolute",top:"240px",right:"20px",width:"220px",background:"ascending"===C?"rgba(255, 165, 0, 0.9)":"descending"===C?"rgba(0, 200, 255, 0.9)":"rgba(0, 200, 0, 0.9)",padding:"10px 15px",borderRadius:"10px",color:"white",fontWeight:"bold",fontSize:"14px",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",border:"2px solid white"},children:[$e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[$e.jsx("span",{style:{fontSize:"20px"},children:"ascending"===C?"üöÄ":"descending"===C?"üìç":"‚úàÔ∏è"}),$e.jsxs("div",{style:{flex:1},children:[$e.jsx("div",{style:{textTransform:"uppercase",letterSpacing:"1px",fontSize:"13px"},children:"ascending"===C?"TAKEOFF":"descending"===C?"LANDING":"CRUISING - FULL CONTROL"}),$e.jsx("div",{style:{fontSize:"10px",opacity:.9},children:"ascending"===C?`Altitude: ${Math.round(qt)}m / 10m`:"descending"===C?`Land on roof (${qt.toFixed(1)}m)`:`Alt: ${qt.toFixed(1)}m`})]})]}),"ascending"===C&&$e.jsx("div",{style:{marginTop:"8px",width:"100%",height:"6px",background:"rgba(0,0,0,0.3)",borderRadius:"3px",overflow:"hidden"},children:$e.jsx("div",{style:{width:`${Math.min(100,qt/10*100)}%`,height:"100%",background:"#fff",transition:"width 0.1s"}})}),$e.jsxs("div",{style:{marginTop:"8px",fontSize:"11px",opacity:.9,display:"flex",justifyContent:"space-between"},children:[$e.jsx("span",{children:"‚¨ÜÔ∏è SPACE = UP"}),$e.jsx("span",{children:"‚¨áÔ∏è SHIFT = DOWN"})]}),$e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:Zt>0?"#00ff00":Zt<0?"#ff6600":"#888"},children:Zt>.5?"‚Üë‚Üë‚Üë ASCENDING":Zt<-.5?"‚Üì‚Üì‚Üì DESCENDING":"‚Äî HOVER"})]}),m&&$e.jsx(cr,{distanceToBase:T,canRelease:A,canDescend:E,horizontalDist:D,altitude:qt}),$e.jsx(dr,{message:h}),re&&$e.jsx(pr,{step:oe,onNext:()=>{oe<Je.length-1?ie(e=>e+1):(se(!1),on())},onSkip:()=>{se(!1),on()}}),pe&&he&&$e.jsx(br,{deliveryTime:he.deliveryTime,tip:he.tip,pizzaHealth:he.pizzaHealth,isPerfect:he.isPerfect,temperature:he.temperature,rating:he.rating,tipMessage:he.tipMessage,pizzaType:he.pizzaType,xpChange:he.xpChange,rankBonus:he.rankBonus,playerRank:he.playerRank,totalDeliveries:l,onNextOrder:()=>{ue(!1),on()},onViewLeaderboard:()=>{ue(!1),le(!0)}}),$e.jsx(fr,{message:He}),$e.jsx(hr,{badge:Fe}),N&&$e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(180, 0, 0, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3,animation:"flashRed 0.5s ease-in-out 3"},children:[$e.jsxs("div",{style:{fontSize:"80px",marginBottom:"20px",animation:"shake 0.5s ease-in-out infinite"},children:[q?.emoji||"üçï","üíÄüí∏"]}),$e.jsx("h1",{style:{color:"white",fontSize:"48px",textShadow:"0 0 20px #ff0000",marginBottom:"10px",textTransform:"uppercase",letterSpacing:"5px"},children:"PIZZA DESTROYED!"}),$e.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"8px 20px",borderRadius:"20px",marginBottom:"10px",fontSize:"18px",color:"#ffcc00"},children:[q?.emoji," ",q?.name||"Pizza"]}),$e.jsxs("p",{style:{color:"#ffcccc",fontSize:"20px",marginBottom:"15px",textAlign:"center",maxWidth:"500px",fontStyle:"italic"},children:['"',q?.description||"That pizza is gone forever!",'"']}),$e.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"15px 30px",borderRadius:"10px",border:"3px solid "+((q?.price||18.99)>25?"#ff0000":"#ff4444"),marginBottom:"20px"},children:[$e.jsx("div",{style:{color:"#ff6666",fontSize:"16px",marginBottom:"5px"},children:"üí∏ CHARGED TO YOUR WAGES:"}),$e.jsxs("div",{style:{color:(q?.price||18.99)>25?"#ff0000":"#ff4444",fontSize:(q?.price||18.99)>25?"42px":"36px",fontWeight:"bold"},children:["-$",(q?.price||18.99).toFixed(2)]}),$e.jsx("div",{style:{color:"#ffaaaa",fontSize:"12px"},children:(q?.price||18.99)>=49.99?"üò± THE MOST EXPENSIVE ONE!":(q?.price||18.99)>=24.99?"üò∞ That was a premium pizza!":(q?.price||18.99)<15?"üòÖ At least it was cheap...":"Full price of destroyed pizza!"})]}),$e.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginBottom:"30px"},children:[$e.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"15px 25px",borderRadius:"10px",color:"white",textAlign:"center"},children:[$e.jsx("div",{style:{fontSize:"14px",opacity:.8},children:"Pizzas Destroyed"}),$e.jsx("div",{style:{fontSize:"36px",fontWeight:"bold"},children:d})]}),$e.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",padding:"15px 25px",borderRadius:"10px",color:i<0?"#ff4444":"#00ff00",textAlign:"center"},children:[$e.jsx("div",{style:{fontSize:"14px",opacity:.8},children:"Total Wages"}),$e.jsx("div",{style:{fontSize:"36px",fontWeight:"bold"},children:i<0?`-$${Math.abs(i).toFixed(2)}`:`$${i.toFixed(2)}`})]})]}),$e.jsxs("div",{style:{display:"flex",gap:"15px"},children:[$e.jsx("button",{onClick:()=>{G(!1),an()},style:{...vr.primary,background:"linear-gradient(180deg, #22aa22 0%, #118811 100%)",fontSize:"20px",padding:"15px 40px"},children:"üçï Try Again"}),$e.jsx("button",{onClick:()=>{G(!1),r("menu"),o(null)},style:{...vr.secondary,fontSize:"20px",padding:"15px 40px"},children:"üè† Back to Menu"})]}),$e.jsx("p",{style:{color:"#ffaaaa",fontSize:"14px",marginTop:"30px",opacity:.7},children:"üí° Tip: Move slowly and keep the pizza box level!"})]}),U&&$e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(180, 100, 0, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3},children:[$e.jsx("div",{style:{fontSize:"80px",marginBottom:"20px"},children:"üçïüò¨üçï"}),$e.jsx("h1",{style:{color:"white",fontSize:"36px",textShadow:"0 0 20px #ff6600",marginBottom:"10px",textAlign:"center"},children:"WAIT... DELIVER THIS?!"}),$e.jsxs("p",{style:{color:"#ffeecc",fontSize:"22px",marginBottom:"10px",textAlign:"center",maxWidth:"500px"},children:["This pizza is only ",$e.jsxs("span",{style:{color:"#ff4444",fontWeight:"bold",fontSize:"28px"},children:[Math.round(Q),"%"]})," intact!"]}),$e.jsxs("p",{style:{color:"#ffcc88",fontSize:"18px",marginBottom:"30px",textAlign:"center",maxWidth:"500px",fontStyle:"italic"},children:['ü§î "Are you SURE you want to deliver this disaster?',$e.jsx("br",{}),"The customer might not tip well... or at all...",$e.jsx("br",{}),'They might even call your manager!"']}),$e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",padding:"15px 30px",borderRadius:"10px",marginBottom:"25px"},children:[$e.jsx("div",{style:{color:"#ffcc00",fontSize:"16px",marginBottom:"5px"},children:"üí∞ Expected Tip Reduction:"}),$e.jsxs("div",{style:{color:"#ff4444",fontSize:"24px",fontWeight:"bold"},children:["-",Math.round(.5*(100-Q)),"% tips! üò¢"]})]}),$e.jsxs("div",{style:{display:"flex",gap:"15px"},children:[$e.jsx("button",{onClick:()=>{W(!1),X&&(dn(X),K(null))},style:{...vr.primary,background:"linear-gradient(180deg, #cc6600 0%, #884400 100%)",fontSize:"18px",padding:"12px 30px"},children:"üòÖ YOLO! Deliver It Anyway"}),$e.jsx("button",{onClick:()=>{W(!1),K(null),an()},style:{...vr.secondary,fontSize:"18px",padding:"12px 30px"},children:"üçï Get Fresh Pizza"})]}),$e.jsx("p",{style:{color:"#ffddaa",fontSize:"12px",marginTop:"20px",opacity:.7},children:"Pro tip: Walk back to the shop for a perfect pizza! üèÉ‚Äç‚ôÇÔ∏è"})]}),$e.jsx(xr,{isOpen:ae,onClose:()=>le(!1),category:ce,onCategoryChange:de,playerRank:42,playerScore:i}),!ae&&!pe&&"menu"!==n&&$e.jsx(yr,{topPlayers:er.fastest_delivery,playerRank:42,onExpand:()=>le(!0)}),$e.jsxs("div",{style:{position:"absolute",bottom:20,left:"50%",transform:"translateX(-50%)",display:"flex",gap:"10px"},children:["menu"===n&&$e.jsxs($e.Fragment,{children:[$e.jsx("button",{onClick:()=>se(!0),style:vr.secondary,children:"üìñ Tutorial"}),$e.jsx("button",{onClick:on,style:vr.primary,children:"üçï Start Delivering!"}),$e.jsx("button",{onClick:()=>le(!0),style:vr.secondary,children:"üèÜ Leaderboards"})]}),"carrying"===n&&!P&&$e.jsx($e.Fragment,{children:jt?$e.jsx("button",{onClick:ln,style:{...vr.primary,animation:"pulse 1s infinite"},children:"üçï Grab Pizza from Shop"}):$e.jsx("div",{style:{color:"white",background:"rgba(0,0,0,0.7)",padding:"10px 20px",borderRadius:"8px"},children:"üè™ Walk to the Pizza Shop! (WASD to move)"})}),"carrying"===n&&P&&$e.jsxs($e.Fragment,{children:[$e.jsxs("div",{style:{color:"white",background:"rgba(0,0,0,0.7)",padding:"10px 20px",borderRadius:"8px",marginRight:"10px"},children:["üçï Walk to Drone ",s?.drone,"! (WASD to move)"]}),Mt&&$e.jsxs("button",{onClick:()=>cn(Mt),style:{...vr.primary,background:Mt===s?.drone?"#22cc22":"#cc8822",animation:Mt===s?.drone?"pulse 0.5s infinite":"none"},children:["üöÅ Load Drone ",Mt,Mt!==s?.drone&&" (Wrong!)"]})]}),"flying"===n&&m&&$e.jsx("button",{onClick:un,style:{...vr.danger,animation:A?"glow 1s infinite":"none"},children:"üì¶ Release Pizza"})]}),P&&$e.jsx(ir,{pizzaHealth:Q,pizzaTilt:te}),P&&$e.jsx(ar,{speed:Qt,isWarning:tn,pizzaHealth:Q}),$e.jsx(mr,{info:It,actions:Sr,bindings:_t,getButtonLabel:Wt,overlayVisible:Bt,onToggleOverlay:()=>{Ht(e=>!e),Ot&&Kt()}}),Bt&&$e.jsx(gr,{info:It,actions:Sr,bindings:_t,getButtonLabel:Wt,pendingBinding:Ot,onStartRemap:Xt,onCancelRemap:Kt,onResetBindings:Vt,onClose:()=>{Ht(!1),Ot&&Kt()}}),m&&$e.jsx(ur,{}),$e.jsx("style",{children:"\n  @keyframes blink {\n    0%, 50% { opacity: 1; }\n    51%, 100% { opacity: 0.3; }\n  }\n  \n  @keyframes pulse {\n    0%, 100% { transform: translate(-50%, -50%) scale(1); }\n    50% { transform: translate(-50%, -50%) scale(1.2); }\n  }\n  \n  @keyframes popIn {\n    0% { transform: scale(0.8); opacity: 0; }\n    100% { transform: scale(1); opacity: 1; }\n  }\n  \n  @keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    25% { transform: translateX(-5px); }\n    75% { transform: translateX(5px); }\n  }\n  \n  @keyframes glow {\n    0%, 100% { box-shadow: 0 0 5px #00ff00; }\n    50% { box-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00; }\n  }\n  \n  @keyframes slideIn {\n    0% { transform: translateY(-100%); opacity: 0; }\n    100% { transform: translateY(0); opacity: 1; }\n  }\n  \n  @keyframes fadeIn {\n    0% { opacity: 0; }\n    100% { opacity: 1; }\n  }\n  \n  @keyframes bounce {\n    0%, 100% { transform: translateY(0); }\n    50% { transform: translateY(-10px); }\n  }\n  \n  @keyframes rotate {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n  \n  @keyframes warning {\n    0%, 100% { background-color: rgba(255, 0, 0, 0.2); }\n    50% { background-color: rgba(255, 0, 0, 0.5); }\n  }\n  \n  .game-button {\n    transition: all 0.2s ease;\n  }\n  \n  .game-button:hover {\n    transform: scale(1.05);\n    box-shadow: 0 6px 12px rgba(0,0,0,0.4);\n  }\n  \n  .game-button:active {\n    transform: scale(0.98);\n  }\n"})]})};function Ar(){return $e.jsx("div",{className:"App",children:$e.jsx(zr,{})})}Ve.createRoot(document.getElementById("root")).render($e.jsx(n.StrictMode,{children:$e.jsx(Ar,{})}));
